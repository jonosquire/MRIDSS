(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[    782398,      19388]
NotebookOptionsPosition[    774878,      19135]
NotebookOutlinePosition[    775233,      19151]
CellTagsIndexPosition[    775190,      19148]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Generate c++ equations", "Title",
 CellChangeTimes->{{3.613285659385439*^9, 3.613285672183166*^9}}],

Cell["\<\
A notebook to automatically generate the complex equations (in c++ syntax) \
required for CE2 implementations of the shearing box MHD equations\
\>", "Subtitle",
 CellChangeTimes->{{3.613285678399642*^9, 3.6132857387259073`*^9}}],

Cell[CellGroupData[{

Cell["Initialization", "Section",
 InitializationGroup->True,
 CellChangeTimes->{{3.61328575477813*^9, 3.6132857579772587`*^9}, {
  3.613289305138309*^9, 3.6132893099360237`*^9}}],

Cell[CellGroupData[{

Cell["Load packages, set notation, define derivative operators", \
"Subsubsection",
 InitializationGroup->True,
 CellChangeTimes->{{3.61328647880902*^9, 3.6132864845926*^9}, {
  3.61328657764961*^9, 3.613286579073427*^9}, {3.614183666778463*^9, 
  3.614183671737118*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Load", " ", "Notation"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "Notation`AutoLoadNotationPalette", "}"}], ",", "\n", "\t", 
     
     RowBox[{
      RowBox[{"Notation`AutoLoadNotationPalette", "=", "False"}], ";", "\n", 
      "\t", 
      RowBox[{"Needs", "[", "\"\<Notation`\>\"", "]"}], ";"}]}], "\n", "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{OverscriptBox["\[Nu]", "\[Dash]"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"\[Nu]b"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{OverscriptBox["\[Eta]", "\[LongDash]"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"\[Eta]b"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SuperscriptBox[
         SubscriptBox["\[EmptyUpTriangle]", "2"], 
         RowBox[{"-", "1"}]]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"iLap2"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SuperscriptBox[
         SubscriptBox["\[EmptyUpTriangle]", "F"], 
         RowBox[{"-", "1"}]]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"iLapF"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Notation", "[", 
    RowBox[{
     TemplateBox[{SuperscriptBox[
        SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
        RowBox[{"-", "1"}]]},
      "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
     TemplateBox[{"iLapFColl"},
      "NotationTemplateTag"]}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["\[PartialD]", "z"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"dz"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["\[PartialD]", "t"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"dt"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SuperscriptBox[
         SubscriptBox["\[ScriptCapitalR]", "x"], "B"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"ReyBx"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SuperscriptBox[
         SubscriptBox["\[ScriptCapitalR]", "y"], "B"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"ReyBy"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["B", "x"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"Bx"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["B", "y"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"By"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["B", "z0"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"B0z"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["k", "y"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"ky"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["k", "x"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"kx"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"kxb"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["\[CapitalXi]", "R"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"ROT"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{"\[SmallCircle]"},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"ph"},
       "NotationTemplateTag"]}], "]"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Place", "-", 
     RowBox[{
     "holder", " ", "for", " ", "the", " ", "operator", " ", "matrix"}]}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"C", " ", "matrix"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["\[ScriptCapitalC]", 
         RowBox[{"a_", "\[InvisibleComma]", "b_"}]]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{RowBox[{"Cm", "[", 
          RowBox[{"a_", ",", "b_"}], "]"}]},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Conjugates", " ", 
     RowBox[{"(", 
      RowBox[{"for", " ", "Reynolds", " ", "stress"}], ")"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SuperscriptBox["a_", "*"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{RowBox[{"conj", "[", "a_", "]"}]},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "Cpp", " ", "variable", " ", "in", " ", "calculated", " ", "products"}], 
     " ", "-", " ", 
     RowBox[{
     "list", " ", "of", " ", "rules", " ", "used", " ", "in", " ", 
      "convertProdToString"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"convertProdToStringVariableRules", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"\[CapitalOmega]", "\[Rule]", "Om"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "iLapF", ",", " ", "iLap2", ",", " ", "dz", ",", " ", "dt", ",", " ", 
     "properties"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "iLap2"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLap2", "[", 
      RowBox[{"a_", "+", "b_"}], "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"iLap2", "[", "a", "]"}], "+", " ", 
      RowBox[{"iLap2", "[", "b", "]"}]}]}], ";", " ", 
    RowBox[{"(*", "Linear", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"iLap2", "[", 
      RowBox[{
       RowBox[{"c_", "?", "NumericQ"}], " ", "a_"}], "]"}], ":=", 
     RowBox[{"c", " ", 
      RowBox[{"iLap2", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Commutes", " ", "with", " ", "derivatives"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLap2", "[", 
      RowBox[{
       RowBox[{"kxb", "^", "n_."}], "  ", "a_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"kxb", "^", "n"}], " ", 
      RowBox[{"iLap2", "[", "a", "]"}]}]}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Put", " ", "down", " ", "ks", " ", "explicitly", " ", "for", " ", 
      "security"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"iLap2", "[", 
      RowBox[{
       RowBox[{"ky", "^", "n_."}], "  ", "a_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"ky", "^", "n"}], " ", 
      RowBox[{"iLap2", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLap2", "[", 
      RowBox[{"q", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"q", " ", 
      RowBox[{"iLap2", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLap2", "[", 
      RowBox[{"S", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"S", " ", 
      RowBox[{"iLap2", "[", "a", "]"}]}]}], " ", ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLap2", "[", 
      RowBox[{"ROT", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"ROT", " ", 
      RowBox[{"iLap2", "[", "a", "]"}]}]}], " ", ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLap2", "[", 
      RowBox[{"\[CapitalOmega]", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"\[CapitalOmega]", " ", 
      RowBox[{"iLap2", "[", "a", "]"}]}]}], " ", ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLap2", "[", 
      RowBox[{"B0z", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"B0z", " ", 
      RowBox[{"iLap2", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLap2", "[", 
      RowBox[{"dz", "[", "a_", "]"}], "]"}], ":=", 
     RowBox[{"dz", "[", 
      RowBox[{"iLap2", "[", "a", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "dz"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dz", "[", 
      RowBox[{"a_", "+", "b_"}], "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"dz", "[", "a", "]"}], "+", " ", 
      RowBox[{"dz", "[", "b", "]"}]}]}], ";", " ", 
    RowBox[{"(*", "Linear", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"dz", "[", 
      RowBox[{
       RowBox[{"c_", "?", "NumericQ"}], " ", "a_"}], "]"}], ":=", 
     RowBox[{"c", " ", 
      RowBox[{"dz", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Commutes", " ", "with", " ", "derivatives"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dz", "[", 
      RowBox[{
       RowBox[{"kxb", "^", "n_."}], "  ", "a_"}], "]"}], ":=", 
     RowBox[{
      SuperscriptBox["kxb", "n"], " ", 
      RowBox[{"dz", "[", "a", "]"}]}]}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Put", " ", "down", " ", "ks", " ", "explicitly", " ", "for", " ", 
      "security"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"dz", "[", 
      RowBox[{
       RowBox[{"ky", "^", "n_."}], "  ", "a_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"ky", "^", "n"}], " ", 
      RowBox[{"dz", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dz", "[", 
      RowBox[{"q", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"q", " ", 
      RowBox[{"dz", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dz", "[", 
      RowBox[{"\[CapitalOmega]", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"\[CapitalOmega]", " ", 
      RowBox[{"dz", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dz", "[", 
      RowBox[{"S", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"S", " ", 
      RowBox[{"dz", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dz", "[", 
      RowBox[{"ROT", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"ROT", " ", 
      RowBox[{"dz", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dz", "[", 
      RowBox[{"B0z", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"B0z", " ", 
      RowBox[{"dz", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dz", "[", "0", "]"}], ":=", "0"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Product", " ", 
     RowBox[{"rule", " ", "--"}], " ", "could", " ", "add", " ", "this"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "dt"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{"a_", "+", "b_"}], "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"dt", "[", "a", "]"}], "+", " ", 
      RowBox[{"dt", "[", "b", "]"}]}]}], ";", " ", 
    RowBox[{"(*", "Linear", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{
       RowBox[{"c_", "?", "NumericQ"}], " ", "a_"}], "]"}], ":=", 
     RowBox[{"c", " ", 
      RowBox[{"dt", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Commutes", " ", "with", " ", "derivatives"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{"kxb", "  ", "a_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"q", " ", "ky", " ", "a"}], "+", " ", 
      RowBox[{"kxb", " ", 
       RowBox[{"dt", "[", "a", "]"}]}]}]}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Put", " ", "down", " ", "ks", " ", "explicitly", " ", "for", " ", 
      "security"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{
       RowBox[{"ky", "^", "n_."}], "  ", "a_"}], "]"}], ":=", 
     RowBox[{
      SuperscriptBox["ky", "n"], " ", 
      RowBox[{"dt", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{"q", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"q", " ", 
      RowBox[{"dt", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{"\[CapitalOmega]", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"\[CapitalOmega]", " ", 
      RowBox[{"dt", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{"S", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"S", " ", 
      RowBox[{"dt", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{"ROT", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"ROT", " ", 
      RowBox[{"dt", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{"B0z", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"B0z", " ", 
      RowBox[{"dt", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Goes", " ", "inside", " ", "iLap2", " ", "and", " ", "dz"}], " ",
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{"dz", "[", "a_", "]"}], "]"}], ":=", 
     RowBox[{"dz", "[", 
      RowBox[{"dt", "[", "a", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{"iLap2", "[", "a_", "]"}], "]"}], ":=", 
     RowBox[{"iLap2", "[", 
      RowBox[{"dt", "[", "a", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "iLapF"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLapF", "[", 
      RowBox[{"a_", "+", "b_"}], "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"iLapF", "[", "a", "]"}], "+", " ", 
      RowBox[{"iLapF", "[", "b", "]"}]}]}], ";", " ", 
    RowBox[{"(*", "Linear", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"iLapF", "[", 
      RowBox[{
       RowBox[{"c_", "?", "NumericQ"}], " ", "a_"}], "]"}], ":=", 
     RowBox[{"c", " ", 
      RowBox[{"iLapF", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Commutes", " ", "with", " ", "derivatives"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLapF", "[", 
      RowBox[{
       RowBox[{"kxb", "^", "n_."}], "  ", "a_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"kxb", "^", "n"}], " ", 
      RowBox[{"iLapF", "[", "a", "]"}]}]}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Put", " ", "down", " ", "ks", " ", "explicitly", " ", "for", " ", 
      "security"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"iLapF", "[", 
      RowBox[{
       RowBox[{"ky", "^", "n_."}], "  ", "a_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"ky", "^", "n"}], " ", 
      RowBox[{"iLapF", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLapF", "[", 
      RowBox[{"q", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"q", " ", 
      RowBox[{"iLapF", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLapF", "[", 
      RowBox[{"\[CapitalOmega]", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"\[CapitalOmega]", " ", 
      RowBox[{"iLapF", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLapF", "[", 
      RowBox[{"S", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"S", " ", 
      RowBox[{"iLapF", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLapF", "[", 
      RowBox[{"ROT", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"ROT", " ", 
      RowBox[{"iLapF", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLapF", "[", 
      RowBox[{"B0z", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"B0z", " ", 
      RowBox[{"iLapF", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Another", " ", "version", " ", "of", " ", "iLapF", " ", "to", " ", 
     "easily", " ", "collect", " ", "together", " ", "different", " ", 
     "terms"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "iLapFColl"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"iLapFColl", "/:", 
     RowBox[{
      RowBox[{"c_", "?", "NumericQ"}], "  ", 
      RowBox[{"iLapFColl", "[", "a_", "]"}]}], ":=", " ", 
     RowBox[{"iLapFColl", "[", 
      RowBox[{"c", " ", "a"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"iLapFColl", "/:", 
     RowBox[{
      RowBox[{"iLapFColl", "[", "a_", "]"}], "+", " ", 
      RowBox[{"iLapFColl", "[", "b_", "]"}]}], ":=", 
     RowBox[{"iLapFColl", "[", 
      RowBox[{"a", "+", "b"}], "]"}]}], ";", " ", 
    RowBox[{"(*", "Linear", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"iLapFColl", "/:", 
     RowBox[{
      RowBox[{"kxb", "^", "n_."}], 
      RowBox[{"iLapFColl", "[", "a_", "]"}]}], ":=", 
     RowBox[{"iLapFColl", "[", 
      RowBox[{
       RowBox[{"kxb", "^", "n"}], "  ", "a"}], "]"}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"iLapFColl", "/:", 
    RowBox[{
     RowBox[{"ky", "^", "n_."}], 
     RowBox[{"iLapFColl", "[", "a_", "]"}]}], ":=", 
    RowBox[{"iLapFColl", "[", 
     RowBox[{
      RowBox[{"ky", "^", "n"}], "  ", "a"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"iLapFColl", "/:", 
    RowBox[{
     RowBox[{"q", "^", "n_."}], 
     RowBox[{"iLapFColl", "[", "a_", "]"}]}], ":=", 
    RowBox[{"iLapFColl", "[", 
     RowBox[{
      RowBox[{"q", "^", "n"}], "  ", "a"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"iLapFColl", "/:", 
    RowBox[{
     RowBox[{"S", "^", "n_."}], 
     RowBox[{"iLapFColl", "[", "a_", "]"}]}], ":=", 
    RowBox[{"iLapFColl", "[", 
     RowBox[{
      RowBox[{"S", "^", "n"}], "  ", "a"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"iLapFColl", "/:", 
    RowBox[{
     RowBox[{"ROT", "^", "n_."}], 
     RowBox[{"iLapFColl", "[", "a_", "]"}]}], ":=", 
    RowBox[{"iLapFColl", "[", 
     RowBox[{
      RowBox[{"ROT", "^", "n"}], "  ", "a"}], "]"}]}], "\[IndentingNewLine]", 
   
   RowBox[{"iLapFColl", "/:", 
    RowBox[{
     RowBox[{"\[CapitalOmega]", "^", "n_."}], 
     RowBox[{"iLapFColl", "[", "a_", "]"}]}], ":=", 
    RowBox[{"iLapFColl", "[", 
     RowBox[{
      RowBox[{"\[CapitalOmega]", "^", "n"}], "  ", "a"}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"iLapFColl", "/:", 
    RowBox[{
     RowBox[{"B0z", "^", "n_."}], 
     RowBox[{"iLapFColl", "[", "a_", "]"}]}], ":=", 
    RowBox[{"iLapFColl", "[", 
     RowBox[{
      RowBox[{"B0z", "^", "n"}], "  ", "a"}], "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]"}]}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.613286581090721*^9, 3.613286689545772*^9}, {
   3.613286889064035*^9, 3.613286908104281*^9}, {3.6132869482086487`*^9, 
   3.613287077374654*^9}, {3.613287138618946*^9, 3.613287140299769*^9}, {
   3.613287639148213*^9, 3.61328770120146*^9}, {3.613287743803678*^9, 
   3.613287773644068*^9}, {3.613288296843178*^9, 3.6132883066816053`*^9}, {
   3.613289870472352*^9, 3.6132898912000837`*^9}, {3.61328995953846*^9, 
   3.613290012328433*^9}, {3.613290091978758*^9, 3.613290110587739*^9}, {
   3.613291002983233*^9, 3.613291016787397*^9}, {3.613291128786306*^9, 
   3.613291140328432*^9}, {3.613291418191675*^9, 3.6132914298902397`*^9}, {
   3.613291787958507*^9, 3.613291883632246*^9}, {3.6132919180813*^9, 
   3.613291942156289*^9}, {3.613292008007991*^9, 3.613292106813635*^9}, {
   3.613293045356043*^9, 3.6132930675783167`*^9}, 3.613293376925857*^9, 
   3.613294621138084*^9, {3.613294694017054*^9, 3.6132947784060097`*^9}, {
   3.613294902803031*^9, 3.6132949806439133`*^9}, 3.6132950396930437`*^9, {
   3.613295346076227*^9, 3.613295481543404*^9}, {3.6132960472516212`*^9, 
   3.613296061097188*^9}, {3.6132961003100023`*^9, 3.613296118980667*^9}, {
   3.613297482407709*^9, 3.6132974934385366`*^9}, {3.613300728518897*^9, 
   3.613300783695135*^9}, {3.613304633293589*^9, 3.613304670793342*^9}, {
   3.613305007338643*^9, 3.613305011424444*^9}, {3.613305054166004*^9, 
   3.613305169291284*^9}, {3.6133262584563932`*^9, 3.613326328142644*^9}, {
   3.613327278627614*^9, 3.613327286046043*^9}, {3.613327328030073*^9, 
   3.613327350931031*^9}, {3.613327392030846*^9, 3.613327432040532*^9}, {
   3.6133292064048977`*^9, 3.613329250947644*^9}, {3.614183755836158*^9, 
   3.614183884767324*^9}, {3.614184743932043*^9, 3.614184895192746*^9}, {
   3.614185078050617*^9, 3.614185081522999*^9}, {3.6141859311896067`*^9, 
   3.614185935756172*^9}, {3.614967885563236*^9, 3.614967917730885*^9}, {
   3.6279382896362963`*^9, 3.627938343549141*^9}, {3.627939311504363*^9, 
   3.627939332185066*^9}, {3.627939498501274*^9, 3.627939551133116*^9}, {
   3.633266145883918*^9, 3.633266236726774*^9}, {3.653923137901127*^9, 
   3.6539232715557137`*^9}, {3.65392949457518*^9, 3.65392953781609*^9}, {
   3.6539297416846447`*^9, 3.653929794535932*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Full incompressible nonlinear equations", "Subsubsection",
 InitializationGroup->True,
 CellChangeTimes->{{3.613285885535736*^9, 3.613285889538149*^9}, {
  3.613286361952444*^9, 3.613286368230513*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Standard", " ", "equations"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"xtv", "=", 
     RowBox[{"{", 
      RowBox[{"x", ",", "y", ",", "z", ",", "t"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xv", "=", 
     RowBox[{"{", 
      RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fullNLvars", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
      "ux", ",", "uy", ",", "uz", ",", "bx", ",", "by", ",", "bz", ",", "p"}],
       "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"momeqn", ",", "adveqn", ",", "uv", ",", "Bv"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"uv", " ", "=", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{
           RowBox[{"-", "q"}], " ", "x"}], ",", "0"}], "}"}], "+", 
        RowBox[{"Through", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ux", ",", "uy", ",", "uz"}], "}"}], "@@", "xtv"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Bv", " ", "=", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "B0z"}], "}"}], "+", 
        RowBox[{"Through", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"bx", ",", "by", ",", "bz"}], "}"}], "@@", "xtv"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"momeqn", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"uv", ",", "t"}], "]"}], "+", 
          RowBox[{
           RowBox[{"Grad", "[", 
            RowBox[{"uv", ",", "xv"}], "]"}], ".", "uv"}], "+", 
          RowBox[{"2", " ", "\[CapitalOmega]", " ", 
           RowBox[{"Cross", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", "uv"}], 
            "]"}]}]}], "\[Equal]", 
         RowBox[{
          RowBox[{"-", " ", 
           RowBox[{"Grad", "[", 
            RowBox[{
             RowBox[{"p", "@@", "xtv"}], ",", "xv"}], "]"}]}], "+", 
          RowBox[{"(", " ", 
           RowBox[{
            RowBox[{"Grad", "[", 
             RowBox[{"Bv", ",", "xv"}], "]"}], ".", "Bv"}], ")"}], "+", 
          RowBox[{"2", "  ", "q", " ", "x", " ", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "+", 
          RowBox[{"\[Nu]b", " ", 
           RowBox[{"Laplacian", "[", 
            RowBox[{"uv", ",", "xv"}], "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"adveqn", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{"Bv", ",", "t"}], "]"}], "\[Equal]", 
           RowBox[{
            RowBox[{"Curl", "[", 
             RowBox[{
              RowBox[{"Cross", "[", 
               RowBox[{"uv", ",", "Bv"}], "]"}], ",", "xv"}], "]"}], "+", 
            RowBox[{
             RowBox[{"1", "/", "ReB"}], " ", 
             RowBox[{"Laplacian", "[", 
              RowBox[{"Bv", ",", "xv"}], "]"}]}]}]}], "]"}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"adveqn", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Bv", ",", "t"}], "]"}], "+", 
          RowBox[{
           RowBox[{"Grad", "[", 
            RowBox[{"Bv", ",", "xv"}], "]"}], ".", "uv"}]}], "==", 
         RowBox[{
          RowBox[{
           RowBox[{"Grad", "[", 
            RowBox[{"uv", ",", "xv"}], "]"}], ".", "Bv"}], "+", 
          RowBox[{"\[Eta]b", " ", 
           RowBox[{"Laplacian", "[", 
            RowBox[{"Bv", ",", "xv"}], "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fullNLeqns", " ", "=", " ", 
       RowBox[{"Subtract", "@@@", 
        RowBox[{"Join", "[", 
         RowBox[{"momeqn", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Div", "[", 
             RowBox[{"uv", ",", "xv"}], "]"}], "\[Equal]", "0"}], "}"}], ",", 
          "adveqn", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Div", "[", 
             RowBox[{"Bv", ",", "xv"}], "]"}], "\[Equal]", "0"}], "}"}]}], 
         "]"}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Translation", " ", "to", " ", "Orr"}], "-", 
     RowBox[{"Somerfeld", " ", "variables"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"toOrrSomerVars", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ux", "\[Rule]", "u"}], ",", "\[IndentingNewLine]", 
       RowBox[{"uy", "\[Rule]", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"z", ",", "t"}], "}"}], ",", 
          RowBox[{"iLap2", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "kxb"}], " ", "ky", " ", 
             RowBox[{"u", "[", 
              RowBox[{"z", ",", "t"}], "]"}]}], "+", 
            RowBox[{"dz", "[", 
             RowBox[{"\[Zeta]", "[", 
              RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "  ", "]"}]}],
        ",", "\[IndentingNewLine]", 
       RowBox[{"uz", "\[Rule]", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"z", ",", "t"}], "}"}], ",", 
          RowBox[{"iLap2", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "kxb"}], " ", 
             RowBox[{"dz", "[", 
              RowBox[{"u", "[", 
               RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "-", 
            RowBox[{"ky", " ", 
             RowBox[{"\[Zeta]", "[", 
              RowBox[{"z", ",", "t"}], "]"}]}]}], "]"}]}], "  ", "]"}]}], ",",
        "\[IndentingNewLine]", 
       RowBox[{"bx", "\[Rule]", "b"}], ",", "\[IndentingNewLine]", 
       RowBox[{"by", "\[Rule]", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"z", ",", "t"}], "}"}], ",", 
          RowBox[{"iLap2", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "kxb"}], " ", "ky", " ", 
             RowBox[{"b", "[", 
              RowBox[{"z", ",", "t"}], "]"}]}], "+", 
            RowBox[{"dz", "[", 
             RowBox[{"\[Eta]", "[", 
              RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "  ", "]"}]}],
        ",", "\[IndentingNewLine]", 
       RowBox[{"bz", "\[Rule]", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"z", ",", "t"}], "}"}], ",", 
          RowBox[{"iLap2", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "kxb"}], " ", 
             RowBox[{"dz", "[", 
              RowBox[{"b", "[", 
               RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "-", 
            RowBox[{"ky", " ", 
             RowBox[{"\[Eta]", "[", 
              RowBox[{"z", ",", "t"}], "]"}]}]}], "]"}]}], "  ", "]"}]}]}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]"}]}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.6132862687853317`*^9, 3.613286292131226*^9}, {
   3.613286330331258*^9, 3.613286331235854*^9}, {3.613286373825049*^9, 
   3.613286475100573*^9}, {3.613286523742776*^9, 3.613286574022657*^9}, {
   3.6132867177659683`*^9, 3.613286844785708*^9}, {3.6132873426960707`*^9, 
   3.613287392767021*^9}, {3.613287431872316*^9, 3.613287444161961*^9}, {
   3.61328749525042*^9, 3.6132874981609697`*^9}, 3.6132875535430107`*^9, {
   3.613287602021194*^9, 3.613287632745328*^9}, {3.613287713936445*^9, 
   3.61328773864904*^9}, {3.6132877787380657`*^9, 3.613288005757513*^9}, {
   3.613288060071485*^9, 3.6132881345693483`*^9}, {3.613288346385255*^9, 
   3.6132883794041157`*^9}, {3.613288504050708*^9, 3.6132885207745028`*^9}, {
   3.6132887600893497`*^9, 3.613288768182979*^9}, {3.6132888149004593`*^9, 
   3.613288846333804*^9}, {3.613291099035706*^9, 3.613291118427603*^9}, {
   3.613291553896966*^9, 3.6132916298613873`*^9}, {3.613291661000248*^9, 
   3.6132917251562147`*^9}, {3.613294580957465*^9, 3.613294612091785*^9}, {
   3.6279381730952253`*^9, 3.6279381759014683`*^9}, {3.6279382155669518`*^9, 
   3.627938220060636*^9}, {3.6279395702051783`*^9, 3.627939571972641*^9}, 
   3.6304427625143547`*^9, {3.6304432022377787`*^9, 3.630443204297186*^9}, 
   3.630443326541299*^9, 3.630443365345359*^9, {3.63044353840036*^9, 
   3.630443565784807*^9}, 3.633265600357808*^9, 3.6332659335568533`*^9, {
   3.633265983826993*^9, 3.63326598489123*^9}, {3.6539219354289227`*^9, 
   3.653921936071176*^9}, {3.653921980563875*^9, 3.653921997792684*^9}, {
   3.653922076337801*^9, 3.653922085520666*^9}, {3.653922201046527*^9, 
   3.6539222033590803`*^9}, {3.653933887170446*^9, 3.653933889592629*^9}}],

Cell["\<\
Generate rules to cancel iLap2 with kz and ky -- This \
doesn\[CloseCurlyQuote]t manage (ky^2+kz^2)^2 *iLap2^2 but only in diffusion?
Also, write down rule for iLapF\
\>", "Text",
 CellChangeTimes->{{3.613300877715733*^9, 3.613300900090197*^9}, {
  3.613301616734581*^9, 3.613301651038678*^9}, {3.613305186229371*^9, 
  3.6133052083324423`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"baseExplicitLap2Rule", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"dz", "[", 
      RowBox[{"dz", "[", 
       RowBox[{"iLap2", "[", "f_", "]"}], "]"}], "]"}], "+", 
     RowBox[{
      RowBox[{"ky", "^", "2"}], " ", 
      RowBox[{"iLap2", "[", "f_", "]"}]}]}], "\[RuleDelayed]", " ", "f"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"order", "=", "2"}], ",", "combinations", ",", "r2l", ",", 
      "l2r", ",", "kyf", ",", "baseRule", ",", "operateOnRule"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Operates", " ", "with", " ", "dz", " ", "and", " ", "ky", " ", "to", 
      " ", "generalize", " ", "rule"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Generate", " ", "the", " ", "possible", " ", "combinations"}], 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"r2l", " ", "=", " ", 
      RowBox[{"RuleDelayed", "\[Rule]", "List"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"l2r", " ", "=", " ", 
      RowBox[{"List", "\[Rule]", "RuleDelayed"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"kyf", " ", "=", " ", 
      RowBox[{
       RowBox[{"ky", " ", "#"}], "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"combinations", "=", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"Tuples", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", "order"}], "]"}], ",", "2"}], "]"}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a_", ",", "b_"}], "}"}], "/;", 
         RowBox[{
          RowBox[{"a", "+", "b"}], "\[LessEqual]", "order"}]}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"combinations", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ConstantArray", "[", 
            RowBox[{"dz", ",", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            "]"}], ",", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"kyf", ",", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            "]"}]}], "}"}], "]"}], "&"}], "/@", "combinations"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
      "combinations", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
      " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"#", "&"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Function", " ", "to", " ", "operate", " ", "on", " ", "both", " ", 
       "sides", " ", "of", " ", "base", " ", "rule", " ", "with", " ", "a", 
       " ", "chosen", " ", "function"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"baseRule", "=", 
      RowBox[{"baseExplicitLap2Rule", "/.", "r2l"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"operateOnRule", " ", "=", " ", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"rule", ",", "func"}], "}"}], ",", 
        RowBox[{"(*", " ", 
         RowBox[{
         "func", " ", "is", " ", "function", " ", "with", " ", "which", " ", 
          "to", " ", "operate", " ", "of", " ", "each", " ", "side"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Evaluate", "/@", 
         RowBox[{"Expand", "/@", 
          RowBox[{"func", "/@", "rule"}]}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"explicitLap2Rule", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "/.", "l2r"}], "&"}], "/@", 
       RowBox[{"Expand", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"c_.", ",", "c"}], "}"}], " ", "#"}], "&"}], "/@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Fold", "[", 
             RowBox[{"operateOnRule", ",", "baseRule", ",", "#"}], "]"}], 
            "&"}], "/@", "combinations"}], ")"}]}], "]"}]}]}], ";"}]}], 
   "\[IndentingNewLine]", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"explicitLapFRule", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"iLapF", "[", 
      RowBox[{
       RowBox[{"kxb", "^", "2"}], " ", "f_"}], "]"}], "+", 
     RowBox[{"iLapF", "[", 
      RowBox[{
       RowBox[{"ky", "^", "2"}], " ", "f_"}], "]"}], "+", 
     RowBox[{"iLapF", "[", 
      RowBox[{"dz", "[", 
       RowBox[{"dz", "[", "f_", "]"}], "]"}], "]"}]}], "\[RuleDelayed]", 
    "f"}]}], ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.613301578032633*^9, 3.613301578138397*^9}, {
  3.6133016143342333`*^9, 3.613301614494217*^9}, {3.613305212858172*^9, 
  3.6133052855307627`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Useful functions", "Subsubsection",
 CellChangeTimes->{{3.613289315465055*^9, 3.613289319164629*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Better", " ", "version", " ", "of", " ", "linearize"}], ",", " ", 
    RowBox[{
    "works", " ", "on", " ", "expressions", " ", "in", " ", "denominator", 
     " ", "and", " ", "multiple", " ", "variables"}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"Remove", "[", "linearize", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"linearize", "[", 
     RowBox[{"expr_", ",", "vars_List", ",", "indvars_List"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"dlist", ",", "fullvars", ",", "t"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"create", " ", "full", " ", "list"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dlist", "=", 
        RowBox[{"Permutations", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"indvars", ",", "4"}], "]"}], "]"}], ",", "4"}], "]"}]}], 
       ";", 
       RowBox[{"fullvars", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{
             RowBox[{"Through", "[", 
              RowBox[{"vars", "@@", "indvars"}], "]"}], ",", 
             RowBox[{"Sequence", "@@", "#"}]}], "]"}], "&"}], "/@", "dlist"}],
          "]"}]}], ";", 
       RowBox[{"Expand", "[", 
        RowBox[{
         RowBox[{"Normal", "[", 
          RowBox[{"Series", "[", 
           RowBox[{
            RowBox[{"expr", "/.", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "->", 
                 RowBox[{"t", " ", "#"}]}], "&"}], "/@", "fullvars"}], 
              ")"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"t", ",", "0", ",", "1"}], "}"}]}], "]"}], "]"}], "/.", 
         RowBox[{"t", "->", "1"}]}], "]"}]}]}], "\n", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "plusToList"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"plusToList", "::", "unrecExpr"}], " ", "=", " ", 
     "\"\<Warning: head is not Times, Plus or Symbol\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"plusToList", "[", "expr_", "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "expr", "]"}], "===", "Plus"}], ",", " ", 
       RowBox[{"List", "@@", "expr"}], ",", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "expr", "]"}], "===", "Times"}], " ", "||", 
          RowBox[{
           RowBox[{"Head", "[", "expr", "]"}], "===", "Symbol"}]}], ",", 
         RowBox[{"{", "expr", "}"}], ",", " ", 
         RowBox[{"Message", "[", 
          RowBox[{"plusToList", "::", "unrecExpr"}], "]"}]}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "MapMatrix"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MapMatrix", "[", 
     RowBox[{"f_", ",", "list_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Map", "[", 
     RowBox[{"f", ",", "list", ",", 
      RowBox[{"{", "2", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Convert", " ", "products", " ", "of", " ", "terms", " ", "to", " ", "a", 
     " ", "string", " ", "that", " ", "can", " ", "be", " ", "used", " ", 
     "as", " ", "a", " ", "variable", " ", "in", " ", 
     RowBox[{"c", "++"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "convertProdToString"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"convertProdToString", "[", "term_", "]"}], ":=", 
    RowBox[{"StringReplace", "[", 
     RowBox[{
      RowBox[{"StringJoin", "[", 
       RowBox[{"\"\<T\>\"", ",", 
        RowBox[{"ToString", "[", 
         RowBox[{
          RowBox[{"term", "/.", "convertProdToStringVariableRules"}], ",", 
          RowBox[{"FormatType", "\[Rule]", "InputForm"}]}], "]"}]}], "]"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<*\>\"", "\[Rule]", "\"\<T\>\""}], ",", 
        RowBox[{"\"\<-\>\"", "\[Rule]", "\"\<m\>\""}], ",", 
        RowBox[{"\"\<(\>\"", "\[Rule]", "\"\<\>\""}], ",", 
        RowBox[{"\"\<)\>\"", "\[Rule]", "\"\<\>\""}], ",", 
        RowBox[{"\"\<^\>\"", "\[Rule]", "\"\<P\>\""}]}], "}"}]}], 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.61328934611686*^9, 3.613289382147559*^9}, {
  3.613291155498661*^9, 3.6132911618903112`*^9}, {3.6133280970501957`*^9, 
  3.6133283216730957`*^9}, {3.614192140790101*^9, 3.614192148272378*^9}, {
  3.614194375038121*^9, 3.614194397693001*^9}, {3.653929809733737*^9, 
  3.6539298099269743`*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Basic Quasi-linear", "Section",
 CellChangeTimes->{{3.6132857813215227`*^9, 3.613285785435519*^9}}],

Cell[TextData[{
 "Quasi-linear equations including only interactions of fluctuations with ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["B", "y"], TraditionalForm]]],
 "."
}], "Text",
 CellChangeTimes->{{3.613285788264741*^9, 3.613285816975567*^9}, {
  3.6132858538148127`*^9, 3.613285857694859*^9}}],

Cell[CellGroupData[{

Cell["Derive equations", "Subsection",
 CellChangeTimes->{{3.613285862743395*^9, 3.613285865310978*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"numVariables", " ", "=", " ", "4"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"zt", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"z", ",", "t"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"meanFields", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
    "0", ",", "0", ",", "0", ",", "0", ",", "By", ",", "0", ",", "0"}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"meanFieldsWDerivs", " ", "=", " ", 
   RowBox[{"Rest", "@", 
    RowBox[{"Union", "[", 
     RowBox[{"Join", "[", 
      RowBox[{"meanFields", ",", 
       RowBox[{"dz", "/@", "meanFields"}], ",", 
       RowBox[{"dz", "/@", 
        RowBox[{"dz", "/@", "meanFields"}]}]}], "]"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"meanFieldQ", " ", "=", " ", 
    RowBox[{
     RowBox[{"MemberQ", "[", 
      RowBox[{"meanFieldsWDerivs", ",", "#"}], "]"}], "&"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fullMFeqns", " ", "=", " ", 
    RowBox[{"Subtract", "@@@", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"Bx", "@@", "zt"}], ",", "t"}], "]"}], "\[Equal]", 
        RowBox[{
         RowBox[{"ReyBx", "@@", "zt"}], "+", 
         RowBox[{"\[Eta]b", " ", 
          RowBox[{"Bx", "@@", "zt"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"By", "@@", "zt"}], ",", "t"}], "]"}], "\[Equal]", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "q"}], " ", 
          RowBox[{"Bx", "@@", "zt"}]}], "+", 
         RowBox[{"ReyBy", "@@", "zt"}], "+", 
         RowBox[{"\[Eta]b", " ", 
          RowBox[{"By", "@@", "zt"}]}]}]}], ",", "0"}], "}"}]}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Plug", " ", "in", " ", "mean", " ", "field"}], " ", "+", " ", 
    RowBox[{
    "fluctuations", " ", "into", " ", "NL", " ", "equations", " ", "and", " ",
      "linearize"}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"NL2fluct", ",", "fourierRules"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"NL2fluct", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
          "fullNLvars", "\[LeftDoubleBracket]", "i", 
           "\[RightDoubleBracket]"}], "\[Rule]", 
          RowBox[{"Function", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x", ",", "y", ",", "z", ",", "t"}], "}"}], ",", 
            RowBox[{"Evaluate", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                "meanFields", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "@@", 
                RowBox[{"{", 
                 RowBox[{"z", ",", "t"}], "}"}]}], "+", 
               RowBox[{
                RowBox[{
                "fullNLvars", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "@@", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "y", ",", "z", ",", "t"}], "}"}]}]}], "/.", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"0", "[", "__", "]"}], ")"}], "\[Rule]", "0"}]}], 
             "]"}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "fullNLvars", "]"}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Plug", " ", "in", " ", "to", " ", "full", " ", "equations", " ", 
        "and", " ", "linearize"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"linearize", "[", 
          RowBox[{"#", ",", "fullNLvars", ",", "xtv"}], "]"}], "&"}], "/@", 
        RowBox[{"Expand", "[", 
         RowBox[{"fullNLeqns", "/.", "NL2fluct"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "fullFluctEqs", " ", "still", " ", "contain", " ", "a", " ", "mean", 
        " ", "field", " ", "part"}], " ", "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Shearing", " ", "wave", " ", "expansion"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"fourierRules", "=", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", "var", "}"}], ",", 
          RowBox[{"Evaluate", "[", 
           RowBox[{"var", "\[Rule]", 
            RowBox[{"Function", "[", 
             RowBox[{
              RowBox[{"Evaluate", "@", "xtv"}], ",", 
              RowBox[{
               RowBox[{"var", "[", 
                RowBox[{"z", ",", "t"}], "]"}], 
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"\[ImaginaryI]", " ", 
                  RowBox[{"(", 
                   RowBox[{"kx", "+", 
                    RowBox[{"q", " ", "t", " ", "ky"}]}], ")"}], "x"}], " ", 
                 "+", " ", 
                 RowBox[{"\[ImaginaryI]", " ", "ky", " ", "y"}]}], "]"}]}]}], 
             "]"}]}], "]"}]}], "]"}], "/@", "fullNLvars"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{"Expand", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"fullFluctEqs", "/.", "fourierRules"}], ")"}], "/", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"\[ImaginaryI]", " ", 
            RowBox[{"(", 
             RowBox[{"kx", "+", 
              RowBox[{"q", " ", "t", " ", "ky"}]}], ")"}], "x"}], " ", "+", 
           " ", 
           RowBox[{"\[ImaginaryI]", " ", "ky", " ", "y"}]}], "]"}]}], "]"}]}],
       ";", 
      RowBox[{"(*", 
       RowBox[{
       "Shearing", " ", "wave", " ", "in", " ", "x", " ", "and", " ", "y"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{"fullFluctEqs", "/.", 
        RowBox[{
         SuperscriptBox["\[ExponentialE]", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "\[ImaginaryI]"}], " ", 
            RowBox[{"(", 
             RowBox[{
              SubscriptBox["k", "x"], "+", 
              RowBox[{
               SubscriptBox["k", "y"], " ", "q", " ", "t"}]}], ")"}], " ", 
            "x"}], "-", 
           RowBox[{"\[ImaginaryI]", " ", 
            SubscriptBox["k", "y"], " ", "y"}]}]], "\[Rule]", "0"}]}]}], ";", 
      " ", 
      RowBox[{"(*", " ", 
       RowBox[{"Remove", " ", "mean", " ", "components"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"fullFluctEqs", "/.", 
          RowBox[{"kx", "\[Rule]", 
           RowBox[{"kxb", "-", 
            RowBox[{"q", " ", "t", " ", "ky"}]}]}]}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"kxb", "\[Rule]", 
            RowBox[{"kxb", "/", "\[ImaginaryI]"}]}], ",", 
           RowBox[{"ky", "\[Rule]", 
            RowBox[{"ky", "/", "\[ImaginaryI]"}]}]}], "}"}]}], "//", 
        "Expand"}]}]}]}], " ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Use", " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "_"]}], "=", 
      RowBox[{
       SubscriptBox["k", "x"], "+", 
       RowBox[{
        SubscriptBox["qtk", "y"], " ", "as", " ", "in", " ", 
        RowBox[{"c", "++"}], " ", "code"}]}]}], " ", "*)"}], 
    "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Derive", " ", "Orr"}], "-", 
     RowBox[{"Somerfeld", " ", "like", " ", "equations"}]}], ",", " ", 
    RowBox[{
     RowBox[{"don", "'"}], "t", " ", "need", " ", "to", " ", "reduce", " ", 
     "other", " ", "equations"}], ",", " ", 
    RowBox[{
    "just", " ", "write", " ", "down", " ", "equations", " ", "for", " ", 
     RowBox[{"Lap", "[", "u", "]"}]}], ",", "\[Zeta]", ",", "b", ",", 
    "\[Eta]"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"derivRules", ",", "LapMGradDiv1", ",", "manualSub"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"derivRules", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Derivative", "[", 
           RowBox[{"n_", ",", "m_"}], "]"}], "[", "a_", "]"}], "[", "vs__", 
         "]"}], "\[RuleDelayed]", 
        RowBox[{"Nest", "[", 
         RowBox[{"dt", ",", 
          RowBox[{"Nest", "[", 
           RowBox[{"dz", ",", 
            RowBox[{"a", "[", "vs", "]"}], ",", "n"}], "]"}], ",", "m"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"LapMGradDiv1", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"kxb", "^", "2"}], "+", 
            RowBox[{"ky", "^", "2"}]}], ")"}], 
          RowBox[{
          "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], "+", 
         
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{
           "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
           "z", ",", "z"}], "]"}], "-", 
         RowBox[{"kxb", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"kxb", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            "+", 
            RowBox[{"ky", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            "+", 
            RowBox[{"D", "[", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
              ",", "z"}], "]"}]}], ")"}]}]}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"finalEqs", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"iLapF", "[", 
            RowBox[{
             RowBox[{"Expand", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"LapMGradDiv1", "[", 
                 RowBox[{"fullFluctEqs", "/.", 
                  RowBox[{"\[Nu]b", "\[Rule]", "0"}]}], "]"}], "/.", 
                "derivRules"}], "/.", "toOrrSomerVars"}], "]"}], "//.", 
             "explicitLap2Rule"}], "]"}], "/.", "explicitLapFRule"}], "//", 
          "Expand"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Expand", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"D", "[", 
                RowBox[{
                 RowBox[{
                 "fullFluctEqs", "\[LeftDoubleBracket]", "2", 
                  "\[RightDoubleBracket]"}], ",", "z"}], "]"}], "-", 
               RowBox[{"ky", " ", 
                RowBox[{
                "fullFluctEqs", "\[LeftDoubleBracket]", "3", 
                 "\[RightDoubleBracket]"}]}]}], "/.", "derivRules"}], "/.", 
             "toOrrSomerVars"}], "]"}], "//.", "explicitLap2Rule"}], "/.", 
          RowBox[{"\[Nu]b", "\[Rule]", "0"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Expand", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
              "fullFluctEqs", "\[LeftDoubleBracket]", "5", 
               "\[RightDoubleBracket]"}], "/.", "derivRules"}], "/.", 
             "toOrrSomerVars"}], "]"}], "//.", "explicitLap2Rule"}], "/.", 
          RowBox[{"\[Eta]b", "\[Rule]", "0"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Expand", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"D", "[", 
                RowBox[{
                 RowBox[{
                 "fullFluctEqs", "\[LeftDoubleBracket]", "6", 
                  "\[RightDoubleBracket]"}], ",", "z"}], "]"}], "-", 
               RowBox[{"ky", " ", 
                RowBox[{
                "fullFluctEqs", "\[LeftDoubleBracket]", "7", 
                 "\[RightDoubleBracket]"}]}]}], "/.", "derivRules"}], "/.", 
             "toOrrSomerVars"}], "]"}], "//.", "explicitLap2Rule"}], "/.", 
          RowBox[{"\[Eta]b", "\[Rule]", "0"}]}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Fix", " ", "these", " ", "up", " ", "manually"}], " ", "-", 
        " ", 
        RowBox[{"sometimes", " ", "much", " ", "easier"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"This", " ", "is", " ", "plugging", " ", "in", " ", 
         RowBox[{"iLapF", "[", "lapF", "]"}]}], " ", "=", " ", 
        RowBox[{
        "1", " ", "in", " ", "the", " ", "more", " ", "complicated", " ", 
         "situation"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"finalEqs", "=", 
       RowBox[{
        RowBox[{"finalEqs", "/.", 
         RowBox[{
          RowBox[{"Expand", "[", 
           RowBox[{
            RowBox[{"-", "ky"}], " ", 
            RowBox[{"iLapF", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                   RowBox[{
                    RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                   RowBox[{"D", "[", 
                    RowBox[{"#", ",", "z", ",", "z"}], "]"}]}], ")"}], "&"}], 
                "[", 
                RowBox[{
                 RowBox[{"b", "[", 
                  RowBox[{"z", ",", "t"}], "]"}], " ", 
                 RowBox[{"By", "[", 
                  RowBox[{"z", ",", "t"}], "]"}]}], "]"}], ")"}], "/.", 
              "derivRules"}], "]"}]}], "]"}], "\[RuleDelayed]", 
          RowBox[{
           RowBox[{"-", " ", "ky"}], " ", 
           RowBox[{"b", "[", 
            RowBox[{"z", ",", "t"}], "]"}], 
           RowBox[{"By", "[", 
            RowBox[{"z", ",", "t"}], "]"}]}]}]}], "/.", 
        RowBox[{
         RowBox[{"Expand", "[", 
          RowBox[{
           RowBox[{"-", " ", "B0z"}], " ", 
           RowBox[{"iLapF", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                  RowBox[{
                   RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                  RowBox[{"dz", "[", 
                   RowBox[{"dz", "[", "#", "]"}], "]"}]}], ")"}], "&"}], "[", 
               
               RowBox[{"dz", "[", 
                RowBox[{"b", "[", 
                 RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], ")"}], "/.", 
             "derivRules"}], "]"}]}], "]"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"-", "B0z"}], " ", 
          RowBox[{"dz", "[", 
           RowBox[{"b", "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}]}]}]}]}]}]}], 
    "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Now", ",", " ", 
    RowBox[{"form", " ", "the", " ", "A", " ", "matrix"}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"redvars", " ", "=", 
   RowBox[{"{", 
    RowBox[{"u", ",", "\[Zeta]", ",", "b", ",", "\[Eta]"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"finalEqs", "=", 
    RowBox[{
     RowBox[{"Solve", "[", 
      RowBox[{
       RowBox[{"Thread", "[", 
        RowBox[{"finalEqs", "\[Equal]", "0"}], "]"}], ",", 
       RowBox[{"dt", "/@", 
        RowBox[{"(", 
         RowBox[{"Through", "[", 
          RowBox[{"redvars", "@@", 
           RowBox[{"{", 
            RowBox[{"z", ",", "t"}], "}"}]}], "]"}], ")"}]}]}], "]"}], 
     "\[LeftDoubleBracket]", 
     RowBox[{"1", ",", "All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Solve", " ", "for", " ", "time"}], "-", "derivatives"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"Aop", " ", "=", " ", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Function", "[", 
          RowBox[{
           RowBox[{"{", "var", "}"}], ",", 
           RowBox[{
            RowBox[{"Plus", "@@", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"#", ",", 
                    RowBox[{"var", "[", 
                    RowBox[{"z", ",", "t"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}], ",", 
                  "#", ",", 
                  RowBox[{"{", "}"}]}], "]"}], "&"}], "/@", 
               RowBox[{"(", 
                RowBox[{"plusToList", "@", 
                 RowBox[{
                 "finalEqs", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}], "/.", 
            RowBox[{
             RowBox[{"var", "[", 
              RowBox[{"z", ",", "t"}], "]"}], "\[Rule]", "ph"}]}]}], "]"}], "/@",
          "redvars"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ")"}], "//", 
    "MatrixForm"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "This", " ", "matches", " ", "my", " ", "previously", " ", "derived", " ", 
    
    RowBox[{"(", 
     RowBox[{"by", " ", "hand"}], ")"}], " ", "version"}], " ", "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.613288323045455*^9, 3.613288326117752*^9}, {
   3.613288389643783*^9, 3.613288407039393*^9}, {3.613288479968417*^9, 
   3.613288487728981*^9}, {3.613288573589717*^9, 3.613288752358992*^9}, {
   3.613288852631976*^9, 3.613288916198966*^9}, {3.613288986990489*^9, 
   3.6132891926695137`*^9}, {3.613289423308837*^9, 3.613289432319971*^9}, {
   3.613289540309534*^9, 3.613289551704471*^9}, {3.613289593180532*^9, 
   3.613289597516069*^9}, {3.6132897828569527`*^9, 3.613289799551094*^9}, {
   3.613289832684938*^9, 3.613289857392364*^9}, {3.613289899387167*^9, 
   3.613289949003064*^9}, {3.613290022566579*^9, 3.613290072980708*^9}, {
   3.6132901333440037`*^9, 3.6132902277049723`*^9}, {3.613290347360075*^9, 
   3.613290348877283*^9}, {3.613290407662169*^9, 3.6132904199021072`*^9}, {
   3.613290617515009*^9, 3.613290693570179*^9}, {3.6132907374778633`*^9, 
   3.613290807808112*^9}, {3.6132911924799023`*^9, 3.613291195598812*^9}, {
   3.6132912379815063`*^9, 3.613291248693972*^9}, {3.613291280284522*^9, 
   3.613291408458893*^9}, {3.613291458080309*^9, 3.613291470927746*^9}, {
   3.6132915090035563`*^9, 3.613291525286358*^9}, {3.6132921232255783`*^9, 
   3.613292144859001*^9}, {3.613292297867838*^9, 3.613292316012755*^9}, 
   3.6132930883268547`*^9, {3.613293312306075*^9, 3.61329333079275*^9}, {
   3.6133006141405077`*^9, 3.61330070673322*^9}, {3.613300799309185*^9, 
   3.613300851120187*^9}, {3.613300912016116*^9, 3.6133009327016172`*^9}, {
   3.6133010023231773`*^9, 3.613301012699256*^9}, {3.6133010441561947`*^9, 
   3.613301156627*^9}, 3.6133013078550577`*^9, {3.613301447081024*^9, 
   3.613301449877001*^9}, {3.6133015415117207`*^9, 3.6133015541220617`*^9}, {
   3.6133016618658733`*^9, 3.613301704111124*^9}, {3.61330185743235*^9, 
   3.613301871088355*^9}, {3.613301910782558*^9, 3.6133019246441307`*^9}, {
   3.613301999871911*^9, 3.6133020708752737`*^9}, {3.61330239110786*^9, 
   3.613302487596188*^9}, {3.613302551646475*^9, 3.61330262406814*^9}, {
   3.6133045173899403`*^9, 3.6133045479377737`*^9}, {3.6133047488389683`*^9, 
   3.6133047694867353`*^9}, {3.613304829996623*^9, 3.613304868581319*^9}, {
   3.613304943519965*^9, 3.613304948407606*^9}, {3.6133053005957613`*^9, 
   3.613305319748056*^9}, {3.6133261571880493`*^9, 3.613326178299334*^9}, {
   3.613326367599222*^9, 3.613326560664708*^9}, {3.613326591582814*^9, 
   3.613326696955864*^9}, {3.613327160076173*^9, 3.613327161075317*^9}, {
   3.61332757642347*^9, 3.613327611115761*^9}, {3.613327657453199*^9, 
   3.613327813791049*^9}, {3.61332805091748*^9, 3.6133280531810827`*^9}, {
   3.613328083202976*^9, 3.613328090811761*^9}, 3.613328347059229*^9, {
   3.613328833019064*^9, 3.6133288553167562`*^9}, {3.6133291560666847`*^9, 
   3.613329177719489*^9}, 3.6141771183999968`*^9, {3.614189292301111*^9, 
   3.614189302092698*^9}, {3.614361699979642*^9, 3.614361719890554*^9}, {
   3.614504566104581*^9, 3.614504591016654*^9}, {3.614504663864559*^9, 
   3.614504666982682*^9}, {3.614545423593639*^9, 3.614545467974424*^9}, {
   3.614545503295141*^9, 3.614545505932638*^9}, {3.6145455804415207`*^9, 
   3.614545585925158*^9}, {3.614545671972193*^9, 3.614545700909773*^9}, {
   3.633266062422936*^9, 3.6332660630542383`*^9}, {3.6332663439836206`*^9, 
   3.6332663519312563`*^9}, {3.633266400282647*^9, 3.633266414370122*^9}, {
   3.633266454308667*^9, 3.63326648568677*^9}, {3.6332665248634443`*^9, 
   3.633266562600638*^9}, {3.633266601699016*^9, 3.633266623957155*^9}, {
   3.633266671966673*^9, 3.633266722283813*^9}, {3.633266761131874*^9, 
   3.6332667621705513`*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["k", "y"], " ", "q", " ", 
       RowBox[{
        SuperscriptBox[
         SubscriptBox["\[EmptyUpTriangle]", "F"], 
         RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], 
      RowBox[{"2", " ", 
       RowBox[{
        SuperscriptBox[
         SubscriptBox["\[EmptyUpTriangle]", "F"], 
         RowBox[{"-", "1"}]], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}], 
        "]"}]}], 
      RowBox[{
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "y"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["B", "z0"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "+", 
       RowBox[{"2", " ", 
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["B", "y"], "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], 
         "]"}]}]}], 
      RowBox[{"2", " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubsuperscriptBox["k", "y", "2"], " ", 
       RowBox[{
        SuperscriptBox[
         SubscriptBox["\[EmptyUpTriangle]", "F"], 
         RowBox[{"-", "1"}]], "[", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "]"}]}]},
     {
      RowBox[{
       RowBox[{
        RowBox[{"-", "2"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "+", 
       RowBox[{"q", " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}]}], 
      "0", 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"]}], " ", "\[SmallCircle]", 
        " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "y"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}]}], 
      RowBox[{
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "y"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["B", "z0"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "-", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}]},
     {
      RowBox[{
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "y"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["B", "z0"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}]}], 
      "0", "0", "0"},
     {
      RowBox[{
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "y"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], "]"}]}],
        "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        SubsuperscriptBox["k", "y", "2"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "y"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}], 
      RowBox[{
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "y"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["B", "z0"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "+", 
       RowBox[{"2", " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "y"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}], 
      RowBox[{
       RowBox[{"-", "q"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
      "0"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{
  3.613304869590173*^9, 3.6133049495007257`*^9, 3.6133053207405367`*^9, {
   3.613326485387342*^9, 3.613326561490202*^9}, {3.613326595815199*^9, 
   3.6133266040226097`*^9}, 3.613326660026622*^9, 3.61332716201223*^9, {
   3.6133275947793913`*^9, 3.613327612121537*^9}, {3.613327744727991*^9, 
   3.613327815555489*^9}, 3.613328054239262*^9, 3.613328356531164*^9, 
   3.613328856170669*^9, {3.613329165606255*^9, 3.613329178601987*^9}, 
   3.614177119713147*^9, 3.614189304110643*^9, 3.6143617220896473`*^9, 
   3.614504591952222*^9, 3.614504668409453*^9, 3.614542661480213*^9, 
   3.614545459261648*^9, 3.6145455874121523`*^9, {3.614545678856031*^9, 
   3.614545702075966*^9}, 3.614615776227653*^9, 3.615115364818183*^9, 
   3.627938102673189*^9, 3.6332656937924013`*^9, {3.6332659684393682`*^9, 
   3.63326599137435*^9}, 3.633266065088125*^9, 3.633266250676612*^9, 
   3.633266489721394*^9, 3.6332665321142673`*^9, 3.633266565736705*^9, {
   3.633266604026013*^9, 3.633266626558113*^9}, {3.6332666760752583`*^9, 
   3.633266724272911*^9}, 3.6332669169916058`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Working out the matrix product, and getting things into a \
\[OpenCurlyDoubleQuote]code convenient\[CloseCurlyDoubleQuote] form\
\>", "Subsection",
 CellChangeTimes->{{3.613329080723421*^9, 3.613329105297495*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Cmat", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"Cm", "[", 
     RowBox[{"i", ",", "j"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "numVariables"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", "numVariables"}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fullMatrixEquations", " ", "=", " ", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Aop", "\[LeftDoubleBracket]", 
          RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], "/.", 
         RowBox[{"ph", "->", 
          RowBox[{"Cmat", "\[LeftDoubleBracket]", 
           RowBox[{"j", ",", "k"}], "\[RightDoubleBracket]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "numVariables"}], "}"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "numVariables"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"k", ",", "numVariables"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Redefine", " ", "lapF", " ", "to", " ", "collect", " ", "as", " ", 
     "many", " ", "terms", " ", "as", " ", "possible"}], ",", " ", 
    RowBox[{"collect", " ", "in", " ", "mean", " ", "fields"}]}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fullMatrixEquations", "=", 
   RowBox[{"MapAll", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Collect", "[", 
       RowBox[{"#", ",", "meanFieldsWDerivs"}], "]"}], "&"}], ",", 
     RowBox[{
      RowBox[{"fullMatrixEquations", "/.", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"Through", "[", 
          RowBox[{"meanFields", "@@", 
           RowBox[{"{", 
            RowBox[{"z", ",", "t"}], "}"}]}], "]"}], "->", "meanFields"}], 
        "]"}]}], 
      RowBox[{"(*", 
       RowBox[{"Easier", " ", "to", " ", "look", " ", "at"}], "*)"}], "/.", 
      "\[IndentingNewLine]", 
      RowBox[{"iLapF", "\[Rule]", "iLapFColl"}]}]}], 
    RowBox[{"(*", 
     RowBox[{"Collect", " ", "iLapF", " ", "terms"}], "*)"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"fullMatrixEquations", "=", 
  RowBox[{"fullMatrixEquations", "//.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"dz", "[", 
       RowBox[{"a_", "/;", 
        RowBox[{"!", 
         RowBox[{"meanFieldQ", "[", "a", "]"}]}]}], "]"}], "\[RuleDelayed]", 
      RowBox[{"dz", " ", "a"}]}], ",", 
     RowBox[{
      RowBox[{"iLap2", "[", "a_", "]"}], "\[RuleDelayed]", 
      RowBox[{"iLap2", " ", "a"}]}]}], "}"}]}]}]}], "Input",
 CellChangeTimes->{{3.614183523653407*^9, 3.614183619973299*^9}, {
   3.6141837102104187`*^9, 3.61418374185849*^9}, {3.6141849032639017`*^9, 
   3.614184910371166*^9}, {3.6141856403035383`*^9, 3.614185671246872*^9}, {
   3.614185814106379*^9, 3.614185877677721*^9}, {3.614186008201589*^9, 
   3.6141860563838873`*^9}, {3.6141861298094*^9, 3.614186133404842*^9}, {
   3.614186265993711*^9, 3.614186266722341*^9}, {3.61418645140637*^9, 
   3.61418648051291*^9}, {3.614186552940997*^9, 3.6141865737590837`*^9}, {
   3.614188523622821*^9, 3.6141885248935966`*^9}, {3.614189283362381*^9, 
   3.614189315179832*^9}, {3.614189422729567*^9, 3.614189433440941*^9}, {
   3.614189677743164*^9, 3.61418967848466*^9}, {3.6141967572921963`*^9, 
   3.6141967583883953`*^9}, {3.6141989228199043`*^9, 3.614198945631775*^9}, 
   3.614198982104651*^9, {3.614361772710515*^9, 3.6143618063669567`*^9}, {
   3.614504631869879*^9, 3.614504678095435*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "2"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "3"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "2"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "3"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"3", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"3", "\[InvisibleComma]", "2"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"3", "\[InvisibleComma]", "3"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"4", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"4", "\[InvisibleComma]", "2"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"4", "\[InvisibleComma]", "3"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"4", "\[InvisibleComma]", "4"}]]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.614186133917675*^9, 3.614186267048477*^9, 3.614186481926425*^9, 
   3.6141885255283833`*^9, 3.614189319838678*^9, {3.6141894304574347`*^9, 
   3.614189433941032*^9}, 3.614189678940024*^9, 3.614195966966*^9, 
   3.614196761527596*^9, {3.61419892962738*^9, 3.614198946179511*^9}, 
   3.61419898388535*^9, {3.614361787735118*^9, 3.614361807137169*^9}, 
   3.614504597712901*^9, {3.614504637573621*^9, 3.6145046797962427`*^9}, 
   3.614542667785318*^9, 3.614545623141712*^9, 3.614545706505865*^9, 
   3.614545743858747*^9, 3.6146157788524723`*^9, 3.615115367785581*^9, {
   3.633266910095096*^9, 3.633266919794445*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SuperscriptBox[
        SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
        RowBox[{"-", "1"}]], "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], " ", 
         SubscriptBox["k", "y"], " ", "q", " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
        RowBox[{"2", " ", 
         SubscriptBox["\[PartialD]", "z"], " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "+", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "y"], "]"}]}]}], "]"}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SuperscriptBox[
        SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
        RowBox[{"-", "1"}]], "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], " ", 
         SubscriptBox["k", "y"], " ", "q", " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
        RowBox[{"2", " ", 
         SubscriptBox["\[PartialD]", "z"], " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "+", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "y"], "]"}]}]}], "]"}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SuperscriptBox[
        SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
        RowBox[{"-", "1"}]], "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], " ", 
         SubscriptBox["k", "y"], " ", "q", " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
        RowBox[{"2", " ", 
         SubscriptBox["\[PartialD]", "z"], " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"2", "\[InvisibleComma]", "3"}]]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "y"], "]"}]}]}], "]"}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SuperscriptBox[
        SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
        RowBox[{"-", "1"}]], "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], " ", 
         SubscriptBox["k", "y"], " ", "q", " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
        RowBox[{"2", " ", 
         SubscriptBox["\[PartialD]", "z"], " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "+", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "y"], "]"}]}]}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "1"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "2"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "3"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "3"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "4"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "4"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "3"}]]}], "-", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "-", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}]}], "}"}]}], "}"}]], "Output",\

 CellChangeTimes->{
  3.614186133917675*^9, 3.614186267048477*^9, 3.614186481926425*^9, 
   3.6141885255283833`*^9, 3.614189319838678*^9, {3.6141894304574347`*^9, 
   3.614189433941032*^9}, 3.614189678940024*^9, 3.614195966966*^9, 
   3.614196761527596*^9, {3.61419892962738*^9, 3.614198946179511*^9}, 
   3.61419898388535*^9, {3.614361787735118*^9, 3.614361807137169*^9}, 
   3.614504597712901*^9, {3.614504637573621*^9, 3.6145046797962427`*^9}, 
   3.614542667785318*^9, 3.614545623141712*^9, 3.614545706505865*^9, 
   3.614545743858747*^9, 3.6146157788524723`*^9, 3.615115367785581*^9, {
   3.633266910095096*^9, 3.63326691980832*^9}}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Put everything into c++ form, including taking the Fourier transforms\
\>", "Subsection",
 CellChangeTimes->{{3.614195675973181*^9, 3.614195696141123*^9}}],

Cell[CellGroupData[{

Cell["Define the various functions and variables to use in c++", \
"Subsubsection",
 CellChangeTimes->{
  3.614200068915313*^9, {3.6145427017460127`*^9, 3.614542707265788*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"CklOut", " ", "=", " ", "\"\<Ckl_out[i]\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CklIn", " ", "=", " ", "\"\<Ckl_in[i]\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ifft", " ", "=", " ", "\"\<fft_.back_2DFull\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fft", " ", "=", " ", "\"\<fft_.for_2DFull\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dealias", " ", "=", " ", "\"\<dealias\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cppProducts", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"\"\<.asDiagonal()*\>\"", ",", "\"\<*\>\""}], "}"}]}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{"Second", " ", "one", " ", "is", " ", "for", " ", "scalars"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"MFcppVariables", " ", "=", 
  RowBox[{"Thread", "[", " ", 
   RowBox[{"meanFieldsWDerivs", "->", 
    RowBox[{"StringReplace", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ToString", "[", "#", "]"}], "<>", "\"\<_\>\""}], "&"}], "/@",
        "meanFieldsWDerivs"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<[\>\"", "\[Rule]", "\"\<\>\""}], ",", 
        RowBox[{"\"\<]\>\"", "\[Rule]", "\"\<\>\""}]}], "}"}]}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"iLapFvar", " ", "=", " ", "\"\<ilapFtmp_.matrix()\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ftFactorVar", "=", "\"\<fft2Dfac_\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"vectorVars", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"iLap2", ",", "dz", ",", "iLapFColl"}], "}"}]}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{
   "Variables", " ", "that", " ", "are", " ", "vectors", " ", "in", " ", 
    RowBox[{"c", "++"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"variablesInCpp", " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"ky", "\[Rule]", "\"\<kyctmp_\>\""}], ",", 
    RowBox[{"kxb", "\[Rule]", "\"\<kxctmp_\>\""}], ",", 
    RowBox[{"dz", "\[Rule]", "\"\<kz_\>\""}], ",", 
    RowBox[{"q", "\[Rule]", "\"\<q_\>\""}], ",", 
    RowBox[{"iLap2", "\[Rule]", "\"\<ilap2tmp_\>\""}], ",", 
    RowBox[{"B0z", "\[Rule]", "\"\<B0z_\>\""}]}], "}"}]}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0E0ow3EAxvGF4rBka15G/TPJ0JDRmtXGltpWlk3K2wVxkiRaSGGhNa+L
SYmtqRUliRy0NAoLZXFRFkXK/jJGMtPwe/6Hp8/xqa+gtaumPYbFYmWQQQ8d
N2l+oZUnIz/L8DyddsLCQNYqZMfub8EN59I2lBVLMi1ECS9BAL1Hwz0TRN7c
ohFqtWk2KGq7Y9wJVB1DU/eXF9ZzN5MmiUGBmwMN49JU2PxeRsFpnyoPqvp9
jGMJFUWwsWWWUW91lUAq8ZExRRKuPSWGLVQdrOzsu4Amx/0VlGrUfjj4t/IA
6dF4GuZLhIy7KRH5GdHo6i2H8+JDO8yVuRzQPCOavyBqBoZt8Hrv8s2HPvbq
EDQ8vbmjREWH3wM5659hyE0eisDbUEPpL/4+rIz6g7UbdpBWNhl0frggj35T
RJ1R/QPFUzaF9pVWFmzzyqEzm5/zxHlW8kcoIfwHJzb67A==
  "]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    SubscriptBox["B", "y"], "\[Rule]", "\<\"By_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     SubscriptBox["B", "y"], "]"}], "\[Rule]", "\<\"dzBy_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      SubscriptBox["B", "y"], "]"}], "]"}], "\[Rule]", "\<\"dzdzBy_\"\>"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.6141968971191683`*^9, {3.614196955865787*^9, 3.614196976553069*^9}, 
   3.6141970176273737`*^9, {3.614197140642284*^9, 3.6141971499528723`*^9}, 
   3.61420280515613*^9, 3.6142041474039993`*^9, 3.61420432093274*^9, 
   3.614332753782305*^9, 3.6143334373897533`*^9, 3.614334227966806*^9, 
   3.614335330770611*^9, {3.614342317980378*^9, 3.6143423257325563`*^9}, 
   3.614345100654113*^9, 3.614361816160263*^9, 3.614385394517193*^9, 
   3.614436871615592*^9, 3.6144373337998466`*^9, 3.614437922414172*^9, 
   3.61446781112652*^9, 3.614504610070334*^9, 3.614504924258411*^9, 
   3.614542674887701*^9, 3.61454565515012*^9, 3.614545745944592*^9, 
   3.614615781190735*^9, 3.615115374144129*^9, 3.6151157690167103`*^9, 
   3.633267015776391*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    SubscriptBox["k", "y"], "\[Rule]", "\<\"kyctmp_\"\>"}], ",", 
   RowBox[{
    OverscriptBox[
     SubscriptBox["k", "x"], "\[LongDash]"], "\[Rule]", "\<\"kxctmp_\"\>"}], 
   ",", 
   RowBox[{
    SubscriptBox["\[PartialD]", "z"], "\[Rule]", "\<\"kz_\"\>"}], ",", 
   RowBox[{"q", "\[Rule]", "\<\"q_\"\>"}], ",", 
   RowBox[{
    SuperscriptBox[
     SubscriptBox["\[EmptyUpTriangle]", "2"], 
     RowBox[{"-", "1"}]], "\[Rule]", "\<\"ilap2tmp_\"\>"}], ",", 
   RowBox[{
    SubscriptBox["B", "z0"], "\[Rule]", "\<\"B0z_\"\>"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6141968971191683`*^9, {3.614196955865787*^9, 3.614196976553069*^9}, 
   3.6141970176273737`*^9, {3.614197140642284*^9, 3.6141971499528723`*^9}, 
   3.61420280515613*^9, 3.6142041474039993`*^9, 3.61420432093274*^9, 
   3.614332753782305*^9, 3.6143334373897533`*^9, 3.614334227966806*^9, 
   3.614335330770611*^9, {3.614342317980378*^9, 3.6143423257325563`*^9}, 
   3.614345100654113*^9, 3.614361816160263*^9, 3.614385394517193*^9, 
   3.614436871615592*^9, 3.6144373337998466`*^9, 3.614437922414172*^9, 
   3.61446781112652*^9, 3.614504610070334*^9, 3.614504924258411*^9, 
   3.614542674887701*^9, 3.61454565515012*^9, 3.614545745944592*^9, 
   3.614615781190735*^9, 3.615115374144129*^9, 3.6151157690167103`*^9, 
   3.6332670157864723`*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Setup functions to find all the coefficients and replace by c++ variables, \
save these variables to automatically compute later\
\>", "Subsubsection",
 CellChangeTimes->{{3.6142001576080503`*^9, 3.6142001733730717`*^9}, {
  3.614542687579644*^9, 3.6145426929862757`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "The", " ", "main", " ", "stuff", " ", "you", " ", "might", " ", "want", 
    " ", "to", " ", "change", " ", "is", " ", "in", " ", "this", " ", 
    RowBox[{"Module", ".", " ", "Defines"}], " ", "various", " ", "functions",
     " ", "and", " ", "lists", " ", "to", " ", "identify", " ", "different", 
    " ", "variable", " ", "types"}], " ", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "coeffList", ",", "fullCppMultVariableList", ",", "scalarCppVars", ",", 
       "vectorCppVars"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"coeffList", "=", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"MapMatrix", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Cases", "[", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{"coeff_", " ", 
                RowBox[{"Cm", "[", 
                 RowBox[{"i1_", ",", "i2_"}], "]"}]}], "\[RuleDelayed]", 
               "coeff"}], ",", "\[Infinity]"}], "]"}], "&"}], ",", 
           "fullMatrixEquations"}], "]"}], "]"}], "/.", 
        RowBox[{"Thread", "[", 
         RowBox[{"meanFieldsWDerivs", "\[Rule]", "1"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"coeffList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "/.", 
          RowBox[{"coeff_", "\[RuleDelayed]", 
           RowBox[{"Rule", "[", 
            RowBox[{"coeff", ",", 
             RowBox[{"convertProdToString", "[", "coeff", "]"}]}], "]"}]}]}], 
         "&"}], "/@", "coeffList"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"coeffList", " ", "=", " ", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"Sort", "[", 
         RowBox[{"coeffList", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"StringLength", "[", 
             RowBox[{
             "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}], ">", 
            RowBox[{"StringLength", "[", 
             RowBox[{
             "#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}]}], "&"}]}], "]"}], "]"}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "Make", " ", "sure", " ", "longest", " ", "products", " ", "are", " ",
          "first"}], ",", " ", 
        RowBox[{
        "otherwise", " ", "it", " ", "replaces", " ", "others", " ", "too", 
         " ", "early", " ", "and", " ", "they", " ", 
         RowBox[{"don", "'"}], "t", " ", "get", " ", "recognized"}]}], "*)"}],
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"fullMatrixEquationsC", "=", 
       RowBox[{
        RowBox[{"fullMatrixEquations", "/.", "coeffList"}], "/.", 
        RowBox[{
         RowBox[{
          RowBox[{"str1_String", " ", 
           RowBox[{"Cm", "[", 
            RowBox[{"i_", ",", "j_"}], "]"}]}], "+", 
          RowBox[{"str2_String", " ", 
           RowBox[{"Cm", "[", 
            RowBox[{"i_", ",", "j_"}], "]"}]}]}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"StringJoin", "[", 
           RowBox[{"str1", ",", "\"\<PLUS\>\"", ",", "str2"}], "]"}], " ", 
          RowBox[{"Cm", "[", 
           RowBox[{"i", ",", "j"}], "]"}]}]}]}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Now", " ", "there", " ", "are", " ", "only"}], ",", " ", 
        RowBox[{"Mean", " ", "fields", " ", 
         RowBox[{"(", 
          RowBox[{"and", " ", "derivatives"}], ")"}]}], ",", " ", 
        RowBox[{"C", " ", "matrices"}], ",", " ", 
        RowBox[{"string", " ", "variables"}]}], "*)"}], 
      RowBox[{"(*", 
       RowBox[{
       "Second", " ", "replacment", " ", "is", " ", "for", " ", "sums"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Before", " ", "going", " ", "on"}], ",", " ", 
        RowBox[{
         RowBox[{
         "keep", " ", "the", " ", "list", " ", "of", " ", "string", " ", 
          "variables"}], " ", "-", " ", 
         RowBox[{
         "some", " ", "of", " ", "these", " ", "get", " ", "rather", " ", 
          RowBox[{"long", "!"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fullCppMultVariableList", " ", "=", 
       RowBox[{"Union", "[", " ", 
        RowBox[{"Cases", "[", 
         RowBox[{
         "fullMatrixEquationsC", ",", "str_String", ",", "\[Infinity]"}], 
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"scalarCppVars", " ", "=", " ", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"coeffList", ",", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{"Alternatives", "@@", "vectorVars"}], ",", 
              "\[Infinity]"}], "]"}]}], "&"}]}], "]"}], 
        "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Separate", " ", "out", " ", "the", " ", "scalar", " ", "variables"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"vectorCppVars", " ", "=", " ", 
       RowBox[{"Complement", "[", 
        RowBox[{"fullCppMultVariableList", ",", "scalarCppVars"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ClearAll", "[", 
       RowBox[{"scalarCppQ", ",", "vectorCppQ"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"scalarCppQ", "[", "_", "]"}], "=", "False"}], ";", 
      RowBox[{
       RowBox[{"vectorCppQ", "[", "_", "]"}], "=", "False"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"scalarCppQ", "[", "#", "]"}], "=", "True"}], ")"}], "&"}], 
       "/@", "scalarCppVars"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"vectorCppQ", "[", "#", "]"}], "=", "True"}], ")"}], "&"}], 
       "/@", "vectorCppVars"}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Q", " ", "functions", " ", "for", " ", "vectors", " ", "and", " ", 
        "scalars"}], " ", "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"ClearAll", "[", "rescaleForFFT", "]"}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Adds", " ", "in", " ", "ftfac", " ", "multiplying", " ", "vector", 
        " ", "for", " ", "more", " ", "efficient", " ", "fft", " ", 
        "rescaling"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"rescaleForFFT", "[", "a_", "]"}], ":=", "\[IndentingNewLine]", 
       RowBox[{"a", "/.", 
        RowBox[{
         RowBox[{"var_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"scalarCppQ", "[", "#", "]"}], "||", 
             RowBox[{"vectorCppQ", "[", "#", "]"}]}], "&"}], ")"}]}], 
         "\[RuleDelayed]", 
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"newvar", "=", 
             RowBox[{
             "\"\<(\>\"", "<>", "var", "<>", "\"\</\>\"", "<>", "ftFactorVar",
               "<>", "\"\<)\>\""}]}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"scalarCppQ", "[", "var", "]"}], ",", 
              RowBox[{
               RowBox[{"scalarCppQ", "[", "newvar", "]"}], "=", "True"}], ",", 
              RowBox[{
               RowBox[{"vectorCppQ", "[", "newvar", "]"}], "=", "True"}]}], 
             "]"}], ";", "\[IndentingNewLine]", "newvar"}]}], 
          "\[IndentingNewLine]", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Product", " ", "to", " ", "use"}], " ", "-", " ", 
        RowBox[{
        "default", " ", "is", " ", "treating", " ", "object", " ", "as", " ", 
         "a", " ", "vector"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"ClearAll", "[", "vec2DiagProd", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vec2DiagProd", "[", "]"}], "=", 
       RowBox[{
       "cppProducts", "\[LeftDoubleBracket]", "1", 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vec2DiagProd", "[", "a_", "]"}], " ", ":=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"scalarCppQ", "@", "a"}], ",", 
         RowBox[{
         "cppProducts", "\[LeftDoubleBracket]", "2", 
          "\[RightDoubleBracket]"}], ",", 
         RowBox[{
         "cppProducts", "\[LeftDoubleBracket]", "1", 
          "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Replacement", " ", "rules", " ", "from", " ", 
        RowBox[{"c", "++"}], " ", "variables", " ", "to", " ", "real", " ", 
        "products"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"CppToBasicVariables", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"fullCppMultVariableList", "\[Rule]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"StringReplace", "[", 
             RowBox[{"fullCppMultVariableList", ",", 
              RowBox[{
               RowBox[{"a__", "~~", "\"\<PLUS\>\"", "~~", "b__"}], 
               "\[RuleDelayed]", 
               RowBox[{"a", "+", "b"}]}]}], "]"}], "/.", 
            RowBox[{"StringExpression", "\[Rule]", "Sequence"}]}], "/.", 
           RowBox[{"coeffList", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "1"}], "}"}]}], "\[RightDoubleBracket]"}]}], 
          ")"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Collect", " ", "to", " ", "scalar", " ", "and", " ", "vector", " ", 
        "variables"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"CppToBasicVariables", " ", "=", " ", 
       RowBox[{"Gather", "[", 
        RowBox[{"CppToBasicVariables", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"scalarCppQ", "[", 
            RowBox[{
            "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}], "===", 
           RowBox[{"scalarCppQ", "[", 
            RowBox[{
            "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}]}], "&"}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "FUNCTIONS", " ", "TO", " ", "CONVERT", " ", "TO", " ", "CPP", " ", 
     "CODE"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"First", " ", "-", " ", 
     RowBox[{"convert", " ", "to", " ", "symbolic", " ", 
      RowBox[{"code", ".", " ", "Takes"}], " ", "a", " ", "single", " ", 
      "term", " ", "and", " ", "converts", " ", "it", " ", "to", " ", 
      "symbolic", " ", 
      RowBox[{
       RowBox[{"c", "++"}], "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "[", 
    RowBox[{"toPseudoCppCode", ",", "$numberOfTempsVars"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"$numberOfTempsVars", "=", "0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"toPseudoCppCode", "[", 
     RowBox[{"expr_", ",", "index_List"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "term", ",", "mfgroups", ",", "pseudoCCode", ",", " ", "ntemps", ",", 
        "FFTpseudoCode"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "Operators", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"SetAttributes", "[", 
        RowBox[{"CPlus", ",", "Orderless"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"SetAttributes", "[", 
        RowBox[{"CTimes", ",", "Orderless"}], "]"}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Set", " ", "these", " ", "as", " ", "commutative", " ", "but", " ", 
         "not", " ", "associative"}], " ", "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Replace", " ", "Times", " ", "and", " ", "Plus", " ", "with", " ", 
         "C", " ", "oeprators"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"term", "=", 
        RowBox[{
         RowBox[{"expr", "/.", 
          RowBox[{
           RowBox[{"Times", "[", 
            RowBox[{"a___", ",", 
             RowBox[{"B_", "?", "meanFieldQ"}], ",", "b___"}], "]"}], 
           "\[RuleDelayed]", 
           RowBox[{"CTimes", "[", 
            RowBox[{"B", ",", 
             RowBox[{"a", " ", "b"}]}], "]"}]}]}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Plus", "\[Rule]", "CPlus"}], ",", 
           RowBox[{"Times", "\[Rule]", "CTimes"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "term", "]"}], "===", "CTimes"}], ",", 
         RowBox[{"term", " ", "=", " ", 
          RowBox[{"CPlus", "[", "term", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Find", " ", "terms", " ", "linear", " ", "in", " ", "the", " ", 
         "mean", " ", "fields"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"mfgroups", " ", "=", " ", 
        RowBox[{"Position", "[", 
         RowBox[{"term", ",", 
          RowBox[{"CTimes", "[", 
           RowBox[{
            RowBox[{"B_", "?", "meanFieldQ"}], ",", "subt_"}], "]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ntemps", " ", "=", " ", 
        RowBox[{"Length", "@", "mfgroups"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Store", " ", "the", " ", "maximum", " ", "number", " ", "of", " ", 
         "temp", " ", "variables", " ", "for", " ", "memory", " ", 
         "assignment", " ", "later"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{"ntemps", ">", "$numberOfTempsVars"}], ",", 
         RowBox[{"$numberOfTempsVars", "=", "ntemps"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"First", " ", "stage"}], " ", "-", " ", 
         RowBox[{
         "assign", " ", "temp", " ", "variables", " ", "to", " ", 
          "groups"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"pseudoCCode", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"CAssign", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "#", "]"}], ",", 
            RowBox[{"Extract", "[", 
             RowBox[{"term", ",", 
              RowBox[{
              "mfgroups", "\[LeftDoubleBracket]", "#", 
               "\[RightDoubleBracket]"}]}], "]"}]}], "]"}], "&"}], "/@", 
         RowBox[{"Range", "[", "ntemps", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"term", " ", "=", " ", 
        RowBox[{"term", "/.", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Reverse", "/@", "pseudoCCode"}], "/.", 
           RowBox[{"CAssign", "\[Rule]", "Rule"}]}], ")"}]}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Replace", " ", "term", " ", "to", " ", "recognize", " ", "temp", " ",
          "variables"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"Next", " ", "stage"}], " ", "-", " ", 
         RowBox[{
         "add", " ", "in", " ", "Fourier", " ", "transforms", " ", "for", " ",
           "pseudospectral", " ", "products"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"pseudoCCode", "=", 
        RowBox[{"pseudoCCode", "/.", 
         RowBox[{
          RowBox[{"CAssign", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "n_", "]"}], ",", 
            RowBox[{"CTimes", "[", 
             RowBox[{
              RowBox[{"B_", "?", "meanFieldQ"}], ",", "subt_"}], "]"}]}], 
           "]"}], "\[RuleDelayed]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"CAssign", "[", 
             RowBox[{
              RowBox[{"CTemp", "[", "n", "]"}], ",", 
              RowBox[{"(*", 
               RowBox[{"rescaleForFFT", "@"}], "*)"}], "subt"}], "]"}], ",", 
            RowBox[{"Cifft", "[", 
             RowBox[{"CTemp", "[", "n", "]"}], "]"}], ",", 
            RowBox[{"CAssign", "[", 
             RowBox[{
              RowBox[{"CTemp", "[", "n", "]"}], ",", 
              RowBox[{"CTimes", "[", 
               RowBox[{"B", ",", 
                RowBox[{"CTemp", "[", "n", "]"}]}], "]"}]}], "]"}]}], 
           "}"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Add", " ", "a", " ", "CPlus", " ", "around", " ", "temp", " ", 
         "variables", " ", "to", " ", "find", " ", "bits", " ", "for", " ", 
         "taking", " ", "forward", " ", "ffts"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"term", " ", "=", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Replace", "[", 
           RowBox[{"term", ",", 
            RowBox[{
             RowBox[{"CPlus", "[", "a__", "]"}], "\[RuleDelayed]", 
             RowBox[{"CPlus", "[", 
              RowBox[{
               RowBox[{"CPlus", "[", 
                RowBox[{"CTemp", "[", "0", "]"}], "]"}], ",", "a"}], "]"}]}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}], "//.", 
          RowBox[{
           RowBox[{"CPlus", "[", 
            RowBox[{
             RowBox[{"CPlus", "[", 
              RowBox[{"a___", ",", 
               RowBox[{"CTemp", "[", "0", "]"}]}], "]"}], ",", "tmp_CTemp", 
             ",", "b___"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"CPlus", "[", 
            RowBox[{
             RowBox[{"CPlus", "[", 
              RowBox[{"a", ",", 
               RowBox[{"CTemp", "[", "0", "]"}], ",", "tmp"}], "]"}], ",", 
             "b"}], "]"}]}]}], "/.", 
         RowBox[{
          RowBox[{"CPlus", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "0", "]"}], ",", "tmp__"}], "]"}], 
          "\[RuleDelayed]", 
          RowBox[{"CPlus", "[", "tmp", "]"}]}]}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"A", " ", "rather", " ", "long"}], "-", 
         RowBox[{"winded", " ", "way", " ", "to", " ", "do", " ", "this"}], 
         " ", "-", " ", 
         RowBox[{"surprisingly", " ", "tricky"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Pseudocode", " ", "for", " ", "taking", " ", "forward", " ", 
         "ffts"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"FFTpseudoCode", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CAssign", "[", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               ",", "#"}], "]"}], ",", 
             RowBox[{"Cfft", "[", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{"Cases", "[", 
           RowBox[{"term", ",", 
            RowBox[{"CPlus", "[", "tmp__CTemp", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}]}], "//", 
         "Flatten"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Replace", " ", "temp", " ", "variables", " ", "in", " ", "term"}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"term", " ", "=", " ", 
        RowBox[{"term", "/.", 
         RowBox[{"Cases", "[", 
          RowBox[{"FFTpseudoCode", ",", 
           RowBox[{
            RowBox[{"CAssign", "[", "a__", "]"}], "\[RuleDelayed]", 
            RowBox[{"Rule", "@@", 
             RowBox[{"Reverse", "[", 
              RowBox[{"{", "a", "}"}], "]"}]}]}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Add", " ", "fft", " ", "and", " ", "dealiasing", " ", "on", " ", 
         "the", " ", "end", " ", "and", " ", "remove", " ", "useless", " ", 
         "assignment"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"pseudoCCode", " ", "=", " ", 
        RowBox[{
         RowBox[{"Flatten", "@", 
          RowBox[{"Join", "[", 
           RowBox[{"pseudoCCode", ",", "FFTpseudoCode", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"CAssign", "[", 
               RowBox[{
                RowBox[{"CTemp", "[", "ntemps", "]"}], ",", 
                RowBox[{"rescaleForFFT", "@", "term"}]}], "]"}], ",", 
              RowBox[{"CDealias", "[", 
               RowBox[{"CTemp", "[", "ntemps", "]"}], "]"}], ",", 
              RowBox[{"CAssign", "[", 
               RowBox[{
                RowBox[{"CBlock", "@@", "index"}], ",", 
                RowBox[{"CTemp", "[", "ntemps", "]"}]}], "]"}]}], "}"}]}], 
           "]"}]}], "/.", 
         RowBox[{
          RowBox[{"CAssign", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "i_", "]"}], ",", 
            RowBox[{"CPlus", "[", 
             RowBox[{"CTemp", "[", "i_", "]"}], "]"}]}], "]"}], 
          "\[RuleDelayed]", 
          RowBox[{"Sequence", "[", "]"}]}]}]}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Function", " ", "to", " ", "store", " ", "c", " ", "variable", " ", 
     "definitions", " ", "for", " ", "other", " ", "stuff"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ClearAll", "[", "toCString", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Cm", "/:", 
     RowBox[{"toCString", "[", 
      RowBox[{"Cm", "[", 
       RowBox[{"i_", ",", "j_"}], "]"}], "]"}], ":=", 
     RowBox[{"\"\<C\>\"", "<>", 
      RowBox[{"ToString", "[", "i", "]"}], "<>", 
      RowBox[{"ToString", "[", "j", "]"}], "<>", "\"\<_\>\""}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"toCString", "[", "a_String", "]"}], ":=", "a"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CTemp", "/:", 
     RowBox[{"toCString", "[", 
      RowBox[{"CTemp", "[", "n_", "]"}], "]"}], ":=", 
     RowBox[{"\"\<Ctmp_\>\"", "<>", 
      RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<_\>\""}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"toCString", "[", 
      RowBox[{"mf_", "?", "meanFieldQ"}], "]"}], ":=", 
     RowBox[{"mf", "/.", "MFcppVariables"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Function", " ", "to", " ", 
     RowBox[{"take", " ", ".", "block"}], 
     RowBox[{"(", ")"}], " ", "method", " ", "of", " ", "Ckl_out", " ", 
     "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "ind2EigenBlock"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ind2EigenBlock", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i_", ",", "j_"}], "}"}], ",", "cmat_"}], "]"}], ":=", 
     RowBox[{"StringReplace", "[", 
      RowBox[{
       RowBox[{"cmat", "<>", "\"\<.block( \>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"i", "-", "1"}], ")"}], "NZ"}], ",", "InputForm"}], "]"}],
         "<>", "\"\<, \>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"j", "-", "1"}], ")"}], "NZ"}], ",", "InputForm"}], "]"}],
         "<>", "\"\<, NZ, NZ)\>\""}], ",", 
       RowBox[{"\"\<NZ\>\"", "\[Rule]", "\"\<NZ_\>\""}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Rules", " ", "to", " ", "change", " ", "pseudoCCode", " ", "into", " ", 
     "real", " ", "Ccode"}], " ", "*)"}], 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Must", " ", "be", " ", "used", " ", "with"}], " ", "//."}], " ",
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"COperatorRules", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"CTimes", "[", 
         RowBox[{"a_String", ",", "b_"}], "]"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", 
         RowBox[{"vec2DiagProd", "[", "a", "]"}], "<>", 
         RowBox[{"toCString", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CTimes", "[", 
         RowBox[{
          RowBox[{"a_", "?", "meanFieldQ"}], ",", "b_"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"toCString", "[", "a", "]"}], "<>", 
         RowBox[{"vec2DiagProd", "[", "a", "]"}], "<>", 
         RowBox[{"toCString", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CPlus", "[", "a__String", "]"}], "\[RuleDelayed]", 
        RowBox[{"ToString", "@", 
         RowBox[{"Row", "[", 
          RowBox[{
           RowBox[{"{", "a", "}"}], ",", "\"\< + \>\""}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CPlus", "[", 
         RowBox[{"a___", ",", "tmp_CTemp", ",", "b___"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{"CPlus", "[", 
         RowBox[{"a", ",", 
          RowBox[{"toCString", "[", "tmp", "]"}], ",", "b"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CAssign", "[", 
         RowBox[{"tmp_", ",", "b_String"}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"toCString", "[", "tmp", "]"}], "<>", "\"\< = \>\"", "<>", 
         "b"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CAssign", "[", 
         RowBox[{"str_String", ",", "tmp_CTemp"}], "]"}], "\[RuleDelayed]", 
        RowBox[{"CAssign", "[", 
         RowBox[{"str", ",", 
          RowBox[{"toCString", "[", "tmp", "]"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Cfft", "[", "a_CTemp", "]"}], "\[RuleDelayed]", 
        RowBox[{"fft", "<>", "\"\<( \>\"", "<>", 
         RowBox[{"toCString", "@", "a"}], "<>", " ", "\"\< )\>\""}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Cifft", "[", "a_CTemp", "]"}], "\[RuleDelayed]", 
        RowBox[{"ifft", "<>", "\"\<( \>\"", "<>", 
         RowBox[{"toCString", "@", "a"}], "<>", " ", "\"\< )\>\""}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"iLapFColl", "[", "str_String", "]"}], "\[RuleDelayed]", 
        RowBox[{"iLapFvar", "<>", 
         RowBox[{"vec2DiagProd", "[", "]"}], "<>", "\"\<(\>\"", "<>", "str", 
         "<>", "\"\<)\>\""}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CBlock", "[", 
         RowBox[{"i_", ",", "j_"}], "]"}], ":>", 
        RowBox[{"ind2EigenBlock", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"i", ",", "j"}], "}"}], ",", "CklOut"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CDealias", "[", "tmp_CTemp", "]"}], "\[RuleDelayed]", 
        RowBox[{"dealias", "<>", "\"\<(\>\"", "<>", 
         RowBox[{"toCString", "[", "tmp", "]"}], "<>", "\"\<)\>\""}]}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.614199820333446*^9, 3.614199973544842*^9}, {
   3.614200154568696*^9, 3.614200177457288*^9}, {3.614203202742343*^9, 
   3.6142032132053423`*^9}, {3.614203687436726*^9, 3.614203694398652*^9}, {
   3.614204078926628*^9, 3.614204079422367*^9}, 3.6142041354989843`*^9, {
   3.614204166229424*^9, 3.6142042190601587`*^9}, {3.614204254561245*^9, 
   3.614204333690789*^9}, {3.614331697718234*^9, 3.61433174227547*^9}, {
   3.614331906693769*^9, 3.614331911117732*^9}, {3.614331987606147*^9, 
   3.614332000077257*^9}, {3.614332466912683*^9, 3.614332469135511*^9}, {
   3.614332812588958*^9, 3.614332843516348*^9}, {3.614332874370685*^9, 
   3.614332874698839*^9}, {3.614332908946308*^9, 3.6143329191369057`*^9}, {
   3.614333144869622*^9, 3.614333156472726*^9}, {3.6143332710284643`*^9, 
   3.614333279858944*^9}, {3.6143622085326366`*^9, 3.614362280097941*^9}, 
   3.614362399974094*^9, {3.614362430655244*^9, 3.614362460967514*^9}, {
   3.6143846802878942`*^9, 3.614384682302619*^9}, 3.614436190971469*^9, {
   3.614436331371933*^9, 3.6144363355680647`*^9}, {3.614437229054408*^9, 
   3.61443728430906*^9}, {3.614437337853598*^9, 3.614437440432015*^9}, {
   3.614437482905383*^9, 3.614437585144912*^9}, {3.614437630726707*^9, 
   3.614437785531118*^9}, {3.614437848964754*^9, 3.614437967122786*^9}, {
   3.6144380848799877`*^9, 3.6144381352511873`*^9}, {3.6144382227794724`*^9, 
   3.614438293388933*^9}, {3.61443989562008*^9, 3.614439938088032*^9}, {
   3.6144401493798637`*^9, 3.61444017699675*^9}, {3.61444021553305*^9, 
   3.614440310323646*^9}, {3.61444036659039*^9, 3.614440615353231*^9}, {
   3.614440664885353*^9, 3.6144407634596643`*^9}, {3.614466811204368*^9, 
   3.614466893555069*^9}, {3.614467338629237*^9, 3.614467397648348*^9}, {
   3.614467447634305*^9, 3.614467566346293*^9}, {3.614467600650503*^9, 
   3.6144676225940247`*^9}, {3.6144676700570917`*^9, 3.614467711185996*^9}, {
   3.614467791283551*^9, 3.614467797969377*^9}, {3.6144679149890614`*^9, 
   3.614467955286832*^9}, {3.614467991859248*^9, 3.6144679928261623`*^9}, {
   3.614504879859517*^9, 3.6145049079875603`*^9}, {3.61454283629358*^9, 
   3.614542837167223*^9}, {3.614542878595272*^9, 3.6145428815772047`*^9}, {
   3.614543175274213*^9, 3.614543217236944*^9}, {3.614543286011907*^9, 
   3.614543330056481*^9}, 3.614543427918807*^9, {3.614544016420259*^9, 
   3.614544016783902*^9}, {3.614545405652108*^9, 3.6145454062903223`*^9}, {
   3.614553685029169*^9, 3.614553713332426*^9}, {3.614553820920223*^9, 
   3.614553821614222*^9}, {3.614615907007505*^9, 3.614615911160202*^9}, {
   3.614616031382146*^9, 3.614616036012775*^9}, {3.615115445069023*^9, 
   3.6151154781928577`*^9}, 3.6151155348790293`*^9, {3.615115588817881*^9, 
   3.615115605142126*^9}, {3.615115678487294*^9, 3.6151156814810743`*^9}, 
   3.61511576016107*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["Split up and assign to Ckl_out", "Subsubsection",
 CellChangeTimes->{{3.6142046790049763`*^9, 3.614204686099799*^9}, {
  3.6142051931686783`*^9, 3.614205195159081*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "tmp", ",", "variableDef", ",", "vecPreVarStringList", ",", 
      "scalarPreVarStringList", ",", "vectorPreVarQ", ",", "scalarPreVarQ", 
      ",", "ctempVars", ",", "cmatVars"}], "}"}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Form", " ", "the", " ", "full", " ", "equations", " ", "as", " ", "a", 
      " ", "single", " ", "text", " ", "block"}], " ", "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"fullEquations", " ", "=", " ", 
      RowBox[{
       RowBox[{"StringJoin", "@@", 
        RowBox[{"Riffle", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"StringJoin", "@@", 
              RowBox[{"Riffle", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"toPseudoCppCode", "[", 
                  RowBox[{
                   RowBox[{"fullMatrixEquationsC", "\[LeftDoubleBracket]", 
                    RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "j"}], "}"}]}], "]"}], "//.", 
                 "COperatorRules"}], ",", "\"\<;\\n\>\""}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i", ",", "4"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "4"}], "}"}]}], "]"}], "]"}], ",", 
          "\[IndentingNewLine]", "\"\<;\\n\\n\\n\\n\>\""}], "]"}]}], "<>", 
       "\"\<;\\n\>\""}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Form", " ", "the", " ", "variable", " ", "definitions"}], " ",
        "-", " ", 
       RowBox[{
       "the", " ", "functions", " ", "here", " ", "are", " ", "for", " ", 
        "pre"}], "-", 
       RowBox[{"defined", " ", "variables", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"e", ".", "g", "."}], ",", " ", "kxctmp_"}], ")"}], " ", 
        "not", " ", "the", " ", "automatically", " ", "generated", " ", 
        "ones"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"vecPreVarStringList", " ", "=", 
      RowBox[{
       RowBox[{"List", "@@", "vectorVars"}], "/.", "variablesInCpp"}]}], ";", 
     " ", 
     RowBox[{"(*", " ", 
      RowBox[{"List", " ", "of", " ", "vector", " ", "variables"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"scalarPreVarStringList", " ", "=", " ", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"variablesInCpp", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
        "vecPreVarStringList"}], "]"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{"List", " ", "of", " ", "vector", " ", "variables"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"vectorPreVarQ", " ", "=", " ", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "[", "vecPreVarStringList", "]"}], ";",
            "vecPreVarStringList"}], ")"}], ",", "#"}], "]"}], "&"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Returns", " ", "true", " ", "for", " ", "vector", " ", "variable"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"scalarPreVarQ", " ", "=", " ", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "[", "scalarPreVarStringList", "]"}], 
           ";", "scalarPreVarStringList"}], ")"}], ",", "#"}], "]"}], " ", 
       "&"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Returns", " ", "true", " ", "for", " ", "scalar", " ", "variable"}], 
      " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Collect", " ", "matrix", " ", "bits", " ", "together"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"CppToBasicVariables", "/.", "variablesInCpp"}], "/.", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"a_", "?", "vectorPreVarQ"}], "^", "n_"}], 
           "\[RuleDelayed]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"tmp", " ", "=", " ", 
              RowBox[{"a", "<>", "\"\<.pow(\>\"", "<>", 
               RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<)\>\""}]}], 
             ";", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"vecPreVarStringList", ",", "tmp"}], "]"}], ";", 
             "tmp"}], ")"}]}]}], "/.", 
         RowBox[{"\"\<kz_.pow(2)\>\"", "\[RuleDelayed]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"vecPreVarStringList", ",", "\"\<kz2_\>\""}], "]"}], 
            ";", "\"\<kz2_\>\""}], ")"}]}]}], "/.", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"a_", "?", "vectorPreVarQ"}], "  ", 
          RowBox[{"b_", "?", "vectorPreVarQ"}]}], "\[RuleDelayed]", 
         RowBox[{
         "\"\<(\>\"", "<>", "a", "<>", "\"\<*\>\"", "<>", "b", "<>", 
          "\"\<).matrix()\>\""}]}]}], "/.", 
       RowBox[{
        RowBox[{"a_", "?", "vectorPreVarQ"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", "\"\<.matrix()\>\""}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Collect", " ", "scalar", " ", "bits", " ", "together"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"fullCppVaribles", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"a_", "?", "scalarPreVarQ"}], "^", "n_"}], 
           "\[RuleDelayed]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"tmp", "=", 
              RowBox[{"\"\<pow(\>\"", "<>", 
               RowBox[{"ToString", "[", "a", "]"}], "<>", "\"\<,\>\"", "<>", 
               RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<)\>\""}]}], 
             ";", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"scalarPreVarStringList", ",", "tmp"}], "]"}], ";", 
             "tmp"}], ")"}]}]}], "/.", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"a_", "?", "scalarPreVarQ"}], " ", 
           RowBox[{"b_", "?", "scalarPreVarQ"}]}], "\[RuleDelayed]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"scalarPreVarStringList", ",", 
              RowBox[{
              "\"\<(\>\"", "<>", "a", "<>", "\"\<*\>\"", "<>", "b", "<>", 
               "\"\<)\>\""}]}], "]"}], ";", 
            RowBox[{
            "\"\<(\>\"", "<>", "a", "<>", "\"\<*\>\"", "<>", "b", "<>", 
             "\"\<)\>\""}]}], ")"}]}]}], "/.", 
        RowBox[{
         RowBox[{
          RowBox[{"n_", "?", "NumericQ"}], " ", 
          RowBox[{"a_", "?", "scalarPreVarQ"}]}], "\[RuleDelayed]", 
         RowBox[{"\"\<(\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"N", "[", "n", "]"}], "]"}], "<>", "\"\<*\>\"", "<>", "a", 
          "<>", "\"\<)\>\""}]}]}], "/.", 
       RowBox[{
        RowBox[{
         RowBox[{"n_", "?", "NumericQ"}], " ", "b_String"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"ToString", "[", 
          RowBox[{"N", "[", "n", "]"}], "]"}], "<>", "\"\<*\>\"", "<>", 
         "b"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{"fullCppVaribles", "/.", 
        RowBox[{
         RowBox[{"a_String", " ", "b_String"}], "\[RuleDelayed]", 
         RowBox[{"a", "<>", "\"\<*\>\"", "<>", "b"}]}]}], "/.", 
       RowBox[{
        RowBox[{"a_String", " ", "+", " ", "b_String"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", "\"\< + \>\"", "<>", "b"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Add", " ", "in", " ", "ftFactor"}], ",", " ", 
       RowBox[{
       "this", " ", "is", " ", "not", " ", "the", " ", "most", " ", 
        "efficient", " ", 
        RowBox[{"(", 
         RowBox[{"multiplying", " ", "vector"}], ")"}], " ", "but", " ", 
        RowBox[{"doesn", "'"}], "t", " ", "seem", " ", "worth", " ", "the", 
        " ", "effort"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{"fullCppVaribles", "/.", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Rule", "[", 
          RowBox[{"a_String", ",", "b_String"}], "]"}], ")"}], 
        "\[RuleDelayed]", 
        RowBox[{"(", 
         RowBox[{"Rule", "[", 
          RowBox[{"a", ",", 
           RowBox[{
           "\"\<(\>\"", "<>", "b", "<>", "\"\<)*\>\"", "<>", 
            "ftFactorVar"}]}], "]"}], ")"}]}]}]}], ";", "\[IndentingNewLine]",
      "\[IndentingNewLine]", 
     RowBox[{"ctempVars", " ", "=", " ", 
      RowBox[{"toCString", "/@", 
       RowBox[{"(", 
        RowBox[{"CTemp", "/@", 
         RowBox[{"Range", "[", "$numberOfTempsVars", "]"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"cmatVars", " ", "=", 
      RowBox[{"toCString", "/@", 
       RowBox[{"Flatten", "[", "Cmat", "]"}]}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"(*", " ", 
      RowBox[{"Declare", " ", "variables", " ", 
       RowBox[{"(", 
        RowBox[{"in", " ", "class", " ", "definition"}], ")"}]}], " ", "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"classVariableDec", " ", "=", " ", 
      RowBox[{"\"\<dcmplxVecM \>\"", "<>", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{
          RowBox[{"CppToBasicVariables", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}], 
          ",", "\"\<, \>\""}], "]"}]}], "<>", "\"\<;\\n\\n\>\"", "<>", 
       "\[IndentingNewLine]", "\"\<dcmplx \>\"", "<>", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{
          RowBox[{"CppToBasicVariables", "\[LeftDoubleBracket]", 
           RowBox[{"2", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}], 
          ",", "\"\<, \>\""}], "]"}]}], "<>", "\"\<;\\n\\n\>\"", "<>", 
       "\[IndentingNewLine]", "\"\<dcmplxMat \>\"", "<>", " ", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{"ctempVars", ",", "\"\<, \>\""}], "]"}]}], "<>", 
       "\"\<;\\n\\n\>\"", "<>", "\[IndentingNewLine]", "\"\<dcmplxMat \>\"", "<>",
        " ", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{"cmatVars", ",", "\"\<, \>\""}], "]"}]}], "<>", 
       "\"\<;\\n\>\""}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     
     RowBox[{"(*", " ", 
      RowBox[{
      "Assign", " ", "memory", " ", "to", " ", "variables", " ", "in", " ", 
       "class", " ", "constructor"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"classConstrAssignMem", " ", "=", 
      RowBox[{
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "<>", "\"\< = dcmplxVecM(NZ_);\\n\>\""}], "&"}], "/@", 
          RowBox[{"CppToBasicVariables", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}]}], 
         ")"}]}], "<>", "\"\<\\n\>\"", "<>", "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "<>", "\"\< = dcmplxMat(NZ_,NZ_);\\n\>\""}], "&"}], "/@",
           "ctempVars"}], ")"}]}], "<>", "\"\<\\n\>\"", "<>", 
       "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "<>", "\"\< = dcmplxMat(NZ_,NZ_);\\n\>\""}], "&"}], "/@",
           "cmatVars"}], ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Assign", " ", "variables", " ", "inside", " ", "the", " ", 
       "equations"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"assignCppVarsInEqs", " ", "=", 
      RowBox[{
      "\"\<// Vector variable definition (automatic)\\n\>\"", "<>", " ", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "<>", "\"\< = \>\"", " ", "<>", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "<>", "\"\<;\\n\>\""}], "&"}], "/@", 
          RowBox[{
          "fullCppVaribles", "\[LeftDoubleBracket]", "1", 
           "\[RightDoubleBracket]"}]}], ")"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"assignCppVarsInEqs", " ", "=", 
      RowBox[{
      "\"\<// Scalar variable definition (automatic)\\n\>\"", "<>", " ", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "<>", "\"\< = \>\"", " ", "<>", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "<>", "\"\<;\\n\>\""}], "&"}], "/@", 
          RowBox[{
          "fullCppVaribles", "\[LeftDoubleBracket]", "2", 
           "\[RightDoubleBracket]"}]}], ")"}]}], "<>", "\"\<\\n\>\"", "<>", 
       "assignCppVarsInEqs"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"assignCppVarsInEqs", " ", "=", " ", 
      RowBox[{
      "\"\<// Submatrix variable definition (automatic)\\n\>\"", "<>", 
       "\[IndentingNewLine]", 
       RowBox[{"(", 
        RowBox[{"StringJoin", "@@", 
         RowBox[{"Riffle", "[", 
          RowBox[{
           RowBox[{"Flatten", "@", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"toCString", "[", 
                RowBox[{"Cm", "[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}], "<>", "\"\< = \>\"", "<>", 
               RowBox[{"ind2EigenBlock", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"i", ",", "j"}], "}"}], ",", "CklIn"}], "]"}]}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "numVariables"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "numVariables"}], "}"}]}], "]"}]}], ",", 
           "\"\<;\\n\>\""}], "]"}]}], ")"}], "<>", "\"\<;\\n\\n\>\"", "<>", 
       "assignCppVarsInEqs"}]}], ";"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]",
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
    "SAVE", " ", "ALL", " ", "THIS", " ", "STUFF", " ", "TO", " ", "FILE"}], 
    " ", "*)"}],
   FontColor->RGBColor[0.5, 0, 0.5]]}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{
  "\"\<~/Documents/MRIDSS/Mathematica/MMA_Generated_Equations_BQlin.cpp\>\"", 
   ",", "\[IndentingNewLine]", 
   RowBox[{
   "\"\<// Automatically generated temporary variables - class \
definition\\n\>\"", "<>", "\[IndentingNewLine]", "classVariableDec", "<>", 
    "\"\<\\n\\n\\n\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
    "\"\<// Automatically generated temporary variables - class \
constructor\\n\>\"", "<>", "\[IndentingNewLine]", "classConstrAssignMem", 
    "<>", "\"\<\\n\\n\\n\\n\\n\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
    "\"\<//Assign automatically generated variables in equations \\n\>\"", "<>",
     "\[IndentingNewLine]", "assignCppVarsInEqs", "<>", 
    "\"\<\\n\\n\\n\\n\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
    "\"\<////////////////////////////////////////////////////////\\n\>\"", "<>",
     "\[IndentingNewLine]", 
    "\"\<///       AUTOMATICALLY GENERATED EQUATIONS         /////\\n\>\"", "<>",
     "\[IndentingNewLine]", 
    "\"\<///       see GenerateC++Equations.nb in MMA        /////\\n\\n\>\"",
     "<>", "\[IndentingNewLine]", "fullEquations", "<>", 
    "\[IndentingNewLine]", 
    "\"\<///     AUTOMATICALLY GENERATED EQUATIONS - END       ///\\n\>\"", "<>",
     "\[IndentingNewLine]", 
    "\"\<////////////////////////////////////////////////////////\\n\>\""}], 
   ",", "\[IndentingNewLine]", "\"\<Text\>\""}], 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.6142047962878428`*^9, 3.6142048287650623`*^9}, {
   3.6142048623685904`*^9, 3.614204871407317*^9}, {3.614204927104175*^9, 
   3.614205167284988*^9}, {3.6142056503063517`*^9, 3.61420569620709*^9}, {
   3.614205733874864*^9, 3.6142057372347527`*^9}, {3.614205801605402*^9, 
   3.6142058147158327`*^9}, {3.614205856654711*^9, 3.614205911695675*^9}, {
   3.614206098560555*^9, 3.6142061335704403`*^9}, {3.614206170108762*^9, 
   3.6142061881144047`*^9}, 3.614206293851531*^9, {3.614206461617001*^9, 
   3.614206486966379*^9}, {3.6142065247418213`*^9, 3.614206525340083*^9}, {
   3.6142065934740763`*^9, 3.6142066005860767`*^9}, {3.614206631795189*^9, 
   3.61420665105902*^9}, {3.6142067668503103`*^9, 3.614206811713435*^9}, {
   3.614206859537304*^9, 3.614206860286922*^9}, {3.6142944293493757`*^9, 
   3.6142944433506927`*^9}, {3.614333316719392*^9, 3.6143334120699873`*^9}, {
   3.614333444377398*^9, 3.614333520964388*^9}, {3.614334399437749*^9, 
   3.61433440340563*^9}, {3.6143353683089323`*^9, 3.614335386748166*^9}, {
   3.6143356115565863`*^9, 3.614335642695072*^9}, {3.614335677308119*^9, 
   3.6143357063543158`*^9}, {3.61433586767843*^9, 3.614336158690496*^9}, {
   3.614336266943084*^9, 3.614336291062385*^9}, {3.614336322628447*^9, 
   3.614336357271209*^9}, {3.614336422201798*^9, 3.61433649219413*^9}, {
   3.6143365411420527`*^9, 3.614336642975008*^9}, {3.614336674388867*^9, 
   3.6143367439724493`*^9}, {3.6143368053654327`*^9, 3.614336827572853*^9}, {
   3.614336871824078*^9, 3.6143368722227917`*^9}, {3.614336903252371*^9, 
   3.614336957793364*^9}, {3.614337118801602*^9, 3.614337369809972*^9}, {
   3.6143374183062*^9, 3.614337432720202*^9}, {3.6143375078514223`*^9, 
   3.6143375282046423`*^9}, {3.6143376036820707`*^9, 3.614337849225244*^9}, {
   3.6143384130703163`*^9, 3.6143384249236937`*^9}, {3.614342468760648*^9, 
   3.614342483795895*^9}, {3.614344870214403*^9, 3.6143448765804043`*^9}, {
   3.6144668024268312`*^9, 3.61446680622049*^9}, {3.614468473094071*^9, 
   3.614468475362665*^9}, {3.6144685580405807`*^9, 3.61446858694422*^9}, {
   3.614468765757752*^9, 3.614468940401372*^9}, {3.614468984586191*^9, 
   3.6144689917783127`*^9}, {3.6144690589896708`*^9, 3.614469059077342*^9}, {
   3.6144691527364483`*^9, 3.6144693667898083`*^9}, {3.614469425367859*^9, 
   3.614469464109496*^9}, {3.6144695490098*^9, 3.6144695491606627`*^9}, {
   3.6144696598494787`*^9, 3.614469660520706*^9}, {3.614469930003291*^9, 
   3.614469937711336*^9}, {3.6144705198149643`*^9, 3.6144705200068417`*^9}, {
   3.6144706655301447`*^9, 3.614470681320969*^9}, {3.614504720143795*^9, 
   3.614504863524947*^9}, {3.614505100915875*^9, 3.614505121919724*^9}, {
   3.614505152906884*^9, 3.614505155503438*^9}, {3.614505221394732*^9, 
   3.614505221833407*^9}, {3.614505263530373*^9, 3.614505263936371*^9}, 
   3.614505308586783*^9, {3.614542746037664*^9, 3.6145427529093513`*^9}, {
   3.6151155952051477`*^9, 3.6151155960670958`*^9}, 3.615115949932311*^9, {
   3.615116475499711*^9, 3.6151165142277412`*^9}}],

Cell[BoxData["\<\"~/Documents/MRIDSS/Mathematica/MMA_Generated_Equations_\
BQlin.cpp\"\>"], "Output",
 CellChangeTimes->{
  3.6143387121822042`*^9, 3.614342337188706*^9, 3.614342486239141*^9, {
   3.6143448771742496`*^9, 3.61434488321599*^9}, 3.6143450218542852`*^9, 
   3.6143451076824017`*^9, 3.6144684790958347`*^9, 3.614469003670755*^9, 
   3.614469059822981*^9, {3.614469192413805*^9, 3.6144692034064283`*^9}, 
   3.614469373655657*^9, 3.6144694649976387`*^9, 3.614469550711421*^9, 
   3.6144696641046753`*^9, 3.614469938679933*^9, 3.614470523412774*^9, {
   3.614505127983507*^9, 3.6145051571376143`*^9}, 3.6145052231571608`*^9, 
   3.614505266300125*^9, 3.614505313529387*^9, {3.6145427143213997`*^9, 
   3.614542725540413*^9}, 3.614542757103635*^9, 3.614542844817013*^9, 
   3.614542885049453*^9, 3.614543449184469*^9, {3.614545738357164*^9, 
   3.614545751438102*^9}, 3.6145539650685472`*^9, 3.614615781332468*^9, 
   3.6146160441739893`*^9, 3.615116154688633*^9, 3.61511651711749*^9, 
   3.633267037863495*^9}]
}, Closed]]
}, Closed]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["B-field Quasi-linear", "Section",
 CellChangeTimes->{{3.6132857813215227`*^9, 3.613285785435519*^9}, {
  3.614613863421791*^9, 3.614613866708189*^9}}],

Cell[TextData[{
 "Quasi-linear equations including only interactions of fluctuations with ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["B", "x"], ",", " ", 
    SubscriptBox["B", "y"]}], TraditionalForm]]]
}], "Text",
 CellChangeTimes->{{3.613285788264741*^9, 3.613285816975567*^9}, {
  3.6132858538148127`*^9, 3.613285857694859*^9}, {3.614613871740099*^9, 
  3.6146138827358103`*^9}}],

Cell[CellGroupData[{

Cell["Derive equations", "Subsection",
 CellChangeTimes->{{3.613285862743395*^9, 3.613285865310978*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"numVariables", " ", "=", " ", "4"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"zt", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"z", ",", "t"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"meanFields", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
    "0", ",", "0", ",", "0", ",", "Bx", ",", "By", ",", "0", ",", "0"}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"meanFieldsWDerivs", " ", "=", " ", 
   RowBox[{"Rest", "@", 
    RowBox[{"Union", "[", 
     RowBox[{"Join", "[", 
      RowBox[{"meanFields", ",", 
       RowBox[{"dz", "/@", "meanFields"}], ",", 
       RowBox[{"dz", "/@", 
        RowBox[{"dz", "/@", "meanFields"}]}], ",", 
       RowBox[{"dz", "/@", 
        RowBox[{"dz", "/@", 
         RowBox[{"dz", "/@", "meanFields"}]}]}], ",", 
       RowBox[{"dz", "/@", 
        RowBox[{"dz", "/@", 
         RowBox[{"dz", "/@", 
          RowBox[{"dz", "/@", "meanFields"}]}]}]}]}], "]"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"meanFieldQ", " ", "=", " ", 
    RowBox[{
     RowBox[{"MemberQ", "[", 
      RowBox[{"meanFieldsWDerivs", ",", "#"}], "]"}], "&"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fullMFeqns", " ", "=", " ", 
    RowBox[{"Subtract", "@@@", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"Bx", "@@", "zt"}], ",", "t"}], "]"}], "\[Equal]", 
        RowBox[{
         RowBox[{"ReyBx", "@@", "zt"}], "+", 
         RowBox[{"\[Eta]b", " ", 
          RowBox[{"Bx", "@@", "zt"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"By", "@@", "zt"}], ",", "t"}], "]"}], "\[Equal]", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "q"}], " ", 
          RowBox[{"Bx", "@@", "zt"}]}], "+", 
         RowBox[{"ReyBy", "@@", "zt"}], "+", 
         RowBox[{"\[Eta]b", " ", 
          RowBox[{"By", "@@", "zt"}]}]}]}], ",", "0"}], "}"}]}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Plug", " ", "in", " ", "mean", " ", "field"}], " ", "+", " ", 
    RowBox[{
    "fluctuations", " ", "into", " ", "NL", " ", "equations", " ", "and", " ",
      "linearize"}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"NL2fluct", ",", "fourierRules"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"NL2fluct", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
          "fullNLvars", "\[LeftDoubleBracket]", "i", 
           "\[RightDoubleBracket]"}], "\[Rule]", 
          RowBox[{"Function", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x", ",", "y", ",", "z", ",", "t"}], "}"}], ",", 
            RowBox[{"Evaluate", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                "meanFields", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "@@", 
                RowBox[{"{", 
                 RowBox[{"z", ",", "t"}], "}"}]}], "+", 
               RowBox[{
                RowBox[{
                "fullNLvars", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "@@", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "y", ",", "z", ",", "t"}], "}"}]}]}], "/.", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"0", "[", "__", "]"}], ")"}], "\[Rule]", "0"}]}], 
             "]"}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "fullNLvars", "]"}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Plug", " ", "in", " ", "to", " ", "full", " ", "equations", " ", 
        "and", " ", "linearize"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"linearize", "[", 
          RowBox[{"#", ",", "fullNLvars", ",", "xtv"}], "]"}], "&"}], "/@", 
        RowBox[{"Expand", "[", 
         RowBox[{"fullNLeqns", "/.", "NL2fluct"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "fullFluctEqs", " ", "still", " ", "contain", " ", "a", " ", "mean", 
        " ", "field", " ", "part"}], " ", "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Shearing", " ", "wave", " ", "expansion"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"fourierRules", "=", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", "var", "}"}], ",", 
          RowBox[{"Evaluate", "[", 
           RowBox[{"var", "\[Rule]", 
            RowBox[{"Function", "[", 
             RowBox[{
              RowBox[{"Evaluate", "@", "xtv"}], ",", 
              RowBox[{
               RowBox[{"var", "[", 
                RowBox[{"z", ",", "t"}], "]"}], 
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"\[ImaginaryI]", " ", 
                  RowBox[{"(", 
                   RowBox[{"kx", "+", 
                    RowBox[{"q", " ", "t", " ", "ky"}]}], ")"}], "x"}], " ", 
                 "+", " ", 
                 RowBox[{"\[ImaginaryI]", " ", "ky", " ", "y"}]}], "]"}]}]}], 
             "]"}]}], "]"}]}], "]"}], "/@", "fullNLvars"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{"Expand", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"fullFluctEqs", "/.", "fourierRules"}], ")"}], "/", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"\[ImaginaryI]", " ", 
            RowBox[{"(", 
             RowBox[{"kx", "+", 
              RowBox[{"q", " ", "t", " ", "ky"}]}], ")"}], "x"}], " ", "+", 
           " ", 
           RowBox[{"\[ImaginaryI]", " ", "ky", " ", "y"}]}], "]"}]}], "]"}]}],
       ";", 
      RowBox[{"(*", 
       RowBox[{
       "Shearing", " ", "wave", " ", "in", " ", "x", " ", "and", " ", "y"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{"fullFluctEqs", "/.", 
        RowBox[{
         SuperscriptBox["\[ExponentialE]", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "\[ImaginaryI]"}], " ", 
            RowBox[{"(", 
             RowBox[{
              SubscriptBox["k", "x"], "+", 
              RowBox[{
               SubscriptBox["k", "y"], " ", "q", " ", "t"}]}], ")"}], " ", 
            "x"}], "-", 
           RowBox[{"\[ImaginaryI]", " ", 
            SubscriptBox["k", "y"], " ", "y"}]}]], "\[Rule]", "0"}]}]}], ";", 
      " ", 
      RowBox[{"(*", " ", 
       RowBox[{"Remove", " ", "mean", " ", "components"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"fullFluctEqs", "/.", 
          RowBox[{"kx", "\[Rule]", 
           RowBox[{"kxb", "-", 
            RowBox[{"q", " ", "t", " ", "ky"}]}]}]}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"kxb", "\[Rule]", 
            RowBox[{"kxb", "/", "\[ImaginaryI]"}]}], ",", 
           RowBox[{"ky", "\[Rule]", 
            RowBox[{"ky", "/", "\[ImaginaryI]"}]}]}], "}"}]}], "//", 
        "Expand"}]}]}]}], " ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Use", " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "_"]}], "=", 
      RowBox[{
       SubscriptBox["k", "x"], "+", 
       RowBox[{
        SubscriptBox["qtk", "y"], " ", "as", " ", "in", " ", 
        RowBox[{"c", "++"}], " ", "code"}]}]}], " ", "*)"}], 
    "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Derive", " ", "Orr"}], "-", 
     RowBox[{"Somerfeld", " ", "like", " ", "equations"}]}], ",", " ", 
    RowBox[{
     RowBox[{"don", "'"}], "t", " ", "need", " ", "to", " ", "reduce", " ", 
     "other", " ", "equations"}], ",", " ", 
    RowBox[{
    "just", " ", "write", " ", "down", " ", "equations", " ", "for", " ", 
     RowBox[{"Lap", "[", "u", "]"}]}], ",", "\[Zeta]", ",", "b", ",", 
    "\[Eta]"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"derivRules", ",", "LapMGradDiv1", ",", "manualSub"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"derivRules", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Derivative", "[", 
           RowBox[{"n_", ",", "m_"}], "]"}], "[", "a_", "]"}], "[", "vs__", 
         "]"}], "\[RuleDelayed]", 
        RowBox[{"Nest", "[", 
         RowBox[{"dt", ",", 
          RowBox[{"Nest", "[", 
           RowBox[{"dz", ",", 
            RowBox[{"a", "[", "vs", "]"}], ",", "n"}], "]"}], ",", "m"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"LapMGradDiv1", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"kxb", "^", "2"}], "+", 
            RowBox[{"ky", "^", "2"}]}], ")"}], 
          RowBox[{
          "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], "+", 
         
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{
           "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
           "z", ",", "z"}], "]"}], "-", 
         RowBox[{"kxb", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"kxb", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            "+", 
            RowBox[{"ky", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            "+", 
            RowBox[{"D", "[", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
              ",", "z"}], "]"}]}], ")"}]}]}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"finalEqs", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"iLapF", "[", 
            RowBox[{
             RowBox[{"Expand", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"LapMGradDiv1", "[", 
                 RowBox[{"fullFluctEqs", "/.", 
                  RowBox[{"\[Nu]b", "\[Rule]", "0"}]}], "]"}], "/.", 
                "derivRules"}], "/.", "toOrrSomerVars"}], "]"}], "//.", 
             "explicitLap2Rule"}], "]"}], "/.", "explicitLapFRule"}], "//", 
          "Expand"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Expand", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"D", "[", 
                RowBox[{
                 RowBox[{
                 "fullFluctEqs", "\[LeftDoubleBracket]", "2", 
                  "\[RightDoubleBracket]"}], ",", "z"}], "]"}], "-", 
               RowBox[{"ky", " ", 
                RowBox[{
                "fullFluctEqs", "\[LeftDoubleBracket]", "3", 
                 "\[RightDoubleBracket]"}]}]}], "/.", "derivRules"}], "/.", 
             "toOrrSomerVars"}], "]"}], "//.", "explicitLap2Rule"}], "/.", 
          RowBox[{"\[Nu]b", "\[Rule]", "0"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Expand", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
              "fullFluctEqs", "\[LeftDoubleBracket]", "5", 
               "\[RightDoubleBracket]"}], "/.", "derivRules"}], "/.", 
             "toOrrSomerVars"}], "]"}], "//.", "explicitLap2Rule"}], "/.", 
          RowBox[{"\[Eta]b", "\[Rule]", "0"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Expand", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"D", "[", 
                RowBox[{
                 RowBox[{
                 "fullFluctEqs", "\[LeftDoubleBracket]", "6", 
                  "\[RightDoubleBracket]"}], ",", "z"}], "]"}], "-", 
               RowBox[{"ky", " ", 
                RowBox[{
                "fullFluctEqs", "\[LeftDoubleBracket]", "7", 
                 "\[RightDoubleBracket]"}]}]}], "/.", "derivRules"}], "/.", 
             "toOrrSomerVars"}], "]"}], "//.", "explicitLap2Rule"}], "/.", 
          RowBox[{"\[Eta]b", "\[Rule]", "0"}]}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Fix", " ", "these", " ", "up", " ", "manually"}], " ", "-", 
        " ", 
        RowBox[{"sometimes", " ", "much", " ", "easier"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"This", " ", "is", " ", "plugging", " ", "in", " ", 
         RowBox[{"iLapF", "[", "lapF", "]"}]}], " ", "=", " ", 
        RowBox[{
        "1", " ", "in", " ", "the", " ", "more", " ", "complicated", " ", 
         "situation"}]}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"finalEqs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"finalEqs", "/.", 
          RowBox[{
           RowBox[{"Expand", "[", 
            RowBox[{
             RowBox[{"-", "ky"}], " ", 
             RowBox[{"iLapF", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                    RowBox[{
                    RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                    RowBox[{"D", "[", 
                    RowBox[{"#", ",", "z", ",", "z"}], "]"}]}], ")"}], "&"}], 
                 "[", 
                 RowBox[{
                  RowBox[{"b", "[", 
                   RowBox[{"z", ",", "t"}], "]"}], " ", 
                  RowBox[{"By", "[", 
                   RowBox[{"z", ",", "t"}], "]"}]}], "]"}], ")"}], "/.", 
               "derivRules"}], "]"}]}], "]"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"-", " ", "ky"}], " ", 
            RowBox[{"b", "[", 
             RowBox[{"z", ",", "t"}], "]"}], 
            RowBox[{"By", "[", 
             RowBox[{"z", ",", "t"}], "]"}]}]}]}], "/.", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Expand", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "kxb"}], " ", 
             RowBox[{"iLapF", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                    RowBox[{
                    RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                    RowBox[{"D", "[", 
                    RowBox[{"#", ",", "z", ",", "z"}], "]"}]}], ")"}], "&"}], 
                 "[", 
                 RowBox[{
                  RowBox[{"b", "[", 
                   RowBox[{"z", ",", "t"}], "]"}], " ", 
                  RowBox[{"Bx", "[", 
                   RowBox[{"z", ",", "t"}], "]"}]}], "]"}], ")"}], "/.", 
               "derivRules"}], "]"}]}], "+", 
            RowBox[{"kxb", " ", 
             RowBox[{"iLapF", "[", 
              RowBox[{
               RowBox[{"dz", "[", 
                RowBox[{"b", "[", 
                 RowBox[{"z", ",", " ", "t"}], "]"}], "]"}], " ", 
               RowBox[{"dz", "[", 
                RowBox[{"Bx", "[", 
                 RowBox[{"z", ",", " ", "t"}], "]"}], "]"}]}], "]"}]}]}], 
           "]"}], "\[RuleDelayed]", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "kxb"}], " ", 
            RowBox[{"b", "[", 
             RowBox[{"z", ",", "t"}], "]"}], 
            RowBox[{"Bx", "[", 
             RowBox[{"z", ",", "t"}], "]"}]}], "+", 
           RowBox[{"kxb", " ", 
            RowBox[{"iLapF", "[", 
             RowBox[{
              RowBox[{"dz", "[", 
               RowBox[{"b", "[", 
                RowBox[{"z", ",", " ", "t"}], "]"}], "]"}], "  ", 
              RowBox[{"dz", "[", 
               RowBox[{"Bx", "[", 
                RowBox[{"z", ",", " ", "t"}], "]"}], "]"}]}], "]"}]}]}]}]}], "/.", 
        RowBox[{
         RowBox[{"Expand", "[", 
          RowBox[{
           RowBox[{"-", " ", "B0z"}], " ", 
           RowBox[{"iLapF", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                  RowBox[{
                   RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                  RowBox[{"dz", "[", 
                   RowBox[{"dz", "[", "#", "]"}], "]"}]}], ")"}], "&"}], "[", 
               
               RowBox[{"dz", "[", 
                RowBox[{"b", "[", 
                 RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], ")"}], "/.", 
             "derivRules"}], "]"}]}], "]"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"-", "B0z"}], " ", 
          RowBox[{"dz", "[", 
           RowBox[{"b", "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}]}]}]}]}], ";"}]}], 
    "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Now", ",", " ", 
    RowBox[{"form", " ", "the", " ", "A", " ", "matrix"}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"redvars", " ", "=", 
   RowBox[{"{", 
    RowBox[{"u", ",", "\[Zeta]", ",", "b", ",", "\[Eta]"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"finalEqs", "=", 
    RowBox[{"Expand", "[", 
     RowBox[{
      RowBox[{"Solve", "[", 
       RowBox[{
        RowBox[{"Thread", "[", 
         RowBox[{"finalEqs", "\[Equal]", "0"}], "]"}], ",", 
        RowBox[{"dt", "/@", 
         RowBox[{"(", 
          RowBox[{"Through", "[", 
           RowBox[{"redvars", "@@", 
            RowBox[{"{", 
             RowBox[{"z", ",", "t"}], "}"}]}], "]"}], ")"}]}]}], "]"}], 
      "\[LeftDoubleBracket]", 
      RowBox[{"1", ",", "All", ",", "2"}], "\[RightDoubleBracket]"}], "]"}]}],
    ";", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Solve", " ", "for", " ", "time"}], "-", "derivatives"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"Aop", " ", "=", " ", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Function", "[", 
          RowBox[{
           RowBox[{"{", "var", "}"}], ",", 
           RowBox[{
            RowBox[{"Plus", "@@", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"#", ",", 
                    RowBox[{"var", "[", 
                    RowBox[{"z", ",", "t"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}], ",", 
                  "#", ",", 
                  RowBox[{"{", "}"}]}], "]"}], "&"}], "/@", 
               RowBox[{"(", 
                RowBox[{"plusToList", "@", 
                 RowBox[{
                 "finalEqs", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}], "/.", 
            RowBox[{
             RowBox[{"var", "[", 
              RowBox[{"z", ",", "t"}], "]"}], "\[Rule]", "ph"}]}]}], "]"}], "/@",
          "redvars"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ")"}], "//", 
    "MatrixForm"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "This", " ", "matches", " ", "my", " ", "previously", " ", "derived", " ", 
    
    RowBox[{"(", 
     RowBox[{"by", " ", "hand"}], ")"}], " ", "version"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"\"\<Mean field derivatives: \>\"", ",", " ", 
    RowBox[{"Union", "@", 
     RowBox[{"Cases", "[", 
      RowBox[{
       RowBox[{"finalEqs", "/.", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"Through", "[", 
           RowBox[{"meanFields", "@@", 
            RowBox[{"{", 
             RowBox[{"z", ",", "t"}], "}"}]}], "]"}], "->", "meanFields"}], 
         "]"}]}], ",", 
       RowBox[{"a_", "?", "meanFieldQ"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}]}]}], "]"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.613288323045455*^9, 3.613288326117752*^9}, {
   3.613288389643783*^9, 3.613288407039393*^9}, {3.613288479968417*^9, 
   3.613288487728981*^9}, {3.613288573589717*^9, 3.613288752358992*^9}, {
   3.613288852631976*^9, 3.613288916198966*^9}, {3.613288986990489*^9, 
   3.6132891926695137`*^9}, {3.613289423308837*^9, 3.613289432319971*^9}, {
   3.613289540309534*^9, 3.613289551704471*^9}, {3.613289593180532*^9, 
   3.613289597516069*^9}, {3.6132897828569527`*^9, 3.613289799551094*^9}, {
   3.613289832684938*^9, 3.613289857392364*^9}, {3.613289899387167*^9, 
   3.613289949003064*^9}, {3.613290022566579*^9, 3.613290072980708*^9}, {
   3.6132901333440037`*^9, 3.6132902277049723`*^9}, {3.613290347360075*^9, 
   3.613290348877283*^9}, {3.613290407662169*^9, 3.6132904199021072`*^9}, {
   3.613290617515009*^9, 3.613290693570179*^9}, {3.6132907374778633`*^9, 
   3.613290807808112*^9}, {3.6132911924799023`*^9, 3.613291195598812*^9}, {
   3.6132912379815063`*^9, 3.613291248693972*^9}, {3.613291280284522*^9, 
   3.613291408458893*^9}, {3.613291458080309*^9, 3.613291470927746*^9}, {
   3.6132915090035563`*^9, 3.613291525286358*^9}, {3.6132921232255783`*^9, 
   3.613292144859001*^9}, {3.613292297867838*^9, 3.613292316012755*^9}, 
   3.6132930883268547`*^9, {3.613293312306075*^9, 3.61329333079275*^9}, {
   3.6133006141405077`*^9, 3.61330070673322*^9}, {3.613300799309185*^9, 
   3.613300851120187*^9}, {3.613300912016116*^9, 3.6133009327016172`*^9}, {
   3.6133010023231773`*^9, 3.613301012699256*^9}, {3.6133010441561947`*^9, 
   3.613301156627*^9}, 3.6133013078550577`*^9, {3.613301447081024*^9, 
   3.613301449877001*^9}, {3.6133015415117207`*^9, 3.6133015541220617`*^9}, {
   3.6133016618658733`*^9, 3.613301704111124*^9}, {3.61330185743235*^9, 
   3.613301871088355*^9}, {3.613301910782558*^9, 3.6133019246441307`*^9}, {
   3.613301999871911*^9, 3.6133020708752737`*^9}, {3.61330239110786*^9, 
   3.613302487596188*^9}, {3.613302551646475*^9, 3.61330262406814*^9}, {
   3.6133045173899403`*^9, 3.6133045479377737`*^9}, {3.6133047488389683`*^9, 
   3.6133047694867353`*^9}, {3.613304829996623*^9, 3.613304868581319*^9}, {
   3.613304943519965*^9, 3.613304948407606*^9}, {3.6133053005957613`*^9, 
   3.613305319748056*^9}, {3.6133261571880493`*^9, 3.613326178299334*^9}, {
   3.613326367599222*^9, 3.613326560664708*^9}, {3.613326591582814*^9, 
   3.613326696955864*^9}, {3.613327160076173*^9, 3.613327161075317*^9}, {
   3.61332757642347*^9, 3.613327611115761*^9}, {3.613327657453199*^9, 
   3.613327813791049*^9}, {3.61332805091748*^9, 3.6133280531810827`*^9}, {
   3.613328083202976*^9, 3.613328090811761*^9}, 3.613328347059229*^9, {
   3.613328833019064*^9, 3.6133288553167562`*^9}, {3.6133291560666847`*^9, 
   3.613329177719489*^9}, 3.6141771183999968`*^9, {3.614189292301111*^9, 
   3.614189302092698*^9}, {3.614361699979642*^9, 3.614361719890554*^9}, {
   3.614504566104581*^9, 3.614504591016654*^9}, {3.614504663864559*^9, 
   3.614504666982682*^9}, {3.614545423593639*^9, 3.614545467974424*^9}, {
   3.614545503295141*^9, 3.614545505932638*^9}, {3.6145455804415207`*^9, 
   3.614545585925158*^9}, {3.614545671972193*^9, 3.614545700909773*^9}, {
   3.61461389665655*^9, 3.6146138980964413`*^9}, {3.614614204204667*^9, 
   3.6146142157163477`*^9}, {3.615049925891439*^9, 3.6150500375845757`*^9}, {
   3.615050120302868*^9, 3.615050132436124*^9}, {3.615058978734177*^9, 
   3.6150589792378473`*^9}, {3.615059036540202*^9, 3.615059049994995*^9}, {
   3.615059082777017*^9, 3.615059123331399*^9}, 3.615059165146443*^9, {
   3.6150592355570507`*^9, 3.615059278639255*^9}, {3.6150593499296637`*^9, 
   3.6150593973669033`*^9}, {3.6150596662742233`*^9, 3.615059703232727*^9}, {
   3.615059763548058*^9, 3.6150597639725227`*^9}, {3.630443634372048*^9, 
   3.630443662436329*^9}, {3.630443703532732*^9, 3.630443753575468*^9}, {
   3.630443832739347*^9, 3.630443835701642*^9}, {3.630444044751194*^9, 
   3.630444104885125*^9}, {3.63326678695084*^9, 3.633266812921629*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["k", "y"], " ", "q", " ", 
       RowBox[{
        SuperscriptBox[
         SubscriptBox["\[EmptyUpTriangle]", "F"], 
         RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], 
      RowBox[{"2", " ", 
       RowBox[{
        SuperscriptBox[
         SubscriptBox["\[EmptyUpTriangle]", "F"], 
         RowBox[{"-", "1"}]], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}], 
        "]"}]}], 
      RowBox[{
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "x"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "y"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["B", "z0"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}], 
          " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["B", "x"], "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "-", 
       RowBox[{"2", " ", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{
             SubscriptBox["B", "x"], "[", 
             RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{
             SuperscriptBox[
              SubscriptBox["\[EmptyUpTriangle]", "2"], 
              RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], 
           "]"}]}], "]"}]}], "+", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "3"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["B", "x"], "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], 
         "]"}]}], "+", 
       RowBox[{"2", " ", 
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["B", "y"], "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], 
         "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{
             SubscriptBox["\[PartialD]", "z"], "[", 
             RowBox[{
              SubscriptBox["B", "x"], "[", 
              RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], 
         "]"}]}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         SubscriptBox["k", "y"]}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{"\[SmallCircle]", " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["B", "x"], "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "-", 
       RowBox[{"2", " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{
             SubscriptBox["B", "x"], "[", 
             RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], 
         "]"}]}], "+", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["B", "x"], "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "]"}]}], "+", 
       RowBox[{"2", " ", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        SubsuperscriptBox["k", "y", "2"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["B", "y"], "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "]"}]}], "-", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{
             SubscriptBox["\[PartialD]", "z"], "[", 
             RowBox[{
              SubscriptBox["B", "x"], "[", 
              RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], "]"}], " ", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "]"}]}]}]},
     {
      RowBox[{
       RowBox[{
        RowBox[{"-", "2"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "+", 
       RowBox[{"q", " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}]}], 
      "0", 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"]}], " ", "\[SmallCircle]", 
        " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "y"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "-", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "x"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}], 
      RowBox[{
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "x"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "y"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["B", "z0"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "x"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "-", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}]},
     {
      RowBox[{
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "x"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "y"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["B", "z0"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "x"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}]}], 
      RowBox[{
       SubscriptBox["k", "y"], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["B", "x"], "[", 
         RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
       RowBox[{
        SuperscriptBox[
         SubscriptBox["\[EmptyUpTriangle]", "2"], 
         RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "0", "0"},
     {
      RowBox[{
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "y"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], "]"}]}],
        "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "-", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "x"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        SubsuperscriptBox["k", "y", "2"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "y"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}], 
      RowBox[{
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "x"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "y"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["B", "z0"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "x"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "+", 
       RowBox[{"2", " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "y"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}], 
      RowBox[{
       RowBox[{"-", "q"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
      "0"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{
  3.613304869590173*^9, 3.6133049495007257`*^9, 3.6133053207405367`*^9, {
   3.613326485387342*^9, 3.613326561490202*^9}, {3.613326595815199*^9, 
   3.6133266040226097`*^9}, 3.613326660026622*^9, 3.61332716201223*^9, {
   3.6133275947793913`*^9, 3.613327612121537*^9}, {3.613327744727991*^9, 
   3.613327815555489*^9}, 3.613328054239262*^9, 3.613328356531164*^9, 
   3.613328856170669*^9, {3.613329165606255*^9, 3.613329178601987*^9}, 
   3.614177119713147*^9, 3.614189304110643*^9, 3.6143617220896473`*^9, 
   3.614504591952222*^9, 3.614504668409453*^9, 3.614542661480213*^9, 
   3.614545459261648*^9, 3.6145455874121523`*^9, {3.614545678856031*^9, 
   3.614545702075966*^9}, 3.614613916915284*^9, 3.6146142165153627`*^9, 
   3.614615738904825*^9, 3.614616051270179*^9, 3.6150498888017807`*^9, {
   3.615050010514894*^9, 3.615050039439272*^9}, {3.615050125142047*^9, 
   3.6150501367897873`*^9}, 3.6150510328884478`*^9, 3.615058980820615*^9, 
   3.615059051844551*^9, {3.615059085092457*^9, 3.615059124052795*^9}, 
   3.61505916670093*^9, 3.615059238878612*^9, {3.615059272035226*^9, 
   3.615059281071846*^9}, {3.61505936694058*^9, 3.615059402310771*^9}, 
   3.615059608203508*^9, {3.615059681641337*^9, 3.615059704416532*^9}, 
   3.6150598012273293`*^9, 3.615074766367387*^9, 3.615116828208126*^9, 
   3.627938122703177*^9, 3.627938245965809*^9, 3.627938353194584*^9, {
   3.627939561982108*^9, 3.627939575771302*^9}, 3.6304427832146873`*^9, 
   3.630443213587928*^9, 3.630443336721917*^9, 3.6304433809388323`*^9, {
   3.6304435182054987`*^9, 3.63044357221451*^9}, 3.630443636452478*^9, 
   3.6304436683794603`*^9, 3.630443708269318*^9, {3.630443742209834*^9, 
   3.630443754525981*^9}, 3.630443801529909*^9, 3.630443839666819*^9, {
   3.630444048956964*^9, 3.6304440666134233`*^9}, 3.630444107127067*^9, {
   3.63326679598462*^9, 3.633266815134177*^9}}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Mean field derivatives: \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["B", "x"], ",", 
     SubscriptBox["B", "y"], ",", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      SubscriptBox["B", "x"], "]"}], ",", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      SubscriptBox["B", "y"], "]"}], ",", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       SubscriptBox["B", "x"], "]"}], "]"}], ",", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       SubscriptBox["B", "y"], "]"}], "]"}], ",", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}], "]"}], "]"}]}], "}"}]}],
  SequenceForm[
  "Mean field derivatives: ", {$CellContext`Bx, $CellContext`By, 
    $CellContext`dz[$CellContext`Bx], 
    $CellContext`dz[$CellContext`By], 
    $CellContext`dz[
     $CellContext`dz[$CellContext`Bx]], 
    $CellContext`dz[
     $CellContext`dz[$CellContext`By]], 
    $CellContext`dz[
     $CellContext`dz[
      $CellContext`dz[$CellContext`Bx]]]}],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.615050136793145*^9, 3.615051032894452*^9, 3.6150589807883*^9, 
   3.615059051813497*^9, {3.615059085024743*^9, 3.615059124022328*^9}, 
   3.615059166650445*^9, 3.615059238827959*^9, {3.615059271978361*^9, 
   3.61505928104042*^9}, {3.6150593669099894`*^9, 3.615059402279347*^9}, 
   3.615059608170322*^9, {3.615059681577407*^9, 3.615059704380804*^9}, 
   3.615059801233618*^9, 3.6150747663747787`*^9, 3.615116828213006*^9, 
   3.627938122732933*^9, 3.627938245978257*^9, 3.627938353207582*^9, {
   3.627939561994133*^9, 3.627939575783758*^9}, 3.630442783243471*^9, 
   3.6304432136531963`*^9, 3.630443336750341*^9, 3.630443380960699*^9, {
   3.630443518217464*^9, 3.630443572228283*^9}, 3.630443636464563*^9, 
   3.63044366839019*^9, 3.630443708281684*^9, {3.630443742223608*^9, 
   3.6304437545378923`*^9}, 3.6304438015416403`*^9, 3.6304438396774807`*^9, {
   3.630444048969336*^9, 3.6304440666356773`*^9}, 3.630444107140677*^9, {
   3.633266795996911*^9, 3.633266815149823*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Working out the matrix product, and getting things into a \
\[OpenCurlyDoubleQuote]code convenient\[CloseCurlyDoubleQuote] form\
\>", "Subsection",
 CellChangeTimes->{{3.613329080723421*^9, 3.613329105297495*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Cmat", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"Cm", "[", 
     RowBox[{"i", ",", "j"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "numVariables"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", "numVariables"}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fullMatrixEquations", " ", "=", " ", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Aop", "\[LeftDoubleBracket]", 
          RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], "/.", 
         RowBox[{"ph", "->", 
          RowBox[{"Cmat", "\[LeftDoubleBracket]", 
           RowBox[{"j", ",", "k"}], "\[RightDoubleBracket]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "numVariables"}], "}"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "numVariables"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"k", ",", "numVariables"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Redefine", " ", "lapF", " ", "to", " ", "collect", " ", "as", " ", 
     "many", " ", "terms", " ", "as", " ", "possible"}], ",", " ", 
    RowBox[{"collect", " ", "in", " ", "mean", " ", "fields"}]}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fullMatrixEquations", "=", 
   RowBox[{"MapAll", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Collect", "[", 
       RowBox[{"#", ",", "meanFieldsWDerivs"}], "]"}], "&"}], ",", 
     RowBox[{
      RowBox[{"fullMatrixEquations", "/.", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"Through", "[", 
          RowBox[{"meanFields", "@@", 
           RowBox[{"{", 
            RowBox[{"z", ",", "t"}], "}"}]}], "]"}], "->", "meanFields"}], 
        "]"}]}], 
      RowBox[{"(*", 
       RowBox[{"Easier", " ", "to", " ", "look", " ", "at"}], "*)"}], "/.", 
      "\[IndentingNewLine]", 
      RowBox[{"iLapF", "\[Rule]", "iLapFColl"}]}]}], 
    RowBox[{"(*", 
     RowBox[{"Collect", " ", "iLapF", " ", "terms"}], "*)"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"fullMatrixEquations", "=", 
  RowBox[{"fullMatrixEquations", "//.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"dz", "[", 
       RowBox[{"a_", "/;", 
        RowBox[{"!", 
         RowBox[{"meanFieldQ", "[", "a", "]"}]}]}], "]"}], "\[RuleDelayed]", 
      RowBox[{"dz", " ", "a"}]}], ",", 
     RowBox[{
      RowBox[{"iLap2", "[", "a_", "]"}], "\[RuleDelayed]", 
      RowBox[{"iLap2", " ", "a"}]}]}], "}"}]}]}]}], "Input",
 CellChangeTimes->{{3.614183523653407*^9, 3.614183619973299*^9}, {
   3.6141837102104187`*^9, 3.61418374185849*^9}, {3.6141849032639017`*^9, 
   3.614184910371166*^9}, {3.6141856403035383`*^9, 3.614185671246872*^9}, {
   3.614185814106379*^9, 3.614185877677721*^9}, {3.614186008201589*^9, 
   3.6141860563838873`*^9}, {3.6141861298094*^9, 3.614186133404842*^9}, {
   3.614186265993711*^9, 3.614186266722341*^9}, {3.61418645140637*^9, 
   3.61418648051291*^9}, {3.614186552940997*^9, 3.6141865737590837`*^9}, {
   3.614188523622821*^9, 3.6141885248935966`*^9}, {3.614189283362381*^9, 
   3.614189315179832*^9}, {3.614189422729567*^9, 3.614189433440941*^9}, {
   3.614189677743164*^9, 3.61418967848466*^9}, {3.6141967572921963`*^9, 
   3.6141967583883953`*^9}, {3.6141989228199043`*^9, 3.614198945631775*^9}, 
   3.614198982104651*^9, {3.614361772710515*^9, 3.6143618063669567`*^9}, {
   3.614504631869879*^9, 3.614504678095435*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "2"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "3"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "2"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "3"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"3", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"3", "\[InvisibleComma]", "2"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"3", "\[InvisibleComma]", "3"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"4", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"4", "\[InvisibleComma]", "2"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"4", "\[InvisibleComma]", "3"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"4", "\[InvisibleComma]", "4"}]]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.614186133917675*^9, 3.614186267048477*^9, 3.614186481926425*^9, 
   3.6141885255283833`*^9, 3.614189319838678*^9, {3.6141894304574347`*^9, 
   3.614189433941032*^9}, 3.614189678940024*^9, 3.614195966966*^9, 
   3.614196761527596*^9, {3.61419892962738*^9, 3.614198946179511*^9}, 
   3.61419898388535*^9, {3.614361787735118*^9, 3.614361807137169*^9}, 
   3.614504597712901*^9, {3.614504637573621*^9, 3.6145046797962427`*^9}, 
   3.614542667785318*^9, 3.614545623141712*^9, 3.614545706505865*^9, 
   3.614545743858747*^9, 3.61461400100451*^9, 3.6146142242536373`*^9, 
   3.614615742538946*^9, 3.614616053498505*^9, 3.6150510348507347`*^9, 
   3.615059806600211*^9, 3.615116830068987*^9, 3.627939105693068*^9, {
   3.627939581795642*^9, 3.627939592430174*^9}, 3.6304428372808743`*^9, 
   3.630443217499037*^9, 3.630443341087009*^9, 3.630443403501874*^9, 
   3.630444380250361*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      SuperscriptBox[
       SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
       RowBox[{"-", "1"}]], "[", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "2"}], " ", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        SubscriptBox["k", "y"], " ", "q", " ", 
        SubscriptBox["\[ScriptCapitalC]", 
         RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
       RowBox[{"2", " ", 
        SubscriptBox["\[PartialD]", "z"], " ", 
        SubscriptBox["\[ScriptCapitalC]", 
         RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], "]"}], ",", 
     RowBox[{
      SuperscriptBox[
       SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
       RowBox[{"-", "1"}]], "[", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "2"}], " ", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        SubscriptBox["k", "y"], " ", "q", " ", 
        SubscriptBox["\[ScriptCapitalC]", 
         RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
       RowBox[{"2", " ", 
        SubscriptBox["\[PartialD]", "z"], " ", 
        SubscriptBox["\[ScriptCapitalC]", 
         RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], "]"}], ",", 
     RowBox[{
      SuperscriptBox[
       SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
       RowBox[{"-", "1"}]], "[", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "2"}], " ", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        SubscriptBox["k", "y"], " ", "q", " ", 
        SubscriptBox["\[ScriptCapitalC]", 
         RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
       RowBox[{"2", " ", 
        SubscriptBox["\[PartialD]", "z"], " ", 
        SubscriptBox["\[ScriptCapitalC]", 
         RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], "]"}], ",", 
     RowBox[{
      SuperscriptBox[
       SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
       RowBox[{"-", "1"}]], "[", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "2"}], " ", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        SubscriptBox["k", "y"], " ", "q", " ", 
        SubscriptBox["\[ScriptCapitalC]", 
         RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
       RowBox[{"2", " ", 
        SubscriptBox["\[PartialD]", "z"], " ", 
        SubscriptBox["\[ScriptCapitalC]", 
         RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], "]"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]]}], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]]}], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "3"}]]}], "-", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]]}], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "-", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]]}], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}]}], "}"}]}], "}"}]], "Output",\

 CellChangeTimes->{
  3.614186133917675*^9, 3.614186267048477*^9, 3.614186481926425*^9, 
   3.6141885255283833`*^9, 3.614189319838678*^9, {3.6141894304574347`*^9, 
   3.614189433941032*^9}, 3.614189678940024*^9, 3.614195966966*^9, 
   3.614196761527596*^9, {3.61419892962738*^9, 3.614198946179511*^9}, 
   3.61419898388535*^9, {3.614361787735118*^9, 3.614361807137169*^9}, 
   3.614504597712901*^9, {3.614504637573621*^9, 3.6145046797962427`*^9}, 
   3.614542667785318*^9, 3.614545623141712*^9, 3.614545706505865*^9, 
   3.614545743858747*^9, 3.61461400100451*^9, 3.6146142242536373`*^9, 
   3.614615742538946*^9, 3.614616053498505*^9, 3.6150510348507347`*^9, 
   3.615059806600211*^9, 3.615116830068987*^9, 3.627939105693068*^9, {
   3.627939581795642*^9, 3.627939592430174*^9}, 3.6304428372808743`*^9, 
   3.630443217499037*^9, 3.630443341087009*^9, 3.630443403501874*^9, 
   3.630444380336522*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Put everything into c++ form, including taking the Fourier transforms\
\>", "Subsection",
 CellChangeTimes->{{3.614195675973181*^9, 3.614195696141123*^9}}],

Cell[CellGroupData[{

Cell["Define the various functions and variables to use in c++", \
"Subsubsection",
 CellChangeTimes->{
  3.614200068915313*^9, {3.6145427017460127`*^9, 3.614542707265788*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"CklOut", " ", "=", " ", "\"\<Ckl_out[i]\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CklIn", " ", "=", " ", "\"\<Ckl_in[i]\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ifft", " ", "=", " ", "\"\<fft_.back_2DFull\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fft", " ", "=", " ", "\"\<fft_.for_2DFull\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dealias", " ", "=", " ", "\"\<dealias\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cppProducts", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"\"\<.asDiagonal()*\>\"", ",", "\"\<*\>\""}], "}"}]}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{"Second", " ", "one", " ", "is", " ", "for", " ", "scalars"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"MFcppVariables", " ", "=", 
  RowBox[{"Thread", "[", " ", 
   RowBox[{"meanFieldsWDerivs", "->", 
    RowBox[{"StringReplace", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ToString", "[", "#", "]"}], "<>", "\"\<_\>\""}], "&"}], "/@",
        "meanFieldsWDerivs"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<[\>\"", "\[Rule]", "\"\<\>\""}], ",", 
        RowBox[{"\"\<]\>\"", "\[Rule]", "\"\<\>\""}]}], "}"}]}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"iLapFvar", " ", "=", " ", "\"\<ilapFtmp_.matrix()\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ftFactorVar", "=", "\"\<fft2Dfac_\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"vectorVars", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"iLap2", ",", "dz", ",", "iLapFColl"}], "}"}]}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{
   "Variables", " ", "that", " ", "are", " ", "vectors", " ", "in", " ", 
    RowBox[{"c", "++"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"variablesInCpp", " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"ky", "\[Rule]", "\"\<kyctmp_\>\""}], ",", 
    RowBox[{"kxb", "\[Rule]", "\"\<kxctmp_\>\""}], ",", 
    RowBox[{"dz", "\[Rule]", "\"\<kz_\>\""}], ",", 
    RowBox[{"q", "\[Rule]", "\"\<q_\>\""}], ",", 
    RowBox[{"iLap2", "\[Rule]", "\"\<ilap2tmp_\>\""}], ",", 
    RowBox[{"ROT", "\[Rule]", "\"\<with_rotation_effects_\>\""}], ",", 
    RowBox[{"B0z", "\[Rule]", "\"\<B0z_\>\""}]}], "}"}]}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0Fsog2EAxvHFwsWSrTmkLJNyGjJaqOFbylYWk8LcIEpJiBYSJiRnMZEc
oiayJHKhtVBYqC1ulIVIbd8y5pCh4X2+i6ff5VN/YVVDUY0Pi8WKIIP7NHt4
4ImmTrQ/8/A8nF6GSY6oFcjxNW1Bw/LcNsxMkUQOEiX8ACE0H3U3DxH5kzMa
qFCE6aCo+pZxx5F/DHuaPs2wlLcZNEx0CY1cqOpPD4UVrxkCOGqVxUFZm5Wx
LyAnGaorxxkLJ/SpUBD4yBgi8RSfEj2DghKYW99qgT1L95cwXZ5ngx1/Cw+Q
7vWnYbwkhnE35Ft6RtToW7LhlPhwEcZm6pfgwJhoykKUt3fr4NXexYsVfRYL
3FBlfzF6iVl1tn3IXf/wQF5w1ze8cZel/eLvbYKx8GDtmuOiqXKV0ganpd4v
AVGpyfuB4hFdluKZphK3+dnQ6GdYNfk7qRutdwOq2Z13MLpIx9i4Uqu2c53U
bMI74z/4zg2J
  "]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    SubscriptBox["B", "x"], "\[Rule]", "\<\"Bx_\"\>"}], ",", 
   RowBox[{
    SubscriptBox["B", "y"], "\[Rule]", "\<\"By_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     SubscriptBox["B", "x"], "]"}], "\[Rule]", "\<\"dzBx_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     SubscriptBox["B", "y"], "]"}], "\[Rule]", "\<\"dzBy_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      SubscriptBox["B", "x"], "]"}], "]"}], "\[Rule]", "\<\"dzdzBx_\"\>"}], 
   ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      SubscriptBox["B", "y"], "]"}], "]"}], "\[Rule]", "\<\"dzdzBy_\"\>"}], 
   ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       SubscriptBox["B", "x"], "]"}], "]"}], "]"}], 
    "\[Rule]", "\<\"dzdzdzBx_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       SubscriptBox["B", "y"], "]"}], "]"}], "]"}], 
    "\[Rule]", "\<\"dzdzdzBy_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}], "]"}], "]"}], "]"}], 
    "\[Rule]", "\<\"dzdzdzdzBx_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}], "]"}], "]"}], "]"}], 
    "\[Rule]", "\<\"dzdzdzdzBy_\"\>"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6141968971191683`*^9, {3.614196955865787*^9, 3.614196976553069*^9}, 
   3.6141970176273737`*^9, {3.614197140642284*^9, 3.6141971499528723`*^9}, 
   3.61420280515613*^9, 3.6142041474039993`*^9, 3.61420432093274*^9, 
   3.614332753782305*^9, 3.6143334373897533`*^9, 3.614334227966806*^9, 
   3.614335330770611*^9, {3.614342317980378*^9, 3.6143423257325563`*^9}, 
   3.614345100654113*^9, 3.614361816160263*^9, 3.614385394517193*^9, 
   3.614436871615592*^9, 3.6144373337998466`*^9, 3.614437922414172*^9, 
   3.61446781112652*^9, 3.614504610070334*^9, 3.614504924258411*^9, 
   3.614542674887701*^9, 3.61454565515012*^9, 3.614545745944592*^9, 
   3.614615781190735*^9, 3.615115374144129*^9, 3.6151157690167103`*^9, {
   3.615116874721467*^9, 3.615116883022649*^9}, 3.627939180153124*^9, 
   3.627939594335135*^9, 3.630442842318356*^9, 3.630443220590811*^9, 
   3.630443344125722*^9, 3.6304434063638687`*^9, 3.6304443833087807`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    SubscriptBox["k", "y"], "\[Rule]", "\<\"kyctmp_\"\>"}], ",", 
   RowBox[{
    OverscriptBox[
     SubscriptBox["k", "x"], "\[LongDash]"], "\[Rule]", "\<\"kxctmp_\"\>"}], 
   ",", 
   RowBox[{
    SubscriptBox["\[PartialD]", "z"], "\[Rule]", "\<\"kz_\"\>"}], ",", 
   RowBox[{"q", "\[Rule]", "\<\"q_\"\>"}], ",", 
   RowBox[{
    SuperscriptBox[
     SubscriptBox["\[EmptyUpTriangle]", "2"], 
     RowBox[{"-", "1"}]], "\[Rule]", "\<\"ilap2tmp_\"\>"}], ",", 
   RowBox[{
    SubscriptBox["\[CapitalXi]", "R"], 
    "\[Rule]", "\<\"with_rotation_effects_\"\>"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6141968971191683`*^9, {3.614196955865787*^9, 3.614196976553069*^9}, 
   3.6141970176273737`*^9, {3.614197140642284*^9, 3.6141971499528723`*^9}, 
   3.61420280515613*^9, 3.6142041474039993`*^9, 3.61420432093274*^9, 
   3.614332753782305*^9, 3.6143334373897533`*^9, 3.614334227966806*^9, 
   3.614335330770611*^9, {3.614342317980378*^9, 3.6143423257325563`*^9}, 
   3.614345100654113*^9, 3.614361816160263*^9, 3.614385394517193*^9, 
   3.614436871615592*^9, 3.6144373337998466`*^9, 3.614437922414172*^9, 
   3.61446781112652*^9, 3.614504610070334*^9, 3.614504924258411*^9, 
   3.614542674887701*^9, 3.61454565515012*^9, 3.614545745944592*^9, 
   3.614615781190735*^9, 3.615115374144129*^9, 3.6151157690167103`*^9, {
   3.615116874721467*^9, 3.615116883022649*^9}, 3.627939180153124*^9, 
   3.627939594335135*^9, 3.630442842318356*^9, 3.630443220590811*^9, 
   3.630443344125722*^9, 3.6304434063638687`*^9, 3.6304443833352833`*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Setup functions to find all the coefficients and replace by c++ variables, \
save these variables to automatically compute later\
\>", "Subsubsection",
 CellChangeTimes->{{3.6142001576080503`*^9, 3.6142001733730717`*^9}, {
  3.614542687579644*^9, 3.6145426929862757`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "The", " ", "main", " ", "stuff", " ", "you", " ", "might", " ", "want", 
    " ", "to", " ", "change", " ", "is", " ", "in", " ", "this", " ", 
    RowBox[{"Module", ".", " ", "Defines"}], " ", "various", " ", "functions",
     " ", "and", " ", "lists", " ", "to", " ", "identify", " ", "different", 
    " ", "variable", " ", "types"}], " ", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "coeffList", ",", "fullCppMultVariableList", ",", "scalarCppVars", ",", 
       "vectorCppVars"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"coeffList", "=", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"MapMatrix", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Cases", "[", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{"coeff_", " ", 
                RowBox[{"Cm", "[", 
                 RowBox[{"i1_", ",", "i2_"}], "]"}]}], "\[RuleDelayed]", 
               "coeff"}], ",", "\[Infinity]"}], "]"}], "&"}], ",", 
           "fullMatrixEquations"}], "]"}], "]"}], "/.", 
        RowBox[{"Thread", "[", 
         RowBox[{"meanFieldsWDerivs", "\[Rule]", "1"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"coeffList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "/.", 
          RowBox[{"coeff_", "\[RuleDelayed]", 
           RowBox[{"Rule", "[", 
            RowBox[{"coeff", ",", 
             RowBox[{"convertProdToString", "[", "coeff", "]"}]}], "]"}]}]}], 
         "&"}], "/@", "coeffList"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"coeffList", " ", "=", " ", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"Sort", "[", 
         RowBox[{"coeffList", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"StringLength", "[", 
             RowBox[{
             "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}], ">", 
            RowBox[{"StringLength", "[", 
             RowBox[{
             "#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}]}], "&"}]}], "]"}], "]"}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "Make", " ", "sure", " ", "longest", " ", "products", " ", "are", " ",
          "first"}], ",", " ", 
        RowBox[{
        "otherwise", " ", "it", " ", "replaces", " ", "others", " ", "too", 
         " ", "early", " ", "and", " ", "they", " ", 
         RowBox[{"don", "'"}], "t", " ", "get", " ", "recognized"}]}], "*)"}],
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"fullMatrixEquationsC", "=", 
       RowBox[{
        RowBox[{"fullMatrixEquations", "/.", "coeffList"}], "/.", 
        RowBox[{
         RowBox[{
          RowBox[{"str1_String", " ", 
           RowBox[{"Cm", "[", 
            RowBox[{"i_", ",", "j_"}], "]"}]}], "+", 
          RowBox[{"str2_String", " ", 
           RowBox[{"Cm", "[", 
            RowBox[{"i_", ",", "j_"}], "]"}]}]}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"StringJoin", "[", 
           RowBox[{"str1", ",", "\"\<PLUS\>\"", ",", "str2"}], "]"}], " ", 
          RowBox[{"Cm", "[", 
           RowBox[{"i", ",", "j"}], "]"}]}]}]}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Now", " ", "there", " ", "are", " ", "only"}], ",", " ", 
        RowBox[{"Mean", " ", "fields", " ", 
         RowBox[{"(", 
          RowBox[{"and", " ", "derivatives"}], ")"}]}], ",", " ", 
        RowBox[{"C", " ", "matrices"}], ",", " ", 
        RowBox[{"string", " ", "variables"}]}], "*)"}], 
      RowBox[{"(*", 
       RowBox[{
       "Second", " ", "replacment", " ", "is", " ", "for", " ", "sums"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Before", " ", "going", " ", "on"}], ",", " ", 
        RowBox[{
         RowBox[{
         "keep", " ", "the", " ", "list", " ", "of", " ", "string", " ", 
          "variables"}], " ", "-", " ", 
         RowBox[{
         "some", " ", "of", " ", "these", " ", "get", " ", "rather", " ", 
          RowBox[{"long", "!"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fullCppMultVariableList", " ", "=", 
       RowBox[{"Union", "[", " ", 
        RowBox[{"Cases", "[", 
         RowBox[{
         "fullMatrixEquationsC", ",", "str_String", ",", "\[Infinity]"}], 
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"scalarCppVars", " ", "=", " ", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"coeffList", ",", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{"Alternatives", "@@", "vectorVars"}], ",", 
              "\[Infinity]"}], "]"}]}], "&"}]}], "]"}], 
        "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Separate", " ", "out", " ", "the", " ", "scalar", " ", "variables"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"vectorCppVars", " ", "=", " ", 
       RowBox[{"Complement", "[", 
        RowBox[{"fullCppMultVariableList", ",", "scalarCppVars"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ClearAll", "[", 
       RowBox[{"scalarCppQ", ",", "vectorCppQ"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"scalarCppQ", "[", "_", "]"}], "=", "False"}], ";", 
      RowBox[{
       RowBox[{"vectorCppQ", "[", "_", "]"}], "=", "False"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"scalarCppQ", "[", "#", "]"}], "=", "True"}], ")"}], "&"}], 
       "/@", "scalarCppVars"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"vectorCppQ", "[", "#", "]"}], "=", "True"}], ")"}], "&"}], 
       "/@", "vectorCppVars"}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Q", " ", "functions", " ", "for", " ", "vectors", " ", "and", " ", 
        "scalars"}], " ", "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"ClearAll", "[", "rescaleForFFT", "]"}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Adds", " ", "in", " ", "ftfac", " ", "multiplying", " ", "vector", 
        " ", "for", " ", "more", " ", "efficient", " ", "fft", " ", 
        "rescaling"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"rescaleForFFT", "[", "a_", "]"}], ":=", "\[IndentingNewLine]", 
       RowBox[{"a", "/.", 
        RowBox[{
         RowBox[{"var_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"scalarCppQ", "[", "#", "]"}], "||", 
             RowBox[{"vectorCppQ", "[", "#", "]"}]}], "&"}], ")"}]}], 
         "\[RuleDelayed]", 
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"newvar", "=", 
             RowBox[{
             "\"\<(\>\"", "<>", "var", "<>", "\"\</\>\"", "<>", "ftFactorVar",
               "<>", "\"\<)\>\""}]}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"scalarCppQ", "[", "var", "]"}], ",", 
              RowBox[{
               RowBox[{"scalarCppQ", "[", "newvar", "]"}], "=", "True"}], ",", 
              RowBox[{
               RowBox[{"vectorCppQ", "[", "newvar", "]"}], "=", "True"}]}], 
             "]"}], ";", "\[IndentingNewLine]", "newvar"}]}], 
          "\[IndentingNewLine]", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Product", " ", "to", " ", "use"}], " ", "-", " ", 
        RowBox[{
        "default", " ", "is", " ", "treating", " ", "object", " ", "as", " ", 
         "a", " ", "vector"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"ClearAll", "[", "vec2DiagProd", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vec2DiagProd", "[", "]"}], "=", 
       RowBox[{
       "cppProducts", "\[LeftDoubleBracket]", "1", 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vec2DiagProd", "[", "a_", "]"}], " ", ":=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"scalarCppQ", "@", "a"}], ",", 
         RowBox[{
         "cppProducts", "\[LeftDoubleBracket]", "2", 
          "\[RightDoubleBracket]"}], ",", 
         RowBox[{
         "cppProducts", "\[LeftDoubleBracket]", "1", 
          "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Replacement", " ", "rules", " ", "from", " ", 
        RowBox[{"c", "++"}], " ", "variables", " ", "to", " ", "real", " ", 
        "products"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"CppToBasicVariables", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"fullCppMultVariableList", "\[Rule]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"StringReplace", "[", 
             RowBox[{"fullCppMultVariableList", ",", 
              RowBox[{
               RowBox[{"a__", "~~", "\"\<PLUS\>\"", "~~", "b__"}], 
               "\[RuleDelayed]", 
               RowBox[{"a", "+", "b"}]}]}], "]"}], "/.", 
            RowBox[{"StringExpression", "\[Rule]", "Sequence"}]}], "/.", 
           RowBox[{"coeffList", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "1"}], "}"}]}], "\[RightDoubleBracket]"}]}], 
          ")"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Collect", " ", "to", " ", "scalar", " ", "and", " ", "vector", " ", 
        "variables"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"CppToBasicVariables", " ", "=", " ", 
       RowBox[{"Gather", "[", 
        RowBox[{"CppToBasicVariables", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"scalarCppQ", "[", 
            RowBox[{
            "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}], "===", 
           RowBox[{"scalarCppQ", "[", 
            RowBox[{
            "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}]}], "&"}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "FUNCTIONS", " ", "TO", " ", "CONVERT", " ", "TO", " ", "CPP", " ", 
     "CODE"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"First", " ", "-", " ", 
     RowBox[{"convert", " ", "to", " ", "symbolic", " ", 
      RowBox[{"code", ".", " ", "Takes"}], " ", "a", " ", "single", " ", 
      "term", " ", "and", " ", "converts", " ", "it", " ", "to", " ", 
      "symbolic", " ", 
      RowBox[{
       RowBox[{"c", "++"}], "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "[", 
    RowBox[{"toPseudoCppCode", ",", "$numberOfTempsVars"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"$numberOfTempsVars", "=", "0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"toPseudoCppCode", "[", 
     RowBox[{"expr_", ",", "index_List"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "term", ",", "mfgroups", ",", "pseudoCCode", ",", " ", "ntemps", ",", 
        "FFTpseudoCode"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "Operators", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"SetAttributes", "[", 
        RowBox[{"CPlus", ",", "Orderless"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"SetAttributes", "[", 
        RowBox[{"CTimes", ",", "Orderless"}], "]"}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Set", " ", "these", " ", "as", " ", "commutative", " ", "but", " ", 
         "not", " ", "associative"}], " ", "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Replace", " ", "Times", " ", "and", " ", "Plus", " ", "with", " ", 
         "C", " ", "oeprators"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"term", "=", 
        RowBox[{
         RowBox[{"expr", "/.", 
          RowBox[{
           RowBox[{"Times", "[", 
            RowBox[{"a___", ",", 
             RowBox[{"B_", "?", "meanFieldQ"}], ",", "b___"}], "]"}], 
           "\[RuleDelayed]", 
           RowBox[{"CTimes", "[", 
            RowBox[{"B", ",", 
             RowBox[{"a", " ", "b"}]}], "]"}]}]}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Plus", "\[Rule]", "CPlus"}], ",", 
           RowBox[{"Times", "\[Rule]", "CTimes"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "term", "]"}], "===", "CTimes"}], ",", 
         RowBox[{"term", " ", "=", " ", 
          RowBox[{"CPlus", "[", "term", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Find", " ", "terms", " ", "linear", " ", "in", " ", "the", " ", 
         "mean", " ", "fields"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"mfgroups", " ", "=", " ", 
        RowBox[{"Position", "[", 
         RowBox[{"term", ",", 
          RowBox[{"CTimes", "[", 
           RowBox[{
            RowBox[{"B_", "?", "meanFieldQ"}], ",", "subt_"}], "]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ntemps", " ", "=", " ", 
        RowBox[{"Length", "@", "mfgroups"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Store", " ", "the", " ", "maximum", " ", "number", " ", "of", " ", 
         "temp", " ", "variables", " ", "for", " ", "memory", " ", 
         "assignment", " ", "later"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{"ntemps", ">", "$numberOfTempsVars"}], ",", 
         RowBox[{"$numberOfTempsVars", "=", "ntemps"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"First", " ", "stage"}], " ", "-", " ", 
         RowBox[{
         "assign", " ", "temp", " ", "variables", " ", "to", " ", 
          "groups"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"pseudoCCode", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"CAssign", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "#", "]"}], ",", 
            RowBox[{"Extract", "[", 
             RowBox[{"term", ",", 
              RowBox[{
              "mfgroups", "\[LeftDoubleBracket]", "#", 
               "\[RightDoubleBracket]"}]}], "]"}]}], "]"}], "&"}], "/@", 
         RowBox[{"Range", "[", "ntemps", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"term", " ", "=", " ", 
        RowBox[{"term", "/.", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Reverse", "/@", "pseudoCCode"}], "/.", 
           RowBox[{"CAssign", "\[Rule]", "Rule"}]}], ")"}]}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Replace", " ", "term", " ", "to", " ", "recognize", " ", "temp", " ",
          "variables"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"Next", " ", "stage"}], " ", "-", " ", 
         RowBox[{
         "add", " ", "in", " ", "Fourier", " ", "transforms", " ", "for", " ",
           "pseudospectral", " ", "products"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"pseudoCCode", "=", 
        RowBox[{"pseudoCCode", "/.", 
         RowBox[{
          RowBox[{"CAssign", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "n_", "]"}], ",", 
            RowBox[{"CTimes", "[", 
             RowBox[{
              RowBox[{"B_", "?", "meanFieldQ"}], ",", "subt_"}], "]"}]}], 
           "]"}], "\[RuleDelayed]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"CAssign", "[", 
             RowBox[{
              RowBox[{"CTemp", "[", "n", "]"}], ",", 
              RowBox[{"(*", 
               RowBox[{"rescaleForFFT", "@"}], "*)"}], "subt"}], "]"}], ",", 
            RowBox[{"Cifft", "[", 
             RowBox[{"CTemp", "[", "n", "]"}], "]"}], ",", 
            RowBox[{"CAssign", "[", 
             RowBox[{
              RowBox[{"CTemp", "[", "n", "]"}], ",", 
              RowBox[{"CTimes", "[", 
               RowBox[{"B", ",", 
                RowBox[{"CTemp", "[", "n", "]"}]}], "]"}]}], "]"}]}], 
           "}"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Add", " ", "a", " ", "CPlus", " ", "around", " ", "temp", " ", 
         "variables", " ", "to", " ", "find", " ", "bits", " ", "for", " ", 
         "taking", " ", "forward", " ", "ffts"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"term", " ", "=", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Replace", "[", 
           RowBox[{"term", ",", 
            RowBox[{
             RowBox[{"CPlus", "[", "a__", "]"}], "\[RuleDelayed]", 
             RowBox[{"CPlus", "[", 
              RowBox[{
               RowBox[{"CPlus", "[", 
                RowBox[{"CTemp", "[", "0", "]"}], "]"}], ",", "a"}], "]"}]}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}], "//.", 
          RowBox[{
           RowBox[{"CPlus", "[", 
            RowBox[{
             RowBox[{"CPlus", "[", 
              RowBox[{"a___", ",", 
               RowBox[{"CTemp", "[", "0", "]"}]}], "]"}], ",", "tmp_CTemp", 
             ",", "b___"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"CPlus", "[", 
            RowBox[{
             RowBox[{"CPlus", "[", 
              RowBox[{"a", ",", 
               RowBox[{"CTemp", "[", "0", "]"}], ",", "tmp"}], "]"}], ",", 
             "b"}], "]"}]}]}], "/.", 
         RowBox[{
          RowBox[{"CPlus", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "0", "]"}], ",", "tmp__"}], "]"}], 
          "\[RuleDelayed]", 
          RowBox[{"CPlus", "[", "tmp", "]"}]}]}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"A", " ", "rather", " ", "long"}], "-", 
         RowBox[{"winded", " ", "way", " ", "to", " ", "do", " ", "this"}], 
         " ", "-", " ", 
         RowBox[{"surprisingly", " ", "tricky"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Pseudocode", " ", "for", " ", "taking", " ", "forward", " ", 
         "ffts"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"FFTpseudoCode", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CAssign", "[", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               ",", "#"}], "]"}], ",", 
             RowBox[{"Cfft", "[", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{"Cases", "[", 
           RowBox[{"term", ",", 
            RowBox[{"CPlus", "[", "tmp__CTemp", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}]}], "//", 
         "Flatten"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Replace", " ", "temp", " ", "variables", " ", "in", " ", "term"}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"term", " ", "=", " ", 
        RowBox[{"term", "/.", 
         RowBox[{"Cases", "[", 
          RowBox[{"FFTpseudoCode", ",", 
           RowBox[{
            RowBox[{"CAssign", "[", "a__", "]"}], "\[RuleDelayed]", 
            RowBox[{"Rule", "@@", 
             RowBox[{"Reverse", "[", 
              RowBox[{"{", "a", "}"}], "]"}]}]}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Add", " ", "fft", " ", "and", " ", "dealiasing", " ", "on", " ", 
         "the", " ", "end", " ", "and", " ", "remove", " ", "useless", " ", 
         "assignment"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"pseudoCCode", " ", "=", " ", 
        RowBox[{
         RowBox[{"Flatten", "@", 
          RowBox[{"Join", "[", 
           RowBox[{"pseudoCCode", ",", "FFTpseudoCode", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"CAssign", "[", 
               RowBox[{
                RowBox[{"CTemp", "[", "ntemps", "]"}], ",", 
                RowBox[{"rescaleForFFT", "@", "term"}]}], "]"}], ",", 
              RowBox[{"CDealias", "[", 
               RowBox[{"CTemp", "[", "ntemps", "]"}], "]"}], ",", 
              RowBox[{"CAssign", "[", 
               RowBox[{
                RowBox[{"CBlock", "@@", "index"}], ",", 
                RowBox[{"CTemp", "[", "ntemps", "]"}]}], "]"}]}], "}"}]}], 
           "]"}]}], "/.", 
         RowBox[{
          RowBox[{"CAssign", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "i_", "]"}], ",", 
            RowBox[{"CPlus", "[", 
             RowBox[{"CTemp", "[", "i_", "]"}], "]"}]}], "]"}], 
          "\[RuleDelayed]", 
          RowBox[{"Sequence", "[", "]"}]}]}]}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Function", " ", "to", " ", "store", " ", "c", " ", "variable", " ", 
     "definitions", " ", "for", " ", "other", " ", "stuff"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ClearAll", "[", "toCString", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Cm", "/:", 
     RowBox[{"toCString", "[", 
      RowBox[{"Cm", "[", 
       RowBox[{"i_", ",", "j_"}], "]"}], "]"}], ":=", 
     RowBox[{"\"\<C\>\"", "<>", 
      RowBox[{"ToString", "[", "i", "]"}], "<>", 
      RowBox[{"ToString", "[", "j", "]"}], "<>", "\"\<_\>\""}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"toCString", "[", "a_String", "]"}], ":=", "a"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CTemp", "/:", 
     RowBox[{"toCString", "[", 
      RowBox[{"CTemp", "[", "n_", "]"}], "]"}], ":=", 
     RowBox[{"\"\<Ctmp_\>\"", "<>", 
      RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<_\>\""}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"toCString", "[", 
      RowBox[{"mf_", "?", "meanFieldQ"}], "]"}], ":=", 
     RowBox[{"mf", "/.", "MFcppVariables"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Function", " ", "to", " ", 
     RowBox[{"take", " ", ".", "block"}], 
     RowBox[{"(", ")"}], " ", "method", " ", "of", " ", "Ckl_out", " ", 
     "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "ind2EigenBlock"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ind2EigenBlock", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i_", ",", "j_"}], "}"}], ",", "cmat_"}], "]"}], ":=", 
     RowBox[{"StringReplace", "[", 
      RowBox[{
       RowBox[{"cmat", "<>", "\"\<.block( \>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"i", "-", "1"}], ")"}], "NZ"}], ",", "InputForm"}], "]"}],
         "<>", "\"\<, \>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"j", "-", "1"}], ")"}], "NZ"}], ",", "InputForm"}], "]"}],
         "<>", "\"\<, NZ, NZ)\>\""}], ",", 
       RowBox[{"\"\<NZ\>\"", "\[Rule]", "\"\<NZ_\>\""}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Rules", " ", "to", " ", "change", " ", "pseudoCCode", " ", "into", " ", 
     "real", " ", "Ccode"}], " ", "*)"}], 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Must", " ", "be", " ", "used", " ", "with"}], " ", "//."}], " ",
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"COperatorRules", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"CTimes", "[", 
         RowBox[{"a_String", ",", "b_"}], "]"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", 
         RowBox[{"vec2DiagProd", "[", "a", "]"}], "<>", 
         RowBox[{"toCString", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CTimes", "[", 
         RowBox[{
          RowBox[{"a_", "?", "meanFieldQ"}], ",", "b_"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"toCString", "[", "a", "]"}], "<>", 
         RowBox[{"vec2DiagProd", "[", "a", "]"}], "<>", 
         RowBox[{"toCString", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CPlus", "[", "a__String", "]"}], "\[RuleDelayed]", 
        RowBox[{"ToString", "@", 
         RowBox[{"Row", "[", 
          RowBox[{
           RowBox[{"{", "a", "}"}], ",", "\"\< + \>\""}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CPlus", "[", 
         RowBox[{"a___", ",", "tmp_CTemp", ",", "b___"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{"CPlus", "[", 
         RowBox[{"a", ",", 
          RowBox[{"toCString", "[", "tmp", "]"}], ",", "b"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CAssign", "[", 
         RowBox[{"tmp_", ",", "b_String"}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"toCString", "[", "tmp", "]"}], "<>", "\"\< = \>\"", "<>", 
         "b"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CAssign", "[", 
         RowBox[{"str_String", ",", "tmp_CTemp"}], "]"}], "\[RuleDelayed]", 
        RowBox[{"CAssign", "[", 
         RowBox[{"str", ",", 
          RowBox[{"toCString", "[", "tmp", "]"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Cfft", "[", "a_CTemp", "]"}], "\[RuleDelayed]", 
        RowBox[{"fft", "<>", "\"\<( \>\"", "<>", 
         RowBox[{"toCString", "@", "a"}], "<>", " ", "\"\< )\>\""}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Cifft", "[", "a_CTemp", "]"}], "\[RuleDelayed]", 
        RowBox[{"ifft", "<>", "\"\<( \>\"", "<>", 
         RowBox[{"toCString", "@", "a"}], "<>", " ", "\"\< )\>\""}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"iLapFColl", "[", "str_String", "]"}], "\[RuleDelayed]", 
        RowBox[{"iLapFvar", "<>", 
         RowBox[{"vec2DiagProd", "[", "]"}], "<>", "\"\<(\>\"", "<>", "str", 
         "<>", "\"\<)\>\""}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CBlock", "[", 
         RowBox[{"i_", ",", "j_"}], "]"}], ":>", 
        RowBox[{"ind2EigenBlock", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"i", ",", "j"}], "}"}], ",", "CklOut"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CDealias", "[", "tmp_CTemp", "]"}], "\[RuleDelayed]", 
        RowBox[{"dealias", "<>", "\"\<(\>\"", "<>", 
         RowBox[{"toCString", "[", "tmp", "]"}], "<>", "\"\<)\>\""}]}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.614199820333446*^9, 3.614199973544842*^9}, {
   3.614200154568696*^9, 3.614200177457288*^9}, {3.614203202742343*^9, 
   3.6142032132053423`*^9}, {3.614203687436726*^9, 3.614203694398652*^9}, {
   3.614204078926628*^9, 3.614204079422367*^9}, 3.6142041354989843`*^9, {
   3.614204166229424*^9, 3.6142042190601587`*^9}, {3.614204254561245*^9, 
   3.614204333690789*^9}, {3.614331697718234*^9, 3.61433174227547*^9}, {
   3.614331906693769*^9, 3.614331911117732*^9}, {3.614331987606147*^9, 
   3.614332000077257*^9}, {3.614332466912683*^9, 3.614332469135511*^9}, {
   3.614332812588958*^9, 3.614332843516348*^9}, {3.614332874370685*^9, 
   3.614332874698839*^9}, {3.614332908946308*^9, 3.6143329191369057`*^9}, {
   3.614333144869622*^9, 3.614333156472726*^9}, {3.6143332710284643`*^9, 
   3.614333279858944*^9}, {3.6143622085326366`*^9, 3.614362280097941*^9}, 
   3.614362399974094*^9, {3.614362430655244*^9, 3.614362460967514*^9}, {
   3.6143846802878942`*^9, 3.614384682302619*^9}, 3.614436190971469*^9, {
   3.614436331371933*^9, 3.6144363355680647`*^9}, {3.614437229054408*^9, 
   3.61443728430906*^9}, {3.614437337853598*^9, 3.614437440432015*^9}, {
   3.614437482905383*^9, 3.614437585144912*^9}, {3.614437630726707*^9, 
   3.614437785531118*^9}, {3.614437848964754*^9, 3.614437967122786*^9}, {
   3.6144380848799877`*^9, 3.6144381352511873`*^9}, {3.6144382227794724`*^9, 
   3.614438293388933*^9}, {3.61443989562008*^9, 3.614439938088032*^9}, {
   3.6144401493798637`*^9, 3.61444017699675*^9}, {3.61444021553305*^9, 
   3.614440310323646*^9}, {3.61444036659039*^9, 3.614440615353231*^9}, {
   3.614440664885353*^9, 3.6144407634596643`*^9}, {3.614466811204368*^9, 
   3.614466893555069*^9}, {3.614467338629237*^9, 3.614467397648348*^9}, {
   3.614467447634305*^9, 3.614467566346293*^9}, {3.614467600650503*^9, 
   3.6144676225940247`*^9}, {3.6144676700570917`*^9, 3.614467711185996*^9}, {
   3.614467791283551*^9, 3.614467797969377*^9}, {3.6144679149890614`*^9, 
   3.614467955286832*^9}, {3.614467991859248*^9, 3.6144679928261623`*^9}, {
   3.614504879859517*^9, 3.6145049079875603`*^9}, {3.61454283629358*^9, 
   3.614542837167223*^9}, {3.614542878595272*^9, 3.6145428815772047`*^9}, {
   3.614543175274213*^9, 3.614543217236944*^9}, {3.614543286011907*^9, 
   3.614543330056481*^9}, 3.614543427918807*^9, {3.614544016420259*^9, 
   3.614544016783902*^9}, {3.614545405652108*^9, 3.6145454062903223`*^9}, {
   3.614553685029169*^9, 3.614553713332426*^9}, {3.614553820920223*^9, 
   3.614553821614222*^9}, {3.614615907007505*^9, 3.614615911160202*^9}, {
   3.614616031382146*^9, 3.614616036012775*^9}, {3.615115445069023*^9, 
   3.6151154781928577`*^9}, 3.6151155348790293`*^9, {3.615115588817881*^9, 
   3.615115605142126*^9}, {3.615115678487294*^9, 3.6151156814810743`*^9}, 
   3.61511576016107*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Split up and assign to Ckl_out", "Subsubsection",
 CellChangeTimes->{{3.6142046790049763`*^9, 3.614204686099799*^9}, {
  3.6142051931686783`*^9, 3.614205195159081*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "tmp", ",", "variableDef", ",", "vecPreVarStringList", ",", 
      "scalarPreVarStringList", ",", "vectorPreVarQ", ",", "scalarPreVarQ", 
      ",", "ctempVars", ",", "cmatVars"}], "}"}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Form", " ", "the", " ", "full", " ", "equations", " ", "as", " ", "a", 
      " ", "single", " ", "text", " ", "block"}], " ", "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"fullEquations", " ", "=", " ", 
      RowBox[{
       RowBox[{"StringJoin", "@@", 
        RowBox[{"Riffle", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"StringJoin", "@@", 
              RowBox[{"Riffle", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"toPseudoCppCode", "[", 
                  RowBox[{
                   RowBox[{"fullMatrixEquationsC", "\[LeftDoubleBracket]", 
                    RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "j"}], "}"}]}], "]"}], "//.", 
                 "COperatorRules"}], ",", "\"\<;\\n\>\""}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i", ",", "4"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "4"}], "}"}]}], "]"}], "]"}], ",", 
          "\[IndentingNewLine]", "\"\<;\\n\\n\\n\\n\>\""}], "]"}]}], "<>", 
       "\"\<;\\n\>\""}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Form", " ", "the", " ", "variable", " ", "definitions"}], " ",
        "-", " ", 
       RowBox[{
       "the", " ", "functions", " ", "here", " ", "are", " ", "for", " ", 
        "pre"}], "-", 
       RowBox[{"defined", " ", "variables", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"e", ".", "g", "."}], ",", " ", "kxctmp_"}], ")"}], " ", 
        "not", " ", "the", " ", "automatically", " ", "generated", " ", 
        "ones"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"vecPreVarStringList", " ", "=", 
      RowBox[{
       RowBox[{"List", "@@", "vectorVars"}], "/.", "variablesInCpp"}]}], ";", 
     " ", 
     RowBox[{"(*", " ", 
      RowBox[{"List", " ", "of", " ", "vector", " ", "variables"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"scalarPreVarStringList", " ", "=", " ", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"variablesInCpp", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
        "vecPreVarStringList"}], "]"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{"List", " ", "of", " ", "vector", " ", "variables"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"vectorPreVarQ", " ", "=", " ", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "[", "vecPreVarStringList", "]"}], ";",
            "vecPreVarStringList"}], ")"}], ",", "#"}], "]"}], "&"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Returns", " ", "true", " ", "for", " ", "vector", " ", "variable"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"scalarPreVarQ", " ", "=", " ", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "[", "scalarPreVarStringList", "]"}], 
           ";", "scalarPreVarStringList"}], ")"}], ",", "#"}], "]"}], " ", 
       "&"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Returns", " ", "true", " ", "for", " ", "scalar", " ", "variable"}], 
      " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Collect", " ", "matrix", " ", "bits", " ", "together"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"CppToBasicVariables", "/.", "variablesInCpp"}], "/.", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"a_", "?", "vectorPreVarQ"}], "^", "n_"}], 
           "\[RuleDelayed]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"tmp", " ", "=", " ", 
              RowBox[{"a", "<>", "\"\<.pow(\>\"", "<>", 
               RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<)\>\""}]}], 
             ";", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"vecPreVarStringList", ",", "tmp"}], "]"}], ";", 
             "tmp"}], ")"}]}]}], "/.", 
         RowBox[{"\"\<kz_.pow(2)\>\"", "\[RuleDelayed]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"vecPreVarStringList", ",", "\"\<kz2_\>\""}], "]"}], 
            ";", "\"\<kz2_\>\""}], ")"}]}]}], "/.", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"a_", "?", "vectorPreVarQ"}], "  ", 
          RowBox[{"b_", "?", "vectorPreVarQ"}]}], "\[RuleDelayed]", 
         RowBox[{
         "\"\<(\>\"", "<>", "a", "<>", "\"\<*\>\"", "<>", "b", "<>", 
          "\"\<).matrix()\>\""}]}]}], "/.", 
       RowBox[{
        RowBox[{"a_", "?", "vectorPreVarQ"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", "\"\<.matrix()\>\""}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Collect", " ", "scalar", " ", "bits", " ", "together"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"fullCppVaribles", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"a_", "?", "scalarPreVarQ"}], "^", "n_"}], 
           "\[RuleDelayed]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"tmp", "=", 
              RowBox[{"\"\<pow(\>\"", "<>", 
               RowBox[{"ToString", "[", "a", "]"}], "<>", "\"\<,\>\"", "<>", 
               RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<)\>\""}]}], 
             ";", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"scalarPreVarStringList", ",", "tmp"}], "]"}], ";", 
             "tmp"}], ")"}]}]}], "/.", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"a_", "?", "scalarPreVarQ"}], " ", 
           RowBox[{"b_", "?", "scalarPreVarQ"}]}], "\[RuleDelayed]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"scalarPreVarStringList", ",", 
              RowBox[{
              "\"\<(\>\"", "<>", "a", "<>", "\"\<*\>\"", "<>", "b", "<>", 
               "\"\<)\>\""}]}], "]"}], ";", 
            RowBox[{
            "\"\<(\>\"", "<>", "a", "<>", "\"\<*\>\"", "<>", "b", "<>", 
             "\"\<)\>\""}]}], ")"}]}]}], "/.", 
        RowBox[{
         RowBox[{
          RowBox[{"n_", "?", "NumericQ"}], " ", 
          RowBox[{"a_", "?", "scalarPreVarQ"}]}], "\[RuleDelayed]", 
         RowBox[{"\"\<(\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"N", "[", "n", "]"}], "]"}], "<>", "\"\<*\>\"", "<>", "a", 
          "<>", "\"\<)\>\""}]}]}], "/.", 
       RowBox[{
        RowBox[{
         RowBox[{"n_", "?", "NumericQ"}], " ", "b_String"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"ToString", "[", 
          RowBox[{"N", "[", "n", "]"}], "]"}], "<>", "\"\<*\>\"", "<>", 
         "b"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{"fullCppVaribles", "/.", 
        RowBox[{
         RowBox[{"a_String", " ", "b_String"}], "\[RuleDelayed]", 
         RowBox[{"a", "<>", "\"\<*\>\"", "<>", "b"}]}]}], "/.", 
       RowBox[{
        RowBox[{"a_String", " ", "+", " ", "b_String"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", "\"\< + \>\"", "<>", "b"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Add", " ", "in", " ", "ftFactor"}], ",", " ", 
       RowBox[{
       "this", " ", "is", " ", "not", " ", "the", " ", "most", " ", 
        "efficient", " ", 
        RowBox[{"(", 
         RowBox[{"multiplying", " ", "vector"}], ")"}], " ", "but", " ", 
        RowBox[{"doesn", "'"}], "t", " ", "seem", " ", "worth", " ", "the", 
        " ", "effort"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{"fullCppVaribles", "/.", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Rule", "[", 
          RowBox[{"a_String", ",", "b_String"}], "]"}], ")"}], 
        "\[RuleDelayed]", 
        RowBox[{"(", 
         RowBox[{"Rule", "[", 
          RowBox[{"a", ",", 
           RowBox[{
           "\"\<(\>\"", "<>", "b", "<>", "\"\<)*\>\"", "<>", 
            "ftFactorVar"}]}], "]"}], ")"}]}]}]}], ";", "\[IndentingNewLine]",
      "\[IndentingNewLine]", 
     RowBox[{"ctempVars", " ", "=", " ", 
      RowBox[{"toCString", "/@", 
       RowBox[{"(", 
        RowBox[{"CTemp", "/@", 
         RowBox[{"Range", "[", "$numberOfTempsVars", "]"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"cmatVars", " ", "=", 
      RowBox[{"toCString", "/@", 
       RowBox[{"Flatten", "[", "Cmat", "]"}]}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"(*", " ", 
      RowBox[{"Declare", " ", "variables", " ", 
       RowBox[{"(", 
        RowBox[{"in", " ", "class", " ", "definition"}], ")"}]}], " ", "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"classVariableDec", " ", "=", " ", 
      RowBox[{"\"\<dcmplxVecM \>\"", "<>", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{
          RowBox[{"CppToBasicVariables", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}], 
          ",", "\"\<, \>\""}], "]"}]}], "<>", "\"\<;\\n\\n\>\"", "<>", 
       "\[IndentingNewLine]", "\"\<dcmplx \>\"", "<>", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{
          RowBox[{"CppToBasicVariables", "\[LeftDoubleBracket]", 
           RowBox[{"2", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}], 
          ",", "\"\<, \>\""}], "]"}]}], "<>", "\"\<;\\n\\n\>\"", "<>", 
       "\[IndentingNewLine]", "\"\<dcmplxMat \>\"", "<>", " ", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{"ctempVars", ",", "\"\<, \>\""}], "]"}]}], "<>", 
       "\"\<;\\n\\n\>\"", "<>", "\[IndentingNewLine]", "\"\<dcmplxMat \>\"", "<>",
        " ", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{"cmatVars", ",", "\"\<, \>\""}], "]"}]}], "<>", 
       "\"\<;\\n\>\""}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     
     RowBox[{"(*", " ", 
      RowBox[{
      "Assign", " ", "memory", " ", "to", " ", "variables", " ", "in", " ", 
       "class", " ", "constructor"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"classConstrAssignMem", " ", "=", 
      RowBox[{
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "<>", "\"\< = dcmplxVecM(NZ_);\\n\>\""}], "&"}], "/@", 
          RowBox[{"CppToBasicVariables", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}]}], 
         ")"}]}], "<>", "\"\<\\n\>\"", "<>", "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "<>", "\"\< = dcmplxMat(NZ_,NZ_);\\n\>\""}], "&"}], "/@",
           "ctempVars"}], ")"}]}], "<>", "\"\<\\n\>\"", "<>", 
       "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "<>", "\"\< = dcmplxMat(NZ_,NZ_);\\n\>\""}], "&"}], "/@",
           "cmatVars"}], ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Assign", " ", "variables", " ", "inside", " ", "the", " ", 
       "equations"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"assignCppVarsInEqs", " ", "=", 
      RowBox[{
      "\"\<// Vector variable definition (automatic)\\n\>\"", "<>", " ", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "<>", "\"\< = \>\"", " ", "<>", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "<>", "\"\<;\\n\>\""}], "&"}], "/@", 
          RowBox[{
          "fullCppVaribles", "\[LeftDoubleBracket]", "1", 
           "\[RightDoubleBracket]"}]}], ")"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"assignCppVarsInEqs", " ", "=", 
      RowBox[{
      "\"\<// Scalar variable definition (automatic)\\n\>\"", "<>", " ", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "<>", "\"\< = \>\"", " ", "<>", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "<>", "\"\<;\\n\>\""}], "&"}], "/@", 
          RowBox[{
          "fullCppVaribles", "\[LeftDoubleBracket]", "2", 
           "\[RightDoubleBracket]"}]}], ")"}]}], "<>", "\"\<\\n\>\"", "<>", 
       "assignCppVarsInEqs"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"assignCppVarsInEqs", " ", "=", " ", 
      RowBox[{
      "\"\<// Submatrix variable definition (automatic)\\n\>\"", "<>", 
       "\[IndentingNewLine]", 
       RowBox[{"(", 
        RowBox[{"StringJoin", "@@", 
         RowBox[{"Riffle", "[", 
          RowBox[{
           RowBox[{"Flatten", "@", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"toCString", "[", 
                RowBox[{"Cm", "[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}], "<>", "\"\< = \>\"", "<>", 
               RowBox[{"ind2EigenBlock", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"i", ",", "j"}], "}"}], ",", "CklIn"}], "]"}]}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "numVariables"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "numVariables"}], "}"}]}], "]"}]}], ",", 
           "\"\<;\\n\>\""}], "]"}]}], ")"}], "<>", "\"\<;\\n\\n\>\"", "<>", 
       "assignCppVarsInEqs"}]}], ";"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]",
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
    "SAVE", " ", "ALL", " ", "THIS", " ", "STUFF", " ", "TO", " ", "FILE"}], 
    " ", "*)"}],
   FontColor->RGBColor[0.5, 0, 0.5]]}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{
  "\"\<~/Documents/MRIDSS/Mathematica/MMA_Generated_Equations_fullBQlin.cpp\>\
\"", ",", "\[IndentingNewLine]", 
   RowBox[{
   "\"\<// Automatically generated temporary variables - class \
definition\\n\>\"", "<>", "\[IndentingNewLine]", "classVariableDec", "<>", 
    "\"\<\\n\\n\\n\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
    "\"\<// Automatically generated temporary variables - class \
constructor\\n\>\"", "<>", "\[IndentingNewLine]", "classConstrAssignMem", 
    "<>", "\"\<\\n\\n\\n\\n\\n\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
    "\"\<//Assign automatically generated variables in equations \\n\>\"", "<>",
     "\[IndentingNewLine]", "assignCppVarsInEqs", "<>", 
    "\"\<\\n\\n\\n\\n\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
    "\"\<////////////////////////////////////////////////////////\\n\>\"", "<>",
     "\[IndentingNewLine]", 
    "\"\<///       AUTOMATICALLY GENERATED EQUATIONS         /////\\n\>\"", "<>",
     "\[IndentingNewLine]", 
    "\"\<///       see GenerateC++Equations.nb in MMA        /////\\n\\n\>\"",
     "<>", "\[IndentingNewLine]", "fullEquations", "<>", 
    "\[IndentingNewLine]", 
    "\"\<///     AUTOMATICALLY GENERATED EQUATIONS - END       ///\\n\>\"", "<>",
     "\[IndentingNewLine]", 
    "\"\<////////////////////////////////////////////////////////\\n\>\""}], 
   ",", "\[IndentingNewLine]", "\"\<Text\>\""}], 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.6142047962878428`*^9, 3.6142048287650623`*^9}, {
   3.6142048623685904`*^9, 3.614204871407317*^9}, {3.614204927104175*^9, 
   3.614205167284988*^9}, {3.6142056503063517`*^9, 3.61420569620709*^9}, {
   3.614205733874864*^9, 3.6142057372347527`*^9}, {3.614205801605402*^9, 
   3.6142058147158327`*^9}, {3.614205856654711*^9, 3.614205911695675*^9}, {
   3.614206098560555*^9, 3.6142061335704403`*^9}, {3.614206170108762*^9, 
   3.6142061881144047`*^9}, 3.614206293851531*^9, {3.614206461617001*^9, 
   3.614206486966379*^9}, {3.6142065247418213`*^9, 3.614206525340083*^9}, {
   3.6142065934740763`*^9, 3.6142066005860767`*^9}, {3.614206631795189*^9, 
   3.61420665105902*^9}, {3.6142067668503103`*^9, 3.614206811713435*^9}, {
   3.614206859537304*^9, 3.614206860286922*^9}, {3.6142944293493757`*^9, 
   3.6142944433506927`*^9}, {3.614333316719392*^9, 3.6143334120699873`*^9}, {
   3.614333444377398*^9, 3.614333520964388*^9}, {3.614334399437749*^9, 
   3.61433440340563*^9}, {3.6143353683089323`*^9, 3.614335386748166*^9}, {
   3.6143356115565863`*^9, 3.614335642695072*^9}, {3.614335677308119*^9, 
   3.6143357063543158`*^9}, {3.61433586767843*^9, 3.614336158690496*^9}, {
   3.614336266943084*^9, 3.614336291062385*^9}, {3.614336322628447*^9, 
   3.614336357271209*^9}, {3.614336422201798*^9, 3.61433649219413*^9}, {
   3.6143365411420527`*^9, 3.614336642975008*^9}, {3.614336674388867*^9, 
   3.6143367439724493`*^9}, {3.6143368053654327`*^9, 3.614336827572853*^9}, {
   3.614336871824078*^9, 3.6143368722227917`*^9}, {3.614336903252371*^9, 
   3.614336957793364*^9}, {3.614337118801602*^9, 3.614337369809972*^9}, {
   3.6143374183062*^9, 3.614337432720202*^9}, {3.6143375078514223`*^9, 
   3.6143375282046423`*^9}, {3.6143376036820707`*^9, 3.614337849225244*^9}, {
   3.6143384130703163`*^9, 3.6143384249236937`*^9}, {3.614342468760648*^9, 
   3.614342483795895*^9}, {3.614344870214403*^9, 3.6143448765804043`*^9}, {
   3.6144668024268312`*^9, 3.61446680622049*^9}, {3.614468473094071*^9, 
   3.614468475362665*^9}, {3.6144685580405807`*^9, 3.61446858694422*^9}, {
   3.614468765757752*^9, 3.614468940401372*^9}, {3.614468984586191*^9, 
   3.6144689917783127`*^9}, {3.6144690589896708`*^9, 3.614469059077342*^9}, {
   3.6144691527364483`*^9, 3.6144693667898083`*^9}, {3.614469425367859*^9, 
   3.614469464109496*^9}, {3.6144695490098*^9, 3.6144695491606627`*^9}, {
   3.6144696598494787`*^9, 3.614469660520706*^9}, {3.614469930003291*^9, 
   3.614469937711336*^9}, {3.6144705198149643`*^9, 3.6144705200068417`*^9}, {
   3.6144706655301447`*^9, 3.614470681320969*^9}, {3.614504720143795*^9, 
   3.614504863524947*^9}, {3.614505100915875*^9, 3.614505121919724*^9}, {
   3.614505152906884*^9, 3.614505155503438*^9}, {3.614505221394732*^9, 
   3.614505221833407*^9}, {3.614505263530373*^9, 3.614505263936371*^9}, 
   3.614505308586783*^9, {3.614542746037664*^9, 3.6145427529093513`*^9}, {
   3.61461405830389*^9, 3.614614058847625*^9}, {3.614614417854628*^9, 
   3.614614458527823*^9}, {3.6146144956214952`*^9, 3.614614625662765*^9}, {
   3.6150297979412947`*^9, 3.615029816415002*^9}, 3.6150304053572807`*^9, {
   3.615051001819131*^9, 3.6150510270659933`*^9}, 3.615051083381027*^9, {
   3.615051118523594*^9, 3.615051141241631*^9}, {3.615051184234514*^9, 
   3.615051217257319*^9}, 3.615116799166812*^9}],

Cell[BoxData["\<\"~/Documents/MRIDSS/Mathematica/MMA_Generated_Equations_\
fullBQlin.cpp\"\>"], "Output",
 CellChangeTimes->{
  3.6143387121822042`*^9, 3.614342337188706*^9, 3.614342486239141*^9, {
   3.6143448771742496`*^9, 3.61434488321599*^9}, 3.6143450218542852`*^9, 
   3.6143451076824017`*^9, 3.6144684790958347`*^9, 3.614469003670755*^9, 
   3.614469059822981*^9, {3.614469192413805*^9, 3.6144692034064283`*^9}, 
   3.614469373655657*^9, 3.6144694649976387`*^9, 3.614469550711421*^9, 
   3.6144696641046753`*^9, 3.614469938679933*^9, 3.614470523412774*^9, {
   3.614505127983507*^9, 3.6145051571376143`*^9}, 3.6145052231571608`*^9, 
   3.614505266300125*^9, 3.614505313529387*^9, {3.6145427143213997`*^9, 
   3.614542725540413*^9}, 3.614542757103635*^9, 3.614542844817013*^9, 
   3.614542885049453*^9, 3.614543449184469*^9, {3.614545738357164*^9, 
   3.614545751438102*^9}, 3.6145539650685472`*^9, 3.6146140636151257`*^9, 
   3.61461428924856*^9, 3.6146146289457407`*^9, 3.6146157553981752`*^9, 
   3.6146160734655457`*^9, {3.61505102898208*^9, 3.615051038026823*^9}, 
   3.6150511425831413`*^9, 3.6150512197186327`*^9, 3.6150598094803543`*^9, 
   3.6151168329697237`*^9, 3.6151168897045393`*^9, 3.627939188316148*^9, 
   3.62793960312108*^9, 3.630442843837528*^9, 3.630443221816702*^9, 
   3.630443344397914*^9, 3.630444383565858*^9}]
}, Open  ]]
}, Open  ]]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Full-field Quasi-linear", "Section",
 CellChangeTimes->{{3.6132857813215227`*^9, 3.613285785435519*^9}, {
  3.614613863421791*^9, 3.614613866708189*^9}, {3.615058297180931*^9, 
  3.615058299955426*^9}}],

Cell[TextData[{
 "Full quasi-linear equations including interactions with ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["B", "x"], ",", " ", 
    SubscriptBox["B", "y"], ",", " ", 
    SubscriptBox["U", "x"], ",", " ", 
    SubscriptBox["U", "y"]}], TraditionalForm]],
  FormatType->"TraditionalForm"]
}], "Text",
 CellChangeTimes->{{3.613285788264741*^9, 3.613285816975567*^9}, {
  3.6132858538148127`*^9, 3.613285857694859*^9}, {3.614613871740099*^9, 
  3.6146138827358103`*^9}, {3.615058303731546*^9, 3.615058347034931*^9}}],

Cell[CellGroupData[{

Cell["Derive equations", "Subsection",
 CellChangeTimes->{{3.613285862743395*^9, 3.613285865310978*^9}}],

Cell[CellGroupData[{

Cell[BoxData["fullMFeqns"], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", "0", ",", "0", ",", 
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      OverscriptBox["\[Eta]", "\[LongDash]"]}], " ", 
     RowBox[{
      SubscriptBox["B", "x"], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "-", 
    RowBox[{
     SuperscriptBox[
      SubscriptBox["\[ScriptCapitalR]", "x"], "B"], "[", 
     RowBox[{"z", ",", "t"}], "]"}], "+", 
    RowBox[{
     SuperscriptBox[
      SubscriptBox["B", "x"], 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "1"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"z", ",", "t"}], "]"}]}], ",", 
   RowBox[{
    RowBox[{"q", " ", 
     RowBox[{
      SubscriptBox["B", "x"], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "-", 
    RowBox[{
     OverscriptBox["\[Eta]", "\[LongDash]"], " ", 
     RowBox[{
      SubscriptBox["B", "y"], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "-", 
    RowBox[{
     SuperscriptBox[
      SubscriptBox["\[ScriptCapitalR]", "y"], "B"], "[", 
     RowBox[{"z", ",", "t"}], "]"}], "+", 
    RowBox[{
     SuperscriptBox[
      SubscriptBox["B", "y"], 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "1"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"z", ",", "t"}], "]"}]}], ",", "0"}], "}"}]], "Output",
 CellChangeTimes->{3.6332688052967463`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"fullFluctEqs", "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"kxb", "\[Rule]", "0"}], ",", 
     RowBox[{"ky", "\[Rule]", "0"}]}], "}"}]}], "/.", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"uz", "\[Rule]", 
     RowBox[{"(", 
      RowBox[{"0", "&"}], ")"}]}], ",", 
    RowBox[{"bz", "\[Rule]", 
     RowBox[{"(", 
      RowBox[{"0", "&"}], ")"}]}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.633268836599291*^9, 3.633268910159667*^9}, {
  3.633270768596004*^9, 3.6332707706742764`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"-", "2"}], " ", "\[CapitalOmega]", " ", 
     RowBox[{"uy", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{
     SuperscriptBox["ux", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "1"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"z", ",", "t"}], "]"}], "-", 
    RowBox[{
     SubscriptBox["B", "z0"], " ", 
     RowBox[{
      SuperscriptBox["bx", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"1", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "-", 
    RowBox[{
     OverscriptBox["\[Nu]", "\[Dash]"], " ", 
     RowBox[{
      SuperscriptBox["ux", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"2", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"-", "S"}], " ", 
     RowBox[{"ux", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{"2", " ", "\[CapitalOmega]", " ", 
     RowBox[{"ux", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{
     SuperscriptBox["uy", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "1"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"z", ",", "t"}], "]"}], "-", 
    RowBox[{
     SubscriptBox["B", "z0"], " ", 
     RowBox[{
      SuperscriptBox["by", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"1", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "-", 
    RowBox[{
     OverscriptBox["\[Nu]", "\[Dash]"], " ", 
     RowBox[{
      SuperscriptBox["uy", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"2", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}]}], ",", 
   RowBox[{
    SuperscriptBox["p", 
     TagBox[
      RowBox[{"(", 
       RowBox[{"1", ",", "0"}], ")"}],
      Derivative],
     MultilineFunction->None], "[", 
    RowBox[{"z", ",", "t"}], "]"}], ",", "0", ",", 
   RowBox[{
    RowBox[{
     SuperscriptBox["bx", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "1"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"z", ",", "t"}], "]"}], "-", 
    RowBox[{
     SubscriptBox["B", "z0"], " ", 
     RowBox[{
      SuperscriptBox["ux", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"1", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "-", 
    RowBox[{
     OverscriptBox["\[Eta]", "\[LongDash]"], " ", 
     RowBox[{
      SuperscriptBox["bx", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"2", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{"S", " ", 
     RowBox[{"bx", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{
     SuperscriptBox["by", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "1"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"z", ",", "t"}], "]"}], "-", 
    RowBox[{
     SubscriptBox["B", "z0"], " ", 
     RowBox[{
      SuperscriptBox["uy", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"1", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "-", 
    RowBox[{
     OverscriptBox["\[Eta]", "\[LongDash]"], " ", 
     RowBox[{
      SuperscriptBox["by", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"2", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}]}], ",", "0", ",", "0"}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.633268843911277*^9, 3.633268864487959*^9}, 
   3.633268910536343*^9, 3.633270771064432*^9, 3.653922295724588*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"numVariables", " ", "=", " ", "4"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"zt", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"z", ",", "t"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"meanFields", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
    "Ux", ",", "Uy", ",", "0", ",", "Bx", ",", "By", ",", "0", ",", "0"}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"meanFieldsWDerivs", " ", "=", " ", 
   RowBox[{"Rest", "@", 
    RowBox[{"Union", "[", 
     RowBox[{"Join", "[", 
      RowBox[{"meanFields", ",", 
       RowBox[{"dz", "/@", "meanFields"}], ",", 
       RowBox[{"dz", "/@", 
        RowBox[{"dz", "/@", "meanFields"}]}], ",", 
       RowBox[{"dz", "/@", 
        RowBox[{"dz", "/@", 
         RowBox[{"dz", "/@", "meanFields"}]}]}], ",", 
       RowBox[{"dz", "/@", 
        RowBox[{"dz", "/@", 
         RowBox[{"dz", "/@", 
          RowBox[{"dz", "/@", "meanFields"}]}]}]}]}], "]"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"meanFieldQ", " ", "=", " ", 
    RowBox[{
     RowBox[{"MemberQ", "[", 
      RowBox[{"meanFieldsWDerivs", ",", "#"}], "]"}], "&"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fullMFeqns", " ", "=", " ", 
    RowBox[{"Subtract", "@@@", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"Bx", "@@", "zt"}], ",", "t"}], "]"}], "\[Equal]", 
        RowBox[{
         RowBox[{"ReyBx", "@@", "zt"}], "+", 
         RowBox[{"\[Eta]b", " ", 
          RowBox[{"Bx", "@@", "zt"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"By", "@@", "zt"}], ",", "t"}], "]"}], "\[Equal]", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "q"}], " ", 
          RowBox[{"Bx", "@@", "zt"}]}], "+", 
         RowBox[{"ReyBy", "@@", "zt"}], "+", 
         RowBox[{"\[Eta]b", " ", 
          RowBox[{"By", "@@", "zt"}]}]}]}], ",", "0"}], "}"}]}]}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{"This", " ", 
     RowBox[{"isn", "'"}], "t", " ", 
     RowBox[{"right", "!"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Plug", " ", "in", " ", "mean", " ", "field"}], " ", "+", " ", 
     RowBox[{
     "fluctuations", " ", "into", " ", "NL", " ", "equations", " ", "and", 
      " ", "linearize"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"NL2fluct", ",", "fourierRules"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"NL2fluct", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
          "fullNLvars", "\[LeftDoubleBracket]", "i", 
           "\[RightDoubleBracket]"}], "\[Rule]", 
          RowBox[{"Function", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x", ",", "y", ",", "z", ",", "t"}], "}"}], ",", 
            RowBox[{"Evaluate", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                "meanFields", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "@@", 
                RowBox[{"{", 
                 RowBox[{"z", ",", "t"}], "}"}]}], "+", 
               RowBox[{
                RowBox[{
                "fullNLvars", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "@@", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "y", ",", "z", ",", "t"}], "}"}]}]}], "/.", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"0", "[", "__", "]"}], ")"}], "\[Rule]", "0"}]}], 
             "]"}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "fullNLvars", "]"}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Plug", " ", "in", " ", "to", " ", "full", " ", "equations", " ", 
        "and", " ", "linearize"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"linearize", "[", 
          RowBox[{"#", ",", "fullNLvars", ",", "xtv"}], "]"}], "&"}], "/@", 
        RowBox[{"Expand", "[", 
         RowBox[{"fullNLeqns", "/.", "NL2fluct"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "fullFluctEqs", " ", "still", " ", "contain", " ", "a", " ", "mean", 
        " ", "field", " ", "part"}], " ", "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Shearing", " ", "wave", " ", "expansion"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"fourierRules", "=", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", "var", "}"}], ",", 
          RowBox[{"Evaluate", "[", 
           RowBox[{"var", "\[Rule]", 
            RowBox[{"Function", "[", 
             RowBox[{
              RowBox[{"Evaluate", "@", "xtv"}], ",", 
              RowBox[{
               RowBox[{"var", "[", 
                RowBox[{"z", ",", "t"}], "]"}], 
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"\[ImaginaryI]", " ", 
                  RowBox[{"(", 
                   RowBox[{"kx", "+", 
                    RowBox[{"q", " ", "t", " ", "ky"}]}], ")"}], "x"}], " ", 
                 "+", " ", 
                 RowBox[{"\[ImaginaryI]", " ", "ky", " ", "y"}]}], "]"}]}]}], 
             "]"}]}], "]"}]}], "]"}], "/@", "fullNLvars"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{"Expand", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"fullFluctEqs", "/.", "fourierRules"}], ")"}], "/", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"\[ImaginaryI]", " ", 
            RowBox[{"(", 
             RowBox[{"kx", "+", 
              RowBox[{"q", " ", "t", " ", "ky"}]}], ")"}], "x"}], " ", "+", 
           " ", 
           RowBox[{"\[ImaginaryI]", " ", "ky", " ", "y"}]}], "]"}]}], "]"}]}],
       ";", 
      RowBox[{"(*", 
       RowBox[{
       "Shearing", " ", "wave", " ", "in", " ", "x", " ", "and", " ", "y"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{"fullFluctEqs", "/.", 
        RowBox[{
         SuperscriptBox["\[ExponentialE]", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "\[ImaginaryI]"}], " ", 
            RowBox[{"(", 
             RowBox[{
              SubscriptBox["k", "x"], "+", 
              RowBox[{
               SubscriptBox["k", "y"], " ", "q", " ", "t"}]}], ")"}], " ", 
            "x"}], "-", 
           RowBox[{"\[ImaginaryI]", " ", 
            SubscriptBox["k", "y"], " ", "y"}]}]], "\[Rule]", "0"}]}]}], ";", 
      " ", 
      RowBox[{"(*", " ", 
       RowBox[{"Remove", " ", "mean", " ", "components"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"fullFluctEqs", "/.", 
          RowBox[{"kx", "\[Rule]", 
           RowBox[{"kxb", "-", 
            RowBox[{"q", " ", "t", " ", "ky"}]}]}]}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"kxb", "\[Rule]", 
            RowBox[{"kxb", "/", "\[ImaginaryI]"}]}], ",", 
           RowBox[{"ky", "\[Rule]", 
            RowBox[{"ky", "/", "\[ImaginaryI]"}]}]}], "}"}]}], "//", 
        "Expand"}]}]}]}], " ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Use", " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "_"]}], "=", 
      RowBox[{
       SubscriptBox["k", "x"], "+", 
       RowBox[{
        SubscriptBox["qtk", "y"], " ", "as", " ", "in", " ", 
        RowBox[{"c", "++"}], " ", "code"}]}]}], " ", "*)"}], 
    "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Derive", " ", "Orr"}], "-", 
     RowBox[{"Somerfeld", " ", "like", " ", "equations"}]}], ",", " ", 
    RowBox[{
     RowBox[{"don", "'"}], "t", " ", "need", " ", "to", " ", "reduce", " ", 
     "other", " ", "equations"}], ",", " ", 
    RowBox[{
    "just", " ", "write", " ", "down", " ", "equations", " ", "for", " ", 
     RowBox[{"Lap", "[", "u", "]"}]}], ",", "\[Zeta]", ",", "b", ",", 
    "\[Eta]"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"derivRules", ",", "LapMGradDiv1", ",", "manualSub"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"derivRules", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Derivative", "[", 
           RowBox[{"n_", ",", "m_"}], "]"}], "[", "a_", "]"}], "[", "vs__", 
         "]"}], "\[RuleDelayed]", 
        RowBox[{"Nest", "[", 
         RowBox[{"dt", ",", 
          RowBox[{"Nest", "[", 
           RowBox[{"dz", ",", 
            RowBox[{"a", "[", "vs", "]"}], ",", "n"}], "]"}], ",", "m"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"LapMGradDiv1", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"kxb", "^", "2"}], "+", 
            RowBox[{"ky", "^", "2"}]}], ")"}], 
          RowBox[{
          "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], "+", 
         
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{
           "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
           "z", ",", "z"}], "]"}], "-", 
         RowBox[{"kxb", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"kxb", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            "+", 
            RowBox[{"ky", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            "+", 
            RowBox[{"D", "[", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
              ",", "z"}], "]"}]}], ")"}]}]}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"finalEqs", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"iLapF", "[", 
            RowBox[{
             RowBox[{"Expand", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"LapMGradDiv1", "[", 
                 RowBox[{"fullFluctEqs", "/.", 
                  RowBox[{"\[Nu]b", "\[Rule]", "0"}]}], "]"}], "/.", 
                "derivRules"}], "/.", "toOrrSomerVars"}], "]"}], "//.", 
             "explicitLap2Rule"}], "]"}], "/.", "explicitLapFRule"}], "//", 
          "Expand"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Expand", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"D", "[", 
                RowBox[{
                 RowBox[{
                 "fullFluctEqs", "\[LeftDoubleBracket]", "2", 
                  "\[RightDoubleBracket]"}], ",", "z"}], "]"}], "-", 
               RowBox[{"ky", " ", 
                RowBox[{
                "fullFluctEqs", "\[LeftDoubleBracket]", "3", 
                 "\[RightDoubleBracket]"}]}]}], "/.", "derivRules"}], "/.", 
             "toOrrSomerVars"}], "]"}], "//.", "explicitLap2Rule"}], "/.", 
          RowBox[{"\[Nu]b", "\[Rule]", "0"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Expand", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
              "fullFluctEqs", "\[LeftDoubleBracket]", "5", 
               "\[RightDoubleBracket]"}], "/.", "derivRules"}], "/.", 
             "toOrrSomerVars"}], "]"}], "//.", "explicitLap2Rule"}], "/.", 
          RowBox[{"\[Eta]b", "\[Rule]", "0"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Expand", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"D", "[", 
                RowBox[{
                 RowBox[{
                 "fullFluctEqs", "\[LeftDoubleBracket]", "6", 
                  "\[RightDoubleBracket]"}], ",", "z"}], "]"}], "-", 
               RowBox[{"ky", " ", 
                RowBox[{
                "fullFluctEqs", "\[LeftDoubleBracket]", "7", 
                 "\[RightDoubleBracket]"}]}]}], "/.", "derivRules"}], "/.", 
             "toOrrSomerVars"}], "]"}], "//.", "explicitLap2Rule"}], "/.", 
          RowBox[{"\[Eta]b", "\[Rule]", "0"}]}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Fix", " ", "these", " ", "up", " ", "manually"}], " ", "-", 
        " ", 
        RowBox[{"sometimes", " ", "much", " ", "easier"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"This", " ", "is", " ", "plugging", " ", "in", " ", 
         RowBox[{"iLapF", "[", "lapF", "]"}]}], " ", "=", " ", 
        RowBox[{
        "1", " ", "in", " ", "the", " ", "more", " ", "complicated", " ", 
         "situation"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"Expand", "[", 
        RowBox[{
         RowBox[{"-", "ky"}], " ", 
         RowBox[{"iLapF", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                RowBox[{
                 RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                RowBox[{"D", "[", 
                 RowBox[{"#", ",", "z", ",", "z"}], "]"}]}], ")"}], "&"}], 
             "[", 
             RowBox[{
              RowBox[{"b", "[", 
               RowBox[{"z", ",", "t"}], "]"}], " ", 
              RowBox[{"By", "[", 
               RowBox[{"z", ",", "t"}], "]"}]}], "]"}], ")"}], "/.", 
           "derivRules"}], "]"}]}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"finalEqs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"finalEqs", "/.", 
            RowBox[{
             RowBox[{"Expand", "[", 
              RowBox[{
               RowBox[{"-", "ky"}], " ", 
               RowBox[{"iLapF", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                    RowBox[{
                    RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                    RowBox[{"D", "[", 
                    RowBox[{"#", ",", "z", ",", "z"}], "]"}]}], ")"}], "&"}], 
                   "[", 
                   RowBox[{
                    RowBox[{"b", "[", 
                    RowBox[{"z", ",", "t"}], "]"}], " ", 
                    RowBox[{"By", "[", 
                    RowBox[{"z", ",", "t"}], "]"}]}], "]"}], ")"}], "/.", 
                 "derivRules"}], "]"}]}], "]"}], "\[RuleDelayed]", 
             RowBox[{
              RowBox[{"-", " ", "ky"}], " ", 
              RowBox[{"b", "[", 
               RowBox[{"z", ",", "t"}], "]"}], 
              RowBox[{"By", "[", 
               RowBox[{"z", ",", "t"}], "]"}]}]}]}], "/.", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Expand", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "kxb"}], " ", 
               RowBox[{"iLapF", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                    RowBox[{
                    RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                    RowBox[{"D", "[", 
                    RowBox[{"#", ",", "z", ",", "z"}], "]"}]}], ")"}], "&"}], 
                   "[", 
                   RowBox[{
                    RowBox[{"b", "[", 
                    RowBox[{"z", ",", "t"}], "]"}], " ", 
                    RowBox[{"Bx", "[", 
                    RowBox[{"z", ",", "t"}], "]"}]}], "]"}], ")"}], "/.", 
                 "derivRules"}], "]"}]}], "+", 
              RowBox[{"kxb", " ", 
               RowBox[{"iLapF", "[", 
                RowBox[{
                 RowBox[{"dz", "[", 
                  RowBox[{"b", "[", 
                   RowBox[{"z", ",", " ", "t"}], "]"}], "]"}], " ", 
                 RowBox[{"dz", "[", 
                  RowBox[{"Bx", "[", 
                   RowBox[{"z", ",", " ", "t"}], "]"}], "]"}]}], "]"}]}]}], 
             "]"}], "\[RuleDelayed]", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "kxb"}], " ", 
              RowBox[{"b", "[", 
               RowBox[{"z", ",", "t"}], "]"}], 
              RowBox[{"Bx", "[", 
               RowBox[{"z", ",", "t"}], "]"}]}], "+", 
             RowBox[{"kxb", " ", 
              RowBox[{"iLapF", "[", 
               RowBox[{
                RowBox[{"dz", "[", 
                 RowBox[{"b", "[", 
                  RowBox[{"z", ",", " ", "t"}], "]"}], "]"}], "  ", 
                RowBox[{"dz", "[", 
                 RowBox[{"Bx", "[", 
                  RowBox[{"z", ",", " ", "t"}], "]"}], "]"}]}], "]"}]}]}]}]}],
           "/.", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Expand", "[", 
            RowBox[{"ky", " ", 
             RowBox[{"iLapF", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                    RowBox[{
                    RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                    RowBox[{"D", "[", 
                    RowBox[{"#", ",", "z", ",", "z"}], "]"}]}], ")"}], "&"}], 
                 "[", 
                 RowBox[{
                  RowBox[{"u", "[", 
                   RowBox[{"z", ",", "t"}], "]"}], " ", 
                  RowBox[{"Uy", "[", 
                   RowBox[{"z", ",", "t"}], "]"}]}], "]"}], ")"}], "/.", 
               "derivRules"}], "]"}]}], "]"}], "\[RuleDelayed]", " ", 
           RowBox[{"ky", " ", 
            RowBox[{"u", "[", 
             RowBox[{"z", ",", "t"}], "]"}], 
            RowBox[{"Uy", "[", 
             RowBox[{"z", ",", "t"}], "]"}]}]}]}], "/.", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Expand", "[", 
           RowBox[{
            RowBox[{"kxb", " ", 
             RowBox[{"iLapF", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                    RowBox[{
                    RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                    RowBox[{"D", "[", 
                    RowBox[{"#", ",", "z", ",", "z"}], "]"}]}], ")"}], "&"}], 
                 "[", 
                 RowBox[{
                  RowBox[{"u", "[", 
                   RowBox[{"z", ",", "t"}], "]"}], " ", 
                  RowBox[{"Ux", "[", 
                   RowBox[{"z", ",", "t"}], "]"}]}], "]"}], ")"}], "/.", 
               "derivRules"}], "]"}]}], "-", 
            RowBox[{"kxb", " ", 
             RowBox[{"iLapF", "[", 
              RowBox[{
               RowBox[{"dz", "[", 
                RowBox[{"u", "[", 
                 RowBox[{"z", ",", " ", "t"}], "]"}], "]"}], " ", 
               RowBox[{"dz", "[", 
                RowBox[{"Ux", "[", 
                 RowBox[{"z", ",", " ", "t"}], "]"}], "]"}]}], "]"}]}]}], 
           "]"}], "\[RuleDelayed]", " ", 
          RowBox[{
           RowBox[{"kxb", " ", 
            RowBox[{"u", "[", 
             RowBox[{"z", ",", "t"}], "]"}], 
            RowBox[{"Ux", "[", 
             RowBox[{"z", ",", "t"}], "]"}]}], "-", 
           RowBox[{"kxb", " ", 
            RowBox[{"iLapF", "[", 
             RowBox[{
              RowBox[{"dz", "[", 
               RowBox[{"u", "[", 
                RowBox[{"z", ",", " ", "t"}], "]"}], "]"}], "  ", 
              RowBox[{"dz", "[", 
               RowBox[{"Ux", "[", 
                RowBox[{"z", ",", " ", "t"}], "]"}], "]"}]}], "]"}]}]}]}]}], "/.", 
        RowBox[{
         RowBox[{"Expand", "[", 
          RowBox[{
           RowBox[{"-", " ", "B0z"}], " ", 
           RowBox[{"iLapF", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                  RowBox[{
                   RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                  RowBox[{"dz", "[", 
                   RowBox[{"dz", "[", "#", "]"}], "]"}]}], ")"}], "&"}], "[", 
               
               RowBox[{"dz", "[", 
                RowBox[{"b", "[", 
                 RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], ")"}], "/.", 
             "derivRules"}], "]"}]}], "]"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"-", "B0z"}], " ", 
          RowBox[{"dz", "[", 
           RowBox[{"b", "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}]}]}]}]}], ";"}]}], 
    "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Now", ",", " ", 
    RowBox[{"form", " ", "the", " ", "A", " ", "matrix"}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"redvars", " ", "=", 
   RowBox[{"{", 
    RowBox[{"u", ",", "\[Zeta]", ",", "b", ",", "\[Eta]"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"finalEqs", "=", 
    RowBox[{
     RowBox[{"Solve", "[", 
      RowBox[{
       RowBox[{"Thread", "[", 
        RowBox[{"finalEqs", "\[Equal]", "0"}], "]"}], ",", 
       RowBox[{"dt", "/@", 
        RowBox[{"(", 
         RowBox[{"Through", "[", 
          RowBox[{"redvars", "@@", 
           RowBox[{"{", 
            RowBox[{"z", ",", "t"}], "}"}]}], "]"}], ")"}]}]}], "]"}], 
     "\[LeftDoubleBracket]", 
     RowBox[{"1", ",", "All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Solve", " ", "for", " ", "time"}], "-", "derivatives"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"Aop", " ", "=", " ", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Function", "[", 
          RowBox[{
           RowBox[{"{", "var", "}"}], ",", 
           RowBox[{
            RowBox[{"Plus", "@@", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"#", ",", 
                    RowBox[{"var", "[", 
                    RowBox[{"z", ",", "t"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}], ",", 
                  "#", ",", 
                  RowBox[{"{", "}"}]}], "]"}], "&"}], "/@", 
               RowBox[{"(", 
                RowBox[{"plusToList", "@", 
                 RowBox[{
                 "finalEqs", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}], "/.", 
            RowBox[{
             RowBox[{"var", "[", 
              RowBox[{"z", ",", "t"}], "]"}], "\[Rule]", "ph"}]}]}], "]"}], "/@",
          "redvars"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ")"}], "//", 
    "MatrixForm"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "This", " ", "matches", " ", "my", " ", "previously", " ", "derived", " ", 
    
    RowBox[{"(", 
     RowBox[{"by", " ", "hand"}], ")"}], " ", "version"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"\"\<Mean field derivatives: \>\"", ",", " ", 
    RowBox[{"Union", "@", 
     RowBox[{"Cases", "[", 
      RowBox[{
       RowBox[{"finalEqs", "/.", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"Through", "[", 
           RowBox[{"meanFields", "@@", 
            RowBox[{"{", 
             RowBox[{"z", ",", "t"}], "}"}]}], "]"}], "->", "meanFields"}], 
         "]"}]}], ",", 
       RowBox[{"a_", "?", "meanFieldQ"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}]}]}], "]"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.613288323045455*^9, 3.613288326117752*^9}, {
   3.613288389643783*^9, 3.613288407039393*^9}, {3.613288479968417*^9, 
   3.613288487728981*^9}, {3.613288573589717*^9, 3.613288752358992*^9}, {
   3.613288852631976*^9, 3.613288916198966*^9}, {3.613288986990489*^9, 
   3.6132891926695137`*^9}, {3.613289423308837*^9, 3.613289432319971*^9}, {
   3.613289540309534*^9, 3.613289551704471*^9}, {3.613289593180532*^9, 
   3.613289597516069*^9}, {3.6132897828569527`*^9, 3.613289799551094*^9}, {
   3.613289832684938*^9, 3.613289857392364*^9}, {3.613289899387167*^9, 
   3.613289949003064*^9}, {3.613290022566579*^9, 3.613290072980708*^9}, {
   3.6132901333440037`*^9, 3.6132902277049723`*^9}, {3.613290347360075*^9, 
   3.613290348877283*^9}, {3.613290407662169*^9, 3.6132904199021072`*^9}, {
   3.613290617515009*^9, 3.613290693570179*^9}, {3.6132907374778633`*^9, 
   3.613290807808112*^9}, {3.6132911924799023`*^9, 3.613291195598812*^9}, {
   3.6132912379815063`*^9, 3.613291248693972*^9}, {3.613291280284522*^9, 
   3.613291408458893*^9}, {3.613291458080309*^9, 3.613291470927746*^9}, {
   3.6132915090035563`*^9, 3.613291525286358*^9}, {3.6132921232255783`*^9, 
   3.613292144859001*^9}, {3.613292297867838*^9, 3.613292316012755*^9}, 
   3.6132930883268547`*^9, {3.613293312306075*^9, 3.61329333079275*^9}, {
   3.6133006141405077`*^9, 3.61330070673322*^9}, {3.613300799309185*^9, 
   3.613300851120187*^9}, {3.613300912016116*^9, 3.6133009327016172`*^9}, {
   3.6133010023231773`*^9, 3.613301012699256*^9}, {3.6133010441561947`*^9, 
   3.613301156627*^9}, 3.6133013078550577`*^9, {3.613301447081024*^9, 
   3.613301449877001*^9}, {3.6133015415117207`*^9, 3.6133015541220617`*^9}, {
   3.6133016618658733`*^9, 3.613301704111124*^9}, {3.61330185743235*^9, 
   3.613301871088355*^9}, {3.613301910782558*^9, 3.6133019246441307`*^9}, {
   3.613301999871911*^9, 3.6133020708752737`*^9}, {3.61330239110786*^9, 
   3.613302487596188*^9}, {3.613302551646475*^9, 3.61330262406814*^9}, {
   3.6133045173899403`*^9, 3.6133045479377737`*^9}, {3.6133047488389683`*^9, 
   3.6133047694867353`*^9}, {3.613304829996623*^9, 3.613304868581319*^9}, {
   3.613304943519965*^9, 3.613304948407606*^9}, {3.6133053005957613`*^9, 
   3.613305319748056*^9}, {3.6133261571880493`*^9, 3.613326178299334*^9}, {
   3.613326367599222*^9, 3.613326560664708*^9}, {3.613326591582814*^9, 
   3.613326696955864*^9}, {3.613327160076173*^9, 3.613327161075317*^9}, {
   3.61332757642347*^9, 3.613327611115761*^9}, {3.613327657453199*^9, 
   3.613327813791049*^9}, {3.61332805091748*^9, 3.6133280531810827`*^9}, {
   3.613328083202976*^9, 3.613328090811761*^9}, 3.613328347059229*^9, {
   3.613328833019064*^9, 3.6133288553167562`*^9}, {3.6133291560666847`*^9, 
   3.613329177719489*^9}, 3.6141771183999968`*^9, {3.614189292301111*^9, 
   3.614189302092698*^9}, {3.614361699979642*^9, 3.614361719890554*^9}, {
   3.614504566104581*^9, 3.614504591016654*^9}, {3.614504663864559*^9, 
   3.614504666982682*^9}, {3.614545423593639*^9, 3.614545467974424*^9}, {
   3.614545503295141*^9, 3.614545505932638*^9}, {3.6145455804415207`*^9, 
   3.614545585925158*^9}, {3.614545671972193*^9, 3.614545700909773*^9}, {
   3.61461389665655*^9, 3.6146138980964413`*^9}, {3.614614204204667*^9, 
   3.6146142157163477`*^9}, {3.615049925891439*^9, 3.6150500375845757`*^9}, {
   3.615050120302868*^9, 3.615050132436124*^9}, {3.615058355525507*^9, 
   3.615058358405109*^9}, {3.615058881326123*^9, 3.6150589009419403`*^9}, 
   3.615059782653624*^9, {3.6150637800470552`*^9, 3.6150637964784727`*^9}, {
   3.615063864018147*^9, 3.615063900598628*^9}, {3.633266836052449*^9, 
   3.633266844050617*^9}, {3.653921133453898*^9, 3.6539211421667337`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", 
    SuperscriptBox[
     OverscriptBox[
      SubscriptBox["k", "x"], "\[LongDash]"], "2"]}], " ", 
   SubscriptBox["k", "y"], " ", 
   RowBox[{
    SuperscriptBox[
     SubscriptBox["\[EmptyUpTriangle]", "F"], 
     RowBox[{"-", "1"}]], "[", 
    RowBox[{
     RowBox[{"b", "[", 
      RowBox[{"z", ",", "t"}], "]"}], " ", 
     RowBox[{
      SubscriptBox["B", "y"], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "]"}]}], "-", 
  RowBox[{
   SubsuperscriptBox["k", "y", "3"], " ", 
   RowBox[{
    SuperscriptBox[
     SubscriptBox["\[EmptyUpTriangle]", "F"], 
     RowBox[{"-", "1"}]], "[", 
    RowBox[{
     RowBox[{"b", "[", 
      RowBox[{"z", ",", "t"}], "]"}], " ", 
     RowBox[{
      SubscriptBox["B", "y"], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "]"}]}], "-", 
  RowBox[{"2", " ", 
   SubscriptBox["k", "y"], " ", 
   RowBox[{
    SuperscriptBox[
     SubscriptBox["\[EmptyUpTriangle]", "F"], 
     RowBox[{"-", "1"}]], "[", 
    RowBox[{
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{"b", "[", 
       RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["B", "y"], "[", 
       RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "-", 
  RowBox[{
   SubscriptBox["k", "y"], " ", 
   RowBox[{
    SuperscriptBox[
     SubscriptBox["\[EmptyUpTriangle]", "F"], 
     RowBox[{"-", "1"}]], "[", 
    RowBox[{
     RowBox[{
      SubscriptBox["B", "y"], "[", 
      RowBox[{"z", ",", "t"}], "]"}], " ", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       RowBox[{"b", "[", 
        RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}]}], "]"}]}], "-", 
  RowBox[{
   SubscriptBox["k", "y"], " ", 
   RowBox[{
    SuperscriptBox[
     SubscriptBox["\[EmptyUpTriangle]", "F"], 
     RowBox[{"-", "1"}]], "[", 
    RowBox[{
     RowBox[{"b", "[", 
      RowBox[{"z", ",", "t"}], "]"}], " ", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       RowBox[{
        SubscriptBox["B", "y"], "[", 
        RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}]}], "]"}]}]}]], "Print",
 CellChangeTimes->{
  3.615050136793145*^9, 3.615051032894452*^9, 3.6150583665519133`*^9, 
   3.61505890273475*^9, 3.6150636545466957`*^9, 3.615063797662045*^9, 
   3.6150639019609327`*^9, {3.6150639769286137`*^9, 3.6150639937635803`*^9}, 
   3.615117165822989*^9, 3.633265456507525*^9, 3.633265610294653*^9, 
   3.633266846545187*^9, 3.6332674584013023`*^9, 3.6539222846072683`*^9}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"]}], " ", 
        SubscriptBox["k", "y"], " ", "q", " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{"\[SmallCircle]", " ", "S"}], "]"}]}], "-", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", "q", " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{"\[SmallCircle]", " ", "x"}], "]"}]}], "-", 
       RowBox[{
        SubsuperscriptBox["k", "y", "3"], " ", "q", " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{"\[SmallCircle]", " ", "x"}], "]"}]}], "+", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{"\[SmallCircle]", " ", "S", " ", "x"}], "]"}]}], "+", 
       RowBox[{
        SubsuperscriptBox["k", "y", "3"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{"\[SmallCircle]", " ", "S", " ", "x"}], "]"}]}], "-", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "q", " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{"x", " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}], 
           "]"}]}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{"S", " ", "x", " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}], 
           "]"}]}], "]"}]}], "+", 
       RowBox[{"2", " ", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{
             SuperscriptBox[
              SubscriptBox["\[EmptyUpTriangle]", "2"], 
              RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], "]"}],
           " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{"Ux", "[", 
             RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}]}], "]"}]}], "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{
             SubscriptBox["\[PartialD]", "z"], "[", 
             RowBox[{"Ux", "[", 
              RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], 
         "]"}]}], "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}], 
          " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{"Ux", "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "-", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "3"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{"Ux", "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "-", 
       RowBox[{"2", " ", 
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{"Uy", "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", "\[SmallCircle]", " ", 
        RowBox[{"Ux", "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "-", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{"Uy", "[", 
         RowBox[{"z", ",", "t"}], "]"}]}]}], 
      RowBox[{
       RowBox[{"2", " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{"\[CapitalOmega]", " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
         "]"}]}], "+", 
       RowBox[{"2", " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{"Ux", "[", 
             RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], 
         "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{"\[SmallCircle]", " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{"Ux", "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{
             SubscriptBox["\[PartialD]", "z"], "[", 
             RowBox[{"Ux", "[", 
              RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], "]"}], " ", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "]"}]}], "-", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{"Ux", "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "]"}]}], "-", 
       RowBox[{"2", " ", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        SubsuperscriptBox["k", "y", "2"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{"Uy", "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "]"}]}]}], 
      RowBox[{
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "x"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "y"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["B", "z0"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}], 
          " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["B", "x"], "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "-", 
       RowBox[{"2", " ", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{
             SubscriptBox["B", "x"], "[", 
             RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{
             SuperscriptBox[
              SubscriptBox["\[EmptyUpTriangle]", "2"], 
              RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], 
           "]"}]}], "]"}]}], "+", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "3"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["B", "x"], "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], 
         "]"}]}], "+", 
       RowBox[{"2", " ", 
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["B", "y"], "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], 
         "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{
             SubscriptBox["\[PartialD]", "z"], "[", 
             RowBox[{
              SubscriptBox["B", "x"], "[", 
              RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], 
         "]"}]}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         SubscriptBox["k", "y"]}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{"\[SmallCircle]", " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["B", "x"], "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "-", 
       RowBox[{"2", " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{
             SubscriptBox["B", "x"], "[", 
             RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], 
         "]"}]}], "+", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["B", "x"], "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "]"}]}], "+", 
       RowBox[{"2", " ", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        SubsuperscriptBox["k", "y", "2"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["B", "y"], "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "]"}]}], "-", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{
             SubscriptBox["\[PartialD]", "z"], "[", 
             RowBox[{
              SubscriptBox["B", "x"], "[", 
              RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], "]"}], " ", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "]"}]}]}]},
     {
      RowBox[{
       RowBox[{"S", " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "-", 
       RowBox[{"2", " ", "\[CapitalOmega]", " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{"Uy", "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{"Uy", "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "+", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{"Ux", "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         SubscriptBox["k", "y"]}], " ", "\[SmallCircle]", " ", "q", " ", 
        "x"}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", "S", " ", "x"}], 
       "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{"Ux", "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{"Uy", "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", "\[SmallCircle]", " ", 
        RowBox[{"Ux", "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "-", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{"Uy", "[", 
         RowBox[{"z", ",", "t"}], "]"}]}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"]}], " ", "\[SmallCircle]", 
        " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "y"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "-", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "x"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}], 
      RowBox[{
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "x"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "y"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["B", "z0"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "x"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "-", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}]},
     {
      RowBox[{
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "x"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "y"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["B", "z0"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "x"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}]}], 
      RowBox[{
       SubscriptBox["k", "y"], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["B", "x"], "[", 
         RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
       RowBox[{
        SuperscriptBox[
         SubscriptBox["\[EmptyUpTriangle]", "2"], 
         RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         SubscriptBox["k", "y"]}], " ", "\[SmallCircle]", " ", "q", " ", 
        "x"}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", "S", " ", "x"}], 
       "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{"Ux", "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", "\[SmallCircle]", " ", 
        RowBox[{"Ux", "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "-", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{"Uy", "[", 
         RowBox[{"z", ",", "t"}], "]"}]}]}], 
      RowBox[{
       RowBox[{"-", 
        SubscriptBox["k", "y"]}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{"Ux", "[", 
         RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
       RowBox[{
        SuperscriptBox[
         SubscriptBox["\[EmptyUpTriangle]", "2"], 
         RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]},
     {
      RowBox[{
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "y"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], "]"}]}],
        "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "-", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "x"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        SubsuperscriptBox["k", "y", "2"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "y"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}], 
      RowBox[{
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "x"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "y"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["B", "z0"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "x"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "+", 
       RowBox[{"2", " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "y"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"-", "S"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{"Uy", "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], "]"}], 
        " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{"Uy", "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "+", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{"Ux", "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        SubsuperscriptBox["k", "y", "2"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{"Uy", "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         SubscriptBox["k", "y"]}], " ", "\[SmallCircle]", " ", "q", " ", 
        "x"}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", "S", " ", "x"}], 
       "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{"Ux", "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "-", 
       RowBox[{"2", " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{"Uy", "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "-", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{"Uy", "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", "\[SmallCircle]", " ", 
        RowBox[{"Ux", "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "-", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{"Uy", "[", 
         RowBox[{"z", ",", "t"}], "]"}]}]}]}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{
  3.613304869590173*^9, 3.6133049495007257`*^9, 3.6133053207405367`*^9, {
   3.613326485387342*^9, 3.613326561490202*^9}, {3.613326595815199*^9, 
   3.6133266040226097`*^9}, 3.613326660026622*^9, 3.61332716201223*^9, {
   3.6133275947793913`*^9, 3.613327612121537*^9}, {3.613327744727991*^9, 
   3.613327815555489*^9}, 3.613328054239262*^9, 3.613328356531164*^9, 
   3.613328856170669*^9, {3.613329165606255*^9, 3.613329178601987*^9}, 
   3.614177119713147*^9, 3.614189304110643*^9, 3.6143617220896473`*^9, 
   3.614504591952222*^9, 3.614504668409453*^9, 3.614542661480213*^9, 
   3.614545459261648*^9, 3.6145455874121523`*^9, {3.614545678856031*^9, 
   3.614545702075966*^9}, 3.614613916915284*^9, 3.6146142165153627`*^9, 
   3.614615738904825*^9, 3.614616051270179*^9, 3.6150498888017807`*^9, {
   3.615050010514894*^9, 3.615050039439272*^9}, {3.615050125142047*^9, 
   3.6150501367897873`*^9}, 3.6150510328884478`*^9, 3.6150583665426188`*^9, 
   3.6150589028007183`*^9, 3.61506365461132*^9, 3.615063797700103*^9, 
   3.615063902027466*^9, {3.6150639769896097`*^9, 3.6150639938249807`*^9}, 
   3.615117165875517*^9, 3.633265456551937*^9, 3.633265610333009*^9, 
   3.633266846588936*^9, 3.6332674584501867`*^9, 3.653922284678236*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Mean field derivatives: \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["B", "x"], ",", 
     SubscriptBox["B", "y"], ",", "Ux", ",", "Uy", ",", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      SubscriptBox["B", "x"], "]"}], ",", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      SubscriptBox["B", "y"], "]"}], ",", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], ",", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], ",", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       SubscriptBox["B", "x"], "]"}], "]"}], ",", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       SubscriptBox["B", "y"], "]"}], "]"}], ",", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}], ",", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}], ",", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}], "]"}], "]"}], ",", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}], "]"}]}], 
    "}"}]}],
  SequenceForm[
  "Mean field derivatives: ", {$CellContext`Bx, $CellContext`By, \
$CellContext`Ux, $CellContext`Uy, 
    $CellContext`dz[$CellContext`Bx], 
    $CellContext`dz[$CellContext`By], 
    $CellContext`dz[$CellContext`Ux], 
    $CellContext`dz[$CellContext`Uy], 
    $CellContext`dz[
     $CellContext`dz[$CellContext`Bx]], 
    $CellContext`dz[
     $CellContext`dz[$CellContext`By]], 
    $CellContext`dz[
     $CellContext`dz[$CellContext`Ux]], 
    $CellContext`dz[
     $CellContext`dz[$CellContext`Uy]], 
    $CellContext`dz[
     $CellContext`dz[
      $CellContext`dz[$CellContext`Bx]]], 
    $CellContext`dz[
     $CellContext`dz[
      $CellContext`dz[$CellContext`Ux]]]}],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.615050136793145*^9, 3.615051032894452*^9, 3.6150583665519133`*^9, 
   3.61505890273475*^9, 3.6150636545466957`*^9, 3.615063797662045*^9, 
   3.6150639019609327`*^9, {3.6150639769286137`*^9, 3.6150639937635803`*^9}, 
   3.615117165822989*^9, 3.633265456507525*^9, 3.633265610294653*^9, 
   3.633266846545187*^9, 3.6332674584013023`*^9, 3.6539222846935596`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Working out the matrix product, and getting things into a \
\[OpenCurlyDoubleQuote]code convenient\[CloseCurlyDoubleQuote] form\
\>", "Subsection",
 CellChangeTimes->{{3.613329080723421*^9, 3.613329105297495*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Cmat", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"Cm", "[", 
     RowBox[{"i", ",", "j"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "numVariables"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", "numVariables"}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fullMatrixEquations", " ", "=", " ", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Aop", "\[LeftDoubleBracket]", 
          RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], "/.", 
         RowBox[{"ph", "->", 
          RowBox[{"Cmat", "\[LeftDoubleBracket]", 
           RowBox[{"j", ",", "k"}], "\[RightDoubleBracket]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "numVariables"}], "}"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "numVariables"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"k", ",", "numVariables"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Redefine", " ", "lapF", " ", "to", " ", "collect", " ", "as", " ", 
     "many", " ", "terms", " ", "as", " ", "possible"}], ",", " ", 
    RowBox[{"collect", " ", "in", " ", "mean", " ", "fields"}]}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fullMatrixEquations", "=", 
   RowBox[{"MapAll", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Collect", "[", 
       RowBox[{"#", ",", "meanFieldsWDerivs"}], "]"}], "&"}], ",", 
     RowBox[{
      RowBox[{"fullMatrixEquations", "/.", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"Through", "[", 
          RowBox[{"meanFields", "@@", 
           RowBox[{"{", 
            RowBox[{"z", ",", "t"}], "}"}]}], "]"}], "->", "meanFields"}], 
        "]"}]}], 
      RowBox[{"(*", 
       RowBox[{"Easier", " ", "to", " ", "look", " ", "at"}], "*)"}], "/.", 
      "\[IndentingNewLine]", 
      RowBox[{"iLapF", "\[Rule]", "iLapFColl"}]}]}], 
    RowBox[{"(*", 
     RowBox[{"Collect", " ", "iLapF", " ", "terms"}], "*)"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"fullMatrixEquations", "=", 
  RowBox[{"fullMatrixEquations", "//.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"dz", "[", 
       RowBox[{"a_", "/;", 
        RowBox[{"!", 
         RowBox[{"meanFieldQ", "[", "a", "]"}]}]}], "]"}], "\[RuleDelayed]", 
      RowBox[{"dz", " ", "a"}]}], ",", 
     RowBox[{
      RowBox[{"iLap2", "[", "a_", "]"}], "\[RuleDelayed]", 
      RowBox[{"iLap2", " ", "a"}]}]}], "}"}]}]}]}], "Input",
 CellChangeTimes->{{3.614183523653407*^9, 3.614183619973299*^9}, {
   3.6141837102104187`*^9, 3.61418374185849*^9}, {3.6141849032639017`*^9, 
   3.614184910371166*^9}, {3.6141856403035383`*^9, 3.614185671246872*^9}, {
   3.614185814106379*^9, 3.614185877677721*^9}, {3.614186008201589*^9, 
   3.6141860563838873`*^9}, {3.6141861298094*^9, 3.614186133404842*^9}, {
   3.614186265993711*^9, 3.614186266722341*^9}, {3.61418645140637*^9, 
   3.61418648051291*^9}, {3.614186552940997*^9, 3.6141865737590837`*^9}, {
   3.614188523622821*^9, 3.6141885248935966`*^9}, {3.614189283362381*^9, 
   3.614189315179832*^9}, {3.614189422729567*^9, 3.614189433440941*^9}, {
   3.614189677743164*^9, 3.61418967848466*^9}, {3.6141967572921963`*^9, 
   3.6141967583883953`*^9}, {3.6141989228199043`*^9, 3.614198945631775*^9}, 
   3.614198982104651*^9, {3.614361772710515*^9, 3.6143618063669567`*^9}, {
   3.614504631869879*^9, 3.614504678095435*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "2"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "3"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "2"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "3"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"3", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"3", "\[InvisibleComma]", "2"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"3", "\[InvisibleComma]", "3"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"4", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"4", "\[InvisibleComma]", "2"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"4", "\[InvisibleComma]", "3"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"4", "\[InvisibleComma]", "4"}]]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.614186133917675*^9, 3.614186267048477*^9, 3.614186481926425*^9, 
   3.6141885255283833`*^9, 3.614189319838678*^9, {3.6141894304574347`*^9, 
   3.614189433941032*^9}, 3.614189678940024*^9, 3.614195966966*^9, 
   3.614196761527596*^9, {3.61419892962738*^9, 3.614198946179511*^9}, 
   3.61419898388535*^9, {3.614361787735118*^9, 3.614361807137169*^9}, 
   3.614504597712901*^9, {3.614504637573621*^9, 3.6145046797962427`*^9}, 
   3.614542667785318*^9, 3.614545623141712*^9, 3.614545706505865*^9, 
   3.614545743858747*^9, 3.61461400100451*^9, 3.6146142242536373`*^9, 
   3.614615742538946*^9, 3.614616053498505*^9, 3.6150510348507347`*^9, 
   3.6150584138525*^9, 3.615064001746892*^9, 3.615117169253036*^9, 
   3.6332674667886877`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"-", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"]}], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SuperscriptBox[
        SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
        RowBox[{"-", "1"}]], "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], " ", 
         SubscriptBox["k", "y"], " ", "q", " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
        RowBox[{"2", " ", 
         SubscriptBox["\[PartialD]", "z"], " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             SubscriptBox["\[PartialD]", "z"]}], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "+", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "3"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "-", 
           RowBox[{
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "1"}]]}], "+", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "x"], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "+", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "y"], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "-", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "3"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
           RowBox[{
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "-", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "-", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], " ", 
            SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "-", 
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           SubscriptBox["B", "x"], "]"}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             SubscriptBox["\[PartialD]", "z"]}], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "-", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            SubscriptBox["B", "x"], "]"}], "]"}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}], 
          "]"}]}]}], "]"}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"-", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"]}], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SuperscriptBox[
        SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
        RowBox[{"-", "1"}]], "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], " ", 
         SubscriptBox["k", "y"], " ", "q", " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
        RowBox[{"2", " ", 
         SubscriptBox["\[PartialD]", "z"], " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             SubscriptBox["\[PartialD]", "z"]}], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "+", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "3"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "-", 
           RowBox[{
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "2"}]]}], "+", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "x"], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "+", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "y"], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "-", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "3"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
           RowBox[{
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "-", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "-", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], " ", 
            SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "-", 
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           SubscriptBox["B", "x"], "]"}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             SubscriptBox["\[PartialD]", "z"]}], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "-", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            SubscriptBox["B", "x"], "]"}], "]"}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}], 
          "]"}]}]}], "]"}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"-", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"]}], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SuperscriptBox[
        SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
        RowBox[{"-", "1"}]], "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], " ", 
         SubscriptBox["k", "y"], " ", "q", " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
        RowBox[{"2", " ", 
         SubscriptBox["\[PartialD]", "z"], " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"2", "\[InvisibleComma]", "3"}]]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             SubscriptBox["\[PartialD]", "z"]}], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "3"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "-", 
           RowBox[{
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "3"}]]}], "+", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "x"], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "y"], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "-", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "3"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
           RowBox[{
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "3"}]]}], "-", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "-", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], " ", 
            SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "-", 
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           SubscriptBox["B", "x"], "]"}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             SubscriptBox["\[PartialD]", "z"]}], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "-", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            SubscriptBox["B", "x"], "]"}], "]"}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}], 
          "]"}]}]}], "]"}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"-", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"]}], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SuperscriptBox[
        SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
        RowBox[{"-", "1"}]], "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], " ", 
         SubscriptBox["k", "y"], " ", "q", " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
        RowBox[{"2", " ", 
         SubscriptBox["\[PartialD]", "z"], " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             SubscriptBox["\[PartialD]", "z"]}], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "+", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "3"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "-", 
           RowBox[{
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "4"}]]}], "+", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "x"], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "+", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "y"], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "-", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "3"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
           RowBox[{
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "-", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "-", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], " ", 
            SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "-", 
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           SubscriptBox["B", "x"], "]"}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             SubscriptBox["\[PartialD]", "z"]}], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "-", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            SubscriptBox["B", "x"], "]"}], "]"}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}], 
          "]"}]}]}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]]}], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "+", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "1"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "-", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}], "+", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]]}], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "+", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "2"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "-", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}], "+", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "3"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]]}], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "3"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "-", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}], "+", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]]}], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "+", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "4"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "-", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}], "+", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}]}]}]}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}]}]}], "}"}], ",", 
   
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]]}], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "-", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubsuperscriptBox["\[PartialD]", "z", "2"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "-", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]]}], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "-", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubsuperscriptBox["\[PartialD]", "z", "2"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "-", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "3"}]]}], "-", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "3"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]]}], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "-", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubsuperscriptBox["\[PartialD]", "z", "2"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "-", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "z0"], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "x"], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "-", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "4"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]]}], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "-", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubsuperscriptBox["\[PartialD]", "z", "2"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "-", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}]}]}]}], 
    "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.614186133917675*^9, 3.614186267048477*^9, 3.614186481926425*^9, 
   3.6141885255283833`*^9, 3.614189319838678*^9, {3.6141894304574347`*^9, 
   3.614189433941032*^9}, 3.614189678940024*^9, 3.614195966966*^9, 
   3.614196761527596*^9, {3.61419892962738*^9, 3.614198946179511*^9}, 
   3.61419898388535*^9, {3.614361787735118*^9, 3.614361807137169*^9}, 
   3.614504597712901*^9, {3.614504637573621*^9, 3.6145046797962427`*^9}, 
   3.614542667785318*^9, 3.614545623141712*^9, 3.614545706505865*^9, 
   3.614545743858747*^9, 3.61461400100451*^9, 3.6146142242536373`*^9, 
   3.614615742538946*^9, 3.614616053498505*^9, 3.6150510348507347`*^9, 
   3.6150584138525*^9, 3.615064001746892*^9, 3.615117169253036*^9, 
   3.633267466926202*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Put everything into c++ form, including taking the Fourier transforms\
\>", "Subsection",
 CellChangeTimes->{{3.614195675973181*^9, 3.614195696141123*^9}}],

Cell[CellGroupData[{

Cell["Define the various functions and variables to use in c++", \
"Subsubsection",
 CellChangeTimes->{
  3.614200068915313*^9, {3.6145427017460127`*^9, 3.614542707265788*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"CklOut", " ", "=", " ", "\"\<Ckl_out[i]\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CklIn", " ", "=", " ", "\"\<Ckl_in[i]\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ifft", " ", "=", " ", "\"\<fft_.back_2DFull\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fft", " ", "=", " ", "\"\<fft_.for_2DFull\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dealias", " ", "=", " ", "\"\<dealias\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cppProducts", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"\"\<.asDiagonal()*\>\"", ",", "\"\<*\>\""}], "}"}]}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{"Second", " ", "one", " ", "is", " ", "for", " ", "scalars"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"MFcppVariables", " ", "=", 
  RowBox[{"Thread", "[", " ", 
   RowBox[{"meanFieldsWDerivs", "->", 
    RowBox[{"StringReplace", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ToString", "[", "#", "]"}], "<>", "\"\<_\>\""}], "&"}], "/@",
        "meanFieldsWDerivs"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<[\>\"", "\[Rule]", "\"\<\>\""}], ",", 
        RowBox[{"\"\<]\>\"", "\[Rule]", "\"\<\>\""}]}], "}"}]}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"iLapFvar", " ", "=", " ", "\"\<ilapFtmp_.matrix()\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ftFactorVar", "=", "\"\<fft2Dfac_\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"vectorVars", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"iLap2", ",", "dz", ",", "iLapFColl"}], "}"}]}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{
   "Variables", " ", "that", " ", "are", " ", "vectors", " ", "in", " ", 
    RowBox[{"c", "++"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"variablesInCpp", " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"ky", "\[Rule]", "\"\<kyctmp_\>\""}], ",", 
    RowBox[{"kxb", "\[Rule]", "\"\<kxctmp_\>\""}], ",", 
    RowBox[{"dz", "\[Rule]", "\"\<kz_\>\""}], ",", 
    RowBox[{"q", "\[Rule]", "\"\<q_\>\""}], ",", 
    RowBox[{"iLap2", "\[Rule]", "\"\<ilap2tmp_\>\""}], ",", 
    RowBox[{"B0z", "\[Rule]", "\"\<B0z_\>\""}]}], "}"}]}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQBmIQfeAVS0/H21eOxxt/zwXRZ6ReLQLRei+VFoNoHuZ9
G0H02kWzN4NoK0MzhS4gbSbCoQiiTxxtKO4G0iKTZ5SBaE9PiakgWiflPpje
8tLnGIhuKvx+AkRHCK0X6AHS7xT3CILowDYLcRCd8MlSDkT3XXDSBNFOlRfA
dCuHgz6IjkqcAKYDJi4zBtFyfE/BtJjZj5BTQPpHl1w4iHbJrTgPopsWPLoM
oi083O+A6Jr/8x6D6Fct7K9AtJaZOpjeJvbL9jSQLltWYg+ipxgdmg+iNayW
LQDRHf06U84DaY+qhqkg+sauSx8ugMJnvv9HEB344sOev0DaLvvOARAtuOrr
DxAtJFr/C0Tf+xhp8g9k3+eJYDrg4MrbPO9eOUYH+t4B0dNs//6UA9K+Ze6/
QbRR71Q7z/evHHU3i9iDaBcHsbgXgq8dX+3OAdMAMK38bw==
  "]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    SubscriptBox["B", "x"], "\[Rule]", "\<\"Bx_\"\>"}], ",", 
   RowBox[{
    SubscriptBox["B", "y"], "\[Rule]", "\<\"By_\"\>"}], ",", 
   RowBox[{"Ux", "\[Rule]", "\<\"Ux_\"\>"}], ",", 
   RowBox[{"Uy", "\[Rule]", "\<\"Uy_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     SubscriptBox["B", "x"], "]"}], "\[Rule]", "\<\"dzBx_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     SubscriptBox["B", "y"], "]"}], "\[Rule]", "\<\"dzBy_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], 
    "\[Rule]", "\<\"dzUx_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], 
    "\[Rule]", "\<\"dzUy_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      SubscriptBox["B", "x"], "]"}], "]"}], "\[Rule]", "\<\"dzdzBx_\"\>"}], 
   ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      SubscriptBox["B", "y"], "]"}], "]"}], "\[Rule]", "\<\"dzdzBy_\"\>"}], 
   ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}], 
    "\[Rule]", "\<\"dzdzUx_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}], 
    "\[Rule]", "\<\"dzdzUy_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       SubscriptBox["B", "x"], "]"}], "]"}], "]"}], 
    "\[Rule]", "\<\"dzdzdzBx_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       SubscriptBox["B", "y"], "]"}], "]"}], "]"}], 
    "\[Rule]", "\<\"dzdzdzBy_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}], "]"}], 
    "\[Rule]", "\<\"dzdzdzUx_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}], "]"}], 
    "\[Rule]", "\<\"dzdzdzUy_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "x"], "]"}], "]"}], "]"}], "]"}], 
    "\[Rule]", "\<\"dzdzdzdzBx_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}], "]"}], "]"}], "]"}], 
    "\[Rule]", "\<\"dzdzdzdzBy_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}], "]"}], 
     "]"}], "\[Rule]", "\<\"dzdzdzdzUx_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}], "]"}], 
     "]"}], "\[Rule]", "\<\"dzdzdzdzUy_\"\>"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6141968971191683`*^9, {3.614196955865787*^9, 3.614196976553069*^9}, 
   3.6141970176273737`*^9, {3.614197140642284*^9, 3.6141971499528723`*^9}, 
   3.61420280515613*^9, 3.6142041474039993`*^9, 3.61420432093274*^9, 
   3.614332753782305*^9, 3.6143334373897533`*^9, 3.614334227966806*^9, 
   3.614335330770611*^9, {3.614342317980378*^9, 3.6143423257325563`*^9}, 
   3.614345100654113*^9, 3.614361816160263*^9, 3.614385394517193*^9, 
   3.614436871615592*^9, 3.6144373337998466`*^9, 3.614437922414172*^9, 
   3.61446781112652*^9, 3.614504610070334*^9, 3.614504924258411*^9, 
   3.614542674887701*^9, 3.61454565515012*^9, 3.614545745944592*^9, 
   3.614615781190735*^9, 3.615115374144129*^9, 3.6151157690167103`*^9, {
   3.615116874721467*^9, 3.615116883022649*^9}, 3.6151171877418413`*^9, 
   3.633267506989159*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    SubscriptBox["k", "y"], "\[Rule]", "\<\"kyctmp_\"\>"}], ",", 
   RowBox[{
    OverscriptBox[
     SubscriptBox["k", "x"], "\[LongDash]"], "\[Rule]", "\<\"kxctmp_\"\>"}], 
   ",", 
   RowBox[{
    SubscriptBox["\[PartialD]", "z"], "\[Rule]", "\<\"kz_\"\>"}], ",", 
   RowBox[{"q", "\[Rule]", "\<\"q_\"\>"}], ",", 
   RowBox[{
    SuperscriptBox[
     SubscriptBox["\[EmptyUpTriangle]", "2"], 
     RowBox[{"-", "1"}]], "\[Rule]", "\<\"ilap2tmp_\"\>"}], ",", 
   RowBox[{
    SubscriptBox["B", "z0"], "\[Rule]", "\<\"B0z_\"\>"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6141968971191683`*^9, {3.614196955865787*^9, 3.614196976553069*^9}, 
   3.6141970176273737`*^9, {3.614197140642284*^9, 3.6141971499528723`*^9}, 
   3.61420280515613*^9, 3.6142041474039993`*^9, 3.61420432093274*^9, 
   3.614332753782305*^9, 3.6143334373897533`*^9, 3.614334227966806*^9, 
   3.614335330770611*^9, {3.614342317980378*^9, 3.6143423257325563`*^9}, 
   3.614345100654113*^9, 3.614361816160263*^9, 3.614385394517193*^9, 
   3.614436871615592*^9, 3.6144373337998466`*^9, 3.614437922414172*^9, 
   3.61446781112652*^9, 3.614504610070334*^9, 3.614504924258411*^9, 
   3.614542674887701*^9, 3.61454565515012*^9, 3.614545745944592*^9, 
   3.614615781190735*^9, 3.615115374144129*^9, 3.6151157690167103`*^9, {
   3.615116874721467*^9, 3.615116883022649*^9}, 3.6151171877418413`*^9, 
   3.633267506999905*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Setup functions to find all the coefficients and replace by c++ variables, \
save these variables to automatically compute later\
\>", "Subsubsection",
 CellChangeTimes->{{3.6142001576080503`*^9, 3.6142001733730717`*^9}, {
  3.614542687579644*^9, 3.6145426929862757`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "The", " ", "main", " ", "stuff", " ", "you", " ", "might", " ", "want", 
    " ", "to", " ", "change", " ", "is", " ", "in", " ", "this", " ", 
    RowBox[{"Module", ".", " ", "Defines"}], " ", "various", " ", "functions",
     " ", "and", " ", "lists", " ", "to", " ", "identify", " ", "different", 
    " ", "variable", " ", "types"}], " ", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "coeffList", ",", "fullCppMultVariableList", ",", "scalarCppVars", ",", 
       "vectorCppVars"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"coeffList", "=", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"MapMatrix", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Cases", "[", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{"coeff_", " ", 
                RowBox[{"Cm", "[", 
                 RowBox[{"i1_", ",", "i2_"}], "]"}]}], "\[RuleDelayed]", 
               "coeff"}], ",", "\[Infinity]"}], "]"}], "&"}], ",", 
           "fullMatrixEquations"}], "]"}], "]"}], "/.", 
        RowBox[{"Thread", "[", 
         RowBox[{"meanFieldsWDerivs", "\[Rule]", "1"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"coeffList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "/.", 
          RowBox[{"coeff_", "\[RuleDelayed]", 
           RowBox[{"Rule", "[", 
            RowBox[{"coeff", ",", 
             RowBox[{"convertProdToString", "[", "coeff", "]"}]}], "]"}]}]}], 
         "&"}], "/@", "coeffList"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"coeffList", " ", "=", " ", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"Sort", "[", 
         RowBox[{"coeffList", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"StringLength", "[", 
             RowBox[{
             "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}], ">", 
            RowBox[{"StringLength", "[", 
             RowBox[{
             "#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}]}], "&"}]}], "]"}], "]"}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "Make", " ", "sure", " ", "longest", " ", "products", " ", "are", " ",
          "first"}], ",", " ", 
        RowBox[{
        "otherwise", " ", "it", " ", "replaces", " ", "others", " ", "too", 
         " ", "early", " ", "and", " ", "they", " ", 
         RowBox[{"don", "'"}], "t", " ", "get", " ", "recognized"}]}], "*)"}],
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"fullMatrixEquationsC", "=", 
       RowBox[{
        RowBox[{"fullMatrixEquations", "/.", "coeffList"}], "/.", 
        RowBox[{
         RowBox[{
          RowBox[{"str1_String", " ", 
           RowBox[{"Cm", "[", 
            RowBox[{"i_", ",", "j_"}], "]"}]}], "+", 
          RowBox[{"str2_String", " ", 
           RowBox[{"Cm", "[", 
            RowBox[{"i_", ",", "j_"}], "]"}]}]}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"StringJoin", "[", 
           RowBox[{"str1", ",", "\"\<PLUS\>\"", ",", "str2"}], "]"}], " ", 
          RowBox[{"Cm", "[", 
           RowBox[{"i", ",", "j"}], "]"}]}]}]}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Now", " ", "there", " ", "are", " ", "only"}], ",", " ", 
        RowBox[{"Mean", " ", "fields", " ", 
         RowBox[{"(", 
          RowBox[{"and", " ", "derivatives"}], ")"}]}], ",", " ", 
        RowBox[{"C", " ", "matrices"}], ",", " ", 
        RowBox[{"string", " ", "variables"}]}], "*)"}], 
      RowBox[{"(*", 
       RowBox[{
       "Second", " ", "replacment", " ", "is", " ", "for", " ", "sums"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Before", " ", "going", " ", "on"}], ",", " ", 
        RowBox[{
         RowBox[{
         "keep", " ", "the", " ", "list", " ", "of", " ", "string", " ", 
          "variables"}], " ", "-", " ", 
         RowBox[{
         "some", " ", "of", " ", "these", " ", "get", " ", "rather", " ", 
          RowBox[{"long", "!"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fullCppMultVariableList", " ", "=", 
       RowBox[{"Union", "[", " ", 
        RowBox[{"Cases", "[", 
         RowBox[{
         "fullMatrixEquationsC", ",", "str_String", ",", "\[Infinity]"}], 
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"scalarCppVars", " ", "=", " ", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"coeffList", ",", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{"Alternatives", "@@", "vectorVars"}], ",", 
              "\[Infinity]"}], "]"}]}], "&"}]}], "]"}], 
        "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Separate", " ", "out", " ", "the", " ", "scalar", " ", "variables"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"vectorCppVars", " ", "=", " ", 
       RowBox[{"Complement", "[", 
        RowBox[{"fullCppMultVariableList", ",", "scalarCppVars"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ClearAll", "[", 
       RowBox[{"scalarCppQ", ",", "vectorCppQ"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"scalarCppQ", "[", "_", "]"}], "=", "False"}], ";", 
      RowBox[{
       RowBox[{"vectorCppQ", "[", "_", "]"}], "=", "False"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"scalarCppQ", "[", "#", "]"}], "=", "True"}], ")"}], "&"}], 
       "/@", "scalarCppVars"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"vectorCppQ", "[", "#", "]"}], "=", "True"}], ")"}], "&"}], 
       "/@", "vectorCppVars"}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Q", " ", "functions", " ", "for", " ", "vectors", " ", "and", " ", 
        "scalars"}], " ", "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"ClearAll", "[", "rescaleForFFT", "]"}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Adds", " ", "in", " ", "ftfac", " ", "multiplying", " ", "vector", 
        " ", "for", " ", "more", " ", "efficient", " ", "fft", " ", 
        "rescaling"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"rescaleForFFT", "[", "a_", "]"}], ":=", "\[IndentingNewLine]", 
       RowBox[{"a", "/.", 
        RowBox[{
         RowBox[{"var_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"scalarCppQ", "[", "#", "]"}], "||", 
             RowBox[{"vectorCppQ", "[", "#", "]"}]}], "&"}], ")"}]}], 
         "\[RuleDelayed]", 
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"newvar", "=", 
             RowBox[{
             "\"\<(\>\"", "<>", "var", "<>", "\"\</\>\"", "<>", "ftFactorVar",
               "<>", "\"\<)\>\""}]}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"scalarCppQ", "[", "var", "]"}], ",", 
              RowBox[{
               RowBox[{"scalarCppQ", "[", "newvar", "]"}], "=", "True"}], ",", 
              RowBox[{
               RowBox[{"vectorCppQ", "[", "newvar", "]"}], "=", "True"}]}], 
             "]"}], ";", "\[IndentingNewLine]", "newvar"}]}], 
          "\[IndentingNewLine]", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Product", " ", "to", " ", "use"}], " ", "-", " ", 
        RowBox[{
        "default", " ", "is", " ", "treating", " ", "object", " ", "as", " ", 
         "a", " ", "vector"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"ClearAll", "[", "vec2DiagProd", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vec2DiagProd", "[", "]"}], "=", 
       RowBox[{
       "cppProducts", "\[LeftDoubleBracket]", "1", 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vec2DiagProd", "[", "a_", "]"}], " ", ":=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"scalarCppQ", "@", "a"}], ",", 
         RowBox[{
         "cppProducts", "\[LeftDoubleBracket]", "2", 
          "\[RightDoubleBracket]"}], ",", 
         RowBox[{
         "cppProducts", "\[LeftDoubleBracket]", "1", 
          "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Replacement", " ", "rules", " ", "from", " ", 
        RowBox[{"c", "++"}], " ", "variables", " ", "to", " ", "real", " ", 
        "products"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"CppToBasicVariables", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"fullCppMultVariableList", "\[Rule]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"StringReplace", "[", 
             RowBox[{"fullCppMultVariableList", ",", 
              RowBox[{
               RowBox[{"a__", "~~", "\"\<PLUS\>\"", "~~", "b__"}], 
               "\[RuleDelayed]", 
               RowBox[{"a", "+", "b"}]}]}], "]"}], "/.", 
            RowBox[{"StringExpression", "\[Rule]", "Sequence"}]}], "/.", 
           RowBox[{"coeffList", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "1"}], "}"}]}], "\[RightDoubleBracket]"}]}], 
          ")"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Collect", " ", "to", " ", "scalar", " ", "and", " ", "vector", " ", 
        "variables"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"CppToBasicVariables", " ", "=", " ", 
       RowBox[{"Gather", "[", 
        RowBox[{"CppToBasicVariables", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"scalarCppQ", "[", 
            RowBox[{
            "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}], "===", 
           RowBox[{"scalarCppQ", "[", 
            RowBox[{
            "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}]}], "&"}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "FUNCTIONS", " ", "TO", " ", "CONVERT", " ", "TO", " ", "CPP", " ", 
     "CODE"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"First", " ", "-", " ", 
     RowBox[{"convert", " ", "to", " ", "symbolic", " ", 
      RowBox[{"code", ".", " ", "Takes"}], " ", "a", " ", "single", " ", 
      "term", " ", "and", " ", "converts", " ", "it", " ", "to", " ", 
      "symbolic", " ", 
      RowBox[{
       RowBox[{"c", "++"}], "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "[", 
    RowBox[{"toPseudoCppCode", ",", "$numberOfTempsVars"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"$numberOfTempsVars", "=", "0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"toPseudoCppCode", "[", 
     RowBox[{"expr_", ",", "index_List"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "term", ",", "mfgroups", ",", "pseudoCCode", ",", " ", "ntemps", ",", 
        "FFTpseudoCode"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "Operators", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"SetAttributes", "[", 
        RowBox[{"CPlus", ",", "Orderless"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"SetAttributes", "[", 
        RowBox[{"CTimes", ",", "Orderless"}], "]"}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Set", " ", "these", " ", "as", " ", "commutative", " ", "but", " ", 
         "not", " ", "associative"}], " ", "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Replace", " ", "Times", " ", "and", " ", "Plus", " ", "with", " ", 
         "C", " ", "oeprators"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"term", "=", 
        RowBox[{
         RowBox[{"expr", "/.", 
          RowBox[{
           RowBox[{"Times", "[", 
            RowBox[{"a___", ",", 
             RowBox[{"B_", "?", "meanFieldQ"}], ",", "b___"}], "]"}], 
           "\[RuleDelayed]", 
           RowBox[{"CTimes", "[", 
            RowBox[{"B", ",", 
             RowBox[{"a", " ", "b"}]}], "]"}]}]}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Plus", "\[Rule]", "CPlus"}], ",", 
           RowBox[{"Times", "\[Rule]", "CTimes"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "term", "]"}], "===", "CTimes"}], ",", 
         RowBox[{"term", " ", "=", " ", 
          RowBox[{"CPlus", "[", "term", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Find", " ", "terms", " ", "linear", " ", "in", " ", "the", " ", 
         "mean", " ", "fields"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"mfgroups", " ", "=", " ", 
        RowBox[{"Position", "[", 
         RowBox[{"term", ",", 
          RowBox[{"CTimes", "[", 
           RowBox[{
            RowBox[{"B_", "?", "meanFieldQ"}], ",", "subt_"}], "]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ntemps", " ", "=", " ", 
        RowBox[{"Length", "@", "mfgroups"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Store", " ", "the", " ", "maximum", " ", "number", " ", "of", " ", 
         "temp", " ", "variables", " ", "for", " ", "memory", " ", 
         "assignment", " ", "later"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{"ntemps", ">", "$numberOfTempsVars"}], ",", 
         RowBox[{"$numberOfTempsVars", "=", "ntemps"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"First", " ", "stage"}], " ", "-", " ", 
         RowBox[{
         "assign", " ", "temp", " ", "variables", " ", "to", " ", 
          "groups"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"pseudoCCode", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"CAssign", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "#", "]"}], ",", 
            RowBox[{"Extract", "[", 
             RowBox[{"term", ",", 
              RowBox[{
              "mfgroups", "\[LeftDoubleBracket]", "#", 
               "\[RightDoubleBracket]"}]}], "]"}]}], "]"}], "&"}], "/@", 
         RowBox[{"Range", "[", "ntemps", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"term", " ", "=", " ", 
        RowBox[{"term", "/.", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Reverse", "/@", "pseudoCCode"}], "/.", 
           RowBox[{"CAssign", "\[Rule]", "Rule"}]}], ")"}]}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Replace", " ", "term", " ", "to", " ", "recognize", " ", "temp", " ",
          "variables"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"Next", " ", "stage"}], " ", "-", " ", 
         RowBox[{
         "add", " ", "in", " ", "Fourier", " ", "transforms", " ", "for", " ",
           "pseudospectral", " ", "products"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"pseudoCCode", "=", 
        RowBox[{"pseudoCCode", "/.", 
         RowBox[{
          RowBox[{"CAssign", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "n_", "]"}], ",", 
            RowBox[{"CTimes", "[", 
             RowBox[{
              RowBox[{"B_", "?", "meanFieldQ"}], ",", "subt_"}], "]"}]}], 
           "]"}], "\[RuleDelayed]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"CAssign", "[", 
             RowBox[{
              RowBox[{"CTemp", "[", "n", "]"}], ",", 
              RowBox[{"(*", 
               RowBox[{"rescaleForFFT", "@"}], "*)"}], "subt"}], "]"}], ",", 
            RowBox[{"Cifft", "[", 
             RowBox[{"CTemp", "[", "n", "]"}], "]"}], ",", 
            RowBox[{"CAssign", "[", 
             RowBox[{
              RowBox[{"CTemp", "[", "n", "]"}], ",", 
              RowBox[{"CTimes", "[", 
               RowBox[{"B", ",", 
                RowBox[{"CTemp", "[", "n", "]"}]}], "]"}]}], "]"}]}], 
           "}"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Add", " ", "a", " ", "CPlus", " ", "around", " ", "temp", " ", 
         "variables", " ", "to", " ", "find", " ", "bits", " ", "for", " ", 
         "taking", " ", "forward", " ", "ffts"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"term", " ", "=", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Replace", "[", 
           RowBox[{"term", ",", 
            RowBox[{
             RowBox[{"CPlus", "[", "a__", "]"}], "\[RuleDelayed]", 
             RowBox[{"CPlus", "[", 
              RowBox[{
               RowBox[{"CPlus", "[", 
                RowBox[{"CTemp", "[", "0", "]"}], "]"}], ",", "a"}], "]"}]}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}], "//.", 
          RowBox[{
           RowBox[{"CPlus", "[", 
            RowBox[{
             RowBox[{"CPlus", "[", 
              RowBox[{"a___", ",", 
               RowBox[{"CTemp", "[", "0", "]"}]}], "]"}], ",", "tmp_CTemp", 
             ",", "b___"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"CPlus", "[", 
            RowBox[{
             RowBox[{"CPlus", "[", 
              RowBox[{"a", ",", 
               RowBox[{"CTemp", "[", "0", "]"}], ",", "tmp"}], "]"}], ",", 
             "b"}], "]"}]}]}], "/.", 
         RowBox[{
          RowBox[{"CPlus", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "0", "]"}], ",", "tmp__"}], "]"}], 
          "\[RuleDelayed]", 
          RowBox[{"CPlus", "[", "tmp", "]"}]}]}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"A", " ", "rather", " ", "long"}], "-", 
         RowBox[{"winded", " ", "way", " ", "to", " ", "do", " ", "this"}], 
         " ", "-", " ", 
         RowBox[{"surprisingly", " ", "tricky"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Pseudocode", " ", "for", " ", "taking", " ", "forward", " ", 
         "ffts"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"FFTpseudoCode", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CAssign", "[", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               ",", "#"}], "]"}], ",", 
             RowBox[{"Cfft", "[", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{"Cases", "[", 
           RowBox[{"term", ",", 
            RowBox[{"CPlus", "[", "tmp__CTemp", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}]}], "//", 
         "Flatten"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Replace", " ", "temp", " ", "variables", " ", "in", " ", "term"}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"term", " ", "=", " ", 
        RowBox[{"term", "/.", 
         RowBox[{"Cases", "[", 
          RowBox[{"FFTpseudoCode", ",", 
           RowBox[{
            RowBox[{"CAssign", "[", "a__", "]"}], "\[RuleDelayed]", 
            RowBox[{"Rule", "@@", 
             RowBox[{"Reverse", "[", 
              RowBox[{"{", "a", "}"}], "]"}]}]}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Add", " ", "fft", " ", "and", " ", "dealiasing", " ", "on", " ", 
         "the", " ", "end", " ", "and", " ", "remove", " ", "useless", " ", 
         "assignment"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"pseudoCCode", " ", "=", " ", 
        RowBox[{
         RowBox[{"Flatten", "@", 
          RowBox[{"Join", "[", 
           RowBox[{"pseudoCCode", ",", "FFTpseudoCode", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"CAssign", "[", 
               RowBox[{
                RowBox[{"CTemp", "[", "ntemps", "]"}], ",", 
                RowBox[{"rescaleForFFT", "@", "term"}]}], "]"}], ",", 
              RowBox[{"CDealias", "[", 
               RowBox[{"CTemp", "[", "ntemps", "]"}], "]"}], ",", 
              RowBox[{"CAssign", "[", 
               RowBox[{
                RowBox[{"CBlock", "@@", "index"}], ",", 
                RowBox[{"CTemp", "[", "ntemps", "]"}]}], "]"}]}], "}"}]}], 
           "]"}]}], "/.", 
         RowBox[{
          RowBox[{"CAssign", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "i_", "]"}], ",", 
            RowBox[{"CPlus", "[", 
             RowBox[{"CTemp", "[", "i_", "]"}], "]"}]}], "]"}], 
          "\[RuleDelayed]", 
          RowBox[{"Sequence", "[", "]"}]}]}]}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Function", " ", "to", " ", "store", " ", "c", " ", "variable", " ", 
     "definitions", " ", "for", " ", "other", " ", "stuff"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ClearAll", "[", "toCString", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Cm", "/:", 
     RowBox[{"toCString", "[", 
      RowBox[{"Cm", "[", 
       RowBox[{"i_", ",", "j_"}], "]"}], "]"}], ":=", 
     RowBox[{"\"\<C\>\"", "<>", 
      RowBox[{"ToString", "[", "i", "]"}], "<>", 
      RowBox[{"ToString", "[", "j", "]"}], "<>", "\"\<_\>\""}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"toCString", "[", "a_String", "]"}], ":=", "a"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CTemp", "/:", 
     RowBox[{"toCString", "[", 
      RowBox[{"CTemp", "[", "n_", "]"}], "]"}], ":=", 
     RowBox[{"\"\<Ctmp_\>\"", "<>", 
      RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<_\>\""}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"toCString", "[", 
      RowBox[{"mf_", "?", "meanFieldQ"}], "]"}], ":=", 
     RowBox[{"mf", "/.", "MFcppVariables"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Function", " ", "to", " ", 
     RowBox[{"take", " ", ".", "block"}], 
     RowBox[{"(", ")"}], " ", "method", " ", "of", " ", "Ckl_out", " ", 
     "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "ind2EigenBlock"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ind2EigenBlock", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i_", ",", "j_"}], "}"}], ",", "cmat_"}], "]"}], ":=", 
     RowBox[{"StringReplace", "[", 
      RowBox[{
       RowBox[{"cmat", "<>", "\"\<.block( \>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"i", "-", "1"}], ")"}], "NZ"}], ",", "InputForm"}], "]"}],
         "<>", "\"\<, \>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"j", "-", "1"}], ")"}], "NZ"}], ",", "InputForm"}], "]"}],
         "<>", "\"\<, NZ, NZ)\>\""}], ",", 
       RowBox[{"\"\<NZ\>\"", "\[Rule]", "\"\<NZ_\>\""}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Rules", " ", "to", " ", "change", " ", "pseudoCCode", " ", "into", " ", 
     "real", " ", "Ccode"}], " ", "*)"}], 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Must", " ", "be", " ", "used", " ", "with"}], " ", "//."}], " ",
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"COperatorRules", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"CTimes", "[", 
         RowBox[{"a_String", ",", "b_"}], "]"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", 
         RowBox[{"vec2DiagProd", "[", "a", "]"}], "<>", 
         RowBox[{"toCString", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CTimes", "[", 
         RowBox[{
          RowBox[{"a_", "?", "meanFieldQ"}], ",", "b_"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"toCString", "[", "a", "]"}], "<>", 
         RowBox[{"vec2DiagProd", "[", "a", "]"}], "<>", 
         RowBox[{"toCString", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CPlus", "[", "a__String", "]"}], "\[RuleDelayed]", 
        RowBox[{"ToString", "@", 
         RowBox[{"Row", "[", 
          RowBox[{
           RowBox[{"{", "a", "}"}], ",", "\"\< + \>\""}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CPlus", "[", 
         RowBox[{"a___", ",", "tmp_CTemp", ",", "b___"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{"CPlus", "[", 
         RowBox[{"a", ",", 
          RowBox[{"toCString", "[", "tmp", "]"}], ",", "b"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CAssign", "[", 
         RowBox[{"tmp_", ",", "b_String"}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"toCString", "[", "tmp", "]"}], "<>", "\"\< = \>\"", "<>", 
         "b"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CAssign", "[", 
         RowBox[{"str_String", ",", "tmp_CTemp"}], "]"}], "\[RuleDelayed]", 
        RowBox[{"CAssign", "[", 
         RowBox[{"str", ",", 
          RowBox[{"toCString", "[", "tmp", "]"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Cfft", "[", "a_CTemp", "]"}], "\[RuleDelayed]", 
        RowBox[{"fft", "<>", "\"\<( \>\"", "<>", 
         RowBox[{"toCString", "@", "a"}], "<>", " ", "\"\< )\>\""}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Cifft", "[", "a_CTemp", "]"}], "\[RuleDelayed]", 
        RowBox[{"ifft", "<>", "\"\<( \>\"", "<>", 
         RowBox[{"toCString", "@", "a"}], "<>", " ", "\"\< )\>\""}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"iLapFColl", "[", "str_String", "]"}], "\[RuleDelayed]", 
        RowBox[{"iLapFvar", "<>", 
         RowBox[{"vec2DiagProd", "[", "]"}], "<>", "\"\<(\>\"", "<>", "str", 
         "<>", "\"\<)\>\""}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CBlock", "[", 
         RowBox[{"i_", ",", "j_"}], "]"}], ":>", 
        RowBox[{"ind2EigenBlock", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"i", ",", "j"}], "}"}], ",", "CklOut"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CDealias", "[", "tmp_CTemp", "]"}], "\[RuleDelayed]", 
        RowBox[{"dealias", "<>", "\"\<(\>\"", "<>", 
         RowBox[{"toCString", "[", "tmp", "]"}], "<>", "\"\<)\>\""}]}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.614199820333446*^9, 3.614199973544842*^9}, {
   3.614200154568696*^9, 3.614200177457288*^9}, {3.614203202742343*^9, 
   3.6142032132053423`*^9}, {3.614203687436726*^9, 3.614203694398652*^9}, {
   3.614204078926628*^9, 3.614204079422367*^9}, 3.6142041354989843`*^9, {
   3.614204166229424*^9, 3.6142042190601587`*^9}, {3.614204254561245*^9, 
   3.614204333690789*^9}, {3.614331697718234*^9, 3.61433174227547*^9}, {
   3.614331906693769*^9, 3.614331911117732*^9}, {3.614331987606147*^9, 
   3.614332000077257*^9}, {3.614332466912683*^9, 3.614332469135511*^9}, {
   3.614332812588958*^9, 3.614332843516348*^9}, {3.614332874370685*^9, 
   3.614332874698839*^9}, {3.614332908946308*^9, 3.6143329191369057`*^9}, {
   3.614333144869622*^9, 3.614333156472726*^9}, {3.6143332710284643`*^9, 
   3.614333279858944*^9}, {3.6143622085326366`*^9, 3.614362280097941*^9}, 
   3.614362399974094*^9, {3.614362430655244*^9, 3.614362460967514*^9}, {
   3.6143846802878942`*^9, 3.614384682302619*^9}, 3.614436190971469*^9, {
   3.614436331371933*^9, 3.6144363355680647`*^9}, {3.614437229054408*^9, 
   3.61443728430906*^9}, {3.614437337853598*^9, 3.614437440432015*^9}, {
   3.614437482905383*^9, 3.614437585144912*^9}, {3.614437630726707*^9, 
   3.614437785531118*^9}, {3.614437848964754*^9, 3.614437967122786*^9}, {
   3.6144380848799877`*^9, 3.6144381352511873`*^9}, {3.6144382227794724`*^9, 
   3.614438293388933*^9}, {3.61443989562008*^9, 3.614439938088032*^9}, {
   3.6144401493798637`*^9, 3.61444017699675*^9}, {3.61444021553305*^9, 
   3.614440310323646*^9}, {3.61444036659039*^9, 3.614440615353231*^9}, {
   3.614440664885353*^9, 3.6144407634596643`*^9}, {3.614466811204368*^9, 
   3.614466893555069*^9}, {3.614467338629237*^9, 3.614467397648348*^9}, {
   3.614467447634305*^9, 3.614467566346293*^9}, {3.614467600650503*^9, 
   3.6144676225940247`*^9}, {3.6144676700570917`*^9, 3.614467711185996*^9}, {
   3.614467791283551*^9, 3.614467797969377*^9}, {3.6144679149890614`*^9, 
   3.614467955286832*^9}, {3.614467991859248*^9, 3.6144679928261623`*^9}, {
   3.614504879859517*^9, 3.6145049079875603`*^9}, {3.61454283629358*^9, 
   3.614542837167223*^9}, {3.614542878595272*^9, 3.6145428815772047`*^9}, {
   3.614543175274213*^9, 3.614543217236944*^9}, {3.614543286011907*^9, 
   3.614543330056481*^9}, 3.614543427918807*^9, {3.614544016420259*^9, 
   3.614544016783902*^9}, {3.614545405652108*^9, 3.6145454062903223`*^9}, {
   3.614553685029169*^9, 3.614553713332426*^9}, {3.614553820920223*^9, 
   3.614553821614222*^9}, {3.614615907007505*^9, 3.614615911160202*^9}, {
   3.614616031382146*^9, 3.614616036012775*^9}, {3.615115445069023*^9, 
   3.6151154781928577`*^9}, 3.6151155348790293`*^9, {3.615115588817881*^9, 
   3.615115605142126*^9}, {3.615115678487294*^9, 3.6151156814810743`*^9}, 
   3.61511576016107*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["Split up and assign to Ckl_out", "Subsubsection",
 CellChangeTimes->{{3.6142046790049763`*^9, 3.614204686099799*^9}, {
  3.6142051931686783`*^9, 3.614205195159081*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "tmp", ",", "variableDef", ",", "vecPreVarStringList", ",", 
      "scalarPreVarStringList", ",", "vectorPreVarQ", ",", "scalarPreVarQ", 
      ",", "ctempVars", ",", "cmatVars"}], "}"}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Form", " ", "the", " ", "full", " ", "equations", " ", "as", " ", "a", 
      " ", "single", " ", "text", " ", "block"}], " ", "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"fullEquations", " ", "=", " ", 
      RowBox[{
       RowBox[{"StringJoin", "@@", 
        RowBox[{"Riffle", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"StringJoin", "@@", 
              RowBox[{"Riffle", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"toPseudoCppCode", "[", 
                  RowBox[{
                   RowBox[{"fullMatrixEquationsC", "\[LeftDoubleBracket]", 
                    RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "j"}], "}"}]}], "]"}], "//.", 
                 "COperatorRules"}], ",", "\"\<;\\n\>\""}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i", ",", "4"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "4"}], "}"}]}], "]"}], "]"}], ",", 
          "\[IndentingNewLine]", "\"\<;\\n\\n\\n\\n\>\""}], "]"}]}], "<>", 
       "\"\<;\\n\>\""}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Form", " ", "the", " ", "variable", " ", "definitions"}], " ",
        "-", " ", 
       RowBox[{
       "the", " ", "functions", " ", "here", " ", "are", " ", "for", " ", 
        "pre"}], "-", 
       RowBox[{"defined", " ", "variables", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"e", ".", "g", "."}], ",", " ", "kxctmp_"}], ")"}], " ", 
        "not", " ", "the", " ", "automatically", " ", "generated", " ", 
        "ones"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"vecPreVarStringList", " ", "=", 
      RowBox[{
       RowBox[{"List", "@@", "vectorVars"}], "/.", "variablesInCpp"}]}], ";", 
     " ", 
     RowBox[{"(*", " ", 
      RowBox[{"List", " ", "of", " ", "vector", " ", "variables"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"scalarPreVarStringList", " ", "=", " ", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"variablesInCpp", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
        "vecPreVarStringList"}], "]"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{"List", " ", "of", " ", "vector", " ", "variables"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"vectorPreVarQ", " ", "=", " ", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "[", "vecPreVarStringList", "]"}], ";",
            "vecPreVarStringList"}], ")"}], ",", "#"}], "]"}], "&"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Returns", " ", "true", " ", "for", " ", "vector", " ", "variable"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"scalarPreVarQ", " ", "=", " ", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "[", "scalarPreVarStringList", "]"}], 
           ";", "scalarPreVarStringList"}], ")"}], ",", "#"}], "]"}], " ", 
       "&"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Returns", " ", "true", " ", "for", " ", "scalar", " ", "variable"}], 
      " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Collect", " ", "matrix", " ", "bits", " ", "together"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"CppToBasicVariables", "/.", "variablesInCpp"}], "/.", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"a_", "?", "vectorPreVarQ"}], "^", "n_"}], 
           "\[RuleDelayed]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"tmp", " ", "=", " ", 
              RowBox[{"a", "<>", "\"\<.pow(\>\"", "<>", 
               RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<)\>\""}]}], 
             ";", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"vecPreVarStringList", ",", "tmp"}], "]"}], ";", 
             "tmp"}], ")"}]}]}], "/.", 
         RowBox[{"\"\<kz_.pow(2)\>\"", "\[RuleDelayed]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"vecPreVarStringList", ",", "\"\<kz2_\>\""}], "]"}], 
            ";", "\"\<kz2_\>\""}], ")"}]}]}], "/.", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"a_", "?", "vectorPreVarQ"}], "  ", 
          RowBox[{"b_", "?", "vectorPreVarQ"}]}], "\[RuleDelayed]", 
         RowBox[{
         "\"\<(\>\"", "<>", "a", "<>", "\"\<*\>\"", "<>", "b", "<>", 
          "\"\<).matrix()\>\""}]}]}], "/.", 
       RowBox[{
        RowBox[{"a_", "?", "vectorPreVarQ"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", "\"\<.matrix()\>\""}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Collect", " ", "scalar", " ", "bits", " ", "together"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"fullCppVaribles", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"a_", "?", "scalarPreVarQ"}], "^", "n_"}], 
           "\[RuleDelayed]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"tmp", "=", 
              RowBox[{"\"\<pow(\>\"", "<>", 
               RowBox[{"ToString", "[", "a", "]"}], "<>", "\"\<,\>\"", "<>", 
               RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<)\>\""}]}], 
             ";", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"scalarPreVarStringList", ",", "tmp"}], "]"}], ";", 
             "tmp"}], ")"}]}]}], "/.", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"a_", "?", "scalarPreVarQ"}], " ", 
           RowBox[{"b_", "?", "scalarPreVarQ"}]}], "\[RuleDelayed]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"scalarPreVarStringList", ",", 
              RowBox[{
              "\"\<(\>\"", "<>", "a", "<>", "\"\<*\>\"", "<>", "b", "<>", 
               "\"\<)\>\""}]}], "]"}], ";", 
            RowBox[{
            "\"\<(\>\"", "<>", "a", "<>", "\"\<*\>\"", "<>", "b", "<>", 
             "\"\<)\>\""}]}], ")"}]}]}], "/.", 
        RowBox[{
         RowBox[{
          RowBox[{"n_", "?", "NumericQ"}], " ", 
          RowBox[{"a_", "?", "scalarPreVarQ"}]}], "\[RuleDelayed]", 
         RowBox[{"\"\<(\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"N", "[", "n", "]"}], "]"}], "<>", "\"\<*\>\"", "<>", "a", 
          "<>", "\"\<)\>\""}]}]}], "/.", 
       RowBox[{
        RowBox[{
         RowBox[{"n_", "?", "NumericQ"}], " ", "b_String"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"ToString", "[", 
          RowBox[{"N", "[", "n", "]"}], "]"}], "<>", "\"\<*\>\"", "<>", 
         "b"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{"fullCppVaribles", "/.", 
        RowBox[{
         RowBox[{"a_String", " ", "b_String"}], "\[RuleDelayed]", 
         RowBox[{"a", "<>", "\"\<*\>\"", "<>", "b"}]}]}], "/.", 
       RowBox[{
        RowBox[{"a_String", " ", "+", " ", "b_String"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", "\"\< + \>\"", "<>", "b"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Add", " ", "in", " ", "ftFactor"}], ",", " ", 
       RowBox[{
       "this", " ", "is", " ", "not", " ", "the", " ", "most", " ", 
        "efficient", " ", 
        RowBox[{"(", 
         RowBox[{"multiplying", " ", "vector"}], ")"}], " ", "but", " ", 
        RowBox[{"doesn", "'"}], "t", " ", "seem", " ", "worth", " ", "the", 
        " ", "effort"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{"fullCppVaribles", "/.", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Rule", "[", 
          RowBox[{"a_String", ",", "b_String"}], "]"}], ")"}], 
        "\[RuleDelayed]", 
        RowBox[{"(", 
         RowBox[{"Rule", "[", 
          RowBox[{"a", ",", 
           RowBox[{
           "\"\<(\>\"", "<>", "b", "<>", "\"\<)*\>\"", "<>", 
            "ftFactorVar"}]}], "]"}], ")"}]}]}]}], ";", "\[IndentingNewLine]",
      "\[IndentingNewLine]", 
     RowBox[{"ctempVars", " ", "=", " ", 
      RowBox[{"toCString", "/@", 
       RowBox[{"(", 
        RowBox[{"CTemp", "/@", 
         RowBox[{"Range", "[", "$numberOfTempsVars", "]"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"cmatVars", " ", "=", 
      RowBox[{"toCString", "/@", 
       RowBox[{"Flatten", "[", "Cmat", "]"}]}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"(*", " ", 
      RowBox[{"Declare", " ", "variables", " ", 
       RowBox[{"(", 
        RowBox[{"in", " ", "class", " ", "definition"}], ")"}]}], " ", "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"classVariableDec", " ", "=", " ", 
      RowBox[{"\"\<dcmplxVecM \>\"", "<>", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{
          RowBox[{"CppToBasicVariables", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}], 
          ",", "\"\<, \>\""}], "]"}]}], "<>", "\"\<;\\n\\n\>\"", "<>", 
       "\[IndentingNewLine]", "\"\<dcmplx \>\"", "<>", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{
          RowBox[{"CppToBasicVariables", "\[LeftDoubleBracket]", 
           RowBox[{"2", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}], 
          ",", "\"\<, \>\""}], "]"}]}], "<>", "\"\<;\\n\\n\>\"", "<>", 
       "\[IndentingNewLine]", "\"\<dcmplxMat \>\"", "<>", " ", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{"ctempVars", ",", "\"\<, \>\""}], "]"}]}], "<>", 
       "\"\<;\\n\\n\>\"", "<>", "\[IndentingNewLine]", "\"\<dcmplxMat \>\"", "<>",
        " ", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{"cmatVars", ",", "\"\<, \>\""}], "]"}]}], "<>", 
       "\"\<;\\n\>\""}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     
     RowBox[{"(*", " ", 
      RowBox[{
      "Assign", " ", "memory", " ", "to", " ", "variables", " ", "in", " ", 
       "class", " ", "constructor"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"classConstrAssignMem", " ", "=", 
      RowBox[{
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "<>", "\"\< = dcmplxVecM(NZ_);\\n\>\""}], "&"}], "/@", 
          RowBox[{"CppToBasicVariables", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}]}], 
         ")"}]}], "<>", "\"\<\\n\>\"", "<>", "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "<>", "\"\< = dcmplxMat(NZ_,NZ_);\\n\>\""}], "&"}], "/@",
           "ctempVars"}], ")"}]}], "<>", "\"\<\\n\>\"", "<>", 
       "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "<>", "\"\< = dcmplxMat(NZ_,NZ_);\\n\>\""}], "&"}], "/@",
           "cmatVars"}], ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Assign", " ", "variables", " ", "inside", " ", "the", " ", 
       "equations"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"assignCppVarsInEqs", " ", "=", 
      RowBox[{
      "\"\<// Vector variable definition (automatic)\\n\>\"", "<>", " ", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "<>", "\"\< = \>\"", " ", "<>", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "<>", "\"\<;\\n\>\""}], "&"}], "/@", 
          RowBox[{
          "fullCppVaribles", "\[LeftDoubleBracket]", "1", 
           "\[RightDoubleBracket]"}]}], ")"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"assignCppVarsInEqs", " ", "=", 
      RowBox[{
      "\"\<// Scalar variable definition (automatic)\\n\>\"", "<>", " ", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "<>", "\"\< = \>\"", " ", "<>", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "<>", "\"\<;\\n\>\""}], "&"}], "/@", 
          RowBox[{
          "fullCppVaribles", "\[LeftDoubleBracket]", "2", 
           "\[RightDoubleBracket]"}]}], ")"}]}], "<>", "\"\<\\n\>\"", "<>", 
       "assignCppVarsInEqs"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"assignCppVarsInEqs", " ", "=", " ", 
      RowBox[{
      "\"\<// Submatrix variable definition (automatic)\\n\>\"", "<>", 
       "\[IndentingNewLine]", 
       RowBox[{"(", 
        RowBox[{"StringJoin", "@@", 
         RowBox[{"Riffle", "[", 
          RowBox[{
           RowBox[{"Flatten", "@", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"toCString", "[", 
                RowBox[{"Cm", "[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}], "<>", "\"\< = \>\"", "<>", 
               RowBox[{"ind2EigenBlock", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"i", ",", "j"}], "}"}], ",", "CklIn"}], "]"}]}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "numVariables"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "numVariables"}], "}"}]}], "]"}]}], ",", 
           "\"\<;\\n\>\""}], "]"}]}], ")"}], "<>", "\"\<;\\n\\n\>\"", "<>", 
       "assignCppVarsInEqs"}]}], ";"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]",
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
    "SAVE", " ", "ALL", " ", "THIS", " ", "STUFF", " ", "TO", " ", "FILE"}], 
    " ", "*)"}],
   FontColor->RGBColor[0.5, 0, 0.5]]}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{
  "\"\<~/Documents/MRIDSS/Mathematica/MMA_Generated_Equations_FullUBQlin.cpp\>\
\"", ",", "\[IndentingNewLine]", 
   RowBox[{
   "\"\<// Automatically generated temporary variables - class \
definition\\n\>\"", "<>", "\[IndentingNewLine]", "classVariableDec", "<>", 
    "\"\<\\n\\n\\n\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
    "\"\<// Automatically generated temporary variables - class \
constructor\\n\>\"", "<>", "\[IndentingNewLine]", "classConstrAssignMem", 
    "<>", "\"\<\\n\\n\\n\\n\\n\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
    "\"\<//Assign automatically generated variables in equations \\n\>\"", "<>",
     "\[IndentingNewLine]", "assignCppVarsInEqs", "<>", 
    "\"\<\\n\\n\\n\\n\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
    "\"\<////////////////////////////////////////////////////////\\n\>\"", "<>",
     "\[IndentingNewLine]", 
    "\"\<///       AUTOMATICALLY GENERATED EQUATIONS         /////\\n\>\"", "<>",
     "\[IndentingNewLine]", 
    "\"\<///       see GenerateC++Equations.nb in MMA        /////\\n\\n\>\"",
     "<>", "\[IndentingNewLine]", "fullEquations", "<>", 
    "\[IndentingNewLine]", 
    "\"\<///     AUTOMATICALLY GENERATED EQUATIONS - END       ///\\n\>\"", "<>",
     "\[IndentingNewLine]", 
    "\"\<////////////////////////////////////////////////////////\\n\>\""}], 
   ",", "\[IndentingNewLine]", "\"\<Text\>\""}], 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.6142047962878428`*^9, 3.6142048287650623`*^9}, {
   3.6142048623685904`*^9, 3.614204871407317*^9}, {3.614204927104175*^9, 
   3.614205167284988*^9}, {3.6142056503063517`*^9, 3.61420569620709*^9}, {
   3.614205733874864*^9, 3.6142057372347527`*^9}, {3.614205801605402*^9, 
   3.6142058147158327`*^9}, {3.614205856654711*^9, 3.614205911695675*^9}, {
   3.614206098560555*^9, 3.6142061335704403`*^9}, {3.614206170108762*^9, 
   3.6142061881144047`*^9}, 3.614206293851531*^9, {3.614206461617001*^9, 
   3.614206486966379*^9}, {3.6142065247418213`*^9, 3.614206525340083*^9}, {
   3.6142065934740763`*^9, 3.6142066005860767`*^9}, {3.614206631795189*^9, 
   3.61420665105902*^9}, {3.6142067668503103`*^9, 3.614206811713435*^9}, {
   3.614206859537304*^9, 3.614206860286922*^9}, {3.6142944293493757`*^9, 
   3.6142944433506927`*^9}, {3.614333316719392*^9, 3.6143334120699873`*^9}, {
   3.614333444377398*^9, 3.614333520964388*^9}, {3.614334399437749*^9, 
   3.61433440340563*^9}, {3.6143353683089323`*^9, 3.614335386748166*^9}, {
   3.6143356115565863`*^9, 3.614335642695072*^9}, {3.614335677308119*^9, 
   3.6143357063543158`*^9}, {3.61433586767843*^9, 3.614336158690496*^9}, {
   3.614336266943084*^9, 3.614336291062385*^9}, {3.614336322628447*^9, 
   3.614336357271209*^9}, {3.614336422201798*^9, 3.61433649219413*^9}, {
   3.6143365411420527`*^9, 3.614336642975008*^9}, {3.614336674388867*^9, 
   3.6143367439724493`*^9}, {3.6143368053654327`*^9, 3.614336827572853*^9}, {
   3.614336871824078*^9, 3.6143368722227917`*^9}, {3.614336903252371*^9, 
   3.614336957793364*^9}, {3.614337118801602*^9, 3.614337369809972*^9}, {
   3.6143374183062*^9, 3.614337432720202*^9}, {3.6143375078514223`*^9, 
   3.6143375282046423`*^9}, {3.6143376036820707`*^9, 3.614337849225244*^9}, {
   3.6143384130703163`*^9, 3.6143384249236937`*^9}, {3.614342468760648*^9, 
   3.614342483795895*^9}, {3.614344870214403*^9, 3.6143448765804043`*^9}, {
   3.6144668024268312`*^9, 3.61446680622049*^9}, {3.614468473094071*^9, 
   3.614468475362665*^9}, {3.6144685580405807`*^9, 3.61446858694422*^9}, {
   3.614468765757752*^9, 3.614468940401372*^9}, {3.614468984586191*^9, 
   3.6144689917783127`*^9}, {3.6144690589896708`*^9, 3.614469059077342*^9}, {
   3.6144691527364483`*^9, 3.6144693667898083`*^9}, {3.614469425367859*^9, 
   3.614469464109496*^9}, {3.6144695490098*^9, 3.6144695491606627`*^9}, {
   3.6144696598494787`*^9, 3.614469660520706*^9}, {3.614469930003291*^9, 
   3.614469937711336*^9}, {3.6144705198149643`*^9, 3.6144705200068417`*^9}, {
   3.6144706655301447`*^9, 3.614470681320969*^9}, {3.614504720143795*^9, 
   3.614504863524947*^9}, {3.614505100915875*^9, 3.614505121919724*^9}, {
   3.614505152906884*^9, 3.614505155503438*^9}, {3.614505221394732*^9, 
   3.614505221833407*^9}, {3.614505263530373*^9, 3.614505263936371*^9}, 
   3.614505308586783*^9, {3.614542746037664*^9, 3.6145427529093513`*^9}, {
   3.61461405830389*^9, 3.614614058847625*^9}, {3.614614417854628*^9, 
   3.614614458527823*^9}, {3.6146144956214952`*^9, 3.614614625662765*^9}, {
   3.6150297979412947`*^9, 3.615029816415002*^9}, 3.6150304053572807`*^9, {
   3.615051001819131*^9, 3.6150510270659933`*^9}, 3.615051083381027*^9, {
   3.615051118523594*^9, 3.615051141241631*^9}, {3.615051184234514*^9, 
   3.615051217257319*^9}, 3.615116799166812*^9, {3.6151171821492977`*^9, 
   3.615117184210381*^9}}],

Cell[BoxData["\<\"~/Documents/MRIDSS/Mathematica/MMA_Generated_Equations_\
FullUBQlin.cpp\"\>"], "Output",
 CellChangeTimes->{
  3.6143387121822042`*^9, 3.614342337188706*^9, 3.614342486239141*^9, {
   3.6143448771742496`*^9, 3.61434488321599*^9}, 3.6143450218542852`*^9, 
   3.6143451076824017`*^9, 3.6144684790958347`*^9, 3.614469003670755*^9, 
   3.614469059822981*^9, {3.614469192413805*^9, 3.6144692034064283`*^9}, 
   3.614469373655657*^9, 3.6144694649976387`*^9, 3.614469550711421*^9, 
   3.6144696641046753`*^9, 3.614469938679933*^9, 3.614470523412774*^9, {
   3.614505127983507*^9, 3.6145051571376143`*^9}, 3.6145052231571608`*^9, 
   3.614505266300125*^9, 3.614505313529387*^9, {3.6145427143213997`*^9, 
   3.614542725540413*^9}, 3.614542757103635*^9, 3.614542844817013*^9, 
   3.614542885049453*^9, 3.614543449184469*^9, {3.614545738357164*^9, 
   3.614545751438102*^9}, 3.6145539650685472`*^9, 3.6146140636151257`*^9, 
   3.61461428924856*^9, 3.6146146289457407`*^9, 3.6146157553981752`*^9, 
   3.6146160734655457`*^9, {3.61505102898208*^9, 3.615051038026823*^9}, 
   3.6150511425831413`*^9, 3.6150512197186327`*^9, 3.6150598094803543`*^9, 
   3.6151168329697237`*^9, 3.6151168897045393`*^9, 3.61511718799275*^9, 
   3.6332675141406*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["fullEquations"], "Input",
 CellChangeTimes->{{3.6332675183989763`*^9, 3.6332675204326077`*^9}}],

Cell[BoxData["\<\"Ctmp_1_ = Tkxb*C31_;\\nfft_.back_2DFull( Ctmp_1_ \
);\\nCtmp_1_ = Bx_.asDiagonal()*Ctmp_1_;\\nCtmp_2_ = \
Tky*C31_;\\nfft_.back_2DFull( Ctmp_2_ );\\nCtmp_2_ = \
By_.asDiagonal()*Ctmp_2_;\\nCtmp_3_ = Tmkxb*C11_;\\nfft_.back_2DFull( Ctmp_3_ \
);\\nCtmp_3_ = Ux_.asDiagonal()*Ctmp_3_;\\nCtmp_4_ = \
Tmky*C11_;\\nfft_.back_2DFull( Ctmp_4_ );\\nCtmp_4_ = \
Uy_.asDiagonal()*Ctmp_4_;\\nCtmp_5_ = T2TdzP2TiLap2Tkxb.asDiagonal()*C11_ + \
T2TdzTiLap2Tky.asDiagonal()*C21_;\\nfft_.back_2DFull( Ctmp_5_ );\\nCtmp_5_ = \
dzdzUx_.asDiagonal()*Ctmp_5_;\\nCtmp_6_ = \
T2TdzTiLap2TkxbP2Tky.asDiagonal()*C31_ + T2TiLap2TkxbTkyP2.asDiagonal()*C41_;\
\\nfft_.back_2DFull( Ctmp_6_ );\\nCtmp_6_ = \
dzBy_.asDiagonal()*Ctmp_6_;\\nCtmp_7_ = TdzTiLap2Tkxb.asDiagonal()*C11_ + \
TiLap2Tky.asDiagonal()*C21_;\\nfft_.back_2DFull( Ctmp_7_ );\\nCtmp_7_ = \
dzdzdzUx_.asDiagonal()*Ctmp_7_;\\nCtmp_8_ = \
Tm2TdzP2TiLap2Tkxb.asDiagonal()*C31_ + \
Tm2TdzTiLap2Tky.asDiagonal()*C41_;\\nfft_.back_2DFull( Ctmp_8_ );\\nCtmp_8_ = \
dzdzBx_.asDiagonal()*Ctmp_8_;\\nCtmp_9_ = \
Tm2TdzTiLap2TkxbP2Tky.asDiagonal()*C11_ + \
Tm2TiLap2TkxbTkyP2.asDiagonal()*C21_;\\nfft_.back_2DFull( Ctmp_9_ \
);\\nCtmp_9_ = dzUy_.asDiagonal()*Ctmp_9_;\\nCtmp_10_ = \
TmdzTiLap2Tkxb.asDiagonal()*C31_ + \
TmiLap2Tky.asDiagonal()*C41_;\\nfft_.back_2DFull( Ctmp_10_ );\\nCtmp_10_ = \
dzdzdzBx_.asDiagonal()*Ctmp_10_;\\nCtmp_11_ = \
TdzTiLap2TkxbP3PLUSTmdzTkxb.asDiagonal()*C31_ + \
TiLap2TkxbP2Tky.asDiagonal()*C41_ + Tmky*C41_;\\nfft_.back_2DFull( Ctmp_11_ \
);\\nCtmp_11_ = dzBx_.asDiagonal()*Ctmp_11_;\\nCtmp_12_ = \
TdzTkxbPLUSTmdzTiLap2TkxbP3.asDiagonal()*C11_ + Tky*C21_ + \
TmiLap2TkxbP2Tky.asDiagonal()*C21_;\\nfft_.back_2DFull( Ctmp_12_ \
);\\nCtmp_12_ = dzUx_.asDiagonal()*Ctmp_12_;\\nCtmp_1_ = Ctmp_1_ + Ctmp_2_ + \
Ctmp_3_ + Ctmp_4_;\\nfft_.for_2DFull( Ctmp_1_ );\\nCtmp_5_ = Ctmp_10_ + \
Ctmp_11_ + Ctmp_12_ + Ctmp_5_ + Ctmp_6_ + Ctmp_7_ + Ctmp_8_ + \
Ctmp_9_;\\nfft_.for_2DFull( Ctmp_5_ );\\nCtmp_12_ = Ctmp_1_ + \
ilapFtmp_.matrix().asDiagonal()*(Ctmp_5_ + \
(T2Tdz/fft2Dfac_).asDiagonal()*C21_ + (Tm2TkxbTkyTq/fft2Dfac_)*C11_) + \
(TB0zTdz/fft2Dfac_).asDiagonal()*C31_;\\ndealias(Ctmp_12_);\\nCkl_out[i].\
block( 0, 0, NZ_, NZ_) = Ctmp_12_;\\n\\n\\n\\nCtmp_1_ = \
Tkxb*C32_;\\nfft_.back_2DFull( Ctmp_1_ );\\nCtmp_1_ = \
Bx_.asDiagonal()*Ctmp_1_;\\nCtmp_2_ = Tky*C32_;\\nfft_.back_2DFull( Ctmp_2_ \
);\\nCtmp_2_ = By_.asDiagonal()*Ctmp_2_;\\nCtmp_3_ = \
Tmkxb*C12_;\\nfft_.back_2DFull( Ctmp_3_ );\\nCtmp_3_ = \
Ux_.asDiagonal()*Ctmp_3_;\\nCtmp_4_ = Tmky*C12_;\\nfft_.back_2DFull( Ctmp_4_ \
);\\nCtmp_4_ = Uy_.asDiagonal()*Ctmp_4_;\\nCtmp_5_ = \
T2TdzP2TiLap2Tkxb.asDiagonal()*C12_ + \
T2TdzTiLap2Tky.asDiagonal()*C22_;\\nfft_.back_2DFull( Ctmp_5_ );\\nCtmp_5_ = \
dzdzUx_.asDiagonal()*Ctmp_5_;\\nCtmp_6_ = \
T2TdzTiLap2TkxbP2Tky.asDiagonal()*C32_ + T2TiLap2TkxbTkyP2.asDiagonal()*C42_;\
\\nfft_.back_2DFull( Ctmp_6_ );\\nCtmp_6_ = \
dzBy_.asDiagonal()*Ctmp_6_;\\nCtmp_7_ = TdzTiLap2Tkxb.asDiagonal()*C12_ + \
TiLap2Tky.asDiagonal()*C22_;\\nfft_.back_2DFull( Ctmp_7_ );\\nCtmp_7_ = \
dzdzdzUx_.asDiagonal()*Ctmp_7_;\\nCtmp_8_ = \
Tm2TdzP2TiLap2Tkxb.asDiagonal()*C32_ + \
Tm2TdzTiLap2Tky.asDiagonal()*C42_;\\nfft_.back_2DFull( Ctmp_8_ );\\nCtmp_8_ = \
dzdzBx_.asDiagonal()*Ctmp_8_;\\nCtmp_9_ = \
Tm2TdzTiLap2TkxbP2Tky.asDiagonal()*C12_ + \
Tm2TiLap2TkxbTkyP2.asDiagonal()*C22_;\\nfft_.back_2DFull( Ctmp_9_ \
);\\nCtmp_9_ = dzUy_.asDiagonal()*Ctmp_9_;\\nCtmp_10_ = \
TmdzTiLap2Tkxb.asDiagonal()*C32_ + \
TmiLap2Tky.asDiagonal()*C42_;\\nfft_.back_2DFull( Ctmp_10_ );\\nCtmp_10_ = \
dzdzdzBx_.asDiagonal()*Ctmp_10_;\\nCtmp_11_ = \
TdzTiLap2TkxbP3PLUSTmdzTkxb.asDiagonal()*C32_ + \
TiLap2TkxbP2Tky.asDiagonal()*C42_ + Tmky*C42_;\\nfft_.back_2DFull( Ctmp_11_ \
);\\nCtmp_11_ = dzBx_.asDiagonal()*Ctmp_11_;\\nCtmp_12_ = \
TdzTkxbPLUSTmdzTiLap2TkxbP3.asDiagonal()*C12_ + Tky*C22_ + \
TmiLap2TkxbP2Tky.asDiagonal()*C22_;\\nfft_.back_2DFull( Ctmp_12_ \
);\\nCtmp_12_ = dzUx_.asDiagonal()*Ctmp_12_;\\nCtmp_1_ = Ctmp_1_ + Ctmp_2_ + \
Ctmp_3_ + Ctmp_4_;\\nfft_.for_2DFull( Ctmp_1_ );\\nCtmp_5_ = Ctmp_10_ + \
Ctmp_11_ + Ctmp_12_ + Ctmp_5_ + Ctmp_6_ + Ctmp_7_ + Ctmp_8_ + \
Ctmp_9_;\\nfft_.for_2DFull( Ctmp_5_ );\\nCtmp_12_ = Ctmp_1_ + \
ilapFtmp_.matrix().asDiagonal()*(Ctmp_5_ + \
(T2Tdz/fft2Dfac_).asDiagonal()*C22_ + (Tm2TkxbTkyTq/fft2Dfac_)*C12_) + \
(TB0zTdz/fft2Dfac_).asDiagonal()*C32_;\\ndealias(Ctmp_12_);\\nCkl_out[i].\
block( 0, NZ_, NZ_, NZ_) = Ctmp_12_;\\n\\n\\n\\nCtmp_1_ = \
Tkxb*C33_;\\nfft_.back_2DFull( Ctmp_1_ );\\nCtmp_1_ = \
Bx_.asDiagonal()*Ctmp_1_;\\nCtmp_2_ = Tky*C33_;\\nfft_.back_2DFull( Ctmp_2_ \
);\\nCtmp_2_ = By_.asDiagonal()*Ctmp_2_;\\nCtmp_3_ = \
Tmkxb*C13_;\\nfft_.back_2DFull( Ctmp_3_ );\\nCtmp_3_ = \
Ux_.asDiagonal()*Ctmp_3_;\\nCtmp_4_ = Tmky*C13_;\\nfft_.back_2DFull( Ctmp_4_ \
);\\nCtmp_4_ = Uy_.asDiagonal()*Ctmp_4_;\\nCtmp_5_ = \
T2TdzP2TiLap2Tkxb.asDiagonal()*C13_ + \
T2TdzTiLap2Tky.asDiagonal()*C23_;\\nfft_.back_2DFull( Ctmp_5_ );\\nCtmp_5_ = \
dzdzUx_.asDiagonal()*Ctmp_5_;\\nCtmp_6_ = \
T2TdzTiLap2TkxbP2Tky.asDiagonal()*C33_ + T2TiLap2TkxbTkyP2.asDiagonal()*C43_;\
\\nfft_.back_2DFull( Ctmp_6_ );\\nCtmp_6_ = \
dzBy_.asDiagonal()*Ctmp_6_;\\nCtmp_7_ = TdzTiLap2Tkxb.asDiagonal()*C13_ + \
TiLap2Tky.asDiagonal()*C23_;\\nfft_.back_2DFull( Ctmp_7_ );\\nCtmp_7_ = \
dzdzdzUx_.asDiagonal()*Ctmp_7_;\\nCtmp_8_ = \
Tm2TdzP2TiLap2Tkxb.asDiagonal()*C33_ + \
Tm2TdzTiLap2Tky.asDiagonal()*C43_;\\nfft_.back_2DFull( Ctmp_8_ );\\nCtmp_8_ = \
dzdzBx_.asDiagonal()*Ctmp_8_;\\nCtmp_9_ = \
Tm2TdzTiLap2TkxbP2Tky.asDiagonal()*C13_ + \
Tm2TiLap2TkxbTkyP2.asDiagonal()*C23_;\\nfft_.back_2DFull( Ctmp_9_ \
);\\nCtmp_9_ = dzUy_.asDiagonal()*Ctmp_9_;\\nCtmp_10_ = \
TmdzTiLap2Tkxb.asDiagonal()*C33_ + \
TmiLap2Tky.asDiagonal()*C43_;\\nfft_.back_2DFull( Ctmp_10_ );\\nCtmp_10_ = \
dzdzdzBx_.asDiagonal()*Ctmp_10_;\\nCtmp_11_ = \
TdzTiLap2TkxbP3PLUSTmdzTkxb.asDiagonal()*C33_ + \
TiLap2TkxbP2Tky.asDiagonal()*C43_ + Tmky*C43_;\\nfft_.back_2DFull( Ctmp_11_ \
);\\nCtmp_11_ = dzBx_.asDiagonal()*Ctmp_11_;\\nCtmp_12_ = \
TdzTkxbPLUSTmdzTiLap2TkxbP3.asDiagonal()*C13_ + Tky*C23_ + \
TmiLap2TkxbP2Tky.asDiagonal()*C23_;\\nfft_.back_2DFull( Ctmp_12_ \
);\\nCtmp_12_ = dzUx_.asDiagonal()*Ctmp_12_;\\nCtmp_1_ = Ctmp_1_ + Ctmp_2_ + \
Ctmp_3_ + Ctmp_4_;\\nfft_.for_2DFull( Ctmp_1_ );\\nCtmp_5_ = Ctmp_10_ + \
Ctmp_11_ + Ctmp_12_ + Ctmp_5_ + Ctmp_6_ + Ctmp_7_ + Ctmp_8_ + \
Ctmp_9_;\\nfft_.for_2DFull( Ctmp_5_ );\\nCtmp_12_ = Ctmp_1_ + \
ilapFtmp_.matrix().asDiagonal()*(Ctmp_5_ + \
(T2Tdz/fft2Dfac_).asDiagonal()*C23_ + (Tm2TkxbTkyTq/fft2Dfac_)*C13_) + \
(TB0zTdz/fft2Dfac_).asDiagonal()*C33_;\\ndealias(Ctmp_12_);\\nCkl_out[i].\
block( 0, 2*NZ_, NZ_, NZ_) = Ctmp_12_;\\n\\n\\n\\nCtmp_1_ = \
Tkxb*C34_;\\nfft_.back_2DFull( Ctmp_1_ );\\nCtmp_1_ = \
Bx_.asDiagonal()*Ctmp_1_;\\nCtmp_2_ = Tky*C34_;\\nfft_.back_2DFull( Ctmp_2_ \
);\\nCtmp_2_ = By_.asDiagonal()*Ctmp_2_;\\nCtmp_3_ = \
Tmkxb*C14_;\\nfft_.back_2DFull( Ctmp_3_ );\\nCtmp_3_ = \
Ux_.asDiagonal()*Ctmp_3_;\\nCtmp_4_ = Tmky*C14_;\\nfft_.back_2DFull( Ctmp_4_ \
);\\nCtmp_4_ = Uy_.asDiagonal()*Ctmp_4_;\\nCtmp_5_ = \
T2TdzP2TiLap2Tkxb.asDiagonal()*C14_ + \
T2TdzTiLap2Tky.asDiagonal()*C24_;\\nfft_.back_2DFull( Ctmp_5_ );\\nCtmp_5_ = \
dzdzUx_.asDiagonal()*Ctmp_5_;\\nCtmp_6_ = \
T2TdzTiLap2TkxbP2Tky.asDiagonal()*C34_ + T2TiLap2TkxbTkyP2.asDiagonal()*C44_;\
\\nfft_.back_2DFull( Ctmp_6_ );\\nCtmp_6_ = \
dzBy_.asDiagonal()*Ctmp_6_;\\nCtmp_7_ = TdzTiLap2Tkxb.asDiagonal()*C14_ + \
TiLap2Tky.asDiagonal()*C24_;\\nfft_.back_2DFull( Ctmp_7_ );\\nCtmp_7_ = \
dzdzdzUx_.asDiagonal()*Ctmp_7_;\\nCtmp_8_ = \
Tm2TdzP2TiLap2Tkxb.asDiagonal()*C34_ + \
Tm2TdzTiLap2Tky.asDiagonal()*C44_;\\nfft_.back_2DFull( Ctmp_8_ );\\nCtmp_8_ = \
dzdzBx_.asDiagonal()*Ctmp_8_;\\nCtmp_9_ = \
Tm2TdzTiLap2TkxbP2Tky.asDiagonal()*C14_ + \
Tm2TiLap2TkxbTkyP2.asDiagonal()*C24_;\\nfft_.back_2DFull( Ctmp_9_ \
);\\nCtmp_9_ = dzUy_.asDiagonal()*Ctmp_9_;\\nCtmp_10_ = \
TmdzTiLap2Tkxb.asDiagonal()*C34_ + \
TmiLap2Tky.asDiagonal()*C44_;\\nfft_.back_2DFull( Ctmp_10_ );\\nCtmp_10_ = \
dzdzdzBx_.asDiagonal()*Ctmp_10_;\\nCtmp_11_ = \
TdzTiLap2TkxbP3PLUSTmdzTkxb.asDiagonal()*C34_ + \
TiLap2TkxbP2Tky.asDiagonal()*C44_ + Tmky*C44_;\\nfft_.back_2DFull( Ctmp_11_ \
);\\nCtmp_11_ = dzBx_.asDiagonal()*Ctmp_11_;\\nCtmp_12_ = \
TdzTkxbPLUSTmdzTiLap2TkxbP3.asDiagonal()*C14_ + Tky*C24_ + \
TmiLap2TkxbP2Tky.asDiagonal()*C24_;\\nfft_.back_2DFull( Ctmp_12_ \
);\\nCtmp_12_ = dzUx_.asDiagonal()*Ctmp_12_;\\nCtmp_1_ = Ctmp_1_ + Ctmp_2_ + \
Ctmp_3_ + Ctmp_4_;\\nfft_.for_2DFull( Ctmp_1_ );\\nCtmp_5_ = Ctmp_10_ + \
Ctmp_11_ + Ctmp_12_ + Ctmp_5_ + Ctmp_6_ + Ctmp_7_ + Ctmp_8_ + \
Ctmp_9_;\\nfft_.for_2DFull( Ctmp_5_ );\\nCtmp_12_ = Ctmp_1_ + \
ilapFtmp_.matrix().asDiagonal()*(Ctmp_5_ + \
(T2Tdz/fft2Dfac_).asDiagonal()*C24_ + (Tm2TkxbTkyTq/fft2Dfac_)*C14_) + \
(TB0zTdz/fft2Dfac_).asDiagonal()*C34_;\\ndealias(Ctmp_12_);\\nCkl_out[i].\
block( 0, 3*NZ_, NZ_, NZ_) = Ctmp_12_;\\n\\n\\n\\nCtmp_1_ = \
Tkxb*C41_;\\nfft_.back_2DFull( Ctmp_1_ );\\nCtmp_1_ = \
Bx_.asDiagonal()*Ctmp_1_;\\nCtmp_2_ = Tky*C41_;\\nfft_.back_2DFull( Ctmp_2_ \
);\\nCtmp_2_ = By_.asDiagonal()*Ctmp_2_;\\nCtmp_3_ = \
Tmkxb*C21_;\\nfft_.back_2DFull( Ctmp_3_ );\\nCtmp_3_ = \
Ux_.asDiagonal()*Ctmp_3_;\\nCtmp_4_ = Tmky*C21_;\\nfft_.back_2DFull( Ctmp_4_ \
);\\nCtmp_4_ = Uy_.asDiagonal()*Ctmp_4_;\\nCtmp_5_ = \
TdzTiLap2Tkxb.asDiagonal()*C11_ + \
TiLap2Tky.asDiagonal()*C21_;\\nfft_.back_2DFull( Ctmp_5_ );\\nCtmp_5_ = \
dzdzUy_.asDiagonal()*Ctmp_5_;\\nCtmp_6_ = TdzTiLap2Tkxb.asDiagonal()*C41_ + \
TmiLap2TkxbP2Tky.asDiagonal()*C31_;\\nfft_.back_2DFull( Ctmp_6_ );\\nCtmp_6_ \
= dzBx_.asDiagonal()*Ctmp_6_;\\nCtmp_7_ = TiLap2TkxbP2Tky.asDiagonal()*C11_ + \
TmdzTiLap2Tkxb.asDiagonal()*C21_;\\nfft_.back_2DFull( Ctmp_7_ );\\nCtmp_7_ = \
dzUx_.asDiagonal()*Ctmp_7_;\\nCtmp_8_ = TmdzTiLap2Tkxb.asDiagonal()*C31_ + \
TmiLap2Tky.asDiagonal()*C41_;\\nfft_.back_2DFull( Ctmp_8_ );\\nCtmp_8_ = \
dzdzBy_.asDiagonal()*Ctmp_8_;\\nCtmp_9_ = Tkxb*C11_;\\nfft_.back_2DFull( \
Ctmp_9_ );\\nCtmp_9_ = dzUy_.asDiagonal()*Ctmp_9_;\\nCtmp_10_ = \
Tmkxb*C31_;\\nfft_.back_2DFull( Ctmp_10_ );\\nCtmp_10_ = \
dzBy_.asDiagonal()*Ctmp_10_;\\nCtmp_1_ = Ctmp_1_ + Ctmp_10_ + Ctmp_2_ + \
Ctmp_3_ + Ctmp_4_ + Ctmp_5_ + Ctmp_6_ + Ctmp_7_ + Ctmp_8_ + \
Ctmp_9_;\\nfft_.for_2DFull( Ctmp_1_ );\\nCtmp_10_ = Ctmp_1_ + \
(TB0zTdz/fft2Dfac_).asDiagonal()*C41_ + \
(TdzTqPLUSTm2Tdz/fft2Dfac_).asDiagonal()*C11_;\\ndealias(Ctmp_10_);\\nCkl_out[\
i].block( NZ_, 0, NZ_, NZ_) = Ctmp_10_;\\n\\n\\n\\nCtmp_1_ = \
Tkxb*C42_;\\nfft_.back_2DFull( Ctmp_1_ );\\nCtmp_1_ = \
Bx_.asDiagonal()*Ctmp_1_;\\nCtmp_2_ = Tky*C42_;\\nfft_.back_2DFull( Ctmp_2_ \
);\\nCtmp_2_ = By_.asDiagonal()*Ctmp_2_;\\nCtmp_3_ = \
Tmkxb*C22_;\\nfft_.back_2DFull( Ctmp_3_ );\\nCtmp_3_ = \
Ux_.asDiagonal()*Ctmp_3_;\\nCtmp_4_ = Tmky*C22_;\\nfft_.back_2DFull( Ctmp_4_ \
);\\nCtmp_4_ = Uy_.asDiagonal()*Ctmp_4_;\\nCtmp_5_ = \
TdzTiLap2Tkxb.asDiagonal()*C12_ + \
TiLap2Tky.asDiagonal()*C22_;\\nfft_.back_2DFull( Ctmp_5_ );\\nCtmp_5_ = \
dzdzUy_.asDiagonal()*Ctmp_5_;\\nCtmp_6_ = TdzTiLap2Tkxb.asDiagonal()*C42_ + \
TmiLap2TkxbP2Tky.asDiagonal()*C32_;\\nfft_.back_2DFull( Ctmp_6_ );\\nCtmp_6_ \
= dzBx_.asDiagonal()*Ctmp_6_;\\nCtmp_7_ = TiLap2TkxbP2Tky.asDiagonal()*C12_ + \
TmdzTiLap2Tkxb.asDiagonal()*C22_;\\nfft_.back_2DFull( Ctmp_7_ );\\nCtmp_7_ = \
dzUx_.asDiagonal()*Ctmp_7_;\\nCtmp_8_ = TmdzTiLap2Tkxb.asDiagonal()*C32_ + \
TmiLap2Tky.asDiagonal()*C42_;\\nfft_.back_2DFull( Ctmp_8_ );\\nCtmp_8_ = \
dzdzBy_.asDiagonal()*Ctmp_8_;\\nCtmp_9_ = Tkxb*C12_;\\nfft_.back_2DFull( \
Ctmp_9_ );\\nCtmp_9_ = dzUy_.asDiagonal()*Ctmp_9_;\\nCtmp_10_ = \
Tmkxb*C32_;\\nfft_.back_2DFull( Ctmp_10_ );\\nCtmp_10_ = \
dzBy_.asDiagonal()*Ctmp_10_;\\nCtmp_1_ = Ctmp_1_ + Ctmp_10_ + Ctmp_2_ + \
Ctmp_3_ + Ctmp_4_ + Ctmp_5_ + Ctmp_6_ + Ctmp_7_ + Ctmp_8_ + \
Ctmp_9_;\\nfft_.for_2DFull( Ctmp_1_ );\\nCtmp_10_ = Ctmp_1_ + \
(TB0zTdz/fft2Dfac_).asDiagonal()*C42_ + \
(TdzTqPLUSTm2Tdz/fft2Dfac_).asDiagonal()*C12_;\\ndealias(Ctmp_10_);\\nCkl_out[\
i].block( NZ_, NZ_, NZ_, NZ_) = Ctmp_10_;\\n\\n\\n\\nCtmp_1_ = \
Tkxb*C43_;\\nfft_.back_2DFull( Ctmp_1_ );\\nCtmp_1_ = \
Bx_.asDiagonal()*Ctmp_1_;\\nCtmp_2_ = Tky*C43_;\\nfft_.back_2DFull( Ctmp_2_ \
);\\nCtmp_2_ = By_.asDiagonal()*Ctmp_2_;\\nCtmp_3_ = \
Tmkxb*C23_;\\nfft_.back_2DFull( Ctmp_3_ );\\nCtmp_3_ = \
Ux_.asDiagonal()*Ctmp_3_;\\nCtmp_4_ = Tmky*C23_;\\nfft_.back_2DFull( Ctmp_4_ \
);\\nCtmp_4_ = Uy_.asDiagonal()*Ctmp_4_;\\nCtmp_5_ = \
TdzTiLap2Tkxb.asDiagonal()*C13_ + \
TiLap2Tky.asDiagonal()*C23_;\\nfft_.back_2DFull( Ctmp_5_ );\\nCtmp_5_ = \
dzdzUy_.asDiagonal()*Ctmp_5_;\\nCtmp_6_ = TdzTiLap2Tkxb.asDiagonal()*C43_ + \
TmiLap2TkxbP2Tky.asDiagonal()*C33_;\\nfft_.back_2DFull( Ctmp_6_ );\\nCtmp_6_ \
= dzBx_.asDiagonal()*Ctmp_6_;\\nCtmp_7_ = TiLap2TkxbP2Tky.asDiagonal()*C13_ + \
TmdzTiLap2Tkxb.asDiagonal()*C23_;\\nfft_.back_2DFull( Ctmp_7_ );\\nCtmp_7_ = \
dzUx_.asDiagonal()*Ctmp_7_;\\nCtmp_8_ = TmdzTiLap2Tkxb.asDiagonal()*C33_ + \
TmiLap2Tky.asDiagonal()*C43_;\\nfft_.back_2DFull( Ctmp_8_ );\\nCtmp_8_ = \
dzdzBy_.asDiagonal()*Ctmp_8_;\\nCtmp_9_ = Tkxb*C13_;\\nfft_.back_2DFull( \
Ctmp_9_ );\\nCtmp_9_ = dzUy_.asDiagonal()*Ctmp_9_;\\nCtmp_10_ = \
Tmkxb*C33_;\\nfft_.back_2DFull( Ctmp_10_ );\\nCtmp_10_ = \
dzBy_.asDiagonal()*Ctmp_10_;\\nCtmp_1_ = Ctmp_1_ + Ctmp_10_ + Ctmp_2_ + \
Ctmp_3_ + Ctmp_4_ + Ctmp_5_ + Ctmp_6_ + Ctmp_7_ + Ctmp_8_ + \
Ctmp_9_;\\nfft_.for_2DFull( Ctmp_1_ );\\nCtmp_10_ = Ctmp_1_ + \
(TB0zTdz/fft2Dfac_).asDiagonal()*C43_ + \
(TdzTqPLUSTm2Tdz/fft2Dfac_).asDiagonal()*C13_;\\ndealias(Ctmp_10_);\\nCkl_out[\
i].block( NZ_, 2*NZ_, NZ_, NZ_) = Ctmp_10_;\\n\\n\\n\\nCtmp_1_ = \
Tkxb*C44_;\\nfft_.back_2DFull( Ctmp_1_ );\\nCtmp_1_ = \
Bx_.asDiagonal()*Ctmp_1_;\\nCtmp_2_ = Tky*C44_;\\nfft_.back_2DFull( Ctmp_2_ \
);\\nCtmp_2_ = By_.asDiagonal()*Ctmp_2_;\\nCtmp_3_ = \
Tmkxb*C24_;\\nfft_.back_2DFull( Ctmp_3_ );\\nCtmp_3_ = \
Ux_.asDiagonal()*Ctmp_3_;\\nCtmp_4_ = Tmky*C24_;\\nfft_.back_2DFull( Ctmp_4_ \
);\\nCtmp_4_ = Uy_.asDiagonal()*Ctmp_4_;\\nCtmp_5_ = \
TdzTiLap2Tkxb.asDiagonal()*C14_ + \
TiLap2Tky.asDiagonal()*C24_;\\nfft_.back_2DFull( Ctmp_5_ );\\nCtmp_5_ = \
dzdzUy_.asDiagonal()*Ctmp_5_;\\nCtmp_6_ = TdzTiLap2Tkxb.asDiagonal()*C44_ + \
TmiLap2TkxbP2Tky.asDiagonal()*C34_;\\nfft_.back_2DFull( Ctmp_6_ );\\nCtmp_6_ \
= dzBx_.asDiagonal()*Ctmp_6_;\\nCtmp_7_ = TiLap2TkxbP2Tky.asDiagonal()*C14_ + \
TmdzTiLap2Tkxb.asDiagonal()*C24_;\\nfft_.back_2DFull( Ctmp_7_ );\\nCtmp_7_ = \
dzUx_.asDiagonal()*Ctmp_7_;\\nCtmp_8_ = TmdzTiLap2Tkxb.asDiagonal()*C34_ + \
TmiLap2Tky.asDiagonal()*C44_;\\nfft_.back_2DFull( Ctmp_8_ );\\nCtmp_8_ = \
dzdzBy_.asDiagonal()*Ctmp_8_;\\nCtmp_9_ = Tkxb*C14_;\\nfft_.back_2DFull( \
Ctmp_9_ );\\nCtmp_9_ = dzUy_.asDiagonal()*Ctmp_9_;\\nCtmp_10_ = \
Tmkxb*C34_;\\nfft_.back_2DFull( Ctmp_10_ );\\nCtmp_10_ = \
dzBy_.asDiagonal()*Ctmp_10_;\\nCtmp_1_ = Ctmp_1_ + Ctmp_10_ + Ctmp_2_ + \
Ctmp_3_ + Ctmp_4_ + Ctmp_5_ + Ctmp_6_ + Ctmp_7_ + Ctmp_8_ + \
Ctmp_9_;\\nfft_.for_2DFull( Ctmp_1_ );\\nCtmp_10_ = Ctmp_1_ + \
(TB0zTdz/fft2Dfac_).asDiagonal()*C44_ + \
(TdzTqPLUSTm2Tdz/fft2Dfac_).asDiagonal()*C14_;\\ndealias(Ctmp_10_);\\nCkl_out[\
i].block( NZ_, 3*NZ_, NZ_, NZ_) = Ctmp_10_;\\n\\n\\n\\nCtmp_1_ = \
Tkxb*C11_;\\nfft_.back_2DFull( Ctmp_1_ );\\nCtmp_1_ = \
Bx_.asDiagonal()*Ctmp_1_;\\nCtmp_2_ = Tky*C11_;\\nfft_.back_2DFull( Ctmp_2_ \
);\\nCtmp_2_ = By_.asDiagonal()*Ctmp_2_;\\nCtmp_3_ = \
Tmkxb*C31_;\\nfft_.back_2DFull( Ctmp_3_ );\\nCtmp_3_ = \
Ux_.asDiagonal()*Ctmp_3_;\\nCtmp_4_ = Tmky*C31_;\\nfft_.back_2DFull( Ctmp_4_ \
);\\nCtmp_4_ = Uy_.asDiagonal()*Ctmp_4_;\\nCtmp_5_ = \
TdzTiLap2Tkxb.asDiagonal()*C11_ + \
TiLap2Tky.asDiagonal()*C21_;\\nfft_.back_2DFull( Ctmp_5_ );\\nCtmp_5_ = \
dzBx_.asDiagonal()*Ctmp_5_;\\nCtmp_6_ = TmdzTiLap2Tkxb.asDiagonal()*C31_ + \
TmiLap2Tky.asDiagonal()*C41_;\\nfft_.back_2DFull( Ctmp_6_ );\\nCtmp_6_ = \
dzUx_.asDiagonal()*Ctmp_6_;\\nCtmp_1_ = Ctmp_1_ + Ctmp_2_ + Ctmp_3_ + Ctmp_4_ \
+ Ctmp_5_ + Ctmp_6_;\\nfft_.for_2DFull( Ctmp_1_ );\\nCtmp_6_ = Ctmp_1_ + \
(TB0zTdz/fft2Dfac_).asDiagonal()*C11_;\\ndealias(Ctmp_6_);\\nCkl_out[i].block(\
 2*NZ_, 0, NZ_, NZ_) = Ctmp_6_;\\n\\n\\n\\nCtmp_1_ = \
Tkxb*C12_;\\nfft_.back_2DFull( Ctmp_1_ );\\nCtmp_1_ = \
Bx_.asDiagonal()*Ctmp_1_;\\nCtmp_2_ = Tky*C12_;\\nfft_.back_2DFull( Ctmp_2_ \
);\\nCtmp_2_ = By_.asDiagonal()*Ctmp_2_;\\nCtmp_3_ = \
Tmkxb*C32_;\\nfft_.back_2DFull( Ctmp_3_ );\\nCtmp_3_ = \
Ux_.asDiagonal()*Ctmp_3_;\\nCtmp_4_ = Tmky*C32_;\\nfft_.back_2DFull( Ctmp_4_ \
);\\nCtmp_4_ = Uy_.asDiagonal()*Ctmp_4_;\\nCtmp_5_ = \
TdzTiLap2Tkxb.asDiagonal()*C12_ + \
TiLap2Tky.asDiagonal()*C22_;\\nfft_.back_2DFull( Ctmp_5_ );\\nCtmp_5_ = \
dzBx_.asDiagonal()*Ctmp_5_;\\nCtmp_6_ = TmdzTiLap2Tkxb.asDiagonal()*C32_ + \
TmiLap2Tky.asDiagonal()*C42_;\\nfft_.back_2DFull( Ctmp_6_ );\\nCtmp_6_ = \
dzUx_.asDiagonal()*Ctmp_6_;\\nCtmp_1_ = Ctmp_1_ + Ctmp_2_ + Ctmp_3_ + Ctmp_4_ \
+ Ctmp_5_ + Ctmp_6_;\\nfft_.for_2DFull( Ctmp_1_ );\\nCtmp_6_ = Ctmp_1_ + \
(TB0zTdz/fft2Dfac_).asDiagonal()*C12_;\\ndealias(Ctmp_6_);\\nCkl_out[i].block(\
 2*NZ_, NZ_, NZ_, NZ_) = Ctmp_6_;\\n\\n\\n\\nCtmp_1_ = \
Tkxb*C13_;\\nfft_.back_2DFull( Ctmp_1_ );\\nCtmp_1_ = \
Bx_.asDiagonal()*Ctmp_1_;\\nCtmp_2_ = Tky*C13_;\\nfft_.back_2DFull( Ctmp_2_ \
);\\nCtmp_2_ = By_.asDiagonal()*Ctmp_2_;\\nCtmp_3_ = \
Tmkxb*C33_;\\nfft_.back_2DFull( Ctmp_3_ );\\nCtmp_3_ = \
Ux_.asDiagonal()*Ctmp_3_;\\nCtmp_4_ = Tmky*C33_;\\nfft_.back_2DFull( Ctmp_4_ \
);\\nCtmp_4_ = Uy_.asDiagonal()*Ctmp_4_;\\nCtmp_5_ = \
TdzTiLap2Tkxb.asDiagonal()*C13_ + \
TiLap2Tky.asDiagonal()*C23_;\\nfft_.back_2DFull( Ctmp_5_ );\\nCtmp_5_ = \
dzBx_.asDiagonal()*Ctmp_5_;\\nCtmp_6_ = TmdzTiLap2Tkxb.asDiagonal()*C33_ + \
TmiLap2Tky.asDiagonal()*C43_;\\nfft_.back_2DFull( Ctmp_6_ );\\nCtmp_6_ = \
dzUx_.asDiagonal()*Ctmp_6_;\\nCtmp_1_ = Ctmp_1_ + Ctmp_2_ + Ctmp_3_ + Ctmp_4_ \
+ Ctmp_5_ + Ctmp_6_;\\nfft_.for_2DFull( Ctmp_1_ );\\nCtmp_6_ = Ctmp_1_ + \
(TB0zTdz/fft2Dfac_).asDiagonal()*C13_;\\ndealias(Ctmp_6_);\\nCkl_out[i].block(\
 2*NZ_, 2*NZ_, NZ_, NZ_) = Ctmp_6_;\\n\\n\\n\\nCtmp_1_ = \
Tkxb*C14_;\\nfft_.back_2DFull( Ctmp_1_ );\\nCtmp_1_ = \
Bx_.asDiagonal()*Ctmp_1_;\\nCtmp_2_ = Tky*C14_;\\nfft_.back_2DFull( Ctmp_2_ \
);\\nCtmp_2_ = By_.asDiagonal()*Ctmp_2_;\\nCtmp_3_ = \
Tmkxb*C34_;\\nfft_.back_2DFull( Ctmp_3_ );\\nCtmp_3_ = \
Ux_.asDiagonal()*Ctmp_3_;\\nCtmp_4_ = Tmky*C34_;\\nfft_.back_2DFull( Ctmp_4_ \
);\\nCtmp_4_ = Uy_.asDiagonal()*Ctmp_4_;\\nCtmp_5_ = \
TdzTiLap2Tkxb.asDiagonal()*C14_ + \
TiLap2Tky.asDiagonal()*C24_;\\nfft_.back_2DFull( Ctmp_5_ );\\nCtmp_5_ = \
dzBx_.asDiagonal()*Ctmp_5_;\\nCtmp_6_ = TmdzTiLap2Tkxb.asDiagonal()*C34_ + \
TmiLap2Tky.asDiagonal()*C44_;\\nfft_.back_2DFull( Ctmp_6_ );\\nCtmp_6_ = \
dzUx_.asDiagonal()*Ctmp_6_;\\nCtmp_1_ = Ctmp_1_ + Ctmp_2_ + Ctmp_3_ + Ctmp_4_ \
+ Ctmp_5_ + Ctmp_6_;\\nfft_.for_2DFull( Ctmp_1_ );\\nCtmp_6_ = Ctmp_1_ + \
(TB0zTdz/fft2Dfac_).asDiagonal()*C14_;\\ndealias(Ctmp_6_);\\nCkl_out[i].block(\
 2*NZ_, 3*NZ_, NZ_, NZ_) = Ctmp_6_;\\n\\n\\n\\nCtmp_1_ = \
Tkxb*C21_;\\nfft_.back_2DFull( Ctmp_1_ );\\nCtmp_1_ = \
Bx_.asDiagonal()*Ctmp_1_;\\nCtmp_2_ = Tky*C21_;\\nfft_.back_2DFull( Ctmp_2_ \
);\\nCtmp_2_ = By_.asDiagonal()*Ctmp_2_;\\nCtmp_3_ = \
Tmkxb*C41_;\\nfft_.back_2DFull( Ctmp_3_ );\\nCtmp_3_ = \
Ux_.asDiagonal()*Ctmp_3_;\\nCtmp_4_ = Tmky*C41_;\\nfft_.back_2DFull( Ctmp_4_ \
);\\nCtmp_4_ = Uy_.asDiagonal()*Ctmp_4_;\\nCtmp_5_ = \
T2TdzTiLap2Tky.asDiagonal()*C21_ + \
TdzP2TiLap2TkxbPLUSTmiLap2TkxbTkyP2.asDiagonal()*C11_;\\nfft_.back_2DFull( \
Ctmp_5_ );\\nCtmp_5_ = dzBy_.asDiagonal()*Ctmp_5_;\\nCtmp_6_ = \
TdzTiLap2Tkxb.asDiagonal()*C11_ + \
TiLap2Tky.asDiagonal()*C21_;\\nfft_.back_2DFull( Ctmp_6_ );\\nCtmp_6_ = \
dzdzBy_.asDiagonal()*Ctmp_6_;\\nCtmp_7_ = TdzTiLap2Tkxb.asDiagonal()*C21_ + \
TmiLap2TkxbP2Tky.asDiagonal()*C11_;\\nfft_.back_2DFull( Ctmp_7_ );\\nCtmp_7_ \
= dzBx_.asDiagonal()*Ctmp_7_;\\nCtmp_8_ = TiLap2TkxbP2Tky.asDiagonal()*C31_ + \
TmdzTiLap2Tkxb.asDiagonal()*C41_;\\nfft_.back_2DFull( Ctmp_8_ );\\nCtmp_8_ = \
dzUx_.asDiagonal()*Ctmp_8_;\\nCtmp_9_ = \
TiLap2TkxbTkyP2PLUSTmdzP2TiLap2Tkxb.asDiagonal()*C31_ + \
Tm2TdzTiLap2Tky.asDiagonal()*C41_;\\nfft_.back_2DFull( Ctmp_9_ );\\nCtmp_9_ = \
dzUy_.asDiagonal()*Ctmp_9_;\\nCtmp_10_ = TmdzTiLap2Tkxb.asDiagonal()*C31_ + \
TmiLap2Tky.asDiagonal()*C41_;\\nfft_.back_2DFull( Ctmp_10_ );\\nCtmp_10_ = \
dzdzUy_.asDiagonal()*Ctmp_10_;\\nCtmp_1_ = Ctmp_1_ + Ctmp_10_ + Ctmp_2_ + \
Ctmp_3_ + Ctmp_4_ + Ctmp_5_ + Ctmp_6_ + Ctmp_7_ + Ctmp_8_ + \
Ctmp_9_;\\nfft_.for_2DFull( Ctmp_1_ );\\nCtmp_10_ = Ctmp_1_ + \
(TB0zTdz/fft2Dfac_).asDiagonal()*C21_ + (TmdzTq/fft2Dfac_).asDiagonal()*C31_;\
\\ndealias(Ctmp_10_);\\nCkl_out[i].block( 3*NZ_, 0, NZ_, NZ_) = \
Ctmp_10_;\\n\\n\\n\\nCtmp_1_ = Tkxb*C22_;\\nfft_.back_2DFull( Ctmp_1_ \
);\\nCtmp_1_ = Bx_.asDiagonal()*Ctmp_1_;\\nCtmp_2_ = \
Tky*C22_;\\nfft_.back_2DFull( Ctmp_2_ );\\nCtmp_2_ = \
By_.asDiagonal()*Ctmp_2_;\\nCtmp_3_ = Tmkxb*C42_;\\nfft_.back_2DFull( Ctmp_3_ \
);\\nCtmp_3_ = Ux_.asDiagonal()*Ctmp_3_;\\nCtmp_4_ = \
Tmky*C42_;\\nfft_.back_2DFull( Ctmp_4_ );\\nCtmp_4_ = \
Uy_.asDiagonal()*Ctmp_4_;\\nCtmp_5_ = T2TdzTiLap2Tky.asDiagonal()*C22_ + \
TdzP2TiLap2TkxbPLUSTmiLap2TkxbTkyP2.asDiagonal()*C12_;\\nfft_.back_2DFull( \
Ctmp_5_ );\\nCtmp_5_ = dzBy_.asDiagonal()*Ctmp_5_;\\nCtmp_6_ = \
TdzTiLap2Tkxb.asDiagonal()*C12_ + \
TiLap2Tky.asDiagonal()*C22_;\\nfft_.back_2DFull( Ctmp_6_ );\\nCtmp_6_ = \
dzdzBy_.asDiagonal()*Ctmp_6_;\\nCtmp_7_ = TdzTiLap2Tkxb.asDiagonal()*C22_ + \
TmiLap2TkxbP2Tky.asDiagonal()*C12_;\\nfft_.back_2DFull( Ctmp_7_ );\\nCtmp_7_ \
= dzBx_.asDiagonal()*Ctmp_7_;\\nCtmp_8_ = TiLap2TkxbP2Tky.asDiagonal()*C32_ + \
TmdzTiLap2Tkxb.asDiagonal()*C42_;\\nfft_.back_2DFull( Ctmp_8_ );\\nCtmp_8_ = \
dzUx_.asDiagonal()*Ctmp_8_;\\nCtmp_9_ = \
TiLap2TkxbTkyP2PLUSTmdzP2TiLap2Tkxb.asDiagonal()*C32_ + \
Tm2TdzTiLap2Tky.asDiagonal()*C42_;\\nfft_.back_2DFull( Ctmp_9_ );\\nCtmp_9_ = \
dzUy_.asDiagonal()*Ctmp_9_;\\nCtmp_10_ = TmdzTiLap2Tkxb.asDiagonal()*C32_ + \
TmiLap2Tky.asDiagonal()*C42_;\\nfft_.back_2DFull( Ctmp_10_ );\\nCtmp_10_ = \
dzdzUy_.asDiagonal()*Ctmp_10_;\\nCtmp_1_ = Ctmp_1_ + Ctmp_10_ + Ctmp_2_ + \
Ctmp_3_ + Ctmp_4_ + Ctmp_5_ + Ctmp_6_ + Ctmp_7_ + Ctmp_8_ + \
Ctmp_9_;\\nfft_.for_2DFull( Ctmp_1_ );\\nCtmp_10_ = Ctmp_1_ + \
(TB0zTdz/fft2Dfac_).asDiagonal()*C22_ + (TmdzTq/fft2Dfac_).asDiagonal()*C32_;\
\\ndealias(Ctmp_10_);\\nCkl_out[i].block( 3*NZ_, NZ_, NZ_, NZ_) = \
Ctmp_10_;\\n\\n\\n\\nCtmp_1_ = Tkxb*C23_;\\nfft_.back_2DFull( Ctmp_1_ \
);\\nCtmp_1_ = Bx_.asDiagonal()*Ctmp_1_;\\nCtmp_2_ = \
Tky*C23_;\\nfft_.back_2DFull( Ctmp_2_ );\\nCtmp_2_ = \
By_.asDiagonal()*Ctmp_2_;\\nCtmp_3_ = Tmkxb*C43_;\\nfft_.back_2DFull( Ctmp_3_ \
);\\nCtmp_3_ = Ux_.asDiagonal()*Ctmp_3_;\\nCtmp_4_ = \
Tmky*C43_;\\nfft_.back_2DFull( Ctmp_4_ );\\nCtmp_4_ = \
Uy_.asDiagonal()*Ctmp_4_;\\nCtmp_5_ = T2TdzTiLap2Tky.asDiagonal()*C23_ + \
TdzP2TiLap2TkxbPLUSTmiLap2TkxbTkyP2.asDiagonal()*C13_;\\nfft_.back_2DFull( \
Ctmp_5_ );\\nCtmp_5_ = dzBy_.asDiagonal()*Ctmp_5_;\\nCtmp_6_ = \
TdzTiLap2Tkxb.asDiagonal()*C13_ + \
TiLap2Tky.asDiagonal()*C23_;\\nfft_.back_2DFull( Ctmp_6_ );\\nCtmp_6_ = \
dzdzBy_.asDiagonal()*Ctmp_6_;\\nCtmp_7_ = TdzTiLap2Tkxb.asDiagonal()*C23_ + \
TmiLap2TkxbP2Tky.asDiagonal()*C13_;\\nfft_.back_2DFull( Ctmp_7_ );\\nCtmp_7_ \
= dzBx_.asDiagonal()*Ctmp_7_;\\nCtmp_8_ = TiLap2TkxbP2Tky.asDiagonal()*C33_ + \
TmdzTiLap2Tkxb.asDiagonal()*C43_;\\nfft_.back_2DFull( Ctmp_8_ );\\nCtmp_8_ = \
dzUx_.asDiagonal()*Ctmp_8_;\\nCtmp_9_ = \
TiLap2TkxbTkyP2PLUSTmdzP2TiLap2Tkxb.asDiagonal()*C33_ + \
Tm2TdzTiLap2Tky.asDiagonal()*C43_;\\nfft_.back_2DFull( Ctmp_9_ );\\nCtmp_9_ = \
dzUy_.asDiagonal()*Ctmp_9_;\\nCtmp_10_ = TmdzTiLap2Tkxb.asDiagonal()*C33_ + \
TmiLap2Tky.asDiagonal()*C43_;\\nfft_.back_2DFull( Ctmp_10_ );\\nCtmp_10_ = \
dzdzUy_.asDiagonal()*Ctmp_10_;\\nCtmp_1_ = Ctmp_1_ + Ctmp_10_ + Ctmp_2_ + \
Ctmp_3_ + Ctmp_4_ + Ctmp_5_ + Ctmp_6_ + Ctmp_7_ + Ctmp_8_ + \
Ctmp_9_;\\nfft_.for_2DFull( Ctmp_1_ );\\nCtmp_10_ = Ctmp_1_ + \
(TB0zTdz/fft2Dfac_).asDiagonal()*C23_ + (TmdzTq/fft2Dfac_).asDiagonal()*C33_;\
\\ndealias(Ctmp_10_);\\nCkl_out[i].block( 3*NZ_, 2*NZ_, NZ_, NZ_) = Ctmp_10_;\
\\n\\n\\n\\nCtmp_1_ = Tkxb*C24_;\\nfft_.back_2DFull( Ctmp_1_ );\\nCtmp_1_ = \
Bx_.asDiagonal()*Ctmp_1_;\\nCtmp_2_ = Tky*C24_;\\nfft_.back_2DFull( Ctmp_2_ \
);\\nCtmp_2_ = By_.asDiagonal()*Ctmp_2_;\\nCtmp_3_ = \
Tmkxb*C44_;\\nfft_.back_2DFull( Ctmp_3_ );\\nCtmp_3_ = \
Ux_.asDiagonal()*Ctmp_3_;\\nCtmp_4_ = Tmky*C44_;\\nfft_.back_2DFull( Ctmp_4_ \
);\\nCtmp_4_ = Uy_.asDiagonal()*Ctmp_4_;\\nCtmp_5_ = \
T2TdzTiLap2Tky.asDiagonal()*C24_ + \
TdzP2TiLap2TkxbPLUSTmiLap2TkxbTkyP2.asDiagonal()*C14_;\\nfft_.back_2DFull( \
Ctmp_5_ );\\nCtmp_5_ = dzBy_.asDiagonal()*Ctmp_5_;\\nCtmp_6_ = \
TdzTiLap2Tkxb.asDiagonal()*C14_ + \
TiLap2Tky.asDiagonal()*C24_;\\nfft_.back_2DFull( Ctmp_6_ );\\nCtmp_6_ = \
dzdzBy_.asDiagonal()*Ctmp_6_;\\nCtmp_7_ = TdzTiLap2Tkxb.asDiagonal()*C24_ + \
TmiLap2TkxbP2Tky.asDiagonal()*C14_;\\nfft_.back_2DFull( Ctmp_7_ );\\nCtmp_7_ \
= dzBx_.asDiagonal()*Ctmp_7_;\\nCtmp_8_ = TiLap2TkxbP2Tky.asDiagonal()*C34_ + \
TmdzTiLap2Tkxb.asDiagonal()*C44_;\\nfft_.back_2DFull( Ctmp_8_ );\\nCtmp_8_ = \
dzUx_.asDiagonal()*Ctmp_8_;\\nCtmp_9_ = \
TiLap2TkxbTkyP2PLUSTmdzP2TiLap2Tkxb.asDiagonal()*C34_ + \
Tm2TdzTiLap2Tky.asDiagonal()*C44_;\\nfft_.back_2DFull( Ctmp_9_ );\\nCtmp_9_ = \
dzUy_.asDiagonal()*Ctmp_9_;\\nCtmp_10_ = TmdzTiLap2Tkxb.asDiagonal()*C34_ + \
TmiLap2Tky.asDiagonal()*C44_;\\nfft_.back_2DFull( Ctmp_10_ );\\nCtmp_10_ = \
dzdzUy_.asDiagonal()*Ctmp_10_;\\nCtmp_1_ = Ctmp_1_ + Ctmp_10_ + Ctmp_2_ + \
Ctmp_3_ + Ctmp_4_ + Ctmp_5_ + Ctmp_6_ + Ctmp_7_ + Ctmp_8_ + \
Ctmp_9_;\\nfft_.for_2DFull( Ctmp_1_ );\\nCtmp_10_ = Ctmp_1_ + \
(TB0zTdz/fft2Dfac_).asDiagonal()*C24_ + (TmdzTq/fft2Dfac_).asDiagonal()*C34_;\
\\ndealias(Ctmp_10_);\\nCkl_out[i].block( 3*NZ_, 3*NZ_, NZ_, NZ_) = Ctmp_10_;\
\\n\"\>"], "Output",
 CellChangeTimes->{3.633267520967383*^9}]
}, Open  ]]
}, Closed]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Hydrodynamic Quasi-linear", "Section",
 CellChangeTimes->{{3.6132857813215227`*^9, 3.613285785435519*^9}, {
  3.653920904176094*^9, 3.653920915598225*^9}}],

Cell[TextData[{
 "Hydrodynamic Quasi-linear equations including interactions of fluctuations \
with both ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["U", "x"], TraditionalForm]],
  FormatType->"TraditionalForm"],
 " and ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["U", "y"], TraditionalForm]],
  FormatType->"TraditionalForm"]
}], "Text",
 CellChangeTimes->{{3.613285788264741*^9, 3.613285816975567*^9}, {
  3.6132858538148127`*^9, 3.613285857694859*^9}, {3.653920934653686*^9, 
  3.6539209721410933`*^9}}],

Cell[CellGroupData[{

Cell["Derive equations", "Subsection",
 CellChangeTimes->{{3.613285862743395*^9, 3.613285865310978*^9}}],

Cell[CellGroupData[{

Cell[BoxData["fullFluctEqs"], "Input",
 CellChangeTimes->{{3.6539337738566093`*^9, 3.653933783065609*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{
     OverscriptBox[
      SubscriptBox["k", "x"], "\[LongDash]"], " ", 
     RowBox[{"p", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "-", 
    RowBox[{
     SuperscriptBox[
      OverscriptBox[
       SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
     OverscriptBox["\[Nu]", "\[Dash]"], " ", 
     RowBox[{"ux", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "-", 
    RowBox[{
     SubsuperscriptBox["k", "y", "2"], " ", 
     OverscriptBox["\[Nu]", "\[Dash]"], " ", 
     RowBox[{"ux", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{
     OverscriptBox[
      SubscriptBox["k", "x"], "\[LongDash]"], " ", 
     RowBox[{"ux", "[", 
      RowBox[{"z", ",", "t"}], "]"}], " ", 
     RowBox[{"Ux", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "-", 
    RowBox[{"2", " ", "\[CapitalOmega]", " ", 
     RowBox[{"uy", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{
     SubscriptBox["k", "y"], " ", 
     RowBox[{"ux", "[", 
      RowBox[{"z", ",", "t"}], "]"}], " ", 
     RowBox[{"Uy", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{
     SuperscriptBox["ux", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "1"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"z", ",", "t"}], "]"}], "+", 
    RowBox[{
     RowBox[{"uz", "[", 
      RowBox[{"z", ",", "t"}], "]"}], " ", 
     RowBox[{
      SuperscriptBox["Ux", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"1", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "-", 
    RowBox[{
     OverscriptBox["\[Nu]", "\[Dash]"], " ", 
     RowBox[{
      SuperscriptBox["ux", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"2", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["k", "y"], " ", 
     RowBox[{"p", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "-", 
    RowBox[{"S", " ", 
     RowBox[{"ux", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{"2", " ", "\[CapitalOmega]", " ", 
     RowBox[{"ux", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "-", 
    RowBox[{
     SuperscriptBox[
      OverscriptBox[
       SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
     OverscriptBox["\[Nu]", "\[Dash]"], " ", 
     RowBox[{"uy", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "-", 
    RowBox[{
     SubsuperscriptBox["k", "y", "2"], " ", 
     OverscriptBox["\[Nu]", "\[Dash]"], " ", 
     RowBox[{"uy", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{
     OverscriptBox[
      SubscriptBox["k", "x"], "\[LongDash]"], " ", 
     RowBox[{"Ux", "[", 
      RowBox[{"z", ",", "t"}], "]"}], " ", 
     RowBox[{"uy", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{
     SubscriptBox["k", "y"], " ", 
     RowBox[{"uy", "[", 
      RowBox[{"z", ",", "t"}], "]"}], " ", 
     RowBox[{"Uy", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{
     SuperscriptBox["uy", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "1"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"z", ",", "t"}], "]"}], "+", 
    RowBox[{
     RowBox[{"uz", "[", 
      RowBox[{"z", ",", "t"}], "]"}], " ", 
     RowBox[{
      SuperscriptBox["Uy", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"1", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "-", 
    RowBox[{
     OverscriptBox["\[Nu]", "\[Dash]"], " ", 
     RowBox[{
      SuperscriptBox["uy", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"2", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      SuperscriptBox[
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], "2"]}], " ", 
     OverscriptBox["\[Nu]", "\[Dash]"], " ", 
     RowBox[{"uz", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "-", 
    RowBox[{
     SubsuperscriptBox["k", "y", "2"], " ", 
     OverscriptBox["\[Nu]", "\[Dash]"], " ", 
     RowBox[{"uz", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{
     OverscriptBox[
      SubscriptBox["k", "x"], "\[LongDash]"], " ", 
     RowBox[{"Ux", "[", 
      RowBox[{"z", ",", "t"}], "]"}], " ", 
     RowBox[{"uz", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{
     SubscriptBox["k", "y"], " ", 
     RowBox[{"Uy", "[", 
      RowBox[{"z", ",", "t"}], "]"}], " ", 
     RowBox[{"uz", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{
     SuperscriptBox["uz", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "1"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"z", ",", "t"}], "]"}], "+", 
    RowBox[{
     SuperscriptBox["p", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"1", ",", "0"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"z", ",", "t"}], "]"}], "-", 
    RowBox[{
     OverscriptBox["\[Nu]", "\[Dash]"], " ", 
     RowBox[{
      SuperscriptBox["uz", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"2", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{
     OverscriptBox[
      SubscriptBox["k", "x"], "\[LongDash]"], " ", 
     RowBox[{"ux", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{
     SubscriptBox["k", "y"], " ", 
     RowBox[{"uy", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{
     SuperscriptBox["uz", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"1", ",", "0"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"z", ",", "t"}], "]"}]}], ",", "0", ",", "0", ",", "0", ",", 
   "0"}], "}"}]], "Output",
 CellChangeTimes->{
  3.6332688052967463`*^9, {3.653933774975625*^9, 3.653933783497717*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"fullFluctEqs", "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"kxb", "\[Rule]", "0"}], ",", 
     RowBox[{"ky", "\[Rule]", "0"}]}], "}"}]}], "/.", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"uz", "\[Rule]", 
     RowBox[{"(", 
      RowBox[{"0", "&"}], ")"}]}], ",", 
    RowBox[{"bz", "\[Rule]", 
     RowBox[{"(", 
      RowBox[{"0", "&"}], ")"}]}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.633268836599291*^9, 3.633268910159667*^9}, {
  3.633270768596004*^9, 3.6332707706742764`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"-", "2"}], " ", "\[CapitalOmega]", " ", 
     RowBox[{"uy", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{
     SuperscriptBox["ux", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "1"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"z", ",", "t"}], "]"}], "-", 
    RowBox[{
     OverscriptBox["\[Nu]", "\[Dash]"], " ", 
     RowBox[{
      SuperscriptBox["ux", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"2", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"-", "S"}], " ", 
     RowBox[{"ux", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{"2", " ", "\[CapitalOmega]", " ", 
     RowBox[{"ux", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "+", 
    RowBox[{
     SuperscriptBox["uy", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "1"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"z", ",", "t"}], "]"}], "-", 
    RowBox[{
     OverscriptBox["\[Nu]", "\[Dash]"], " ", 
     RowBox[{
      SuperscriptBox["uy", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"2", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"z", ",", "t"}], "]"}]}]}], ",", 
   RowBox[{
    SuperscriptBox["p", 
     TagBox[
      RowBox[{"(", 
       RowBox[{"1", ",", "0"}], ")"}],
      Derivative],
     MultilineFunction->None], "[", 
    RowBox[{"z", ",", "t"}], "]"}], ",", "0", ",", "0", ",", "0", ",", "0", 
   ",", "0"}], "}"}]], "Output",
 CellChangeTimes->{{3.633268843911277*^9, 3.633268864487959*^9}, 
   3.633268910536343*^9, 3.633270771064432*^9, 3.653921694362967*^9, 
   3.6539222202745457`*^9, 3.6539224018111343`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"numVariables", " ", "=", " ", "2"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"zt", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"z", ",", "t"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"meanFields", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
    "Ux", ",", "Uy", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"meanFieldsWDerivs", " ", "=", " ", 
   RowBox[{"Rest", "@", 
    RowBox[{"Union", "[", 
     RowBox[{"Join", "[", 
      RowBox[{"meanFields", ",", 
       RowBox[{"dz", "/@", "meanFields"}], ",", 
       RowBox[{"dz", "/@", 
        RowBox[{"dz", "/@", "meanFields"}]}], ",", 
       RowBox[{"dz", "/@", 
        RowBox[{"dz", "/@", 
         RowBox[{"dz", "/@", "meanFields"}]}]}], ",", 
       RowBox[{"dz", "/@", 
        RowBox[{"dz", "/@", 
         RowBox[{"dz", "/@", 
          RowBox[{"dz", "/@", "meanFields"}]}]}]}]}], "]"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"meanFieldQ", " ", "=", " ", 
   RowBox[{
    RowBox[{"MemberQ", "[", 
     RowBox[{"meanFieldsWDerivs", ",", "#"}], "]"}], "&"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"localNLvars", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
     "ux", ",", "uy", ",", "uz", ",", "0", ",", "0", ",", "0", ",", "p"}], 
     "}"}]}], ";", " ", 
   RowBox[{"(*", " ", 
    RowBox[{"No", " ", "b", " ", "variables", " ", "here"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Plug", " ", "in", " ", "mean", " ", "field"}], " ", "+", " ", 
     RowBox[{
     "fluctuations", " ", "into", " ", "NL", " ", "equations", " ", "and", 
      " ", "linearize"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"NL2fluct", ",", "fourierRules", ",", "expArg"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"NL2fluct", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
          "fullNLvars", "\[LeftDoubleBracket]", "i", 
           "\[RightDoubleBracket]"}], "\[Rule]", 
          RowBox[{"Function", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x", ",", "y", ",", "z", ",", "t"}], "}"}], ",", 
            RowBox[{"Evaluate", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                "meanFields", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "@@", 
                RowBox[{"{", 
                 RowBox[{"z", ",", "t"}], "}"}]}], "+", 
               RowBox[{
                RowBox[{
                "localNLvars", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "@@", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "y", ",", "z", ",", "t"}], "}"}]}]}], "/.", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"0", "[", "__", "]"}], ")"}], "\[Rule]", "0"}]}], 
             "]"}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "fullNLvars", "]"}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Plug", " ", "in", " ", "to", " ", "full", " ", "equations", " ", 
        "and", " ", "linearize"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"linearize", "[", 
          RowBox[{"#", ",", "fullNLvars", ",", "xtv"}], "]"}], "&"}], "/@", 
        RowBox[{"Expand", "[", 
         RowBox[{
          RowBox[{"fullNLeqns", "/.", "NL2fluct"}], "/.", 
          RowBox[{"B0z", "\[Rule]", "0"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "fullFluctEqs", " ", "still", " ", "contain", " ", "a", " ", "mean", 
        " ", "field", " ", "part"}], " ", "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Shearing", " ", "wave", " ", "expansion"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"fourierRules", "=", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", "var", "}"}], ",", 
          RowBox[{"Evaluate", "[", 
           RowBox[{"var", "\[Rule]", 
            RowBox[{"Function", "[", 
             RowBox[{
              RowBox[{"Evaluate", "@", "xtv"}], ",", 
              RowBox[{
               RowBox[{"var", "[", 
                RowBox[{"z", ",", "t"}], "]"}], 
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"\[ImaginaryI]", " ", 
                  RowBox[{"(", 
                   RowBox[{"kx", "+", 
                    RowBox[{"q", " ", "t", " ", "ky"}]}], ")"}], "x"}], " ", 
                 "+", " ", 
                 RowBox[{"\[ImaginaryI]", " ", "ky", " ", "y"}]}], "]"}]}]}], 
             "]"}]}], "]"}]}], "]"}], "/@", "fullNLvars"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{"Expand", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"fullFluctEqs", "/.", "fourierRules"}], ")"}], "/", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"\[ImaginaryI]", " ", 
            RowBox[{"(", 
             RowBox[{"kx", "+", 
              RowBox[{"q", " ", "t", " ", "ky"}]}], ")"}], "x"}], " ", "+", 
           " ", 
           RowBox[{"\[ImaginaryI]", " ", "ky", " ", "y"}]}], "]"}]}], "]"}]}],
       ";", 
      RowBox[{"(*", 
       RowBox[{
       "Shearing", " ", "wave", " ", "in", " ", "x", " ", "and", " ", "y"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{"fullFluctEqs", "/.", 
        RowBox[{
         SuperscriptBox["\[ExponentialE]", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "\[ImaginaryI]"}], " ", 
            RowBox[{"(", 
             RowBox[{
              SubscriptBox["k", "x"], "+", 
              RowBox[{
               SubscriptBox["k", "y"], " ", "q", " ", "t"}]}], ")"}], " ", 
            "x"}], "-", 
           RowBox[{"\[ImaginaryI]", " ", 
            SubscriptBox["k", "y"], " ", "y"}]}]], "\[Rule]", "0"}]}]}], ";", 
      " ", 
      RowBox[{"(*", " ", 
       RowBox[{"Remove", " ", "mean", " ", "components"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"fullFluctEqs", "/.", 
          RowBox[{"kx", "\[Rule]", 
           RowBox[{"kxb", "-", 
            RowBox[{"q", " ", "t", " ", "ky"}]}]}]}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"kxb", "\[Rule]", 
            RowBox[{"kxb", "/", "\[ImaginaryI]"}]}], ",", 
           RowBox[{"ky", "\[Rule]", 
            RowBox[{"ky", "/", "\[ImaginaryI]"}]}]}], "}"}]}], "//", 
        "Expand"}]}]}]}], " ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Use", " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "_"]}], "=", 
      RowBox[{
       SubscriptBox["k", "x"], "+", 
       RowBox[{
        SubscriptBox["qtk", "y"], " ", "as", " ", "in", " ", 
        RowBox[{"c", "++"}], " ", "code"}]}]}], " ", "*)"}], 
    "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Derive", " ", "Orr"}], "-", 
     RowBox[{"Somerfeld", " ", "like", " ", "equations"}]}], ",", " ", 
    RowBox[{
     RowBox[{"don", "'"}], "t", " ", "need", " ", "to", " ", "reduce", " ", 
     "other", " ", "equations"}], ",", " ", 
    RowBox[{
    "just", " ", "write", " ", "down", " ", "equations", " ", "for", " ", 
     RowBox[{"Lap", "[", "u", "]"}]}], ",", "\[Zeta]", ",", "b", ",", 
    "\[Eta]"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"derivRules", ",", "LapMGradDiv1", ",", "manualSub"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"derivRules", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Derivative", "[", 
           RowBox[{"n_", ",", "m_"}], "]"}], "[", "a_", "]"}], "[", "vs__", 
         "]"}], "\[RuleDelayed]", 
        RowBox[{"Nest", "[", 
         RowBox[{"dt", ",", 
          RowBox[{"Nest", "[", 
           RowBox[{"dz", ",", 
            RowBox[{"a", "[", "vs", "]"}], ",", "n"}], "]"}], ",", "m"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"LapMGradDiv1", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"kxb", "^", "2"}], "+", 
            RowBox[{"ky", "^", "2"}]}], ")"}], 
          RowBox[{
          "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], "+", 
         
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{
           "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
           "z", ",", "z"}], "]"}], "-", 
         RowBox[{"kxb", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"kxb", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            "+", 
            RowBox[{"ky", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            "+", 
            RowBox[{"D", "[", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
              ",", "z"}], "]"}]}], ")"}]}]}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"finalEqs", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"iLapF", "[", 
            RowBox[{
             RowBox[{"Expand", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"LapMGradDiv1", "[", 
                 RowBox[{"fullFluctEqs", "/.", 
                  RowBox[{"\[Nu]b", "\[Rule]", "0"}]}], "]"}], "/.", 
                "derivRules"}], "/.", "toOrrSomerVars"}], "]"}], "//.", 
             "explicitLap2Rule"}], "]"}], "/.", "explicitLapFRule"}], "//", 
          "Expand"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Expand", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"D", "[", 
                RowBox[{
                 RowBox[{
                 "fullFluctEqs", "\[LeftDoubleBracket]", "2", 
                  "\[RightDoubleBracket]"}], ",", "z"}], "]"}], "-", 
               RowBox[{"ky", " ", 
                RowBox[{
                "fullFluctEqs", "\[LeftDoubleBracket]", "3", 
                 "\[RightDoubleBracket]"}]}]}], "/.", "derivRules"}], "/.", 
             "toOrrSomerVars"}], "]"}], "//.", "explicitLap2Rule"}], "/.", 
          RowBox[{"\[Nu]b", "\[Rule]", "0"}]}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Fix", " ", "these", " ", "up", " ", "manually"}], " ", "-", 
        " ", 
        RowBox[{"sometimes", " ", "much", " ", "easier"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"This", " ", "is", " ", "plugging", " ", "in", " ", 
         RowBox[{"iLapF", "[", "lapF", "]"}]}], " ", "=", " ", 
        RowBox[{
        "1", " ", "in", " ", "the", " ", "more", " ", "complicated", " ", 
         "situation"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "Some", " ", "of", " ", "these", " ", "are", " ", "unecessary", " ", 
         "here"}], ",", " ", 
        RowBox[{"but", " ", "they", " ", 
         RowBox[{"don", "'"}], "t", " ", "do", " ", "any", " ", "harm"}]}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"Expand", "[", 
        RowBox[{
         RowBox[{"-", "ky"}], " ", 
         RowBox[{"iLapF", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                RowBox[{
                 RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                RowBox[{"D", "[", 
                 RowBox[{"#", ",", "z", ",", "z"}], "]"}]}], ")"}], "&"}], 
             "[", 
             RowBox[{
              RowBox[{"u", "[", 
               RowBox[{"z", ",", "t"}], "]"}], " ", 
              RowBox[{"Uy", "[", 
               RowBox[{"z", ",", "t"}], "]"}]}], "]"}], ")"}], "/.", 
           "derivRules"}], "]"}]}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"finalEqs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"finalEqs", "/.", 
            RowBox[{
             RowBox[{"Expand", "[", 
              RowBox[{
               RowBox[{"-", "ky"}], " ", 
               RowBox[{"iLapF", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                    RowBox[{
                    RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                    RowBox[{"D", "[", 
                    RowBox[{"#", ",", "z", ",", "z"}], "]"}]}], ")"}], "&"}], 
                   "[", 
                   RowBox[{
                    RowBox[{"b", "[", 
                    RowBox[{"z", ",", "t"}], "]"}], " ", 
                    RowBox[{"By", "[", 
                    RowBox[{"z", ",", "t"}], "]"}]}], "]"}], ")"}], "/.", 
                 "derivRules"}], "]"}]}], "]"}], "\[RuleDelayed]", 
             RowBox[{
              RowBox[{"-", " ", "ky"}], " ", 
              RowBox[{"b", "[", 
               RowBox[{"z", ",", "t"}], "]"}], 
              RowBox[{"By", "[", 
               RowBox[{"z", ",", "t"}], "]"}]}]}]}], "/.", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Expand", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "kxb"}], " ", 
               RowBox[{"iLapF", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                    RowBox[{
                    RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                    RowBox[{"D", "[", 
                    RowBox[{"#", ",", "z", ",", "z"}], "]"}]}], ")"}], "&"}], 
                   "[", 
                   RowBox[{
                    RowBox[{"b", "[", 
                    RowBox[{"z", ",", "t"}], "]"}], " ", 
                    RowBox[{"Bx", "[", 
                    RowBox[{"z", ",", "t"}], "]"}]}], "]"}], ")"}], "/.", 
                 "derivRules"}], "]"}]}], "+", 
              RowBox[{"kxb", " ", 
               RowBox[{"iLapF", "[", 
                RowBox[{
                 RowBox[{"dz", "[", 
                  RowBox[{"b", "[", 
                   RowBox[{"z", ",", " ", "t"}], "]"}], "]"}], " ", 
                 RowBox[{"dz", "[", 
                  RowBox[{"Bx", "[", 
                   RowBox[{"z", ",", " ", "t"}], "]"}], "]"}]}], "]"}]}]}], 
             "]"}], "\[RuleDelayed]", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "kxb"}], " ", 
              RowBox[{"b", "[", 
               RowBox[{"z", ",", "t"}], "]"}], 
              RowBox[{"Bx", "[", 
               RowBox[{"z", ",", "t"}], "]"}]}], "+", 
             RowBox[{"kxb", " ", 
              RowBox[{"iLapF", "[", 
               RowBox[{
                RowBox[{"dz", "[", 
                 RowBox[{"b", "[", 
                  RowBox[{"z", ",", " ", "t"}], "]"}], "]"}], "  ", 
                RowBox[{"dz", "[", 
                 RowBox[{"Bx", "[", 
                  RowBox[{"z", ",", " ", "t"}], "]"}], "]"}]}], "]"}]}]}]}]}],
           "/.", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Expand", "[", 
            RowBox[{"ky", " ", 
             RowBox[{"iLapF", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                    RowBox[{
                    RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                    RowBox[{"D", "[", 
                    RowBox[{"#", ",", "z", ",", "z"}], "]"}]}], ")"}], "&"}], 
                 "[", 
                 RowBox[{
                  RowBox[{"u", "[", 
                   RowBox[{"z", ",", "t"}], "]"}], " ", 
                  RowBox[{"Uy", "[", 
                   RowBox[{"z", ",", "t"}], "]"}]}], "]"}], ")"}], "/.", 
               "derivRules"}], "]"}]}], "]"}], "\[RuleDelayed]", " ", 
           RowBox[{"ky", " ", 
            RowBox[{"u", "[", 
             RowBox[{"z", ",", "t"}], "]"}], 
            RowBox[{"Uy", "[", 
             RowBox[{"z", ",", "t"}], "]"}]}]}]}], "/.", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Expand", "[", 
           RowBox[{
            RowBox[{"kxb", " ", 
             RowBox[{"iLapF", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                    RowBox[{
                    RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                    RowBox[{"D", "[", 
                    RowBox[{"#", ",", "z", ",", "z"}], "]"}]}], ")"}], "&"}], 
                 "[", 
                 RowBox[{
                  RowBox[{"u", "[", 
                   RowBox[{"z", ",", "t"}], "]"}], " ", 
                  RowBox[{"Ux", "[", 
                   RowBox[{"z", ",", "t"}], "]"}]}], "]"}], ")"}], "/.", 
               "derivRules"}], "]"}]}], "-", 
            RowBox[{"kxb", " ", 
             RowBox[{"iLapF", "[", 
              RowBox[{
               RowBox[{"dz", "[", 
                RowBox[{"u", "[", 
                 RowBox[{"z", ",", " ", "t"}], "]"}], "]"}], " ", 
               RowBox[{"dz", "[", 
                RowBox[{"Ux", "[", 
                 RowBox[{"z", ",", " ", "t"}], "]"}], "]"}]}], "]"}]}]}], 
           "]"}], "\[RuleDelayed]", " ", 
          RowBox[{
           RowBox[{"kxb", " ", 
            RowBox[{"u", "[", 
             RowBox[{"z", ",", "t"}], "]"}], 
            RowBox[{"Ux", "[", 
             RowBox[{"z", ",", "t"}], "]"}]}], "-", 
           RowBox[{"kxb", " ", 
            RowBox[{"iLapF", "[", 
             RowBox[{
              RowBox[{"dz", "[", 
               RowBox[{"u", "[", 
                RowBox[{"z", ",", " ", "t"}], "]"}], "]"}], "  ", 
              RowBox[{"dz", "[", 
               RowBox[{"Ux", "[", 
                RowBox[{"z", ",", " ", "t"}], "]"}], "]"}]}], "]"}]}]}]}]}], "/.", 
        RowBox[{
         RowBox[{"Expand", "[", 
          RowBox[{
           RowBox[{"-", " ", "B0z"}], " ", 
           RowBox[{"iLapF", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                  RowBox[{
                   RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                  RowBox[{"dz", "[", 
                   RowBox[{"dz", "[", "#", "]"}], "]"}]}], ")"}], "&"}], "[", 
               
               RowBox[{"dz", "[", 
                RowBox[{"b", "[", 
                 RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], ")"}], "/.", 
             "derivRules"}], "]"}]}], "]"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"-", "B0z"}], " ", 
          RowBox[{"dz", "[", 
           RowBox[{"b", "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}]}]}]}]}], ";"}]}], 
    "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Now", ",", " ", 
    RowBox[{"form", " ", "the", " ", "A", " ", "matrix"}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"redvars", " ", "=", 
   RowBox[{"{", 
    RowBox[{"u", ",", "\[Zeta]"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"finalEqs", "=", 
    RowBox[{
     RowBox[{"Solve", "[", 
      RowBox[{
       RowBox[{"Thread", "[", 
        RowBox[{"finalEqs", "\[Equal]", "0"}], "]"}], ",", 
       RowBox[{"dt", "/@", 
        RowBox[{"(", 
         RowBox[{"Through", "[", 
          RowBox[{"redvars", "@@", 
           RowBox[{"{", 
            RowBox[{"z", ",", "t"}], "}"}]}], "]"}], ")"}]}]}], "]"}], 
     "\[LeftDoubleBracket]", 
     RowBox[{"1", ",", "All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Solve", " ", "for", " ", "time"}], "-", "derivatives"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"Aop", " ", "=", " ", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Function", "[", 
          RowBox[{
           RowBox[{"{", "var", "}"}], ",", 
           RowBox[{
            RowBox[{"Plus", "@@", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"#", ",", 
                    RowBox[{"var", "[", 
                    RowBox[{"z", ",", "t"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}], ",", 
                  "#", ",", 
                  RowBox[{"{", "}"}]}], "]"}], "&"}], "/@", 
               RowBox[{"(", 
                RowBox[{"plusToList", "@", 
                 RowBox[{
                 "finalEqs", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}], "/.", 
            RowBox[{
             RowBox[{"var", "[", 
              RowBox[{"z", ",", "t"}], "]"}], "\[Rule]", "ph"}]}]}], "]"}], "/@",
          "redvars"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ")"}], "//", 
    "MatrixForm"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"(*", " ", 
    RowBox[{
    "This", " ", "matches", " ", "my", " ", "previously", " ", "derived", " ", 
     RowBox[{"(", 
      RowBox[{"by", " ", "hand"}], ")"}], " ", "version"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Print", "[", 
    RowBox[{"\"\<Mean field derivatives: \>\"", ",", " ", 
     RowBox[{"Union", "@", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"finalEqs", "/.", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"Through", "[", 
            RowBox[{"meanFields", "@@", 
             RowBox[{"{", 
              RowBox[{"z", ",", "t"}], "}"}]}], "]"}], "->", "meanFields"}], 
          "]"}]}], ",", 
        RowBox[{"a_", "?", "meanFieldQ"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}]}]}], "]"}], 
   "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.613288323045455*^9, 3.613288326117752*^9}, {
   3.613288389643783*^9, 3.613288407039393*^9}, {3.613288479968417*^9, 
   3.613288487728981*^9}, {3.613288573589717*^9, 3.613288752358992*^9}, {
   3.613288852631976*^9, 3.613288916198966*^9}, {3.613288986990489*^9, 
   3.6132891926695137`*^9}, {3.613289423308837*^9, 3.613289432319971*^9}, {
   3.613289540309534*^9, 3.613289551704471*^9}, {3.613289593180532*^9, 
   3.613289597516069*^9}, {3.6132897828569527`*^9, 3.613289799551094*^9}, {
   3.613289832684938*^9, 3.613289857392364*^9}, {3.613289899387167*^9, 
   3.613289949003064*^9}, {3.613290022566579*^9, 3.613290072980708*^9}, {
   3.6132901333440037`*^9, 3.6132902277049723`*^9}, {3.613290347360075*^9, 
   3.613290348877283*^9}, {3.613290407662169*^9, 3.6132904199021072`*^9}, {
   3.613290617515009*^9, 3.613290693570179*^9}, {3.6132907374778633`*^9, 
   3.613290807808112*^9}, {3.6132911924799023`*^9, 3.613291195598812*^9}, {
   3.6132912379815063`*^9, 3.613291248693972*^9}, {3.613291280284522*^9, 
   3.613291408458893*^9}, {3.613291458080309*^9, 3.613291470927746*^9}, {
   3.6132915090035563`*^9, 3.613291525286358*^9}, {3.6132921232255783`*^9, 
   3.613292144859001*^9}, {3.613292297867838*^9, 3.613292316012755*^9}, 
   3.6132930883268547`*^9, {3.613293312306075*^9, 3.61329333079275*^9}, {
   3.6133006141405077`*^9, 3.61330070673322*^9}, {3.613300799309185*^9, 
   3.613300851120187*^9}, {3.613300912016116*^9, 3.6133009327016172`*^9}, {
   3.6133010023231773`*^9, 3.613301012699256*^9}, {3.6133010441561947`*^9, 
   3.613301156627*^9}, 3.6133013078550577`*^9, {3.613301447081024*^9, 
   3.613301449877001*^9}, {3.6133015415117207`*^9, 3.6133015541220617`*^9}, {
   3.6133016618658733`*^9, 3.613301704111124*^9}, {3.61330185743235*^9, 
   3.613301871088355*^9}, {3.613301910782558*^9, 3.6133019246441307`*^9}, {
   3.613301999871911*^9, 3.6133020708752737`*^9}, {3.61330239110786*^9, 
   3.613302487596188*^9}, {3.613302551646475*^9, 3.61330262406814*^9}, {
   3.6133045173899403`*^9, 3.6133045479377737`*^9}, {3.6133047488389683`*^9, 
   3.6133047694867353`*^9}, {3.613304829996623*^9, 3.613304868581319*^9}, {
   3.613304943519965*^9, 3.613304948407606*^9}, {3.6133053005957613`*^9, 
   3.613305319748056*^9}, {3.6133261571880493`*^9, 3.613326178299334*^9}, {
   3.613326367599222*^9, 3.613326560664708*^9}, {3.613326591582814*^9, 
   3.613326696955864*^9}, {3.613327160076173*^9, 3.613327161075317*^9}, {
   3.61332757642347*^9, 3.613327611115761*^9}, {3.613327657453199*^9, 
   3.613327813791049*^9}, {3.61332805091748*^9, 3.6133280531810827`*^9}, {
   3.613328083202976*^9, 3.613328090811761*^9}, 3.613328347059229*^9, {
   3.613328833019064*^9, 3.6133288553167562`*^9}, {3.6133291560666847`*^9, 
   3.613329177719489*^9}, 3.6141771183999968`*^9, {3.614189292301111*^9, 
   3.614189302092698*^9}, {3.614361699979642*^9, 3.614361719890554*^9}, {
   3.614504566104581*^9, 3.614504591016654*^9}, {3.614504663864559*^9, 
   3.614504666982682*^9}, {3.614545423593639*^9, 3.614545467974424*^9}, {
   3.614545503295141*^9, 3.614545505932638*^9}, {3.6145455804415207`*^9, 
   3.614545585925158*^9}, {3.614545671972193*^9, 3.614545700909773*^9}, {
   3.61461389665655*^9, 3.6146138980964413`*^9}, {3.614614204204667*^9, 
   3.6146142157163477`*^9}, {3.615049925891439*^9, 3.6150500375845757`*^9}, {
   3.615050120302868*^9, 3.615050132436124*^9}, {3.615058355525507*^9, 
   3.615058358405109*^9}, {3.615058881326123*^9, 3.6150589009419403`*^9}, 
   3.615059782653624*^9, {3.6150637800470552`*^9, 3.6150637964784727`*^9}, {
   3.615063864018147*^9, 3.615063900598628*^9}, {3.633266836052449*^9, 
   3.633266844050617*^9}, {3.65392103703028*^9, 3.653921054557699*^9}, 
   3.653921337770562*^9, {3.653921389601144*^9, 3.653921407788941*^9}, {
   3.653921525154999*^9, 3.653921568427013*^9}, {3.6539216329437437`*^9, 
   3.65392166798941*^9}, {3.653922377589559*^9, 3.653922394988905*^9}, {
   3.6539224948764563`*^9, 3.653922508231072*^9}, {3.653922751933522*^9, 
   3.653922794065708*^9}, 3.6539228590434437`*^9, {3.653923050752593*^9, 
   3.653923087274963*^9}, {3.6539233369839163`*^9, 3.653923417399081*^9}, {
   3.653923456871005*^9, 3.653923480225334*^9}, {3.653923515888198*^9, 
   3.653923587989191*^9}, {3.653933914302847*^9, 3.6539339197253113`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", "2"}], " ", 
   SubscriptBox["k", "y"], " ", 
   RowBox[{
    SuperscriptBox[
     SubscriptBox["\[EmptyUpTriangle]", "F"], 
     RowBox[{"-", "1"}]], "[", 
    RowBox[{
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{"u", "[", 
       RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{"Uy", "[", 
       RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "-", 
  RowBox[{
   SubscriptBox["k", "y"], " ", 
   RowBox[{
    SuperscriptBox[
     SubscriptBox["\[EmptyUpTriangle]", "F"], 
     RowBox[{"-", "1"}]], "[", 
    RowBox[{
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       RowBox[{"Uy", "[", 
        RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
     RowBox[{"u", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "]"}]}], "-", 
  RowBox[{
   SubscriptBox["k", "y"], " ", 
   RowBox[{
    SuperscriptBox[
     SubscriptBox["\[EmptyUpTriangle]", "F"], 
     RowBox[{"-", "1"}]], "[", 
    RowBox[{
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       RowBox[{"u", "[", 
        RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
     RowBox[{"Uy", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "]"}]}], "-", 
  RowBox[{
   SuperscriptBox[
    OverscriptBox[
     SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
   SubscriptBox["k", "y"], " ", 
   RowBox[{
    SuperscriptBox[
     SubscriptBox["\[EmptyUpTriangle]", "F"], 
     RowBox[{"-", "1"}]], "[", 
    RowBox[{
     RowBox[{"u", "[", 
      RowBox[{"z", ",", "t"}], "]"}], " ", 
     RowBox[{"Uy", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "]"}]}], "-", 
  RowBox[{
   SubsuperscriptBox["k", "y", "3"], " ", 
   RowBox[{
    SuperscriptBox[
     SubscriptBox["\[EmptyUpTriangle]", "F"], 
     RowBox[{"-", "1"}]], "[", 
    RowBox[{
     RowBox[{"u", "[", 
      RowBox[{"z", ",", "t"}], "]"}], " ", 
     RowBox[{"Uy", "[", 
      RowBox[{"z", ",", "t"}], "]"}]}], "]"}]}]}]], "Print",
 CellChangeTimes->{
  3.6539233899196587`*^9, 3.653923457831686*^9, {3.6539234999315443`*^9, 
   3.653923590930851*^9}, 3.653933925071069*^9, 3.6539340401439962`*^9}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{
       RowBox[{
        RowBox[{"-", "2"}], " ", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        SubscriptBox["k", "y"], " ", "q", " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "+", 
       RowBox[{"2", " ", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{
             SuperscriptBox[
              SubscriptBox["\[EmptyUpTriangle]", "2"], 
              RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], "]"}],
           " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{"Ux", "[", 
             RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}]}], "]"}]}], "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{
             SubscriptBox["\[PartialD]", "z"], "[", 
             RowBox[{"Ux", "[", 
              RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], 
         "]"}]}], "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}], 
          " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{"Ux", "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "-", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "3"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{"Ux", "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "-", 
       RowBox[{"2", " ", 
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{"Uy", "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", "\[SmallCircle]", " ", 
        RowBox[{"Ux", "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "-", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{"Uy", "[", 
         RowBox[{"z", ",", "t"}], "]"}]}]}], 
      RowBox[{
       RowBox[{"2", " ", "\[CapitalOmega]", " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}], 
         "]"}]}], "+", 
       RowBox[{"2", " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{"Ux", "[", 
             RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], 
         "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{"\[SmallCircle]", " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{"Ux", "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", 
            RowBox[{
             SubscriptBox["\[PartialD]", "z"], "[", 
             RowBox[{"Ux", "[", 
              RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], "]"}], " ", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "]"}]}], "-", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{"Ux", "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "]"}]}], "-", 
       RowBox[{"2", " ", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        SubsuperscriptBox["k", "y", "2"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{"Uy", "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "]"}]}]}]},
     {
      RowBox[{
       RowBox[{"q", " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "-", 
       RowBox[{"2", " ", "\[CapitalOmega]", " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{"Uy", "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{"Uy", "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "+", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{"Ux", "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"]}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{"Ux", "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{"Uy", "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", "\[SmallCircle]", " ", 
        RowBox[{"Ux", "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "-", 
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{"Uy", "[", 
         RowBox[{"z", ",", "t"}], "]"}]}]}]}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.653923590969596*^9, 3.6539339250835*^9, 
  3.653934040214336*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Working out the matrix product, and getting things into a \
\[OpenCurlyDoubleQuote]code convenient\[CloseCurlyDoubleQuote] form\
\>", "Subsection",
 CellChangeTimes->{{3.613329080723421*^9, 3.613329105297495*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Cmat", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"Cm", "[", 
     RowBox[{"i", ",", "j"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "numVariables"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", "numVariables"}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fullMatrixEquations", " ", "=", " ", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Aop", "\[LeftDoubleBracket]", 
          RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], "/.", 
         RowBox[{"ph", "->", 
          RowBox[{"Cmat", "\[LeftDoubleBracket]", 
           RowBox[{"j", ",", "k"}], "\[RightDoubleBracket]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "numVariables"}], "}"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "numVariables"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"k", ",", "numVariables"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Redefine", " ", "lapF", " ", "to", " ", "collect", " ", "as", " ", 
     "many", " ", "terms", " ", "as", " ", "possible"}], ",", " ", 
    RowBox[{"collect", " ", "in", " ", "mean", " ", "fields"}]}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fullMatrixEquations", "=", 
   RowBox[{"MapAll", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Collect", "[", 
       RowBox[{"#", ",", "meanFieldsWDerivs"}], "]"}], "&"}], ",", 
     RowBox[{
      RowBox[{"fullMatrixEquations", "/.", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"Through", "[", 
          RowBox[{"meanFields", "@@", 
           RowBox[{"{", 
            RowBox[{"z", ",", "t"}], "}"}]}], "]"}], "->", "meanFields"}], 
        "]"}]}], 
      RowBox[{"(*", 
       RowBox[{"Easier", " ", "to", " ", "look", " ", "at"}], "*)"}], "/.", 
      "\[IndentingNewLine]", 
      RowBox[{"iLapF", "\[Rule]", "iLapFColl"}]}]}], 
    RowBox[{"(*", 
     RowBox[{"Collect", " ", "iLapF", " ", "terms"}], "*)"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"fullMatrixEquations", "=", 
  RowBox[{"fullMatrixEquations", "//.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"dz", "[", 
       RowBox[{"a_", "/;", 
        RowBox[{"!", 
         RowBox[{"meanFieldQ", "[", "a", "]"}]}]}], "]"}], "\[RuleDelayed]", 
      RowBox[{"dz", " ", "a"}]}], ",", 
     RowBox[{
      RowBox[{"iLap2", "[", "a_", "]"}], "\[RuleDelayed]", 
      RowBox[{"iLap2", " ", "a"}]}]}], "}"}]}]}]}], "Input",
 CellChangeTimes->{{3.614183523653407*^9, 3.614183619973299*^9}, {
   3.6141837102104187`*^9, 3.61418374185849*^9}, {3.6141849032639017`*^9, 
   3.614184910371166*^9}, {3.6141856403035383`*^9, 3.614185671246872*^9}, {
   3.614185814106379*^9, 3.614185877677721*^9}, {3.614186008201589*^9, 
   3.6141860563838873`*^9}, {3.6141861298094*^9, 3.614186133404842*^9}, {
   3.614186265993711*^9, 3.614186266722341*^9}, {3.61418645140637*^9, 
   3.61418648051291*^9}, {3.614186552940997*^9, 3.6141865737590837`*^9}, {
   3.614188523622821*^9, 3.6141885248935966`*^9}, {3.614189283362381*^9, 
   3.614189315179832*^9}, {3.614189422729567*^9, 3.614189433440941*^9}, {
   3.614189677743164*^9, 3.61418967848466*^9}, {3.6141967572921963`*^9, 
   3.6141967583883953`*^9}, {3.6141989228199043`*^9, 3.614198945631775*^9}, 
   3.614198982104651*^9, {3.614361772710515*^9, 3.6143618063669567`*^9}, {
   3.614504631869879*^9, 3.614504678095435*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.614186133917675*^9, 3.614186267048477*^9, 3.614186481926425*^9, 
   3.6141885255283833`*^9, 3.614189319838678*^9, {3.6141894304574347`*^9, 
   3.614189433941032*^9}, 3.614189678940024*^9, 3.614195966966*^9, 
   3.614196761527596*^9, {3.61419892962738*^9, 3.614198946179511*^9}, 
   3.61419898388535*^9, {3.614361787735118*^9, 3.614361807137169*^9}, 
   3.614504597712901*^9, {3.614504637573621*^9, 3.6145046797962427`*^9}, 
   3.614542667785318*^9, 3.614545623141712*^9, 3.614545706505865*^9, 
   3.614545743858747*^9, 3.61461400100451*^9, 3.6146142242536373`*^9, 
   3.614615742538946*^9, 3.614616053498505*^9, 3.6150510348507347`*^9, 
   3.6150584138525*^9, 3.615064001746892*^9, 3.615117169253036*^9, 
   3.6332674667886877`*^9, 3.653928276290979*^9, 3.6539339500479403`*^9, 
   3.653934042999486*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"-", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"]}], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SuperscriptBox[
        SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
        RowBox[{"-", "1"}]], "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], " ", 
         SubscriptBox["k", "y"], " ", "q", " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
        RowBox[{"2", " ", 
         SubscriptBox["\[PartialD]", "z"], " ", "\[CapitalOmega]", " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "-", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "3"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
           RowBox[{
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "-", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "-", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}], 
          "]"}]}]}], "]"}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"-", 
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"]}], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SuperscriptBox[
        SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
        RowBox[{"-", "1"}]], "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], " ", 
         SubscriptBox["k", "y"], " ", "q", " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
        RowBox[{"2", " ", 
         SubscriptBox["\[PartialD]", "z"], " ", "\[CapitalOmega]", " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "-", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "3"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
           RowBox[{
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "-", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2"}], " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "-", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}], 
          "]"}]}]}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{"2", " ", 
       SubscriptBox["\[PartialD]", "z"], " ", "\[CapitalOmega]", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "-", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}], "+", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{"2", " ", 
       SubscriptBox["\[PartialD]", "z"], " ", "\[CapitalOmega]", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", "Ux", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{
       SubscriptBox["k", "y"], " ", "Uy", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SuperscriptBox[
           OverscriptBox[
            SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "-", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}]}], "+", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}]}]}]}], 
    "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.614186133917675*^9, 3.614186267048477*^9, 3.614186481926425*^9, 
   3.6141885255283833`*^9, 3.614189319838678*^9, {3.6141894304574347`*^9, 
   3.614189433941032*^9}, 3.614189678940024*^9, 3.614195966966*^9, 
   3.614196761527596*^9, {3.61419892962738*^9, 3.614198946179511*^9}, 
   3.61419898388535*^9, {3.614361787735118*^9, 3.614361807137169*^9}, 
   3.614504597712901*^9, {3.614504637573621*^9, 3.6145046797962427`*^9}, 
   3.614542667785318*^9, 3.614545623141712*^9, 3.614545706505865*^9, 
   3.614545743858747*^9, 3.61461400100451*^9, 3.6146142242536373`*^9, 
   3.614615742538946*^9, 3.614616053498505*^9, 3.6150510348507347`*^9, 
   3.6150584138525*^9, 3.615064001746892*^9, 3.615117169253036*^9, 
   3.6332674667886877`*^9, 3.653928276290979*^9, 3.6539339500479403`*^9, 
   3.653934043015543*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Put everything into c++ form, including taking the Fourier transforms\
\>", "Subsection",
 CellChangeTimes->{{3.614195675973181*^9, 3.614195696141123*^9}}],

Cell[CellGroupData[{

Cell["Define the various functions and variables to use in c++", \
"Subsubsection",
 CellChangeTimes->{
  3.614200068915313*^9, {3.6145427017460127`*^9, 3.614542707265788*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"CklOut", " ", "=", " ", "\"\<Ckl_out[i]\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CklIn", " ", "=", " ", "\"\<Ckl_in[i]\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ifft", " ", "=", " ", "\"\<fft_.back_2DFull\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fft", " ", "=", " ", "\"\<fft_.for_2DFull\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dealias", " ", "=", " ", "\"\<dealias\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cppProducts", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"\"\<.asDiagonal()*\>\"", ",", "\"\<*\>\""}], "}"}]}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{"Second", " ", "one", " ", "is", " ", "for", " ", "scalars"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"MFcppVariables", " ", "=", 
  RowBox[{"Thread", "[", " ", 
   RowBox[{"meanFieldsWDerivs", "->", 
    RowBox[{"StringReplace", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ToString", "[", "#", "]"}], "<>", "\"\<_\>\""}], "&"}], "/@",
        "meanFieldsWDerivs"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<[\>\"", "\[Rule]", "\"\<\>\""}], ",", 
        RowBox[{"\"\<]\>\"", "\[Rule]", "\"\<\>\""}]}], "}"}]}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"iLapFvar", " ", "=", " ", "\"\<ilapFtmp_.matrix()\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ftFactorVar", "=", "\"\<fft2Dfac_\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"vectorVars", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"iLap2", ",", "dz", ",", "iLapFColl"}], "}"}]}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{
   "Variables", " ", "that", " ", "are", " ", "vectors", " ", "in", " ", 
    RowBox[{"c", "++"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"variablesInCpp", " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"ky", "\[Rule]", "\"\<kyctmp_\>\""}], ",", 
    RowBox[{"kxb", "\[Rule]", "\"\<kxctmp_\>\""}], ",", 
    RowBox[{"dz", "\[Rule]", "\"\<kz_\>\""}], ",", 
    RowBox[{"q", "\[Rule]", "\"\<q_\>\""}], ",", 
    RowBox[{"\[CapitalOmega]", "\[Rule]", "\"\<Omega_\>\""}], ",", 
    RowBox[{"S", "\[Rule]", "\"\<q_\>\""}], ",", 
    RowBox[{"iLap2", "\[Rule]", "\"\<ilap2tmp_\>\""}], ",", 
    RowBox[{"B0z", "\[Rule]", "\"\<B0z_\>\""}]}], "}"}]}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0E0ow3EAxvGF2GEtY0bSMhcvDRmNrYa/VrMimxSmhDghiRZSZiF5XzYp
eWlqRUkiB5ZGYaEsLsqiSPFfxkg2a/g9/8PT5/jUV9TUUdkSxmKxksigg46Y
GH2lqdPB4CK8SKStMOslZRVywg+24IZ1YRvKc6TJY0Qpny2CzmND1ziRPzuv
h2p1ggWKm+8Zd17KTqCx89sJa2I2oyeIXpGdB7UjBfGw4UMmhFOuknRY0uti
HGYXZ0Nd4wyjxmTLhULuE6NA6q86I/rHhNVQ2d5zCY0rD9ewoFTlhv1/S4+Q
HoqiYYY0lXFX8KM4J+pt3UXQLDlahmly2wocnRabL4mlfQYLvNm7enehz3KF
D2qf3+0hYmGr2wF5619+GBM38APvfLV5v/j7NDFqDtduOV6aqtOWu+GcIhQQ
Esv1qiCUTFoK1W80lbnNL4LKYkH9M89D0fttjDpufkAj81CRsfdB+A8w8AN0

  "]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Ux", "\[Rule]", "\<\"Ux_\"\>"}], ",", 
   RowBox[{"Uy", "\[Rule]", "\<\"Uy_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], 
    "\[Rule]", "\<\"dzUx_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], 
    "\[Rule]", "\<\"dzUy_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}], 
    "\[Rule]", "\<\"dzdzUx_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}], 
    "\[Rule]", "\<\"dzdzUy_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}], "]"}], 
    "\[Rule]", "\<\"dzdzdzUx_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}], "]"}], 
    "\[Rule]", "\<\"dzdzdzUy_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Ux", "]"}], "]"}], "]"}], 
     "]"}], "\[Rule]", "\<\"dzdzdzdzUx_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "[", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "Uy", "]"}], "]"}], "]"}], 
     "]"}], "\[Rule]", "\<\"dzdzdzdzUy_\"\>"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6141968971191683`*^9, {3.614196955865787*^9, 3.614196976553069*^9}, 
   3.6141970176273737`*^9, {3.614197140642284*^9, 3.6141971499528723`*^9}, 
   3.61420280515613*^9, 3.6142041474039993`*^9, 3.61420432093274*^9, 
   3.614332753782305*^9, 3.6143334373897533`*^9, 3.614334227966806*^9, 
   3.614335330770611*^9, {3.614342317980378*^9, 3.6143423257325563`*^9}, 
   3.614345100654113*^9, 3.614361816160263*^9, 3.614385394517193*^9, 
   3.614436871615592*^9, 3.6144373337998466`*^9, 3.614437922414172*^9, 
   3.61446781112652*^9, 3.614504610070334*^9, 3.614504924258411*^9, 
   3.614542674887701*^9, 3.61454565515012*^9, 3.614545745944592*^9, 
   3.614615781190735*^9, 3.615115374144129*^9, 3.6151157690167103`*^9, {
   3.615116874721467*^9, 3.615116883022649*^9}, 3.6151171877418413`*^9, 
   3.633267506989159*^9, 3.653928933473083*^9, {3.653933963409555*^9, 
   3.653934003016267*^9}, 3.653934048508584*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    SubscriptBox["k", "y"], "\[Rule]", "\<\"kyctmp_\"\>"}], ",", 
   RowBox[{
    OverscriptBox[
     SubscriptBox["k", "x"], "\[LongDash]"], "\[Rule]", "\<\"kxctmp_\"\>"}], 
   ",", 
   RowBox[{
    SubscriptBox["\[PartialD]", "z"], "\[Rule]", "\<\"kz_\"\>"}], ",", 
   RowBox[{"q", "\[Rule]", "\<\"q_\"\>"}], ",", 
   RowBox[{"\[CapitalOmega]", "\[Rule]", "\<\"Omega_\"\>"}], ",", 
   RowBox[{"S", "\[Rule]", "\<\"q_\"\>"}], ",", 
   RowBox[{
    SuperscriptBox[
     SubscriptBox["\[EmptyUpTriangle]", "2"], 
     RowBox[{"-", "1"}]], "\[Rule]", "\<\"ilap2tmp_\"\>"}], ",", 
   RowBox[{
    SubscriptBox["B", "z0"], "\[Rule]", "\<\"B0z_\"\>"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6141968971191683`*^9, {3.614196955865787*^9, 3.614196976553069*^9}, 
   3.6141970176273737`*^9, {3.614197140642284*^9, 3.6141971499528723`*^9}, 
   3.61420280515613*^9, 3.6142041474039993`*^9, 3.61420432093274*^9, 
   3.614332753782305*^9, 3.6143334373897533`*^9, 3.614334227966806*^9, 
   3.614335330770611*^9, {3.614342317980378*^9, 3.6143423257325563`*^9}, 
   3.614345100654113*^9, 3.614361816160263*^9, 3.614385394517193*^9, 
   3.614436871615592*^9, 3.6144373337998466`*^9, 3.614437922414172*^9, 
   3.61446781112652*^9, 3.614504610070334*^9, 3.614504924258411*^9, 
   3.614542674887701*^9, 3.61454565515012*^9, 3.614545745944592*^9, 
   3.614615781190735*^9, 3.615115374144129*^9, 3.6151157690167103`*^9, {
   3.615116874721467*^9, 3.615116883022649*^9}, 3.6151171877418413`*^9, 
   3.633267506989159*^9, 3.653928933473083*^9, {3.653933963409555*^9, 
   3.653934003016267*^9}, 3.6539340485258408`*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Setup functions to find all the coefficients and replace by c++ variables, \
save these variables to automatically compute later\
\>", "Subsubsection",
 CellChangeTimes->{{3.6142001576080503`*^9, 3.6142001733730717`*^9}, {
  3.614542687579644*^9, 3.6145426929862757`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "The", " ", "main", " ", "stuff", " ", "you", " ", "might", " ", "want", 
    " ", "to", " ", "change", " ", "is", " ", "in", " ", "this", " ", 
    RowBox[{"Module", ".", " ", "Defines"}], " ", "various", " ", "functions",
     " ", "and", " ", "lists", " ", "to", " ", "identify", " ", "different", 
    " ", "variable", " ", "types"}], " ", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "coeffList", ",", "fullCppMultVariableList", ",", "scalarCppVars", ",", 
       "vectorCppVars"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"coeffList", "=", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"MapMatrix", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Cases", "[", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{"coeff_", " ", 
                RowBox[{"Cm", "[", 
                 RowBox[{"i1_", ",", "i2_"}], "]"}]}], "\[RuleDelayed]", 
               "coeff"}], ",", "\[Infinity]"}], "]"}], "&"}], ",", 
           "fullMatrixEquations"}], "]"}], "]"}], "/.", 
        RowBox[{"Thread", "[", 
         RowBox[{"meanFieldsWDerivs", "\[Rule]", "1"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"coeffList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "/.", 
          RowBox[{"coeff_", "\[RuleDelayed]", 
           RowBox[{"Rule", "[", 
            RowBox[{"coeff", ",", 
             RowBox[{"convertProdToString", "[", "coeff", "]"}]}], "]"}]}]}], 
         "&"}], "/@", "coeffList"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"coeffList", " ", "=", " ", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"Sort", "[", 
         RowBox[{"coeffList", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"StringLength", "[", 
             RowBox[{
             "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}], ">", 
            RowBox[{"StringLength", "[", 
             RowBox[{
             "#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}]}], "&"}]}], "]"}], "]"}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "Make", " ", "sure", " ", "longest", " ", "products", " ", "are", " ",
          "first"}], ",", " ", 
        RowBox[{
        "otherwise", " ", "it", " ", "replaces", " ", "others", " ", "too", 
         " ", "early", " ", "and", " ", "they", " ", 
         RowBox[{"don", "'"}], "t", " ", "get", " ", "recognized"}]}], "*)"}],
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"fullMatrixEquationsC", "=", 
       RowBox[{
        RowBox[{"fullMatrixEquations", "/.", "coeffList"}], "/.", 
        RowBox[{
         RowBox[{
          RowBox[{"str1_String", " ", 
           RowBox[{"Cm", "[", 
            RowBox[{"i_", ",", "j_"}], "]"}]}], "+", 
          RowBox[{"str2_String", " ", 
           RowBox[{"Cm", "[", 
            RowBox[{"i_", ",", "j_"}], "]"}]}]}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"StringJoin", "[", 
           RowBox[{"str1", ",", "\"\<PLUS\>\"", ",", "str2"}], "]"}], " ", 
          RowBox[{"Cm", "[", 
           RowBox[{"i", ",", "j"}], "]"}]}]}]}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Now", " ", "there", " ", "are", " ", "only"}], ",", " ", 
        RowBox[{"Mean", " ", "fields", " ", 
         RowBox[{"(", 
          RowBox[{"and", " ", "derivatives"}], ")"}]}], ",", " ", 
        RowBox[{"C", " ", "matrices"}], ",", " ", 
        RowBox[{"string", " ", "variables"}]}], "*)"}], 
      RowBox[{"(*", 
       RowBox[{
       "Second", " ", "replacment", " ", "is", " ", "for", " ", "sums"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Before", " ", "going", " ", "on"}], ",", " ", 
        RowBox[{
         RowBox[{
         "keep", " ", "the", " ", "list", " ", "of", " ", "string", " ", 
          "variables"}], " ", "-", " ", 
         RowBox[{
         "some", " ", "of", " ", "these", " ", "get", " ", "rather", " ", 
          RowBox[{"long", "!"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fullCppMultVariableList", " ", "=", 
       RowBox[{"Union", "[", " ", 
        RowBox[{"Cases", "[", 
         RowBox[{
         "fullMatrixEquationsC", ",", "str_String", ",", "\[Infinity]"}], 
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"scalarCppVars", " ", "=", " ", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"coeffList", ",", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{"Alternatives", "@@", "vectorVars"}], ",", 
              "\[Infinity]"}], "]"}]}], "&"}]}], "]"}], 
        "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Separate", " ", "out", " ", "the", " ", "scalar", " ", "variables"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"vectorCppVars", " ", "=", " ", 
       RowBox[{"Complement", "[", 
        RowBox[{"fullCppMultVariableList", ",", "scalarCppVars"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ClearAll", "[", 
       RowBox[{"scalarCppQ", ",", "vectorCppQ"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"scalarCppQ", "[", "_", "]"}], "=", "False"}], ";", 
      RowBox[{
       RowBox[{"vectorCppQ", "[", "_", "]"}], "=", "False"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"scalarCppQ", "[", "#", "]"}], "=", "True"}], ")"}], "&"}], 
       "/@", "scalarCppVars"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"vectorCppQ", "[", "#", "]"}], "=", "True"}], ")"}], "&"}], 
       "/@", "vectorCppVars"}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Q", " ", "functions", " ", "for", " ", "vectors", " ", "and", " ", 
        "scalars"}], " ", "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"ClearAll", "[", "rescaleForFFT", "]"}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Adds", " ", "in", " ", "ftfac", " ", "multiplying", " ", "vector", 
        " ", "for", " ", "more", " ", "efficient", " ", "fft", " ", 
        "rescaling"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"rescaleForFFT", "[", "a_", "]"}], ":=", "\[IndentingNewLine]", 
       RowBox[{"a", "/.", 
        RowBox[{
         RowBox[{"var_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"scalarCppQ", "[", "#", "]"}], "||", 
             RowBox[{"vectorCppQ", "[", "#", "]"}]}], "&"}], ")"}]}], 
         "\[RuleDelayed]", 
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"newvar", "=", 
             RowBox[{
             "\"\<(\>\"", "<>", "var", "<>", "\"\</\>\"", "<>", "ftFactorVar",
               "<>", "\"\<)\>\""}]}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"scalarCppQ", "[", "var", "]"}], ",", 
              RowBox[{
               RowBox[{"scalarCppQ", "[", "newvar", "]"}], "=", "True"}], ",", 
              RowBox[{
               RowBox[{"vectorCppQ", "[", "newvar", "]"}], "=", "True"}]}], 
             "]"}], ";", "\[IndentingNewLine]", "newvar"}]}], 
          "\[IndentingNewLine]", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Product", " ", "to", " ", "use"}], " ", "-", " ", 
        RowBox[{
        "default", " ", "is", " ", "treating", " ", "object", " ", "as", " ", 
         "a", " ", "vector"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"ClearAll", "[", "vec2DiagProd", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vec2DiagProd", "[", "]"}], "=", 
       RowBox[{
       "cppProducts", "\[LeftDoubleBracket]", "1", 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vec2DiagProd", "[", "a_", "]"}], " ", ":=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"scalarCppQ", "@", "a"}], ",", 
         RowBox[{
         "cppProducts", "\[LeftDoubleBracket]", "2", 
          "\[RightDoubleBracket]"}], ",", 
         RowBox[{
         "cppProducts", "\[LeftDoubleBracket]", "1", 
          "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Replacement", " ", "rules", " ", "from", " ", 
        RowBox[{"c", "++"}], " ", "variables", " ", "to", " ", "real", " ", 
        "products"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"CppToBasicVariables", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"fullCppMultVariableList", "\[Rule]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"StringReplace", "[", 
             RowBox[{"fullCppMultVariableList", ",", 
              RowBox[{
               RowBox[{"a__", "~~", "\"\<PLUS\>\"", "~~", "b__"}], 
               "\[RuleDelayed]", 
               RowBox[{"a", "+", "b"}]}]}], "]"}], "/.", 
            RowBox[{"StringExpression", "\[Rule]", "Sequence"}]}], "/.", 
           RowBox[{"coeffList", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "1"}], "}"}]}], "\[RightDoubleBracket]"}]}], 
          ")"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Collect", " ", "to", " ", "scalar", " ", "and", " ", "vector", " ", 
        "variables"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"CppToBasicVariables", " ", "=", " ", 
       RowBox[{"Gather", "[", 
        RowBox[{"CppToBasicVariables", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"scalarCppQ", "[", 
            RowBox[{
            "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}], "===", 
           RowBox[{"scalarCppQ", "[", 
            RowBox[{
            "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}]}], "&"}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "FUNCTIONS", " ", "TO", " ", "CONVERT", " ", "TO", " ", "CPP", " ", 
     "CODE"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"First", " ", "-", " ", 
     RowBox[{"convert", " ", "to", " ", "symbolic", " ", 
      RowBox[{"code", ".", " ", "Takes"}], " ", "a", " ", "single", " ", 
      "term", " ", "and", " ", "converts", " ", "it", " ", "to", " ", 
      "symbolic", " ", 
      RowBox[{
       RowBox[{"c", "++"}], "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "[", 
    RowBox[{"toPseudoCppCode", ",", "$numberOfTempsVars"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"$numberOfTempsVars", "=", "0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"toPseudoCppCode", "[", 
     RowBox[{"expr_", ",", "index_List"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "term", ",", "mfgroups", ",", "pseudoCCode", ",", " ", "ntemps", ",", 
        "FFTpseudoCode"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "Operators", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"SetAttributes", "[", 
        RowBox[{"CPlus", ",", "Orderless"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"SetAttributes", "[", 
        RowBox[{"CTimes", ",", "Orderless"}], "]"}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Set", " ", "these", " ", "as", " ", "commutative", " ", "but", " ", 
         "not", " ", "associative"}], " ", "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Replace", " ", "Times", " ", "and", " ", "Plus", " ", "with", " ", 
         "C", " ", "oeprators"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"term", "=", 
        RowBox[{
         RowBox[{"expr", "/.", 
          RowBox[{
           RowBox[{"Times", "[", 
            RowBox[{"a___", ",", 
             RowBox[{"B_", "?", "meanFieldQ"}], ",", "b___"}], "]"}], 
           "\[RuleDelayed]", 
           RowBox[{"CTimes", "[", 
            RowBox[{"B", ",", 
             RowBox[{"a", " ", "b"}]}], "]"}]}]}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Plus", "\[Rule]", "CPlus"}], ",", 
           RowBox[{"Times", "\[Rule]", "CTimes"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "term", "]"}], "===", "CTimes"}], ",", 
         RowBox[{"term", " ", "=", " ", 
          RowBox[{"CPlus", "[", "term", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Find", " ", "terms", " ", "linear", " ", "in", " ", "the", " ", 
         "mean", " ", "fields"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"mfgroups", " ", "=", " ", 
        RowBox[{"Position", "[", 
         RowBox[{"term", ",", 
          RowBox[{"CTimes", "[", 
           RowBox[{
            RowBox[{"B_", "?", "meanFieldQ"}], ",", "subt_"}], "]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ntemps", " ", "=", " ", 
        RowBox[{"Length", "@", "mfgroups"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Store", " ", "the", " ", "maximum", " ", "number", " ", "of", " ", 
         "temp", " ", "variables", " ", "for", " ", "memory", " ", 
         "assignment", " ", "later"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{"ntemps", ">", "$numberOfTempsVars"}], ",", 
         RowBox[{"$numberOfTempsVars", "=", "ntemps"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"First", " ", "stage"}], " ", "-", " ", 
         RowBox[{
         "assign", " ", "temp", " ", "variables", " ", "to", " ", 
          "groups"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"pseudoCCode", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"CAssign", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "#", "]"}], ",", 
            RowBox[{"Extract", "[", 
             RowBox[{"term", ",", 
              RowBox[{
              "mfgroups", "\[LeftDoubleBracket]", "#", 
               "\[RightDoubleBracket]"}]}], "]"}]}], "]"}], "&"}], "/@", 
         RowBox[{"Range", "[", "ntemps", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"term", " ", "=", " ", 
        RowBox[{"term", "/.", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Reverse", "/@", "pseudoCCode"}], "/.", 
           RowBox[{"CAssign", "\[Rule]", "Rule"}]}], ")"}]}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Replace", " ", "term", " ", "to", " ", "recognize", " ", "temp", " ",
          "variables"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"Next", " ", "stage"}], " ", "-", " ", 
         RowBox[{
         "add", " ", "in", " ", "Fourier", " ", "transforms", " ", "for", " ",
           "pseudospectral", " ", "products"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"pseudoCCode", "=", 
        RowBox[{"pseudoCCode", "/.", 
         RowBox[{
          RowBox[{"CAssign", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "n_", "]"}], ",", 
            RowBox[{"CTimes", "[", 
             RowBox[{
              RowBox[{"B_", "?", "meanFieldQ"}], ",", "subt_"}], "]"}]}], 
           "]"}], "\[RuleDelayed]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"CAssign", "[", 
             RowBox[{
              RowBox[{"CTemp", "[", "n", "]"}], ",", 
              RowBox[{"(*", 
               RowBox[{"rescaleForFFT", "@"}], "*)"}], "subt"}], "]"}], ",", 
            RowBox[{"Cifft", "[", 
             RowBox[{"CTemp", "[", "n", "]"}], "]"}], ",", 
            RowBox[{"CAssign", "[", 
             RowBox[{
              RowBox[{"CTemp", "[", "n", "]"}], ",", 
              RowBox[{"CTimes", "[", 
               RowBox[{"B", ",", 
                RowBox[{"CTemp", "[", "n", "]"}]}], "]"}]}], "]"}]}], 
           "}"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Add", " ", "a", " ", "CPlus", " ", "around", " ", "temp", " ", 
         "variables", " ", "to", " ", "find", " ", "bits", " ", "for", " ", 
         "taking", " ", "forward", " ", "ffts"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"term", " ", "=", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Replace", "[", 
           RowBox[{"term", ",", 
            RowBox[{
             RowBox[{"CPlus", "[", "a__", "]"}], "\[RuleDelayed]", 
             RowBox[{"CPlus", "[", 
              RowBox[{
               RowBox[{"CPlus", "[", 
                RowBox[{"CTemp", "[", "0", "]"}], "]"}], ",", "a"}], "]"}]}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}], "//.", 
          RowBox[{
           RowBox[{"CPlus", "[", 
            RowBox[{
             RowBox[{"CPlus", "[", 
              RowBox[{"a___", ",", 
               RowBox[{"CTemp", "[", "0", "]"}]}], "]"}], ",", "tmp_CTemp", 
             ",", "b___"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"CPlus", "[", 
            RowBox[{
             RowBox[{"CPlus", "[", 
              RowBox[{"a", ",", 
               RowBox[{"CTemp", "[", "0", "]"}], ",", "tmp"}], "]"}], ",", 
             "b"}], "]"}]}]}], "/.", 
         RowBox[{
          RowBox[{"CPlus", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "0", "]"}], ",", "tmp__"}], "]"}], 
          "\[RuleDelayed]", 
          RowBox[{"CPlus", "[", "tmp", "]"}]}]}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"A", " ", "rather", " ", "long"}], "-", 
         RowBox[{"winded", " ", "way", " ", "to", " ", "do", " ", "this"}], 
         " ", "-", " ", 
         RowBox[{"surprisingly", " ", "tricky"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Pseudocode", " ", "for", " ", "taking", " ", "forward", " ", 
         "ffts"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"FFTpseudoCode", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CAssign", "[", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               ",", "#"}], "]"}], ",", 
             RowBox[{"Cfft", "[", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{"Cases", "[", 
           RowBox[{"term", ",", 
            RowBox[{"CPlus", "[", "tmp__CTemp", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}]}], "//", 
         "Flatten"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Replace", " ", "temp", " ", "variables", " ", "in", " ", "term"}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"term", " ", "=", " ", 
        RowBox[{"term", "/.", 
         RowBox[{"Cases", "[", 
          RowBox[{"FFTpseudoCode", ",", 
           RowBox[{
            RowBox[{"CAssign", "[", "a__", "]"}], "\[RuleDelayed]", 
            RowBox[{"Rule", "@@", 
             RowBox[{"Reverse", "[", 
              RowBox[{"{", "a", "}"}], "]"}]}]}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Add", " ", "fft", " ", "and", " ", "dealiasing", " ", "on", " ", 
         "the", " ", "end", " ", "and", " ", "remove", " ", "useless", " ", 
         "assignment"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"pseudoCCode", " ", "=", " ", 
        RowBox[{
         RowBox[{"Flatten", "@", 
          RowBox[{"Join", "[", 
           RowBox[{"pseudoCCode", ",", "FFTpseudoCode", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"CAssign", "[", 
               RowBox[{
                RowBox[{"CTemp", "[", "ntemps", "]"}], ",", 
                RowBox[{"rescaleForFFT", "@", "term"}]}], "]"}], ",", 
              RowBox[{"CDealias", "[", 
               RowBox[{"CTemp", "[", "ntemps", "]"}], "]"}], ",", 
              RowBox[{"CAssign", "[", 
               RowBox[{
                RowBox[{"CBlock", "@@", "index"}], ",", 
                RowBox[{"CTemp", "[", "ntemps", "]"}]}], "]"}]}], "}"}]}], 
           "]"}]}], "/.", 
         RowBox[{
          RowBox[{"CAssign", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "i_", "]"}], ",", 
            RowBox[{"CPlus", "[", 
             RowBox[{"CTemp", "[", "i_", "]"}], "]"}]}], "]"}], 
          "\[RuleDelayed]", 
          RowBox[{"Sequence", "[", "]"}]}]}]}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Function", " ", "to", " ", "store", " ", "c", " ", "variable", " ", 
     "definitions", " ", "for", " ", "other", " ", "stuff"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ClearAll", "[", "toCString", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Cm", "/:", 
     RowBox[{"toCString", "[", 
      RowBox[{"Cm", "[", 
       RowBox[{"i_", ",", "j_"}], "]"}], "]"}], ":=", 
     RowBox[{"\"\<C\>\"", "<>", 
      RowBox[{"ToString", "[", "i", "]"}], "<>", 
      RowBox[{"ToString", "[", "j", "]"}], "<>", "\"\<_\>\""}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"toCString", "[", "a_String", "]"}], ":=", "a"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CTemp", "/:", 
     RowBox[{"toCString", "[", 
      RowBox[{"CTemp", "[", "n_", "]"}], "]"}], ":=", 
     RowBox[{"\"\<Ctmp_\>\"", "<>", 
      RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<_\>\""}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"toCString", "[", 
      RowBox[{"mf_", "?", "meanFieldQ"}], "]"}], ":=", 
     RowBox[{"mf", "/.", "MFcppVariables"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Function", " ", "to", " ", 
     RowBox[{"take", " ", ".", "block"}], 
     RowBox[{"(", ")"}], " ", "method", " ", "of", " ", "Ckl_out", " ", 
     "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "ind2EigenBlock"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ind2EigenBlock", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i_", ",", "j_"}], "}"}], ",", "cmat_"}], "]"}], ":=", 
     RowBox[{"StringReplace", "[", 
      RowBox[{
       RowBox[{"cmat", "<>", "\"\<.block( \>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"i", "-", "1"}], ")"}], "NZ"}], ",", "InputForm"}], "]"}],
         "<>", "\"\<, \>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"j", "-", "1"}], ")"}], "NZ"}], ",", "InputForm"}], "]"}],
         "<>", "\"\<, NZ, NZ)\>\""}], ",", 
       RowBox[{"\"\<NZ\>\"", "\[Rule]", "\"\<NZ_\>\""}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Rules", " ", "to", " ", "change", " ", "pseudoCCode", " ", "into", " ", 
     "real", " ", "Ccode"}], " ", "*)"}], 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Must", " ", "be", " ", "used", " ", "with"}], " ", "//."}], " ",
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"COperatorRules", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"CTimes", "[", 
         RowBox[{"a_String", ",", "b_"}], "]"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", 
         RowBox[{"vec2DiagProd", "[", "a", "]"}], "<>", 
         RowBox[{"toCString", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CTimes", "[", 
         RowBox[{
          RowBox[{"a_", "?", "meanFieldQ"}], ",", "b_"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"toCString", "[", "a", "]"}], "<>", 
         RowBox[{"vec2DiagProd", "[", "a", "]"}], "<>", 
         RowBox[{"toCString", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CPlus", "[", "a__String", "]"}], "\[RuleDelayed]", 
        RowBox[{"ToString", "@", 
         RowBox[{"Row", "[", 
          RowBox[{
           RowBox[{"{", "a", "}"}], ",", "\"\< + \>\""}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CPlus", "[", 
         RowBox[{"a___", ",", "tmp_CTemp", ",", "b___"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{"CPlus", "[", 
         RowBox[{"a", ",", 
          RowBox[{"toCString", "[", "tmp", "]"}], ",", "b"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CAssign", "[", 
         RowBox[{"tmp_", ",", "b_String"}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"toCString", "[", "tmp", "]"}], "<>", "\"\< = \>\"", "<>", 
         "b"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CAssign", "[", 
         RowBox[{"str_String", ",", "tmp_CTemp"}], "]"}], "\[RuleDelayed]", 
        RowBox[{"CAssign", "[", 
         RowBox[{"str", ",", 
          RowBox[{"toCString", "[", "tmp", "]"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Cfft", "[", "a_CTemp", "]"}], "\[RuleDelayed]", 
        RowBox[{"fft", "<>", "\"\<( \>\"", "<>", 
         RowBox[{"toCString", "@", "a"}], "<>", " ", "\"\< )\>\""}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Cifft", "[", "a_CTemp", "]"}], "\[RuleDelayed]", 
        RowBox[{"ifft", "<>", "\"\<( \>\"", "<>", 
         RowBox[{"toCString", "@", "a"}], "<>", " ", "\"\< )\>\""}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"iLapFColl", "[", "str_String", "]"}], "\[RuleDelayed]", 
        RowBox[{"iLapFvar", "<>", 
         RowBox[{"vec2DiagProd", "[", "]"}], "<>", "\"\<(\>\"", "<>", "str", 
         "<>", "\"\<)\>\""}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CBlock", "[", 
         RowBox[{"i_", ",", "j_"}], "]"}], ":>", 
        RowBox[{"ind2EigenBlock", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"i", ",", "j"}], "}"}], ",", "CklOut"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"CDealias", "[", "tmp_CTemp", "]"}], "\[RuleDelayed]", 
        RowBox[{"dealias", "<>", "\"\<(\>\"", "<>", 
         RowBox[{"toCString", "[", "tmp", "]"}], "<>", "\"\<)\>\""}]}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.614199820333446*^9, 3.614199973544842*^9}, {
   3.614200154568696*^9, 3.614200177457288*^9}, {3.614203202742343*^9, 
   3.6142032132053423`*^9}, {3.614203687436726*^9, 3.614203694398652*^9}, {
   3.614204078926628*^9, 3.614204079422367*^9}, 3.6142041354989843`*^9, {
   3.614204166229424*^9, 3.6142042190601587`*^9}, {3.614204254561245*^9, 
   3.614204333690789*^9}, {3.614331697718234*^9, 3.61433174227547*^9}, {
   3.614331906693769*^9, 3.614331911117732*^9}, {3.614331987606147*^9, 
   3.614332000077257*^9}, {3.614332466912683*^9, 3.614332469135511*^9}, {
   3.614332812588958*^9, 3.614332843516348*^9}, {3.614332874370685*^9, 
   3.614332874698839*^9}, {3.614332908946308*^9, 3.6143329191369057`*^9}, {
   3.614333144869622*^9, 3.614333156472726*^9}, {3.6143332710284643`*^9, 
   3.614333279858944*^9}, {3.6143622085326366`*^9, 3.614362280097941*^9}, 
   3.614362399974094*^9, {3.614362430655244*^9, 3.614362460967514*^9}, {
   3.6143846802878942`*^9, 3.614384682302619*^9}, 3.614436190971469*^9, {
   3.614436331371933*^9, 3.6144363355680647`*^9}, {3.614437229054408*^9, 
   3.61443728430906*^9}, {3.614437337853598*^9, 3.614437440432015*^9}, {
   3.614437482905383*^9, 3.614437585144912*^9}, {3.614437630726707*^9, 
   3.614437785531118*^9}, {3.614437848964754*^9, 3.614437967122786*^9}, {
   3.6144380848799877`*^9, 3.6144381352511873`*^9}, {3.6144382227794724`*^9, 
   3.614438293388933*^9}, {3.61443989562008*^9, 3.614439938088032*^9}, {
   3.6144401493798637`*^9, 3.61444017699675*^9}, {3.61444021553305*^9, 
   3.614440310323646*^9}, {3.61444036659039*^9, 3.614440615353231*^9}, {
   3.614440664885353*^9, 3.6144407634596643`*^9}, {3.614466811204368*^9, 
   3.614466893555069*^9}, {3.614467338629237*^9, 3.614467397648348*^9}, {
   3.614467447634305*^9, 3.614467566346293*^9}, {3.614467600650503*^9, 
   3.6144676225940247`*^9}, {3.6144676700570917`*^9, 3.614467711185996*^9}, {
   3.614467791283551*^9, 3.614467797969377*^9}, {3.6144679149890614`*^9, 
   3.614467955286832*^9}, {3.614467991859248*^9, 3.6144679928261623`*^9}, {
   3.614504879859517*^9, 3.6145049079875603`*^9}, {3.61454283629358*^9, 
   3.614542837167223*^9}, {3.614542878595272*^9, 3.6145428815772047`*^9}, {
   3.614543175274213*^9, 3.614543217236944*^9}, {3.614543286011907*^9, 
   3.614543330056481*^9}, 3.614543427918807*^9, {3.614544016420259*^9, 
   3.614544016783902*^9}, {3.614545405652108*^9, 3.6145454062903223`*^9}, {
   3.614553685029169*^9, 3.614553713332426*^9}, {3.614553820920223*^9, 
   3.614553821614222*^9}, {3.614615907007505*^9, 3.614615911160202*^9}, {
   3.614616031382146*^9, 3.614616036012775*^9}, {3.615115445069023*^9, 
   3.6151154781928577`*^9}, 3.6151155348790293`*^9, {3.615115588817881*^9, 
   3.615115605142126*^9}, {3.615115678487294*^9, 3.6151156814810743`*^9}, 
   3.61511576016107*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Split up and assign to Ckl_out", "Subsubsection",
 CellChangeTimes->{{3.6142046790049763`*^9, 3.614204686099799*^9}, {
  3.6142051931686783`*^9, 3.614205195159081*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "tmp", ",", "variableDef", ",", "vecPreVarStringList", ",", 
      "scalarPreVarStringList", ",", "vectorPreVarQ", ",", "scalarPreVarQ", 
      ",", "ctempVars", ",", "cmatVars"}], "}"}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Form", " ", "the", " ", "full", " ", "equations", " ", "as", " ", "a", 
      " ", "single", " ", "text", " ", "block"}], " ", "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"fullEquations", " ", "=", " ", 
      RowBox[{
       RowBox[{"StringJoin", "@@", 
        RowBox[{"Riffle", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"StringJoin", "@@", 
              RowBox[{"Riffle", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"toPseudoCppCode", "[", 
                  RowBox[{
                   RowBox[{"fullMatrixEquationsC", "\[LeftDoubleBracket]", 
                    RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "j"}], "}"}]}], "]"}], "//.", 
                 "COperatorRules"}], ",", "\"\<;\\n\>\""}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i", ",", "numVariables"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "numVariables"}], "}"}]}], "]"}], "]"}], ",", 
          "\[IndentingNewLine]", "\"\<;\\n\\n\\n\\n\>\""}], "]"}]}], "<>", 
       "\"\<;\\n\>\""}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Form", " ", "the", " ", "variable", " ", "definitions"}], " ",
        "-", " ", 
       RowBox[{
       "the", " ", "functions", " ", "here", " ", "are", " ", "for", " ", 
        "pre"}], "-", 
       RowBox[{"defined", " ", "variables", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"e", ".", "g", "."}], ",", " ", "kxctmp_"}], ")"}], " ", 
        "not", " ", "the", " ", "automatically", " ", "generated", " ", 
        "ones"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"vecPreVarStringList", " ", "=", 
      RowBox[{
       RowBox[{"List", "@@", "vectorVars"}], "/.", "variablesInCpp"}]}], ";", 
     " ", 
     RowBox[{"(*", " ", 
      RowBox[{"List", " ", "of", " ", "vector", " ", "variables"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"scalarPreVarStringList", " ", "=", " ", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"variablesInCpp", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
        "vecPreVarStringList"}], "]"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{"List", " ", "of", " ", "vector", " ", "variables"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"vectorPreVarQ", " ", "=", " ", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "[", "vecPreVarStringList", "]"}], ";",
            "vecPreVarStringList"}], ")"}], ",", "#"}], "]"}], "&"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Returns", " ", "true", " ", "for", " ", "vector", " ", "variable"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"scalarPreVarQ", " ", "=", " ", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "[", "scalarPreVarStringList", "]"}], 
           ";", "scalarPreVarStringList"}], ")"}], ",", "#"}], "]"}], " ", 
       "&"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Returns", " ", "true", " ", "for", " ", "scalar", " ", "variable"}], 
      " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Collect", " ", "matrix", " ", "bits", " ", "together"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"CppToBasicVariables", "/.", "variablesInCpp"}], "/.", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"a_", "?", "vectorPreVarQ"}], "^", "n_"}], 
           "\[RuleDelayed]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"tmp", " ", "=", " ", 
              RowBox[{"a", "<>", "\"\<.pow(\>\"", "<>", 
               RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<)\>\""}]}], 
             ";", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"vecPreVarStringList", ",", "tmp"}], "]"}], ";", 
             "tmp"}], ")"}]}]}], "/.", 
         RowBox[{"\"\<kz_.pow(2)\>\"", "\[RuleDelayed]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"vecPreVarStringList", ",", "\"\<kz2_\>\""}], "]"}], 
            ";", "\"\<kz2_\>\""}], ")"}]}]}], "/.", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"a_", "?", "vectorPreVarQ"}], "  ", 
          RowBox[{"b_", "?", "vectorPreVarQ"}]}], "\[RuleDelayed]", 
         RowBox[{
         "\"\<(\>\"", "<>", "a", "<>", "\"\<*\>\"", "<>", "b", "<>", 
          "\"\<).matrix()\>\""}]}]}], "/.", 
       RowBox[{
        RowBox[{"a_", "?", "vectorPreVarQ"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", "\"\<.matrix()\>\""}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Collect", " ", "scalar", " ", "bits", " ", "together"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"fullCppVaribles", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"a_", "?", "scalarPreVarQ"}], "^", "n_"}], 
           "\[RuleDelayed]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"tmp", "=", 
              RowBox[{"\"\<pow(\>\"", "<>", 
               RowBox[{"ToString", "[", "a", "]"}], "<>", "\"\<,\>\"", "<>", 
               RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<)\>\""}]}], 
             ";", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"scalarPreVarStringList", ",", "tmp"}], "]"}], ";", 
             "tmp"}], ")"}]}]}], "/.", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"a_", "?", "scalarPreVarQ"}], " ", 
           RowBox[{"b_", "?", "scalarPreVarQ"}]}], "\[RuleDelayed]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"scalarPreVarStringList", ",", 
              RowBox[{
              "\"\<(\>\"", "<>", "a", "<>", "\"\<*\>\"", "<>", "b", "<>", 
               "\"\<)\>\""}]}], "]"}], ";", 
            RowBox[{
            "\"\<(\>\"", "<>", "a", "<>", "\"\<*\>\"", "<>", "b", "<>", 
             "\"\<)\>\""}]}], ")"}]}]}], "/.", 
        RowBox[{
         RowBox[{
          RowBox[{"n_", "?", "NumericQ"}], " ", 
          RowBox[{"a_", "?", "scalarPreVarQ"}]}], "\[RuleDelayed]", 
         RowBox[{"\"\<(\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"N", "[", "n", "]"}], "]"}], "<>", "\"\<*\>\"", "<>", "a", 
          "<>", "\"\<)\>\""}]}]}], "/.", 
       RowBox[{
        RowBox[{
         RowBox[{"n_", "?", "NumericQ"}], " ", "b_String"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"ToString", "[", 
          RowBox[{"N", "[", "n", "]"}], "]"}], "<>", "\"\<*\>\"", "<>", 
         "b"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{"fullCppVaribles", "/.", 
        RowBox[{
         RowBox[{"a_String", " ", "b_String"}], "\[RuleDelayed]", 
         RowBox[{"a", "<>", "\"\<*\>\"", "<>", "b"}]}]}], "/.", 
       RowBox[{
        RowBox[{"a_String", " ", "+", " ", "b_String"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", "\"\< + \>\"", "<>", "b"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Add", " ", "in", " ", "ftFactor"}], ",", " ", 
       RowBox[{
       "this", " ", "is", " ", "not", " ", "the", " ", "most", " ", 
        "efficient", " ", 
        RowBox[{"(", 
         RowBox[{"multiplying", " ", "vector"}], ")"}], " ", "but", " ", 
        RowBox[{"doesn", "'"}], "t", " ", "seem", " ", "worth", " ", "the", 
        " ", "effort"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{"fullCppVaribles", "/.", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Rule", "[", 
          RowBox[{"a_String", ",", "b_String"}], "]"}], ")"}], 
        "\[RuleDelayed]", 
        RowBox[{"(", 
         RowBox[{"Rule", "[", 
          RowBox[{"a", ",", 
           RowBox[{
           "\"\<(\>\"", "<>", "b", "<>", "\"\<)*\>\"", "<>", 
            "ftFactorVar"}]}], "]"}], ")"}]}]}]}], ";", "\[IndentingNewLine]",
      "\[IndentingNewLine]", 
     RowBox[{"ctempVars", " ", "=", " ", 
      RowBox[{"toCString", "/@", 
       RowBox[{"(", 
        RowBox[{"CTemp", "/@", 
         RowBox[{"Range", "[", "$numberOfTempsVars", "]"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"cmatVars", " ", "=", 
      RowBox[{"toCString", "/@", 
       RowBox[{"Flatten", "[", "Cmat", "]"}]}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"(*", " ", 
      RowBox[{"Declare", " ", "variables", " ", 
       RowBox[{"(", 
        RowBox[{"in", " ", "class", " ", "definition"}], ")"}]}], " ", "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"classVariableDec", " ", "=", " ", 
      RowBox[{"\"\<dcmplxVecM \>\"", "<>", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{
          RowBox[{"CppToBasicVariables", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}], 
          ",", "\"\<, \>\""}], "]"}]}], "<>", "\"\<;\\n\\n\>\"", "<>", 
       "\[IndentingNewLine]", "\"\<dcmplx \>\"", "<>", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{
          RowBox[{"CppToBasicVariables", "\[LeftDoubleBracket]", 
           RowBox[{"2", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}], 
          ",", "\"\<, \>\""}], "]"}]}], "<>", "\"\<;\\n\\n\>\"", "<>", 
       "\[IndentingNewLine]", "\"\<dcmplxMat \>\"", "<>", " ", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{"ctempVars", ",", "\"\<, \>\""}], "]"}]}], "<>", 
       "\"\<;\\n\\n\>\"", "<>", "\[IndentingNewLine]", "\"\<dcmplxMat \>\"", "<>",
        " ", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{"cmatVars", ",", "\"\<, \>\""}], "]"}]}], "<>", 
       "\"\<;\\n\>\""}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     
     RowBox[{"(*", " ", 
      RowBox[{
      "Assign", " ", "memory", " ", "to", " ", "variables", " ", "in", " ", 
       "class", " ", "constructor"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"classConstrAssignMem", " ", "=", 
      RowBox[{
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "<>", "\"\< = dcmplxVecM(NZ_);\\n\>\""}], "&"}], "/@", 
          RowBox[{"CppToBasicVariables", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}]}], 
         ")"}]}], "<>", "\"\<\\n\>\"", "<>", "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "<>", "\"\< = dcmplxMat(NZ_,NZ_);\\n\>\""}], "&"}], "/@",
           "ctempVars"}], ")"}]}], "<>", "\"\<\\n\>\"", "<>", 
       "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "<>", "\"\< = dcmplxMat(NZ_,NZ_);\\n\>\""}], "&"}], "/@",
           "cmatVars"}], ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Assign", " ", "variables", " ", "inside", " ", "the", " ", 
       "equations"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"assignCppVarsInEqs", " ", "=", 
      RowBox[{
      "\"\<// Vector variable definition (automatic)\\n\>\"", "<>", " ", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "<>", "\"\< = \>\"", " ", "<>", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "<>", "\"\<;\\n\>\""}], "&"}], "/@", 
          RowBox[{
          "fullCppVaribles", "\[LeftDoubleBracket]", "1", 
           "\[RightDoubleBracket]"}]}], ")"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"assignCppVarsInEqs", " ", "=", 
      RowBox[{
      "\"\<// Scalar variable definition (automatic)\\n\>\"", "<>", " ", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "<>", "\"\< = \>\"", " ", "<>", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "<>", "\"\<;\\n\>\""}], "&"}], "/@", 
          RowBox[{
          "fullCppVaribles", "\[LeftDoubleBracket]", "2", 
           "\[RightDoubleBracket]"}]}], ")"}]}], "<>", "\"\<\\n\>\"", "<>", 
       "assignCppVarsInEqs"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"assignCppVarsInEqs", " ", "=", " ", 
      RowBox[{
      "\"\<// Submatrix variable definition (automatic)\\n\>\"", "<>", 
       "\[IndentingNewLine]", 
       RowBox[{"(", 
        RowBox[{"StringJoin", "@@", 
         RowBox[{"Riffle", "[", 
          RowBox[{
           RowBox[{"Flatten", "@", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"toCString", "[", 
                RowBox[{"Cm", "[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}], "<>", "\"\< = \>\"", "<>", 
               RowBox[{"ind2EigenBlock", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"i", ",", "j"}], "}"}], ",", "CklIn"}], "]"}]}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "numVariables"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "numVariables"}], "}"}]}], "]"}]}], ",", 
           "\"\<;\\n\>\""}], "]"}]}], ")"}], "<>", "\"\<;\\n\\n\>\"", "<>", 
       "assignCppVarsInEqs"}]}], ";"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]",
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
    "SAVE", " ", "ALL", " ", "THIS", " ", "STUFF", " ", "TO", " ", "FILE"}], 
    " ", "*)"}],
   FontColor->RGBColor[0.5, 0, 0.5]]}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{
  "\"\<~/Documents/MRIDSS/Mathematica/MMA_Generated_Equations_fullHD.cpp\>\"",
    ",", "\[IndentingNewLine]", 
   RowBox[{
   "\"\<// Automatically generated temporary variables - class \
definition\\n\>\"", "<>", "\[IndentingNewLine]", "classVariableDec", "<>", 
    "\"\<\\n\\n\\n\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
    "\"\<// Automatically generated temporary variables - class \
constructor\\n\>\"", "<>", "\[IndentingNewLine]", "classConstrAssignMem", 
    "<>", "\"\<\\n\\n\\n\\n\\n\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
    "\"\<//Assign automatically generated variables in equations \\n\>\"", "<>",
     "\[IndentingNewLine]", "assignCppVarsInEqs", "<>", 
    "\"\<\\n\\n\\n\\n\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
    "\"\<////////////////////////////////////////////////////////\\n\>\"", "<>",
     "\[IndentingNewLine]", 
    "\"\<///       AUTOMATICALLY GENERATED EQUATIONS         /////\\n\>\"", "<>",
     "\[IndentingNewLine]", 
    "\"\<///       see GenerateC++Equations.nb in MMA        /////\\n\\n\>\"",
     "<>", "\[IndentingNewLine]", "fullEquations", "<>", 
    "\[IndentingNewLine]", 
    "\"\<///     AUTOMATICALLY GENERATED EQUATIONS - END       ///\\n\>\"", "<>",
     "\[IndentingNewLine]", 
    "\"\<////////////////////////////////////////////////////////\\n\>\""}], 
   ",", "\[IndentingNewLine]", "\"\<Text\>\""}], 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.6142047962878428`*^9, 3.6142048287650623`*^9}, {
   3.6142048623685904`*^9, 3.614204871407317*^9}, {3.614204927104175*^9, 
   3.614205167284988*^9}, {3.6142056503063517`*^9, 3.61420569620709*^9}, {
   3.614205733874864*^9, 3.6142057372347527`*^9}, {3.614205801605402*^9, 
   3.6142058147158327`*^9}, {3.614205856654711*^9, 3.614205911695675*^9}, {
   3.614206098560555*^9, 3.6142061335704403`*^9}, {3.614206170108762*^9, 
   3.6142061881144047`*^9}, 3.614206293851531*^9, {3.614206461617001*^9, 
   3.614206486966379*^9}, {3.6142065247418213`*^9, 3.614206525340083*^9}, {
   3.6142065934740763`*^9, 3.6142066005860767`*^9}, {3.614206631795189*^9, 
   3.61420665105902*^9}, {3.6142067668503103`*^9, 3.614206811713435*^9}, {
   3.614206859537304*^9, 3.614206860286922*^9}, {3.6142944293493757`*^9, 
   3.6142944433506927`*^9}, {3.614333316719392*^9, 3.6143334120699873`*^9}, {
   3.614333444377398*^9, 3.614333520964388*^9}, {3.614334399437749*^9, 
   3.61433440340563*^9}, {3.6143353683089323`*^9, 3.614335386748166*^9}, {
   3.6143356115565863`*^9, 3.614335642695072*^9}, {3.614335677308119*^9, 
   3.6143357063543158`*^9}, {3.61433586767843*^9, 3.614336158690496*^9}, {
   3.614336266943084*^9, 3.614336291062385*^9}, {3.614336322628447*^9, 
   3.614336357271209*^9}, {3.614336422201798*^9, 3.61433649219413*^9}, {
   3.6143365411420527`*^9, 3.614336642975008*^9}, {3.614336674388867*^9, 
   3.6143367439724493`*^9}, {3.6143368053654327`*^9, 3.614336827572853*^9}, {
   3.614336871824078*^9, 3.6143368722227917`*^9}, {3.614336903252371*^9, 
   3.614336957793364*^9}, {3.614337118801602*^9, 3.614337369809972*^9}, {
   3.6143374183062*^9, 3.614337432720202*^9}, {3.6143375078514223`*^9, 
   3.6143375282046423`*^9}, {3.6143376036820707`*^9, 3.614337849225244*^9}, {
   3.6143384130703163`*^9, 3.6143384249236937`*^9}, {3.614342468760648*^9, 
   3.614342483795895*^9}, {3.614344870214403*^9, 3.6143448765804043`*^9}, {
   3.6144668024268312`*^9, 3.61446680622049*^9}, {3.614468473094071*^9, 
   3.614468475362665*^9}, {3.6144685580405807`*^9, 3.61446858694422*^9}, {
   3.614468765757752*^9, 3.614468940401372*^9}, {3.614468984586191*^9, 
   3.6144689917783127`*^9}, {3.6144690589896708`*^9, 3.614469059077342*^9}, {
   3.6144691527364483`*^9, 3.6144693667898083`*^9}, {3.614469425367859*^9, 
   3.614469464109496*^9}, {3.6144695490098*^9, 3.6144695491606627`*^9}, {
   3.6144696598494787`*^9, 3.614469660520706*^9}, {3.614469930003291*^9, 
   3.614469937711336*^9}, {3.6144705198149643`*^9, 3.6144705200068417`*^9}, {
   3.6144706655301447`*^9, 3.614470681320969*^9}, {3.614504720143795*^9, 
   3.614504863524947*^9}, {3.614505100915875*^9, 3.614505121919724*^9}, {
   3.614505152906884*^9, 3.614505155503438*^9}, {3.614505221394732*^9, 
   3.614505221833407*^9}, {3.614505263530373*^9, 3.614505263936371*^9}, 
   3.614505308586783*^9, {3.614542746037664*^9, 3.6145427529093513`*^9}, {
   3.61461405830389*^9, 3.614614058847625*^9}, {3.614614417854628*^9, 
   3.614614458527823*^9}, {3.6146144956214952`*^9, 3.614614625662765*^9}, {
   3.6150297979412947`*^9, 3.615029816415002*^9}, 3.6150304053572807`*^9, {
   3.615051001819131*^9, 3.6150510270659933`*^9}, 3.615051083381027*^9, {
   3.615051118523594*^9, 3.615051141241631*^9}, {3.615051184234514*^9, 
   3.615051217257319*^9}, 3.615116799166812*^9, {3.6151171821492977`*^9, 
   3.615117184210381*^9}, {3.653929021865943*^9, 3.653929025946598*^9}, {
   3.653930504459765*^9, 3.653930518951517*^9}}],

Cell[BoxData["\<\"~/Documents/MRIDSS/Mathematica/MMA_Generated_Equations_\
fullHD.cpp\"\>"], "Output",
 CellChangeTimes->{
  3.6143387121822042`*^9, 3.614342337188706*^9, 3.614342486239141*^9, {
   3.6143448771742496`*^9, 3.61434488321599*^9}, 3.6143450218542852`*^9, 
   3.6143451076824017`*^9, 3.6144684790958347`*^9, 3.614469003670755*^9, 
   3.614469059822981*^9, {3.614469192413805*^9, 3.6144692034064283`*^9}, 
   3.614469373655657*^9, 3.6144694649976387`*^9, 3.614469550711421*^9, 
   3.6144696641046753`*^9, 3.614469938679933*^9, 3.614470523412774*^9, {
   3.614505127983507*^9, 3.6145051571376143`*^9}, 3.6145052231571608`*^9, 
   3.614505266300125*^9, 3.614505313529387*^9, {3.6145427143213997`*^9, 
   3.614542725540413*^9}, 3.614542757103635*^9, 3.614542844817013*^9, 
   3.614542885049453*^9, 3.614543449184469*^9, {3.614545738357164*^9, 
   3.614545751438102*^9}, 3.6145539650685472`*^9, 3.6146140636151257`*^9, 
   3.61461428924856*^9, 3.6146146289457407`*^9, 3.6146157553981752`*^9, 
   3.6146160734655457`*^9, {3.61505102898208*^9, 3.615051038026823*^9}, 
   3.6150511425831413`*^9, 3.6150512197186327`*^9, 3.6150598094803543`*^9, 
   3.6151168329697237`*^9, 3.6151168897045393`*^9, 3.61511718799275*^9, 
   3.6332675141406*^9, 3.653928998590324*^9, 3.6539290394642267`*^9, 
   3.653929555355323*^9, 3.6539298629711943`*^9, 3.653930520994677*^9, 
   3.653934048805066*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["assignCppVarsInEqs"], "Input"],

Cell[BoxData["\<\"// Submatrix variable definition (automatic)\\nC11_ = \
Ckl_in[i].block( 0, 0, NZ_, NZ_);\\nC12_ = Ckl_in[i].block( 0, NZ_, NZ_, \
NZ_);\\nC21_ = Ckl_in[i].block( NZ_, 0, NZ_, NZ_);\\nC22_ = Ckl_in[i].block( \
NZ_, NZ_, NZ_, NZ_);\\n\\n// Scalar variable definition (automatic)\\nTkxb = \
(kxctmp_)*fft2Dfac_;\\nTky = (kyctmp_)*fft2Dfac_;\\nTm2TkxbTkyTq = \
((-2.*(kxctmp_*kyctmp_))*q_)*fft2Dfac_;\\nTmkxb = \
((-1.*kxctmp_))*fft2Dfac_;\\nTmky = ((-1.*kyctmp_))*fft2Dfac_;\\n\\n// Vector \
variable definition (automatic)\\nT2TdzP2TiLap2Tkxb = \
((2.*kxctmp_)*(ilap2tmp_*kz2_).matrix())*fft2Dfac_;\\nT2TdzTiLap2Tky = \
((2.*kyctmp_)*(ilap2tmp_*kz_).matrix())*fft2Dfac_;\\nT2TdzTOm = \
((2.*Omega_)*kz_.matrix())*fft2Dfac_;\\nTdzTiLap2Tkxb = \
((ilap2tmp_*kz_).matrix()*kxctmp_)*fft2Dfac_;\\nTdzTkxbPLUSTmdzTiLap2TkxbP3 = \
((-1.*pow(kxctmp_,3))*(ilap2tmp_*kz_).matrix() + \
kxctmp_*kz_.matrix())*fft2Dfac_;\\nTdzTqPLUSTm2TdzTOm = \
((-2.*Omega_)*kz_.matrix() + kz_.matrix()*q_)*fft2Dfac_;\\nTiLap2TkxbP2Tky = \
(ilap2tmp_.matrix()*(kyctmp_*pow(kxctmp_,2)))*fft2Dfac_;\\nTiLap2Tky = \
(ilap2tmp_.matrix()*kyctmp_)*fft2Dfac_;\\nTm2TdzTiLap2TkxbP2Tky = \
((-2.*(kyctmp_*pow(kxctmp_,2)))*(ilap2tmp_*kz_).matrix())*fft2Dfac_;\\\
nTm2TiLap2TkxbTkyP2 = \
((-2.*(kxctmp_*pow(kyctmp_,2)))*ilap2tmp_.matrix())*fft2Dfac_;\\\
nTmdzTiLap2Tkxb = \
((-1.*kxctmp_)*(ilap2tmp_*kz_).matrix())*fft2Dfac_;\\nTmiLap2TkxbP2Tky = \
((-1.*(kyctmp_*pow(kxctmp_,2)))*ilap2tmp_.matrix())*fft2Dfac_;\\n\"\>"], \
"Output",
 CellChangeTimes->{3.653934060941058*^9}]
}, Open  ]]
}, Closed]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Reynolds stresses", "Section",
 CellChangeTimes->{{3.614953263774658*^9, 3.614953267580805*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "conj", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"conj", "[", 
   RowBox[{"Dot", "[", 
    RowBox[{"b_", ",", "a__"}], "]"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"conj", "[", 
    RowBox[{"Dot", "[", "a", "]"}], "]"}], ".", 
   RowBox[{"conj", "[", "b", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"conj", "[", "1", "]"}], ":=", "1"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"redvars", " ", "=", 
   RowBox[{"{", 
    RowBox[{"u", ",", "\[Zeta]", ",", "b", ",", "\[Eta]"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"vectorVars", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"iLap2", ",", "dz", ",", "iLapFColl"}], "}"}]}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{
   "Variables", " ", "that", " ", "are", " ", "vectors", " ", "in", " ", 
    RowBox[{"c", "++"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"variablesInCpp", " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"ky", "\[Rule]", "\"\<kyctmp_\>\""}], ",", 
    RowBox[{"kxb", "\[Rule]", "\"\<kxctmp_\>\""}], ",", 
    RowBox[{"dz", "\[Rule]", "\"\<kz_\>\""}], ",", 
    RowBox[{"q", "\[Rule]", "\"\<q_\>\""}], ",", 
    RowBox[{"iLap2", "\[Rule]", "\"\<ilap2tmp_.cast<dcmplx>()\>\""}]}], 
   "}"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.614968353291263*^9, 3.614968356609688*^9}, {
  3.614968839320692*^9, 3.614968842306284*^9}, {3.61496997567763*^9, 
  3.614969980805501*^9}, {3.6150280583916807`*^9, 3.615028080506551*^9}, {
  3.615032673957727*^9, 3.61503269163594*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    SubscriptBox["k", "y"], "\[Rule]", "\<\"kyctmp_\"\>"}], ",", 
   RowBox[{
    OverscriptBox[
     SubscriptBox["k", "x"], "\[LongDash]"], "\[Rule]", "\<\"kxctmp_\"\>"}], 
   ",", 
   RowBox[{
    SubscriptBox["\[PartialD]", "z"], "\[Rule]", "\<\"kz_\"\>"}], ",", 
   RowBox[{"q", "\[Rule]", "\<\"q_\"\>"}], ",", 
   RowBox[{
    SuperscriptBox[
     SubscriptBox["\[EmptyUpTriangle]", "2"], 
     RowBox[{"-", "1"}]], "\[Rule]", "\<\"ilap2tmp_.cast<dcmplx>()\"\>"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{3.615028082251027*^9, 3.6150326932688217`*^9, 
  3.615042764969593*^9, 3.631019148238813*^9, 3.6310198649779654`*^9, 
  3.653930788564479*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "xv", ",", "xpv", ",", "uv", ",", "bv", ",", "\[IndentingNewLine]", 
      "reynoldsStressesLabels", ",", "\[IndentingNewLine]", "kfun", ",", 
      "fourierRules", ",", "derivRules", ",", "dot1Rule", ",", "conjRules", 
      ",", "\[IndentingNewLine]", "toOrrSomerVarsReynolds", ",", "toCijRules",
       ",", "\[IndentingNewLine]", "scalarQ", ",", "\[IndentingNewLine]", 
      "coeffList", ",", "cppVariables", ",", "\[IndentingNewLine]", 
      "vecPreVarStringList", ",", "scalarPreVarStringList", ",", 
      "vectorPreVarQ", ",", "scalarPreVarQ", ",", "\[IndentingNewLine]", 
      "CppToBasicVariables", ",", "fullCppVaribles", ",", "tmp", ",", 
      "\[IndentingNewLine]", "classVariableDec", ",", "classConstrAssignMem", 
      ",", "assignCppVarsInEqs"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"xv", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"xpv", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{"xp", ",", "yp", ",", "zp"}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"uv", " ", "=", 
        RowBox[{
         RowBox[{"Through", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"ux", ",", "uy", ",", "uz"}], "}"}], "@@", "#"}], "]"}], 
         "&"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"bv", " ", "=", 
        RowBox[{
         RowBox[{"Through", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"bx", ",", "by", ",", "bz"}], "}"}], "@@", "#"}], "]"}], 
         "&"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"reynoldsStressesLabels", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
         "\"\<// Bx reynolds stress\\n\>\"", ",", 
          "\"\<// By reynolds stress\\n\>\"", ",", 
          "\"\<// Ux reynolds stress\\n\>\"", ",", 
          "\"\<// Uy reynolds stress\\n\>\""}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"reynoldsStresses", " ", "=", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"bz", "@@", "xv"}], " ", 
             RowBox[{"ux", "@@", "xpv"}]}], "-", 
            RowBox[{
             RowBox[{"bx", "@@", "xv"}], " ", 
             RowBox[{"uz", "@@", "xpv"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"bz", "@@", "xv"}], " ", 
             RowBox[{"uy", "@@", "xpv"}]}], "-", 
            RowBox[{
             RowBox[{"by", "@@", "xv"}], " ", 
             RowBox[{"uz", "@@", "xpv"}]}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{
                RowBox[{"Grad", "[", 
                 RowBox[{
                  RowBox[{"uv", "[", "xv", "]"}], ",", "xv"}], "]"}], ".", 
                RowBox[{"uv", "[", "xpv", "]"}]}]}], "+", 
              RowBox[{
               RowBox[{"Grad", "[", 
                RowBox[{
                 RowBox[{"bv", "[", "xv", "]"}], ",", "xv"}], "]"}], ".", 
               RowBox[{"bv", "[", "xpv", "]"}]}]}], ")"}], 
            "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{
                RowBox[{"Grad", "[", 
                 RowBox[{
                  RowBox[{"uv", "[", "xv", "]"}], ",", "xv"}], "]"}], ".", 
                RowBox[{"uv", "[", "xpv", "]"}]}]}], "+", 
              RowBox[{
               RowBox[{"Grad", "[", 
                RowBox[{
                 RowBox[{"bv", "[", "xv", "]"}], ",", "xv"}], "]"}], ".", 
               RowBox[{"bv", "[", "xpv", "]"}]}]}], ")"}], 
            "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], "}"}], 
         "\[IndentingNewLine]", "/.", 
         RowBox[{
          RowBox[{
           RowBox[{"f_", "@@", "xv"}], " ", 
           RowBox[{"g_", "@@", "xpv"}]}], "\[RuleDelayed]", 
          RowBox[{
           RowBox[{"f", "@@", "xv"}], " ", ".", " ", 
           RowBox[{"g", "@@", "xpv"}]}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"kfun", "[", 
         RowBox[{"xn_", ",", "yn_", ",", "zn_"}], "]"}], ":=", 
        RowBox[{
         RowBox[{"kxb", "^", "xn"}], ".", 
         RowBox[{"ky", "^", "yn"}], ".", 
         RowBox[{"dz", "^", "zn"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"fourierRules", " ", "=", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Derivative", "[", "ds__", "]"}], "[", "f_", "]"}], "@@",
             "xv"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"kfun", "[", "ds", "]"}], ".", 
            RowBox[{"f", "@@", "xv"}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Derivative", "[", "ds__", "]"}], "[", "f_", "]"}], "@@",
             "xpv"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"f", "@@", "xpv"}], ".", 
            RowBox[{"conj", "[", 
             RowBox[{"kfun", "[", "ds", "]"}], "]"}]}]}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dot1Rule", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{"1", ",", "k__"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"Dot", "[", "k", "]"}]}], ",", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{"k__", ",", "1"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"Dot", "[", "k", "]"}]}]}], "}"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Removes", " ", "1", " ", "from", " ", "dot", " ", "product"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Reynolds", " ", "stress", " ", "in", " ", "original", " ", 
         "variables", " ", "n"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"ONLY", " ", "FLUID", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"STRESSES", "!!"}], "!!"}], "!"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"bZeroSub", "=", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"bx", ",", "by", ",", "bz"}], "}"}], "\[Rule]", 
          RowBox[{"Function", "[", 
           RowBox[{"xv", ",", "0"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"reynoldsStresses", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"reynoldsStresses", "/.", "bZeroSub"}], "/.", 
          "fourierRules"}], "//.", "dot1Rule"}]}], ";", "\[IndentingNewLine]",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Rules", " ", "to", " ", "put", " ", "into", " ", "reduced", " ", 
         "variables"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"toOrrSomerVarsReynolds", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"ux", "@@", "xv"}], "\[Rule]", "u"}], ",", 
          RowBox[{
           RowBox[{"uy", "@@", "xv"}], "\[Rule]", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"kxb", ".", "ky", ".", "iLap2", ".", "u"}]}], "+", 
            RowBox[{"dz", ".", "iLap2", ".", "\[Zeta]"}]}]}], ",", 
          RowBox[{
           RowBox[{"uz", "@@", "xv"}], "\[Rule]", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"kxb", ".", "dz", ".", "iLap2", ".", "u"}]}], "-", 
            RowBox[{"ky", ".", "iLap2", ".", "\[Zeta]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"bx", "@@", "xv"}], "\[Rule]", "b"}], ",", 
          RowBox[{
           RowBox[{"by", "@@", "xv"}], "\[Rule]", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"kxb", ".", "ky", ".", "iLap2", ".", "b"}]}], "+", 
            RowBox[{"dz", ".", "iLap2", ".", "\[Eta]"}]}]}], ",", 
          RowBox[{
           RowBox[{"bz", "@@", "xv"}], "\[Rule]", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"kxb", ".", "dz", ".", "iLap2", ".", "b"}]}], "-", 
            RowBox[{"ky", ".", "iLap2", ".", "\[Eta]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ux", "@@", "xpv"}], "\[Rule]", "u"}], ",", 
          RowBox[{
           RowBox[{"uy", "@@", "xpv"}], "\[Rule]", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"u", ".", 
              RowBox[{"conj", "[", 
               RowBox[{"kxb", ".", "ky", ".", "iLap2"}], "]"}]}]}], "+", 
            RowBox[{"\[Zeta]", ".", 
             RowBox[{"conj", "[", 
              RowBox[{"dz", ".", "iLap2"}], "]"}]}]}]}], ",", 
          RowBox[{
           RowBox[{"uz", "@@", "xpv"}], "\[Rule]", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"u", ".", 
              RowBox[{"conj", "[", 
               RowBox[{"kxb", ".", "dz", ".", "iLap2"}], "]"}]}]}], "-", 
            RowBox[{"\[Zeta]", ".", 
             RowBox[{"conj", "[", 
              RowBox[{"ky", ".", "iLap2"}], "]"}]}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"bx", "@@", "xpv"}], "\[Rule]", "b"}], ",", 
          RowBox[{
           RowBox[{"by", "@@", "xpv"}], "\[Rule]", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"b", ".", 
              RowBox[{"conj", "[", 
               RowBox[{"kxb", ".", "ky", ".", "iLap2"}], "]"}]}]}], "+", 
            RowBox[{"\[Eta]", ".", 
             RowBox[{"conj", "[", 
              RowBox[{"dz", ".", "iLap2"}], "]"}]}]}]}], ",", 
          RowBox[{
           RowBox[{"bz", "@@", "xpv"}], "\[Rule]", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"b", ".", 
              RowBox[{"conj", "[", 
               RowBox[{"kxb", ".", "dz", ".", "iLap2"}], "]"}]}]}], "-", 
            RowBox[{"\[Eta]", ".", 
             RowBox[{"conj", "[", 
              RowBox[{"ky", ".", "iLap2"}], "]"}]}]}]}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"conjRules", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"conj", "[", "kxb", "]"}], "\[Rule]", 
           RowBox[{"-", "kxb"}]}], ",", 
          RowBox[{
           RowBox[{"conj", "[", "ky", "]"}], "\[Rule]", 
           RowBox[{"-", "ky"}]}], ",", 
          RowBox[{
           RowBox[{"conj", "[", "dz", "]"}], "\[Rule]", 
           RowBox[{"-", "dz"}]}], ",", 
          RowBox[{
           RowBox[{"conj", "[", "iLap2", "]"}], "\[Rule]", "iLap2"}]}], 
         "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"Put", " ", "into", " ", "Orr"}], "-", 
         RowBox[{"Somerfeld", " ", "variables"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"reynoldsStresses", " ", "=", " ", 
        RowBox[{"TensorExpand", "[", 
         RowBox[{
          RowBox[{"reynoldsStresses", "/.", "toOrrSomerVarsReynolds"}], "/.", 
          "conjRules"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "@", 
        RowBox[{
        "reynoldsStresses", "\[LeftDoubleBracket]", "1", 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Convert", " ", "to", " ", "Cij"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"toCijRules", " ", "=", " ", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"Flatten", "@", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Dot", "[", 
              RowBox[{"a___", ",", "v1", ",", "v2", ",", "b___"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"v1", ",", "redvars"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"v2", ",", "redvars"}], "}"}]}], "]"}]}], 
          "\[RuleDelayed]", 
          RowBox[{"Evaluate", "[", 
           RowBox[{"Flatten", "@", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"Dot", "[", 
               RowBox[{"a", ",", 
                RowBox[{"Cm", "[", 
                 RowBox[{"i", ",", "j"}], "]"}], ",", "b"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"Length", "[", "redvars", "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{"Length", "[", "redvars", "]"}]}], "}"}]}], "]"}]}], 
           "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Put", " ", "into", " ", "canonical", " ", "form", " ", "by", " ", 
         "converting", " ", "dot", " ", "to", " ", "times"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"reynoldsStresses", "=", 
        RowBox[{
         RowBox[{"reynoldsStresses", "/.", "toCijRules"}], "/.", 
         RowBox[{
          RowBox[{"Dot", "[", 
           RowBox[{"a___", ",", 
            RowBox[{"Cm", "[", "i__", "]"}], ",", "b___"}], "]"}], 
          "\[RuleDelayed]", 
          RowBox[{"Dot", "[", 
           RowBox[{
            RowBox[{"Times", "[", "a", "]"}], ",", 
            RowBox[{"Cm", "[", "i", "]"}], ",", 
            RowBox[{"Times", "[", "b", "]"}]}], "]"}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Remove", " ", "single", " ", "scalar", " ", "variables"}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"scalarQ", "[", "kxb", "]"}], "=", "True"}], ";", 
         RowBox[{
          RowBox[{"scalarQ", "[", "ky", "]"}], "=", "True"}], ";", 
         RowBox[{
          RowBox[{"scalarQ", "[", "_", "]"}], "=", "False"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"reynoldsStresses", " ", "=", " ", 
          RowBox[{"reynoldsStresses", "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"Dot", "[", 
               RowBox[{
                RowBox[{"a_", "?", "scalarQ"}], ",", 
                RowBox[{"Cm", "[", "i__", "]"}], ",", "b_"}], "]"}], 
              "\[RuleDelayed]", 
              RowBox[{"Dot", "[", 
               RowBox[{
                RowBox[{"Cm", "[", "i", "]"}], ",", 
                RowBox[{"a", " ", "b"}]}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"Dot", "[", 
               RowBox[{"a_", ",", 
                RowBox[{"Cm", "[", "i__", "]"}], ",", 
                RowBox[{"b_", "?", "scalarQ"}]}], "]"}], "\[RuleDelayed]", 
              RowBox[{"Dot", "[", 
               RowBox[{
                RowBox[{"a", " ", "b"}], ",", 
                RowBox[{"Cm", "[", "i", "]"}]}], "]"}]}]}], "}"}]}]}], ";"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Print", "@", 
        RowBox[{
        "reynoldsStresses", "\[LeftDoubleBracket]", "1", 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Find", " ", "coefficients", " ", "to", " ", "precalculate"}],
         " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"coeffList", "=", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{
          RowBox[{"Union", "@", 
           RowBox[{"Flatten", "@", 
            RowBox[{"Cases", "[", 
             RowBox[{"reynoldsStresses", ",", 
              RowBox[{
               RowBox[{"Dot", "[", 
                RowBox[{"coeff1_", ",", " ", 
                 RowBox[{"Cm", "[", 
                  RowBox[{"i1_", ",", "i2_"}], "]"}], ",", "coeff2_"}], "]"}],
                "\[RuleDelayed]", 
               RowBox[{"{", 
                RowBox[{"coeff1", ",", "coeff2"}], "}"}]}], ",", 
              "\[Infinity]"}], "]"}]}]}], ",", 
          RowBox[{"1", "|", 
           RowBox[{"-", "1"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"coeffList", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "/.", 
           RowBox[{"coeff_", "\[RuleDelayed]", 
            RowBox[{"Rule", "[", 
             RowBox[{"coeff", ",", 
              RowBox[{"\"\<rey_\>\"", "<>", 
               RowBox[{"convertProdToString", "[", "coeff", "]"}]}]}], 
             "]"}]}]}], "&"}], "/@", "coeffList"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"coeffList", " ", "=", " ", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"Sort", "[", 
          RowBox[{"coeffList", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"StringLength", "[", 
              RowBox[{
              "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "]"}], ">", 
             RowBox[{"StringLength", "[", 
              RowBox[{
              "#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "]"}]}], "&"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"cppVariables", " ", "=", " ", 
        RowBox[{"coeffList", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Cm", "/:", 
        RowBox[{"toCString", "[", 
         RowBox[{"Cm", "[", 
          RowBox[{"i_", ",", "j_"}], "]"}], "]"}], ":=", 
        RowBox[{"\"\<C\>\"", "<>", 
         RowBox[{"ToString", "[", "i", "]"}], "<>", 
         RowBox[{"ToString", "[", "j", "]"}], "<>", "\"\<_\>\""}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Convert", " ", "everything", " ", "to", " ", "a", " ", "cpp", " ", 
         "string"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"reynoldsStresses", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"reynoldsStresses", "/.", "coeffList"}], "/.", 
           RowBox[{
            RowBox[{"Cm", "[", "i__", "]"}], "\[RuleDelayed]", 
            RowBox[{"toCString", "[", 
             RowBox[{"Cm", "[", "i", "]"}], "]"}]}]}], "//.", "dot1Rule"}], "/.", 
         RowBox[{
          RowBox[{"a_", "/;", 
           RowBox[{"MemberQ", "[", 
            RowBox[{"cppVariables", ",", "a"}], "]"}]}], "\[RuleDelayed]", 
          RowBox[{"a", "<>", "\"\<.asDiagonal()\>\""}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Very", " ", "ghetto", " ", "way", " ", "to", " ", "remove", " ", 
          "scalar", " ", "variables"}], ",", " ", 
         RowBox[{"just", " ", "getting", " ", "lazy"}], ",", " ", 
         RowBox[{"not", " ", "too", " ", "efficient"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"reynoldsStresses", " ", "=", " ", 
        RowBox[{"reynoldsStresses", "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
           "\"\<rey_Tkxb.asDiagonal()\>\"", "\[Rule]", "\"\<kxctmp_\>\""}], 
           ",", 
           RowBox[{
           "\"\<rey_Tky.asDiagonal()\>\"", "\[Rule]", "\"\<kyctmp_\>\""}]}], 
          "}"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"reynoldsStresses", " ", "=", " ", 
        RowBox[{"Map", "[", 
         RowBox[{"ToString", ",", 
          RowBox[{"reynoldsStresses", "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"Dot", "[", 
               RowBox[{"a_", ",", "C_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
              
              RowBox[{
              "a", "<>", "\"\<*\>\"", "<>", "C", "<>", "\"\<*\>\"", "<>", 
               "b"}]}], ",", 
             RowBox[{
              RowBox[{"Dot", "[", 
               RowBox[{"C_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
              RowBox[{"C", "<>", "\"\<*\>\"", "<>", "b"}]}], ",", 
             RowBox[{
              RowBox[{"Dot", "[", 
               RowBox[{"a_", ",", "C_"}], "]"}], "\[RuleDelayed]", 
              RowBox[{"a", "<>", "\"\<*\>\"", "<>", "C"}]}]}], "}"}]}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Assign", " ", "to", " ", "reynolds_mat", "_tmp", " ", 
         RowBox[{"(", 
          RowBox[{"need", " ", "to", " ", "take", " ", "fft", " ", "later"}], 
          ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"reynoldsStresses", "=", 
        RowBox[{
         RowBox[{"StringJoin", "@@", 
          RowBox[{"Riffle", "[", 
           RowBox[{
            RowBox[{"MapThread", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
               "#1", "<>", "\"\<reynolds_mat_tmp_ = \>\"", "<>", "#2"}], 
               "&"}], ",", 
              RowBox[{"{", 
               RowBox[{"reynoldsStressesLabels", ",", "reynoldsStresses"}], 
               "}"}]}], "]"}], ",", "\"\<;\\n\\n\\n\>\""}], "]"}]}], "<>", 
         "\"\<;\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", ";"}], 
     "\[IndentingNewLine]", ";", "\[IndentingNewLine]", "\[IndentingNewLine]",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Now", " ", "assign", " ", "to", " ", "the", " ", "temporary", " ", 
       "variables"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Form", " ", "the", " ", "variable", " ", "definitions"}], " ",
        "-", " ", 
       RowBox[{
       "the", " ", "functions", " ", "here", " ", "are", " ", "for", " ", 
        "pre"}], "-", 
       RowBox[{"defined", " ", "variables", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"e", ".", "g", "."}], ",", " ", "kxctmp_"}], ")"}], " ", 
        "not", " ", "the", " ", "automatically", " ", "generated", " ", 
        "ones"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"vecPreVarStringList", " ", "=", 
      RowBox[{
       RowBox[{"List", "@@", "vectorVars"}], "/.", "variablesInCpp"}]}], ";", 
     " ", 
     RowBox[{"(*", " ", 
      RowBox[{"List", " ", "of", " ", "vector", " ", "variables"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"scalarPreVarStringList", " ", "=", " ", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"variablesInCpp", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
        "vecPreVarStringList"}], "]"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{"List", " ", "of", " ", "vector", " ", "variables"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"vectorPreVarQ", " ", "=", " ", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "[", "vecPreVarStringList", "]"}], ";",
            "vecPreVarStringList"}], ")"}], ",", "#"}], "]"}], "&"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Returns", " ", "true", " ", "for", " ", "vector", " ", "variable"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"scalarPreVarQ", " ", "=", " ", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "[", "scalarPreVarStringList", "]"}], 
           ";", "scalarPreVarStringList"}], ")"}], ",", "#"}], "]"}], " ", 
       "&"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Returns", " ", "true", " ", "for", " ", "scalar", " ", "variable"}], 
      " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Ghetto", " ", "removal", " ", "of", " ", "scalars"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Print", "[", "coeffList", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"coeffList", " ", "=", " ", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{"coeffList", ",", 
        RowBox[{"Rule", "[", 
         RowBox[{"_", ",", 
          RowBox[{"Alternatives", "@@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\"\<rey_\>\"", "<>", 
                RowBox[{"convertProdToString", "[", "#", "]"}]}], ")"}], 
              "&"}], "/@", 
             RowBox[{"{", 
              RowBox[{"kxb", ",", "ky"}], "}"}]}], ")"}]}]}], "]"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"cppVariables", " ", "=", " ", 
      RowBox[{"coeffList", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Collect", " ", "matrix", " ", "bits", " ", "together"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", " ", 
           RowBox[{"Reverse", "/@", "coeffList"}], ")"}], "/.", 
          "variablesInCpp"}], "/.", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"a_", "?", "vectorPreVarQ"}], "^", "n_"}], 
          "\[RuleDelayed]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"tmp", " ", "=", " ", 
             RowBox[{"a", "<>", "\"\<.pow(\>\"", "<>", 
              RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<)\>\""}]}], ";", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"vecPreVarStringList", ",", "tmp"}], "]"}], ";", "tmp"}],
            ")"}]}]}], "/.", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"a_", "?", "vectorPreVarQ"}], "  ", 
          RowBox[{"b_", "?", "vectorPreVarQ"}]}], "\[RuleDelayed]", 
         RowBox[{
         "\"\<(\>\"", "<>", "a", "<>", "\"\<*\>\"", "<>", "b", "<>", 
          "\"\<).matrix()\>\""}]}]}], "/.", 
       RowBox[{
        RowBox[{"a_", "?", "vectorPreVarQ"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", "\"\<.matrix()\>\""}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Collect", " ", "scalar", " ", "bits", " ", "together"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"fullCppVaribles", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"a_", "?", "scalarPreVarQ"}], "^", "n_"}], 
           "\[RuleDelayed]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"tmp", "=", 
              RowBox[{"\"\<pow(\>\"", "<>", 
               RowBox[{"ToString", "[", "a", "]"}], "<>", "\"\<,\>\"", "<>", 
               RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<)\>\""}]}], 
             ";", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"scalarPreVarStringList", ",", "tmp"}], "]"}], ";", 
             "tmp"}], ")"}]}]}], "/.", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"a_", "?", "scalarPreVarQ"}], " ", 
           RowBox[{"b_", "?", "scalarPreVarQ"}]}], "\[RuleDelayed]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"scalarPreVarStringList", ",", 
              RowBox[{
              "\"\<(\>\"", "<>", "a", "<>", "\"\<*\>\"", "<>", "b", "<>", 
               "\"\<)\>\""}]}], "]"}], ";", 
            RowBox[{
            "\"\<(\>\"", "<>", "a", "<>", "\"\<*\>\"", "<>", "b", "<>", 
             "\"\<)\>\""}]}], ")"}]}]}], "/.", 
        RowBox[{
         RowBox[{
          RowBox[{"n_", "?", "NumericQ"}], " ", 
          RowBox[{"a_", "?", "scalarPreVarQ"}]}], "\[RuleDelayed]", 
         RowBox[{"\"\<(\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"N", "[", "n", "]"}], "]"}], "<>", "\"\<*\>\"", "<>", "a", 
          "<>", "\"\<)\>\""}]}]}], "/.", 
       RowBox[{
        RowBox[{
         RowBox[{"n_", "?", "NumericQ"}], " ", "b_String"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"ToString", "[", 
          RowBox[{"N", "[", "n", "]"}], "]"}], "<>", "\"\<*\>\"", "<>", 
         "b"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{"fullCppVaribles", "/.", 
       RowBox[{
        RowBox[{"a_String", " ", "b_String"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", "\"\<*\>\"", "<>", "b"}]}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Declare", " ", "in", " ", "class", " ", "definition"}], "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"classVariableDec", " ", "=", " ", 
      RowBox[{"\"\<dcmplxVecM \>\"", "<>", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{"cppVariables", ",", "\"\<, \>\""}], "]"}]}], "<>", 
       "\"\<;\\n\\n\>\""}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Assign", " ", "memory", " ", "to", " ", "variables", " ", "in", " ", 
       "class", " ", "constructor"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"classConstrAssignMem", " ", "=", 
      RowBox[{
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "<>", "\"\< = dcmplxVecM(NZ_);\\n\>\""}], "&"}], "/@",
           "cppVariables"}], ")"}]}], "<>", "\"\<\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Assign", " ", "variables", " ", "inside", " ", "the", " ", 
       "equations"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"assignCppVarsInEqs", " ", "=", 
      RowBox[{
      "\"\<// Vector variable definition Reynolds stress (automatic)\\n\>\"", 
       "<>", " ", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "<>", "\"\< = \>\"", " ", "<>", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "<>", "\"\<;\\n\>\""}], "&"}], "/@", "fullCppVaribles"}], 
         ")"}]}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"fullSavedOutputReynolds", " ", "=", " ", 
      RowBox[{
      "\"\<// Automatically generated temporary variables - class \
definition\\n\>\"", "<>", "\[IndentingNewLine]", "classVariableDec", "<>", 
       "\"\<\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
       "\"\<// Automatically generated temporary variables - class \
constructor\\n\>\"", "<>", "\[IndentingNewLine]", "classConstrAssignMem", 
       "<>", "\"\<\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
       "\"\<//Assign automatically generated variables in equations \\n\>\"", 
       "<>", "\[IndentingNewLine]", "assignCppVarsInEqs", "<>", 
       "\"\<\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
       "\"\<////////////////////////////////////////////////////////\\n\>\"", 
       "<>", "\[IndentingNewLine]", 
       "\"\<///  AUTOMATICALLY GENERATED REYNOLDS STRESSES      /////\\n\>\"",
        "<>", "\[IndentingNewLine]", 
       "\"\<///       see GenerateC++Equations.nb in MMA        /////\\n\\n\>\
\"", "<>", "\[IndentingNewLine]", "reynoldsStresses", "<>", 
       "\[IndentingNewLine]", 
       "\"\</// AUTOMATICALLY GENERATED REYNOLDS STRESSES - END /////\\n\>\"",
        "<>", "\[IndentingNewLine]", 
       "\"\<////////////////////////////////////////////////////////\\n\>\""}]\
}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
    "SAVE", " ", "ALL", " ", "THIS", " ", "STUFF", " ", "TO", " ", "FILE"}], 
    " ", "*)"}],
   FontColor->RGBColor[0.5, 0, 0.5]]}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{
  "\"\<~/Documents/MRIDSS/Mathematica/MMA_Generated_ReynoldsStresses.cpp\>\"",
    ",", "\[IndentingNewLine]", "fullSavedOutputReynolds", ",", 
   "\[IndentingNewLine]", "\"\<Text\>\""}], "]"}]}], "Input",
 CellChangeTimes->{{3.614954140890256*^9, 3.614954254156444*^9}, {
   3.614954297234413*^9, 3.614954359170815*^9}, {3.614954507173497*^9, 
   3.614954691598151*^9}, {3.614966271743904*^9, 3.614966384474889*^9}, {
   3.614966420658431*^9, 3.614966468833269*^9}, {3.614966521538568*^9, 
   3.614966525648926*^9}, {3.614966556973939*^9, 3.614966558812303*^9}, {
   3.614966893756914*^9, 3.614966978883154*^9}, {3.614967025194991*^9, 
   3.614967070065365*^9}, {3.614967106601871*^9, 3.614967109658472*^9}, {
   3.614967212517124*^9, 3.614967254546564*^9}, {3.614967327599065*^9, 
   3.6149674446627607`*^9}, {3.614967513779579*^9, 3.6149676977936573`*^9}, {
   3.6149678355333023`*^9, 3.614967862002326*^9}, {3.614968897435368*^9, 
   3.6149689936592093`*^9}, 3.614969101219598*^9, {3.614969195092318*^9, 
   3.614969286658963*^9}, {3.614969553946069*^9, 3.6149697213403883`*^9}, {
   3.614969752777896*^9, 3.614969757008914*^9}, {3.614969792086261*^9, 
   3.6149698527982073`*^9}, {3.614970138027603*^9, 3.6149701684432383`*^9}, {
   3.614970361085209*^9, 3.614970361555359*^9}, {3.6149705706398973`*^9, 
   3.6149705940414667`*^9}, {3.614970634895241*^9, 3.614970642807794*^9}, {
   3.614970698416541*^9, 3.614970709359087*^9}, {3.61497091702547*^9, 
   3.6149709201656637`*^9}, {3.614971058131727*^9, 3.6149711955476437`*^9}, {
   3.614971242060709*^9, 3.614971355236931*^9}, {3.614971472920533*^9, 
   3.6149716486922626`*^9}, {3.6149717360409603`*^9, 3.614971737671545*^9}, 
   3.614971773686449*^9, {3.6149718752630367`*^9, 3.61497205271235*^9}, {
   3.614972131149613*^9, 3.614972284262714*^9}, {3.614972315801504*^9, 
   3.614972318552045*^9}, {3.614972379225976*^9, 3.6149723837526283`*^9}, {
   3.614972414206048*^9, 3.614972423614871*^9}, {3.6149869890088453`*^9, 
   3.61498704598812*^9}, {3.6149873751290197`*^9, 3.614987468381742*^9}, {
   3.614987538417439*^9, 3.614987566004695*^9}, {3.614987615994206*^9, 
   3.6149876199139*^9}, {3.614987669528802*^9, 3.6149877570853233`*^9}, {
   3.614987850734271*^9, 3.6149878879390907`*^9}, {3.6150274066311073`*^9, 
   3.615027666723768*^9}, {3.615027702115666*^9, 3.615027755156046*^9}, {
   3.615028018055396*^9, 3.615028047983551*^9}, {3.615028093241024*^9, 
   3.6150283358942623`*^9}, {3.615028394058867*^9, 3.615028687939126*^9}, {
   3.615028731522182*^9, 3.615028731672833*^9}, {3.615028784139933*^9, 
   3.615028814207711*^9}, {3.615028892339262*^9, 3.615028922359234*^9}, {
   3.6150293281934977`*^9, 3.615029344930874*^9}, {3.6150294321851873`*^9, 
   3.6150294882932367`*^9}, {3.615029551919859*^9, 3.615029595320745*^9}, {
   3.615029695557748*^9, 3.6150297378843193`*^9}, {3.615029869125358*^9, 
   3.6150298723884563`*^9}, {3.615029912896887*^9, 3.615029925075115*^9}, {
   3.61502995690983*^9, 3.615029971830276*^9}, 3.615030249915057*^9, {
   3.6150302990319557`*^9, 3.6150303154977713`*^9}, {3.615030358476726*^9, 
   3.615030367335416*^9}, {3.615030410950201*^9, 3.615030528064905*^9}, {
   3.615030560444873*^9, 3.615030676804809*^9}, {3.615031455139426*^9, 
   3.615031528050686*^9}, {3.615031566790921*^9, 3.6150315683092747`*^9}, {
   3.615036379847866*^9, 3.6150364794466343`*^9}, {3.615042902219393*^9, 
   3.615042924434169*^9}, {3.615043212898203*^9, 3.615043222192498*^9}, {
   3.615043656938156*^9, 3.615043692974873*^9}, {3.615048128657043*^9, 
   3.61504814986946*^9}, {3.6150484112742167`*^9, 3.61504843290022*^9}, {
   3.615048473932034*^9, 3.6150486023687487`*^9}, {3.6150486507273912`*^9, 
   3.615048676229186*^9}, {3.6150488107225533`*^9, 3.615048821022482*^9}, {
   3.615048872730873*^9, 3.6150488854228897`*^9}, 3.615048995601192*^9, {
   3.615049139915153*^9, 3.6150492342634087`*^9}, {3.615049272875079*^9, 
   3.615049288804282*^9}, {3.61504937390134*^9, 3.615049458665628*^9}, {
   3.6150495131727333`*^9, 3.615049537582659*^9}, {3.615049580042758*^9, 
   3.615049632167449*^9}, {3.631019203208091*^9, 3.631019242264917*^9}, {
   3.631019274103209*^9, 3.631019288042337*^9}, {3.631019528552754*^9, 
   3.631019534746839*^9}, {3.6310199669118643`*^9, 3.631019968479347*^9}, {
   3.653931918649941*^9, 3.653932029537806*^9}}],

Cell[CellGroupData[{

Cell[BoxData["0"], "Print",
 CellChangeTimes->{{3.615049618262972*^9, 3.615049632898081*^9}, 
   3.631019151438381*^9, 3.631019212467914*^9, 3.631019243645279*^9, 
   3.631019289930953*^9, 3.631019760397934*^9, 3.631019867384573*^9, 
   3.6310199689402323`*^9, 3.6539308880393343`*^9, {3.653932013976221*^9, 
   3.653932030143343*^9}}],

Cell[BoxData["0"], "Print",
 CellChangeTimes->{{3.615049618262972*^9, 3.615049632898081*^9}, 
   3.631019151438381*^9, 3.631019212467914*^9, 3.631019243645279*^9, 
   3.631019289930953*^9, 3.631019760397934*^9, 3.631019867384573*^9, 
   3.6310199689402323`*^9, 3.6539308880393343`*^9, {3.653932013976221*^9, 
   3.6539320301565123`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], " ", 
     SuperscriptBox[
      SubscriptBox["\[EmptyUpTriangle]", "2"], 
      RowBox[{"-", "1"}]], " ", 
     OverscriptBox[
      SubscriptBox["k", "x"], "\[LongDash]"], " ", 
     SubscriptBox["k", "y"]}], "\[Rule]", "\<\"rey_TdzTiLap2TkxbTky\"\>"}], 
   ",", 
   RowBox[{
    RowBox[{
     SuperscriptBox[
      SubscriptBox["\[EmptyUpTriangle]", "2"], 
      RowBox[{"-", "1"}]], " ", 
     OverscriptBox[
      SubscriptBox["k", "x"], "\[LongDash]"], " ", 
     SubsuperscriptBox["k", "y", "2"]}], 
    "\[Rule]", "\<\"rey_TiLap2TkxbTkyP2\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SuperscriptBox[
      SubscriptBox["\[EmptyUpTriangle]", "2"], 
      RowBox[{"-", "1"}]], " ", 
     SuperscriptBox[
      OverscriptBox[
       SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
     SubscriptBox["k", "y"]}], "\[Rule]", "\<\"rey_TiLap2TkxbP2Tky\"\>"}], 
   ",", 
   RowBox[{
    RowBox[{
     SuperscriptBox[
      SubscriptBox["\[EmptyUpTriangle]", "2"], 
      RowBox[{"-", "1"}]], " ", 
     OverscriptBox[
      SubscriptBox["k", "x"], "\[LongDash]"], " ", 
     SubscriptBox["k", "y"]}], "\[Rule]", "\<\"rey_TiLap2TkxbTky\"\>"}], ",", 
   
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], " ", 
     SuperscriptBox[
      SubscriptBox["\[EmptyUpTriangle]", "2"], 
      RowBox[{"-", "1"}]], " ", 
     OverscriptBox[
      SubscriptBox["k", "x"], "\[LongDash]"]}], 
    "\[Rule]", "\<\"rey_TdzTiLap2Tkxb\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], " ", 
     SuperscriptBox[
      SubscriptBox["\[EmptyUpTriangle]", "2"], 
      RowBox[{"-", "1"}]], " ", 
     SubscriptBox["k", "y"]}], "\[Rule]", "\<\"rey_TdzTiLap2Tky\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
     SuperscriptBox[
      SubscriptBox["\[EmptyUpTriangle]", "2"], 
      RowBox[{"-", "1"}]]}], "\[Rule]", "\<\"rey_TdzP2TiLap2\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SuperscriptBox[
      SubscriptBox["\[EmptyUpTriangle]", "2"], 
      RowBox[{"-", "1"}]], " ", 
     SubscriptBox["k", "y"]}], "\[Rule]", "\<\"rey_TiLap2Tky\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], " ", 
     SuperscriptBox[
      SubscriptBox["\[EmptyUpTriangle]", "2"], 
      RowBox[{"-", "1"}]]}], "\[Rule]", "\<\"rey_TdzTiLap2\"\>"}], ",", 
   RowBox[{
    OverscriptBox[
     SubscriptBox["k", "x"], "\[LongDash]"], "\[Rule]", "\<\"rey_Tkxb\"\>"}], 
   ",", 
   RowBox[{
    SubscriptBox["k", "y"], "\[Rule]", "\<\"rey_Tky\"\>"}], ",", 
   RowBox[{
    SubscriptBox["\[PartialD]", "z"], "\[Rule]", "\<\"rey_Tdz\"\>"}]}], 
  "}"}]], "Print",
 CellChangeTimes->{{3.615049618262972*^9, 3.615049632898081*^9}, 
   3.631019151438381*^9, 3.631019212467914*^9, 3.631019243645279*^9, 
   3.631019289930953*^9, 3.631019760397934*^9, 3.631019867384573*^9, 
   3.6310199689402323`*^9, 3.6539308880393343`*^9, {3.653932013976221*^9, 
   3.653932030169723*^9}}]
}, Open  ]],

Cell[BoxData["\<\"// Automatically generated temporary variables - class \
definition\\ndcmplxVecM rey_TdzTiLap2TkxbTky, rey_TiLap2TkxbTkyP2, \
rey_TiLap2TkxbP2Tky, rey_TiLap2TkxbTky, rey_TdzTiLap2Tkxb, rey_TdzTiLap2Tky, \
rey_TdzP2TiLap2, rey_TiLap2Tky, rey_TdzTiLap2, rey_Tdz;\\n\\n\\n\\n\\n// \
Automatically generated temporary variables - class \
constructor\\nrey_TdzTiLap2TkxbTky = dcmplxVecM(NZ_);\\nrey_TiLap2TkxbTkyP2 = \
dcmplxVecM(NZ_);\\nrey_TiLap2TkxbP2Tky = dcmplxVecM(NZ_);\\nrey_TiLap2TkxbTky \
= dcmplxVecM(NZ_);\\nrey_TdzTiLap2Tkxb = dcmplxVecM(NZ_);\\nrey_TdzTiLap2Tky \
= dcmplxVecM(NZ_);\\nrey_TdzP2TiLap2 = dcmplxVecM(NZ_);\\nrey_TiLap2Tky = \
dcmplxVecM(NZ_);\\nrey_TdzTiLap2 = dcmplxVecM(NZ_);\\nrey_Tdz = \
dcmplxVecM(NZ_);\\n\\n\\n\\n\\n//Assign automatically generated variables in \
equations \\n// Vector variable definition Reynolds stress \
(automatic)\\nrey_TdzTiLap2TkxbTky = \
(ilap2tmp_.cast<dcmplx>()*kz_).matrix()*(kxctmp_*kyctmp_);\\nrey_\
TiLap2TkxbTkyP2 = ilap2tmp_.cast<dcmplx>().matrix()*(kxctmp_*pow(kyctmp_,2));\
\\nrey_TiLap2TkxbP2Tky = \
ilap2tmp_.cast<dcmplx>().matrix()*(kyctmp_*pow(kxctmp_,2));\\nrey_\
TiLap2TkxbTky = \
ilap2tmp_.cast<dcmplx>().matrix()*(kxctmp_*kyctmp_);\\nrey_TdzTiLap2Tkxb = \
(ilap2tmp_.cast<dcmplx>()*kz_).matrix()*kxctmp_;\\nrey_TdzTiLap2Tky = \
(ilap2tmp_.cast<dcmplx>()*kz_).matrix()*kyctmp_;\\nrey_TdzP2TiLap2 = \
(ilap2tmp_.cast<dcmplx>()*kz_.pow(2)).matrix();\\nrey_TiLap2Tky = \
ilap2tmp_.cast<dcmplx>().matrix()*kyctmp_;\\nrey_TdzTiLap2 = \
(ilap2tmp_.cast<dcmplx>()*kz_).matrix();\\nrey_Tdz = \
kz_.matrix();\\n\\n\\n\\n/////////////////////////////////////////////////////\
///\\n///  AUTOMATICALLY GENERATED REYNOLDS STRESSES      /////\\n///       \
see GenerateC++Equations.nb in MMA        /////\\n\\n// Bx reynolds \
stress\\nreynolds_mat_tmp_ = 0;\\n\\n\\n// By reynolds \
stress\\nreynolds_mat_tmp_ = 0;\\n\\n\\n// Ux reynolds \
stress\\nreynolds_mat_tmp_ = -kxctmp_*C11_ + \
kyctmp_*C11_*rey_TiLap2TkxbTky.asDiagonal() + \
kyctmp_*C12_*rey_TdzTiLap2.asDiagonal() + \
rey_Tdz.asDiagonal()*C11_*rey_TdzTiLap2Tkxb.asDiagonal() - \
rey_Tdz.asDiagonal()*C12_*rey_TiLap2Tky.asDiagonal();\\n\\n\\n// Uy reynolds \
stress\\nreynolds_mat_tmp_ = \
rey_TdzP2TiLap2.asDiagonal()*C21_*rey_TdzTiLap2Tkxb.asDiagonal() - \
rey_TdzP2TiLap2.asDiagonal()*C22_*rey_TiLap2Tky.asDiagonal() - \
rey_TdzTiLap2Tkxb.asDiagonal()*C21_ - \
rey_TdzTiLap2TkxbTky.asDiagonal()*C11_*rey_TdzTiLap2Tkxb.asDiagonal() + \
rey_TdzTiLap2TkxbTky.asDiagonal()*C12_*rey_TiLap2Tky.asDiagonal() + \
rey_TdzTiLap2Tky.asDiagonal()*C21_*rey_TiLap2TkxbTky.asDiagonal() + \
rey_TdzTiLap2Tky.asDiagonal()*C22_*rey_TdzTiLap2.asDiagonal() + \
rey_TiLap2TkxbP2Tky.asDiagonal()*C11_ - \
rey_TiLap2TkxbTkyP2.asDiagonal()*C11_*rey_TiLap2TkxbTky.asDiagonal() - \
rey_TiLap2TkxbTkyP2.asDiagonal()*C12_*rey_TdzTiLap2.asDiagonal();\\n\\n/// \
AUTOMATICALLY GENERATED REYNOLDS STRESSES - END \
/////\\n////////////////////////////////////////////////////////\\n\"\>"], \
"Output",
 CellChangeTimes->{
  3.615029595993595*^9, {3.615029712175734*^9, 3.615029738702917*^9}, 
   3.6150298308186693`*^9, 3.615030536672903*^9, {3.615030568803341*^9, 
   3.6150305833510027`*^9}, 3.615030644992588*^9, 3.615030678927168*^9, 
   3.615031531480201*^9, 3.615031569368704*^9, 3.6150326956315928`*^9, 
   3.615036537181931*^9, {3.6150428870417*^9, 3.615042933512992*^9}, 
   3.615043225702456*^9, {3.615043679981806*^9, 3.615043697942257*^9}, 
   3.615048150879539*^9, 3.615048603631291*^9, {3.6150486600820303`*^9, 
   3.615048677008074*^9}, 3.6150488228440742`*^9, 3.6150489963667183`*^9, 
   3.615049234908379*^9, 3.615049459688321*^9, {3.615049602342572*^9, 
   3.6150496329054737`*^9}, 3.631019151735819*^9, 3.631019212740511*^9, 
   3.631019243895255*^9, 3.631019290161447*^9, 3.6310197606159067`*^9, 
   3.631019867402804*^9, 3.631019968976179*^9, 3.6539308880744247`*^9, {
   3.6539320142481728`*^9, 3.653932030183943*^9}}],

Cell[BoxData["\<\"~/Documents/MRIDSS/Mathematica/MMA_Generated_\
ReynoldsStresses.cpp\"\>"], "Output",
 CellChangeTimes->{
  3.615029595993595*^9, {3.615029712175734*^9, 3.615029738702917*^9}, 
   3.6150298308186693`*^9, 3.615030536672903*^9, {3.615030568803341*^9, 
   3.6150305833510027`*^9}, 3.615030644992588*^9, 3.615030678927168*^9, 
   3.615031531480201*^9, 3.615031569368704*^9, 3.6150326956315928`*^9, 
   3.615036537181931*^9, {3.6150428870417*^9, 3.615042933512992*^9}, 
   3.615043225702456*^9, {3.615043679981806*^9, 3.615043697942257*^9}, 
   3.615048150879539*^9, 3.615048603631291*^9, {3.6150486600820303`*^9, 
   3.615048677008074*^9}, 3.6150488228440742`*^9, 3.6150489963667183`*^9, 
   3.615049234908379*^9, 3.615049459688321*^9, {3.615049602342572*^9, 
   3.6150496329054737`*^9}, 3.631019151735819*^9, 3.631019212740511*^9, 
   3.631019243895255*^9, 3.631019290161447*^9, 3.6310197606159067`*^9, 
   3.631019867402804*^9, 3.631019968976179*^9, 3.6539308880744247`*^9, {
   3.6539320142481728`*^9, 3.653932030195071*^9}}]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.615031428745222*^9, 3.615031439820664*^9}}],

Cell[CellGroupData[{

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.615045175606947*^9, 3.615045223495364*^9}}],

Cell[BoxData["$Aborted"], "Output",
 CellChangeTimes->{{3.615045194995625*^9, 3.615045214112916*^9}}]
}, Open  ]]
}, Closed]]
}, Open  ]]
},
WindowSize->{1093, 846},
WindowMargins->{{Automatic, 92}, {Automatic, 0}},
FrontEndVersion->"10.1 for Mac OS X x86 (32-bit, 64-bit Kernel) (March 23, \
2015)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 105, 1, 92, "Title"],
Cell[687, 25, 239, 4, 81, "Subtitle"],
Cell[CellGroupData[{
Cell[951, 33, 179, 3, 64, "Section",
 InitializationGroup->True],
Cell[CellGroupData[{
Cell[1155, 40, 271, 5, 35, "Subsubsection",
 InitializationGroup->True],
Cell[1429, 47, 22845, 590, 1939, "Input",
 InitializationGroup->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[24311, 642, 207, 3, 35, "Subsubsection",
 InitializationGroup->True],
Cell[24521, 647, 8923, 223, 403, "Input",
 InitializationGroup->True],
Cell[33447, 872, 355, 7, 49, "Text"],
Cell[33805, 881, 4867, 129, 335, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[38709, 1015, 107, 1, 35, "Subsubsection"],
Cell[38819, 1018, 4779, 118, 386, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[43647, 1142, 105, 1, 64, "Section"],
Cell[43755, 1145, 299, 8, 34, "Text"],
Cell[CellGroupData[{
Cell[44079, 1157, 104, 1, 44, "Subsection"],
Cell[CellGroupData[{
Cell[44208, 1162, 21730, 534, 1068, "Input"],
Cell[65941, 1698, 9623, 264, 113, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[75613, 1968, 223, 4, 44, "Subsection"],
Cell[CellGroupData[{
Cell[75861, 1976, 3564, 86, 165, "Input"],
Cell[79428, 2064, 2353, 52, 28, "Output"],
Cell[81784, 2118, 29798, 773, 420, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[111631, 2897, 165, 3, 36, "Subsection"],
Cell[CellGroupData[{
Cell[111821, 2904, 176, 3, 35, "Subsubsection"],
Cell[CellGroupData[{
Cell[112022, 2911, 2821, 72, 199, "Input"],
Cell[114846, 2985, 1247, 27, 35, "Output"],
Cell[116096, 3014, 1368, 29, 42, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[117513, 3049, 282, 5, 29, "Subsubsection"],
Cell[117798, 3056, 30582, 710, 1916, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[148417, 3771, 174, 2, 29, "Subsubsection"],
Cell[CellGroupData[{
Cell[148616, 3777, 19730, 431, 1389, "Input"],
Cell[168349, 4210, 1020, 15, 28, "Output"]
}, Closed]]
}, Closed]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[169442, 4233, 156, 2, 50, "Section"],
Cell[169601, 4237, 398, 10, 34, "Text"],
Cell[CellGroupData[{
Cell[170024, 4251, 104, 1, 44, "Subsection"],
Cell[CellGroupData[{
Cell[170153, 4256, 25163, 620, 1213, "Input"],
Cell[195319, 4878, 19930, 539, 132, "Output"],
Cell[215252, 5419, 2409, 56, 27, "Print"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[217710, 5481, 223, 4, 44, "Subsection"],
Cell[CellGroupData[{
Cell[217958, 5489, 3564, 86, 165, "Input"],
Cell[221525, 5577, 2614, 56, 28, "Output"],
Cell[224142, 5635, 25068, 657, 322, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[249259, 6298, 165, 3, 36, "Subsection"],
Cell[CellGroupData[{
Cell[249449, 6305, 176, 3, 35, "Subsubsection"],
Cell[CellGroupData[{
Cell[249650, 6312, 2918, 74, 216, "Input"],
Cell[252571, 6388, 3174, 82, 57, "Output"],
Cell[255748, 6472, 1589, 32, 42, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[257386, 6510, 282, 5, 29, "Subsubsection"],
Cell[257671, 6517, 30582, 710, 1916, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[288290, 7232, 174, 2, 35, "Subsubsection"],
Cell[CellGroupData[{
Cell[288489, 7238, 20023, 435, 1389, "Input"],
Cell[308515, 7675, 1342, 19, 28, "Output"]
}, Open  ]]
}, Open  ]]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[309930, 7702, 208, 3, 50, "Section"],
Cell[310141, 7707, 539, 13, 34, "Text"],
Cell[CellGroupData[{
Cell[310705, 7724, 104, 1, 44, "Subsection"],
Cell[CellGroupData[{
Cell[310834, 7729, 36, 0, 28, "Input"],
Cell[310873, 7731, 1378, 46, 36, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[312288, 7782, 525, 16, 28, "Input"],
Cell[312816, 7800, 4065, 143, 80, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[316918, 7948, 29057, 720, 1267, "Input"],
Cell[345978, 8670, 2676, 83, 53, "Print"],
Cell[348657, 8755, 37287, 1022, 132, "Output"],
Cell[385947, 9779, 2807, 76, 42, "Print"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[388803, 9861, 223, 4, 44, "Subsection"],
Cell[CellGroupData[{
Cell[389051, 9869, 3564, 86, 165, "Input"],
Cell[392618, 9957, 2470, 54, 28, "Output"],
Cell[395091, 10013, 107014, 2745, 1657, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[502154, 12764, 165, 3, 36, "Subsection"],
Cell[CellGroupData[{
Cell[502344, 12771, 176, 3, 35, "Subsubsection"],
Cell[CellGroupData[{
Cell[502545, 12778, 2821, 72, 199, "Input"],
Cell[505369, 12852, 4990, 139, 99, "Output"],
Cell[510362, 12993, 1440, 30, 42, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[511851, 13029, 282, 5, 29, "Subsubsection"],
Cell[512136, 13036, 30582, 710, 1916, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[542755, 13751, 174, 2, 29, "Subsubsection"],
Cell[CellGroupData[{
Cell[542954, 13757, 20076, 436, 1389, "Input"],
Cell[563033, 14195, 1249, 18, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[564319, 14218, 109, 1, 28, "Input"],
Cell[564431, 14221, 25636, 393, 10110, "Output"]
}, Open  ]]
}, Closed]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[590140, 14622, 161, 2, 50, "Section"],
Cell[590304, 14626, 508, 15, 34, "Text"],
Cell[CellGroupData[{
Cell[590837, 14645, 104, 1, 44, "Subsection"],
Cell[CellGroupData[{
Cell[590966, 14650, 106, 1, 28, "Input"],
Cell[591075, 14653, 6155, 204, 159, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[597267, 14862, 525, 16, 28, "Input"],
Cell[597795, 14880, 1904, 63, 36, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[599736, 14948, 28219, 689, 1250, "Input"],
Cell[627958, 15639, 2328, 75, 53, "Print"],
Cell[630289, 15716, 11337, 312, 78, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[641675, 16034, 223, 4, 44, "Subsection"],
Cell[CellGroupData[{
Cell[641923, 16042, 3564, 86, 165, "Input"],
Cell[645490, 16130, 1336, 27, 28, "Output"],
Cell[646829, 16159, 17703, 440, 274, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[664581, 16605, 165, 3, 36, "Subsection"],
Cell[CellGroupData[{
Cell[664771, 16612, 176, 3, 35, "Subsubsection"],
Cell[CellGroupData[{
Cell[664972, 16619, 2952, 75, 216, "Input"],
Cell[667927, 16696, 2916, 74, 70, "Output"],
Cell[670846, 16772, 1652, 33, 70, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[672547, 16811, 282, 5, 29, "Subsubsection"],
Cell[672832, 16818, 30582, 710, 1916, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[703451, 17533, 174, 2, 35, "Subsubsection"],
Cell[CellGroupData[{
Cell[703650, 17539, 20192, 437, 1389, "Input"],
Cell[723845, 17978, 1389, 20, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[725271, 18003, 44, 0, 28, "Input"],
Cell[725318, 18005, 1553, 24, 471, "Output"]
}, Open  ]]
}, Closed]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[726944, 18037, 102, 1, 64, "Section"],
Cell[CellGroupData[{
Cell[727071, 18042, 1631, 41, 148, "Input"],
Cell[728705, 18085, 707, 19, 42, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[729449, 18109, 36300, 822, 2376, "Input"],
Cell[CellGroupData[{
Cell[765774, 18935, 335, 5, 21, "Print"],
Cell[766112, 18942, 337, 5, 21, "Print"],
Cell[766452, 18949, 3049, 88, 88, "Print"]
}, Open  ]],
Cell[769516, 19040, 3950, 61, 1168, "Output"],
Cell[773469, 19103, 1041, 15, 28, "Output"]
}, Open  ]],
Cell[774525, 19121, 92, 1, 28, "Input"],
Cell[CellGroupData[{
Cell[774642, 19126, 92, 1, 28, "Input"],
Cell[774737, 19129, 101, 1, 28, "Output"]
}, Open  ]]
}, Closed]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
