(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[    159618,       4064]
NotebookOptionsPosition[    156624,       3958]
NotebookOutlinePosition[    156977,       3974]
CellTagsIndexPosition[    156934,       3971]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Generate c++ equations", "Title",
 CellChangeTimes->{{3.613285659385439*^9, 3.613285672183166*^9}}],

Cell["\<\
A notebook to automatically generate the complex equations (in c++ syntax) \
required for CE2 implementations of the shearing box MHD equations\
\>", "Subtitle",
 CellChangeTimes->{{3.613285678399642*^9, 3.6132857387259073`*^9}}],

Cell[CellGroupData[{

Cell["Initialization", "Section",
 InitializationGroup->True,
 CellChangeTimes->{{3.61328575477813*^9, 3.6132857579772587`*^9}, {
  3.613289305138309*^9, 3.6132893099360237`*^9}}],

Cell[CellGroupData[{

Cell["Load packages, set notation, define derivative operators", \
"Subsubsection",
 InitializationGroup->True,
 CellChangeTimes->{{3.61328647880902*^9, 3.6132864845926*^9}, {
  3.61328657764961*^9, 3.613286579073427*^9}, {3.614183666778463*^9, 
  3.614183671737118*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Load", " ", "Notation"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "Notation`AutoLoadNotationPalette", "}"}], ",", "\n", "\t", 
     
     RowBox[{
      RowBox[{"Notation`AutoLoadNotationPalette", "=", "False"}], ";", "\n", 
      "\t", 
      RowBox[{"Needs", "[", "\"\<Notation`\>\"", "]"}], ";"}]}], "\n", "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{OverscriptBox["\[Nu]", "\[Dash]"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"\[Nu]b"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{OverscriptBox["\[Eta]", "\[LongDash]"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"\[Eta]b"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SuperscriptBox[
         SubscriptBox["\[EmptyUpTriangle]", "2"], 
         RowBox[{"-", "1"}]]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"iLap2"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SuperscriptBox[
         SubscriptBox["\[EmptyUpTriangle]", "F"], 
         RowBox[{"-", "1"}]]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"iLapF"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Notation", "[", 
    RowBox[{
     TemplateBox[{SuperscriptBox[
        SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
        RowBox[{"-", "1"}]]},
      "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
     TemplateBox[{"iLapFColl"},
      "NotationTemplateTag"]}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["\[PartialD]", "z"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"dz"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["\[PartialD]", "t"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"dt"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SuperscriptBox[
         SubscriptBox["\[ScriptCapitalR]", "x"], "B"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"ReyBx"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SuperscriptBox[
         SubscriptBox["\[ScriptCapitalR]", "y"], "B"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"ReyBy"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["B", "x"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"Bx"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["B", "y"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"By"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["B", "z0"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"B0z"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["k", "y"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"ky"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["k", "x"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"kx"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"kxb"},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{"\[SmallCircle]"},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{"ph"},
       "NotationTemplateTag"]}], "]"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Place", "-", 
     RowBox[{
     "holder", " ", "for", " ", "the", " ", "operator", " ", "matrix"}]}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"C", " ", "matrix"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Notation", "[", 
     RowBox[{
      TemplateBox[{SubscriptBox["\[ScriptCapitalC]", 
         RowBox[{"a_", "\[InvisibleComma]", "b_"}]]},
       "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
      TemplateBox[{RowBox[{"Cm", "[", 
          RowBox[{"a_", ",", "b_"}], "]"}]},
       "NotationTemplateTag"]}], "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "iLapF", ",", " ", "iLap2", ",", " ", "dz", ",", " ", "dt", ",", " ", 
     "properties"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "iLap2"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLap2", "[", 
      RowBox[{"a_", "+", "b_"}], "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"iLap2", "[", "a", "]"}], "+", " ", 
      RowBox[{"iLap2", "[", "b", "]"}]}]}], ";"}], " ", 
   RowBox[{"(*", "Linear", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLap2", "[", 
      RowBox[{
       RowBox[{"c_", "?", "NumericQ"}], " ", "a_"}], "]"}], ":=", 
     RowBox[{"c", " ", 
      RowBox[{"iLap2", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Commutes", " ", "with", " ", "derivatives"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLap2", "[", 
      RowBox[{
       RowBox[{"kxb", "^", "n_."}], "  ", "a_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"kxb", "^", "n"}], " ", 
      RowBox[{"iLap2", "[", "a", "]"}]}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Put", " ", "down", " ", "ks", " ", "explicitly", " ", "for", " ", 
     "security"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLap2", "[", 
      RowBox[{
       RowBox[{"ky", "^", "n_."}], "  ", "a_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"ky", "^", "n"}], " ", 
      RowBox[{"iLap2", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLap2", "[", 
      RowBox[{"q", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"q", " ", 
      RowBox[{"iLap2", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLap2", "[", 
      RowBox[{"dz", "[", "a_", "]"}], "]"}], ":=", 
     RowBox[{"dz", "[", 
      RowBox[{"iLap2", "[", "a", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "dz"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dz", "[", 
      RowBox[{"a_", "+", "b_"}], "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"dz", "[", "a", "]"}], "+", " ", 
      RowBox[{"dz", "[", "b", "]"}]}]}], ";"}], " ", 
   RowBox[{"(*", "Linear", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dz", "[", 
      RowBox[{
       RowBox[{"c_", "?", "NumericQ"}], " ", "a_"}], "]"}], ":=", 
     RowBox[{"c", " ", 
      RowBox[{"dz", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Commutes", " ", "with", " ", "derivatives"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dz", "[", 
      RowBox[{
       RowBox[{"kxb", "^", "n_."}], "  ", "a_"}], "]"}], ":=", 
     RowBox[{
      SuperscriptBox["kxb", "n"], " ", 
      RowBox[{"dz", "[", "a", "]"}]}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Put", " ", "down", " ", "ks", " ", "explicitly", " ", "for", " ", 
     "security"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dz", "[", 
      RowBox[{
       RowBox[{"ky", "^", "n_."}], "  ", "a_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"ky", "^", "n"}], " ", 
      RowBox[{"dz", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dz", "[", 
      RowBox[{"q", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"q", " ", 
      RowBox[{"dz", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dz", "[", "0", "]"}], ":=", "0"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Product", " ", 
     RowBox[{"rule", " ", "--"}], " ", "could", " ", "add", " ", "this"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "dt"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{"a_", "+", "b_"}], "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"dt", "[", "a", "]"}], "+", " ", 
      RowBox[{"dt", "[", "b", "]"}]}]}], ";"}], " ", 
   RowBox[{"(*", "Linear", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{
       RowBox[{"c_", "?", "NumericQ"}], " ", "a_"}], "]"}], ":=", 
     RowBox[{"c", " ", 
      RowBox[{"dt", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Commutes", " ", "with", " ", "derivatives"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{"kxb", "  ", "a_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"q", " ", "ky", " ", "a"}], "+", " ", 
      RowBox[{"kxb", " ", 
       RowBox[{"dt", "[", "a", "]"}]}]}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Put", " ", "down", " ", "ks", " ", "explicitly", " ", "for", " ", 
     "security"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{
       RowBox[{"ky", "^", "n_."}], "  ", "a_"}], "]"}], ":=", 
     RowBox[{
      SuperscriptBox["ky", "n"], " ", 
      RowBox[{"dt", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{"q", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"q", " ", 
      RowBox[{"dt", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Goes", " ", "inside", " ", "iLap2", " ", "and", " ", "dz"}], " ",
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{"dz", "[", "a_", "]"}], "]"}], ":=", 
     RowBox[{"dz", "[", 
      RowBox[{"dt", "[", "a", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "[", 
      RowBox[{"iLap2", "[", "a_", "]"}], "]"}], ":=", 
     RowBox[{"iLap2", "[", 
      RowBox[{"dt", "[", "a", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "iLapF"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLapF", "[", 
      RowBox[{"a_", "+", "b_"}], "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"iLapF", "[", "a", "]"}], "+", " ", 
      RowBox[{"iLapF", "[", "b", "]"}]}]}], ";"}], " ", 
   RowBox[{"(*", "Linear", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLapF", "[", 
      RowBox[{
       RowBox[{"c_", "?", "NumericQ"}], " ", "a_"}], "]"}], ":=", 
     RowBox[{"c", " ", 
      RowBox[{"iLapF", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Commutes", " ", "with", " ", "derivatives"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLapF", "[", 
      RowBox[{
       RowBox[{"kxb", "^", "n_."}], "  ", "a_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"kxb", "^", "n"}], " ", 
      RowBox[{"iLapF", "[", "a", "]"}]}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Put", " ", "down", " ", "ks", " ", "explicitly", " ", "for", " ", 
     "security"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLapF", "[", 
      RowBox[{
       RowBox[{"ky", "^", "n_."}], "  ", "a_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"ky", "^", "n"}], " ", 
      RowBox[{"iLapF", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"iLapF", "[", 
      RowBox[{"q", "  ", "a_"}], "]"}], ":=", 
     RowBox[{"q", " ", 
      RowBox[{"iLapF", "[", "a", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Another", " ", "version", " ", "of", " ", "iLapF", " ", "to", " ", 
     "easily", " ", "collect", " ", "together", " ", "different", " ", 
     "terms"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "iLapFColl"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"iLapFColl", "/:", 
     RowBox[{
      RowBox[{"c_", "?", "NumericQ"}], "  ", 
      RowBox[{"iLapFColl", "[", "a_", "]"}]}], ":=", " ", 
     RowBox[{"iLapFColl", "[", 
      RowBox[{"c", " ", "a"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"iLapFColl", "/:", 
     RowBox[{
      RowBox[{"iLapFColl", "[", "a_", "]"}], "+", " ", 
      RowBox[{"iLapFColl", "[", "b_", "]"}]}], ":=", 
     RowBox[{"iLapFColl", "[", 
      RowBox[{"a", "+", "b"}], "]"}]}], ";"}], " ", 
   RowBox[{"(*", "Linear", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"iLapFColl", "/:", 
    RowBox[{
     RowBox[{"kxb", "^", "n_."}], 
     RowBox[{"iLapFColl", "[", "a_", "]"}]}], ":=", 
    RowBox[{"iLapFColl", "[", 
     RowBox[{
      RowBox[{"kxb", "^", "n"}], "  ", "a"}], "]"}]}], "\[IndentingNewLine]", 
   
   RowBox[{"iLapFColl", "/:", 
    RowBox[{
     RowBox[{"ky", "^", "n_."}], 
     RowBox[{"iLapFColl", "[", "a_", "]"}]}], ":=", 
    RowBox[{"iLapFColl", "[", 
     RowBox[{
      RowBox[{"ky", "^", "n"}], "  ", "a"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"iLapFColl", "/:", 
    RowBox[{
     RowBox[{"q", "^", "n_."}], 
     RowBox[{"iLapFColl", "[", "a_", "]"}]}], ":=", 
    RowBox[{"iLapFColl", "[", 
     RowBox[{
      RowBox[{"q", "^", "n"}], "  ", "a"}], "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]"}]}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.613286581090721*^9, 3.613286689545772*^9}, {
   3.613286889064035*^9, 3.613286908104281*^9}, {3.6132869482086487`*^9, 
   3.613287077374654*^9}, {3.613287138618946*^9, 3.613287140299769*^9}, {
   3.613287639148213*^9, 3.61328770120146*^9}, {3.613287743803678*^9, 
   3.613287773644068*^9}, {3.613288296843178*^9, 3.6132883066816053`*^9}, {
   3.613289870472352*^9, 3.6132898912000837`*^9}, {3.61328995953846*^9, 
   3.613290012328433*^9}, {3.613290091978758*^9, 3.613290110587739*^9}, {
   3.613291002983233*^9, 3.613291016787397*^9}, {3.613291128786306*^9, 
   3.613291140328432*^9}, {3.613291418191675*^9, 3.6132914298902397`*^9}, {
   3.613291787958507*^9, 3.613291883632246*^9}, {3.6132919180813*^9, 
   3.613291942156289*^9}, {3.613292008007991*^9, 3.613292106813635*^9}, {
   3.613293045356043*^9, 3.6132930675783167`*^9}, 3.613293376925857*^9, 
   3.613294621138084*^9, {3.613294694017054*^9, 3.6132947784060097`*^9}, {
   3.613294902803031*^9, 3.6132949806439133`*^9}, 3.6132950396930437`*^9, {
   3.613295346076227*^9, 3.613295481543404*^9}, {3.6132960472516212`*^9, 
   3.613296061097188*^9}, {3.6132961003100023`*^9, 3.613296118980667*^9}, {
   3.613297482407709*^9, 3.6132974934385366`*^9}, {3.613300728518897*^9, 
   3.613300783695135*^9}, {3.613304633293589*^9, 3.613304670793342*^9}, {
   3.613305007338643*^9, 3.613305011424444*^9}, {3.613305054166004*^9, 
   3.613305169291284*^9}, {3.6133262584563932`*^9, 3.613326328142644*^9}, {
   3.613327278627614*^9, 3.613327286046043*^9}, {3.613327328030073*^9, 
   3.613327350931031*^9}, {3.613327392030846*^9, 3.613327432040532*^9}, {
   3.6133292064048977`*^9, 3.613329250947644*^9}, {3.614183755836158*^9, 
   3.614183884767324*^9}, {3.614184743932043*^9, 3.614184895192746*^9}, {
   3.614185078050617*^9, 3.614185081522999*^9}, {3.6141859311896067`*^9, 
   3.614185935756172*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Full incompressible nonlinear equations", "Subsubsection",
 InitializationGroup->True,
 CellChangeTimes->{{3.613285885535736*^9, 3.613285889538149*^9}, {
  3.613286361952444*^9, 3.613286368230513*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Standard", " ", "equations"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"xtv", "=", 
     RowBox[{"{", 
      RowBox[{"x", ",", "y", ",", "z", ",", "t"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xv", "=", 
     RowBox[{"{", 
      RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fullNLvars", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
      "ux", ",", "uy", ",", "uz", ",", "bx", ",", "by", ",", "bz", ",", "p"}],
       "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"momeqn", ",", "adveqn", ",", "uv", ",", "Bv"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"uv", " ", "=", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{
           RowBox[{"-", "q"}], " ", "x"}], ",", "0"}], "}"}], "+", 
        RowBox[{"Through", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ux", ",", "uy", ",", "uz"}], "}"}], "@@", "xtv"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Bv", " ", "=", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "B0z"}], "}"}], "+", 
        RowBox[{"Through", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"bx", ",", "by", ",", "bz"}], "}"}], "@@", "xtv"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"momeqn", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"uv", ",", "t"}], "]"}], "+", 
          RowBox[{
           RowBox[{"Grad", "[", 
            RowBox[{"uv", ",", "xv"}], "]"}], ".", "uv"}], "+", 
          RowBox[{"2", " ", 
           RowBox[{"Cross", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", "uv"}], 
            "]"}]}]}], "\[Equal]", 
         RowBox[{
          RowBox[{"-", " ", 
           RowBox[{"Grad", "[", 
            RowBox[{
             RowBox[{"p", "@@", "xtv"}], ",", "xv"}], "]"}]}], "+", 
          RowBox[{"(", " ", 
           RowBox[{
            RowBox[{"Grad", "[", 
             RowBox[{"Bv", ",", "xv"}], "]"}], ".", "Bv"}], ")"}], "+", 
          RowBox[{"2", " ", "q", " ", "x", " ", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "+", 
          RowBox[{"\[Nu]b", " ", 
           RowBox[{"Laplacian", "[", 
            RowBox[{"uv", ",", "xv"}], "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"adveqn", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{"Bv", ",", "t"}], "]"}], "\[Equal]", 
           RowBox[{
            RowBox[{"Curl", "[", 
             RowBox[{
              RowBox[{"Cross", "[", 
               RowBox[{"uv", ",", "Bv"}], "]"}], ",", "xv"}], "]"}], "+", 
            RowBox[{
             RowBox[{"1", "/", "ReB"}], " ", 
             RowBox[{"Laplacian", "[", 
              RowBox[{"Bv", ",", "xv"}], "]"}]}]}]}], "]"}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"adveqn", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Bv", ",", "t"}], "]"}], "+", 
          RowBox[{
           RowBox[{"Grad", "[", 
            RowBox[{"Bv", ",", "xv"}], "]"}], ".", "uv"}]}], "==", 
         RowBox[{
          RowBox[{
           RowBox[{"Grad", "[", 
            RowBox[{"uv", ",", "xv"}], "]"}], ".", "Bv"}], "+", 
          RowBox[{"\[Eta]b", " ", 
           RowBox[{"Laplacian", "[", 
            RowBox[{"Bv", ",", "xv"}], "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fullNLeqns", " ", "=", " ", 
       RowBox[{"Subtract", "@@@", 
        RowBox[{"Join", "[", 
         RowBox[{"momeqn", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Div", "[", 
             RowBox[{"uv", ",", "xv"}], "]"}], "\[Equal]", "0"}], "}"}], ",", 
          "adveqn", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Div", "[", 
             RowBox[{"Bv", ",", "xv"}], "]"}], "\[Equal]", "0"}], "}"}]}], 
         "]"}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Translation", " ", "to", " ", "Orr"}], "-", 
     RowBox[{"Somerfeld", " ", "variables"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"toOrrSomerVars", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ux", "\[Rule]", "u"}], ",", "\[IndentingNewLine]", 
       RowBox[{"uy", "\[Rule]", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"z", ",", "t"}], "}"}], ",", 
          RowBox[{"iLap2", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "kxb"}], " ", "ky", " ", 
             RowBox[{"u", "[", 
              RowBox[{"z", ",", "t"}], "]"}]}], "+", 
            RowBox[{"dz", "[", 
             RowBox[{"\[Zeta]", "[", 
              RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "  ", "]"}]}],
        ",", "\[IndentingNewLine]", 
       RowBox[{"uz", "\[Rule]", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"z", ",", "t"}], "}"}], ",", 
          RowBox[{"iLap2", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "kxb"}], " ", 
             RowBox[{"dz", "[", 
              RowBox[{"u", "[", 
               RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "-", 
            RowBox[{"ky", " ", 
             RowBox[{"\[Zeta]", "[", 
              RowBox[{"z", ",", "t"}], "]"}]}]}], "]"}]}], "  ", "]"}]}], ",",
        "\[IndentingNewLine]", 
       RowBox[{"bx", "\[Rule]", "b"}], ",", "\[IndentingNewLine]", 
       RowBox[{"by", "\[Rule]", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"z", ",", "t"}], "}"}], ",", 
          RowBox[{"iLap2", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "kxb"}], " ", "ky", " ", 
             RowBox[{"b", "[", 
              RowBox[{"z", ",", "t"}], "]"}]}], "+", 
            RowBox[{"dz", "[", 
             RowBox[{"\[Eta]", "[", 
              RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "]"}]}], "  ", "]"}]}],
        ",", "\[IndentingNewLine]", 
       RowBox[{"bz", "\[Rule]", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"z", ",", "t"}], "}"}], ",", 
          RowBox[{"iLap2", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "kxb"}], " ", 
             RowBox[{"dz", "[", 
              RowBox[{"b", "[", 
               RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "-", 
            RowBox[{"ky", " ", 
             RowBox[{"\[Eta]", "[", 
              RowBox[{"z", ",", "t"}], "]"}]}]}], "]"}]}], "  ", "]"}]}]}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]"}]}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.6132862687853317`*^9, 3.613286292131226*^9}, {
   3.613286330331258*^9, 3.613286331235854*^9}, {3.613286373825049*^9, 
   3.613286475100573*^9}, {3.613286523742776*^9, 3.613286574022657*^9}, {
   3.6132867177659683`*^9, 3.613286844785708*^9}, {3.6132873426960707`*^9, 
   3.613287392767021*^9}, {3.613287431872316*^9, 3.613287444161961*^9}, {
   3.61328749525042*^9, 3.6132874981609697`*^9}, 3.6132875535430107`*^9, {
   3.613287602021194*^9, 3.613287632745328*^9}, {3.613287713936445*^9, 
   3.61328773864904*^9}, {3.6132877787380657`*^9, 3.613288005757513*^9}, {
   3.613288060071485*^9, 3.6132881345693483`*^9}, {3.613288346385255*^9, 
   3.6132883794041157`*^9}, {3.613288504050708*^9, 3.6132885207745028`*^9}, {
   3.6132887600893497`*^9, 3.613288768182979*^9}, {3.6132888149004593`*^9, 
   3.613288846333804*^9}, {3.613291099035706*^9, 3.613291118427603*^9}, {
   3.613291553896966*^9, 3.6132916298613873`*^9}, {3.613291661000248*^9, 
   3.6132917251562147`*^9}, {3.613294580957465*^9, 3.613294612091785*^9}}],

Cell["\<\
Generate rules to cancel iLap2 with kz and ky -- This \
doesn\[CloseCurlyQuote]t manage (ky^2+kz^2)^2 *iLap2^2 but only in diffusion?
Also, write down rule for iLapF\
\>", "Text",
 CellChangeTimes->{{3.613300877715733*^9, 3.613300900090197*^9}, {
  3.613301616734581*^9, 3.613301651038678*^9}, {3.613305186229371*^9, 
  3.6133052083324423`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"baseExplicitLap2Rule", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"dz", "[", 
      RowBox[{"dz", "[", 
       RowBox[{"iLap2", "[", "f_", "]"}], "]"}], "]"}], "+", 
     RowBox[{
      RowBox[{"ky", "^", "2"}], " ", 
      RowBox[{"iLap2", "[", "f_", "]"}]}]}], "\[RuleDelayed]", " ", "f"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"order", "=", "2"}], ",", "combinations", ",", "r2l", ",", 
      "l2r", ",", "kyf", ",", "baseRule", ",", "operateOnRule"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Operates", " ", "with", " ", "dz", " ", "and", " ", "ky", " ", "to", 
      " ", "generalize", " ", "rule"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Generate", " ", "the", " ", "possible", " ", "combinations"}], 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"r2l", " ", "=", " ", 
      RowBox[{"RuleDelayed", "\[Rule]", "List"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"l2r", " ", "=", " ", 
      RowBox[{"List", "\[Rule]", "RuleDelayed"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"kyf", " ", "=", " ", 
      RowBox[{
       RowBox[{"ky", " ", "#"}], "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"combinations", "=", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"Tuples", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", "order"}], "]"}], ",", "2"}], "]"}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a_", ",", "b_"}], "}"}], "/;", 
         RowBox[{
          RowBox[{"a", "+", "b"}], "\[LessEqual]", "order"}]}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"combinations", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ConstantArray", "[", 
            RowBox[{"dz", ",", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            "]"}], ",", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"kyf", ",", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            "]"}]}], "}"}], "]"}], "&"}], "/@", "combinations"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
      "combinations", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
      " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"#", "&"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Function", " ", "to", " ", "operate", " ", "on", " ", "both", " ", 
       "sides", " ", "of", " ", "base", " ", "rule", " ", "with", " ", "a", 
       " ", "chosen", " ", "function"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"baseRule", "=", 
      RowBox[{"baseExplicitLap2Rule", "/.", "r2l"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"operateOnRule", " ", "=", " ", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"rule", ",", "func"}], "}"}], ",", 
        RowBox[{"(*", " ", 
         RowBox[{
         "func", " ", "is", " ", "function", " ", "with", " ", "which", " ", 
          "to", " ", "operate", " ", "of", " ", "each", " ", "side"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Evaluate", "/@", 
         RowBox[{"Expand", "/@", 
          RowBox[{"func", "/@", "rule"}]}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"explicitLap2Rule", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "/.", "l2r"}], "&"}], "/@", 
       RowBox[{"Expand", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"c_.", ",", "c"}], "}"}], " ", "#"}], "&"}], "/@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Fold", "[", 
             RowBox[{"operateOnRule", ",", "baseRule", ",", "#"}], "]"}], 
            "&"}], "/@", "combinations"}], ")"}]}], "]"}]}]}], ";"}]}], 
   "\[IndentingNewLine]", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"explicitLapFRule", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"iLapF", "[", 
      RowBox[{
       RowBox[{"kxb", "^", "2"}], " ", "f_"}], "]"}], "+", 
     RowBox[{"iLapF", "[", 
      RowBox[{
       RowBox[{"ky", "^", "2"}], " ", "f_"}], "]"}], "+", 
     RowBox[{"iLapF", "[", 
      RowBox[{"dz", "[", 
       RowBox[{"dz", "[", "f_", "]"}], "]"}], "]"}]}], "\[RuleDelayed]", 
    "f"}]}], ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.613301578032633*^9, 3.613301578138397*^9}, {
  3.6133016143342333`*^9, 3.613301614494217*^9}, {3.613305212858172*^9, 
  3.6133052855307627`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Useful functions", "Subsubsection",
 CellChangeTimes->{{3.613289315465055*^9, 3.613289319164629*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Better", " ", "version", " ", "of", " ", "linearize"}], ",", " ", 
    RowBox[{
    "works", " ", "on", " ", "expressions", " ", "in", " ", "denominator", 
     " ", "and", " ", "multiple", " ", "variables"}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"Remove", "[", "linearize", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"linearize", "[", 
     RowBox[{"expr_", ",", "vars_List", ",", "indvars_List"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"dlist", ",", "fullvars", ",", "t"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"create", " ", "full", " ", "list"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dlist", "=", 
        RowBox[{"Permutations", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"indvars", ",", "4"}], "]"}], "]"}], ",", "4"}], "]"}]}], 
       ";", 
       RowBox[{"fullvars", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{
             RowBox[{"Through", "[", 
              RowBox[{"vars", "@@", "indvars"}], "]"}], ",", 
             RowBox[{"Sequence", "@@", "#"}]}], "]"}], "&"}], "/@", "dlist"}],
          "]"}]}], ";", 
       RowBox[{"Expand", "[", 
        RowBox[{
         RowBox[{"Normal", "[", 
          RowBox[{"Series", "[", 
           RowBox[{
            RowBox[{"expr", "/.", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "->", 
                 RowBox[{"t", " ", "#"}]}], "&"}], "/@", "fullvars"}], 
              ")"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"t", ",", "0", ",", "1"}], "}"}]}], "]"}], "]"}], "/.", 
         RowBox[{"t", "->", "1"}]}], "]"}]}]}], "\n", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "plusToList"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"plusToList", "::", "unrecExpr"}], " ", "=", " ", 
     "\"\<Warning: head is not Times, Plus or Symbol\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"plusToList", "[", "expr_", "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "expr", "]"}], "===", "Plus"}], ",", " ", 
       RowBox[{"List", "@@", "expr"}], ",", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "expr", "]"}], "===", "Times"}], " ", "||", 
          RowBox[{
           RowBox[{"Head", "[", "expr", "]"}], "===", "Symbol"}]}], ",", 
         RowBox[{"{", "expr", "}"}], ",", " ", 
         RowBox[{"Message", "[", 
          RowBox[{"plusToList", "::", "unrecExpr"}], "]"}]}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "MapMatrix"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MapMatrix", "[", 
     RowBox[{"f_", ",", "list_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Map", "[", 
     RowBox[{"f", ",", "list", ",", 
      RowBox[{"{", "2", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Convert", " ", "products", " ", "of", " ", "terms", " ", "to", " ", "a", 
     " ", "string", " ", "that", " ", "can", " ", "be", " ", "used", " ", 
     "as", " ", "a", " ", "variable", " ", "in", " ", 
     RowBox[{"c", "++"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ClearAll", "@", "convertProdToString"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"convertProdToString", "[", "term_", "]"}], ":=", 
    RowBox[{"StringReplace", "[", 
     RowBox[{
      RowBox[{"StringJoin", "[", 
       RowBox[{"\"\<T\>\"", ",", 
        RowBox[{"ToString", "[", 
         RowBox[{"term", ",", 
          RowBox[{"FormatType", "\[Rule]", "InputForm"}]}], "]"}]}], "]"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<*\>\"", "\[Rule]", "\"\<T\>\""}], ",", 
        RowBox[{"\"\<-\>\"", "\[Rule]", "\"\<m\>\""}], ",", 
        RowBox[{"\"\<(\>\"", "\[Rule]", "\"\<\>\""}], ",", 
        RowBox[{"\"\<)\>\"", "\[Rule]", "\"\<\>\""}], ",", 
        RowBox[{"\"\<^\>\"", "\[Rule]", "\"\<P\>\""}]}], "}"}]}], 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.61328934611686*^9, 3.613289382147559*^9}, {
  3.613291155498661*^9, 3.6132911618903112`*^9}, {3.6133280970501957`*^9, 
  3.6133283216730957`*^9}, {3.614192140790101*^9, 3.614192148272378*^9}, {
  3.614194375038121*^9, 3.614194397693001*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Basic Quasi-linear", "Section",
 CellChangeTimes->{{3.6132857813215227`*^9, 3.613285785435519*^9}}],

Cell[TextData[{
 "Quasi-linear equations including only interactions of fluctuations with ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["B", "y"], TraditionalForm]]],
 "."
}], "Text",
 CellChangeTimes->{{3.613285788264741*^9, 3.613285816975567*^9}, {
  3.6132858538148127`*^9, 3.613285857694859*^9}}],

Cell[CellGroupData[{

Cell["Derive equations", "Subsection",
 CellChangeTimes->{{3.613285862743395*^9, 3.613285865310978*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"zt", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"z", ",", "t"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"meanFields", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
    "0", ",", "0", ",", "0", ",", "0", ",", "By", ",", "0", ",", "0"}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"meanFieldsWDerivs", " ", "=", " ", 
   RowBox[{"Rest", "@", 
    RowBox[{"Union", "[", 
     RowBox[{"Join", "[", 
      RowBox[{"meanFields", ",", 
       RowBox[{"dz", "/@", "meanFields"}], ",", 
       RowBox[{"dz", "/@", 
        RowBox[{"dz", "/@", "meanFields"}]}]}], "]"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"meanFieldQ", " ", "=", " ", 
    RowBox[{
     RowBox[{"MemberQ", "[", 
      RowBox[{"meanFieldsWDerivs", ",", "#"}], "]"}], "&"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fullMFeqns", " ", "=", " ", 
    RowBox[{"Subtract", "@@@", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"Bx", "@@", "zt"}], ",", "t"}], "]"}], "\[Equal]", 
        RowBox[{
         RowBox[{"ReyBx", "@@", "zt"}], "+", 
         RowBox[{"\[Eta]b", " ", 
          RowBox[{"Bx", "@@", "zt"}]}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"By", "@@", "zt"}], ",", "t"}], "]"}], "\[Equal]", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "q"}], " ", 
          RowBox[{"Bx", "@@", "zt"}]}], "+", 
         RowBox[{"ReyBy", "@@", "zt"}], "+", 
         RowBox[{"\[Eta]b", " ", 
          RowBox[{"By", "@@", "zt"}]}]}]}], ",", "0"}], "}"}]}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Plug", " ", "in", " ", "mean", " ", "field"}], " ", "+", " ", 
    RowBox[{
    "fluctuations", " ", "into", " ", "NL", " ", "equations", " ", "and", " ",
      "linearize"}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"NL2fluct", ",", "fourierRules"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"NL2fluct", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
          "fullNLvars", "\[LeftDoubleBracket]", "i", 
           "\[RightDoubleBracket]"}], "\[Rule]", 
          RowBox[{"Function", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x", ",", "y", ",", "z", ",", "t"}], "}"}], ",", 
            RowBox[{"Evaluate", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                "meanFields", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "@@", 
                RowBox[{"{", 
                 RowBox[{"z", ",", "t"}], "}"}]}], "+", 
               RowBox[{
                RowBox[{
                "fullNLvars", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "@@", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "y", ",", "z", ",", "t"}], "}"}]}]}], "/.", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"0", "[", "__", "]"}], ")"}], "\[Rule]", "0"}]}], 
             "]"}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "fullNLvars", "]"}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Plug", " ", "in", " ", "to", " ", "full", " ", "equations", " ", 
        "and", " ", "linearize"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"linearize", "[", 
          RowBox[{"#", ",", "fullNLvars", ",", "xtv"}], "]"}], "&"}], "/@", 
        RowBox[{"Expand", "[", 
         RowBox[{
          RowBox[{"fullNLeqns", "/.", "NL2fluct"}], "/.", 
          RowBox[{"B0z", "\[Rule]", "0"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "fullFluctEqs", " ", "still", " ", "contain", " ", "a", " ", "mean", 
        " ", "field", " ", "part"}], " ", "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Shearing", " ", "wave", " ", "expansion"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"fourierRules", "=", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", "var", "}"}], ",", 
          RowBox[{"Evaluate", "[", 
           RowBox[{"var", "\[Rule]", 
            RowBox[{"Function", "[", 
             RowBox[{
              RowBox[{"Evaluate", "@", "xtv"}], ",", 
              RowBox[{
               RowBox[{"var", "[", 
                RowBox[{"z", ",", "t"}], "]"}], 
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"\[ImaginaryI]", " ", 
                  RowBox[{"(", 
                   RowBox[{"kx", "+", 
                    RowBox[{"q", " ", "t", " ", "ky"}]}], ")"}], "x"}], " ", 
                 "+", " ", 
                 RowBox[{"\[ImaginaryI]", " ", "ky", " ", "y"}]}], "]"}]}]}], 
             "]"}]}], "]"}]}], "]"}], "/@", "fullNLvars"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{"Expand", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"fullFluctEqs", "/.", "fourierRules"}], ")"}], "/", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"\[ImaginaryI]", " ", 
            RowBox[{"(", 
             RowBox[{"kx", "+", 
              RowBox[{"q", " ", "t", " ", "ky"}]}], ")"}], "x"}], " ", "+", 
           " ", 
           RowBox[{"\[ImaginaryI]", " ", "ky", " ", "y"}]}], "]"}]}], "]"}]}],
       ";", 
      RowBox[{"(*", 
       RowBox[{
       "Shearing", " ", "wave", " ", "in", " ", "x", " ", "and", " ", "y"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{"fullFluctEqs", "/.", 
        RowBox[{
         SuperscriptBox["\[ExponentialE]", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "\[ImaginaryI]"}], " ", 
            RowBox[{"(", 
             RowBox[{
              SubscriptBox["k", "x"], "+", 
              RowBox[{
               SubscriptBox["k", "y"], " ", "q", " ", "t"}]}], ")"}], " ", 
            "x"}], "-", 
           RowBox[{"\[ImaginaryI]", " ", 
            SubscriptBox["k", "y"], " ", "y"}]}]], "\[Rule]", "0"}]}]}], ";", 
      " ", 
      RowBox[{"(*", " ", 
       RowBox[{"Remove", " ", "mean", " ", "components"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"fullFluctEqs", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"fullFluctEqs", "/.", 
          RowBox[{"kx", "\[Rule]", 
           RowBox[{"kxb", "-", 
            RowBox[{"q", " ", "t", " ", "ky"}]}]}]}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"kxb", "\[Rule]", 
            RowBox[{"kxb", "/", "\[ImaginaryI]"}]}], ",", 
           RowBox[{"ky", "\[Rule]", 
            RowBox[{"ky", "/", "\[ImaginaryI]"}]}]}], "}"}]}], "//", 
        "Expand"}]}]}]}], " ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Use", " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "_"]}], "=", 
      RowBox[{
       SubscriptBox["k", "x"], "+", 
       RowBox[{
        SubscriptBox["qtk", "y"], " ", "as", " ", "in", " ", 
        RowBox[{"c", "++"}], " ", "code"}]}]}], " ", "*)"}], 
    "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Derive", " ", "Orr"}], "-", 
     RowBox[{"Somerfeld", " ", "like", " ", "equations"}]}], ",", " ", 
    RowBox[{
     RowBox[{"don", "'"}], "t", " ", "need", " ", "to", " ", "reduce", " ", 
     "other", " ", "equations"}], ",", " ", 
    RowBox[{
    "just", " ", "write", " ", "down", " ", "equations", " ", "for", " ", 
     RowBox[{"Lap", "[", "u", "]"}]}], ",", "\[Zeta]", ",", "b", ",", 
    "\[Eta]"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"derivRules", ",", "LapMGradDiv1", ",", "manualSub"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"derivRules", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Derivative", "[", 
           RowBox[{"n_", ",", "m_"}], "]"}], "[", "a_", "]"}], "[", "vs__", 
         "]"}], "\[RuleDelayed]", 
        RowBox[{"Nest", "[", 
         RowBox[{"dt", ",", 
          RowBox[{"Nest", "[", 
           RowBox[{"dz", ",", 
            RowBox[{"a", "[", "vs", "]"}], ",", "n"}], "]"}], ",", "m"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"LapMGradDiv1", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"kxb", "^", "2"}], "+", 
            RowBox[{"ky", "^", "2"}]}], ")"}], 
          RowBox[{
          "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], "+", 
         
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{
           "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
           "z", ",", "z"}], "]"}], "-", 
         RowBox[{"kxb", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"kxb", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            "+", 
            RowBox[{"ky", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            "+", 
            RowBox[{"D", "[", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
              ",", "z"}], "]"}]}], ")"}]}]}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"finalEqs", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"iLapF", "[", 
            RowBox[{
             RowBox[{"Expand", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"LapMGradDiv1", "[", 
                 RowBox[{"fullFluctEqs", "/.", 
                  RowBox[{"\[Nu]b", "\[Rule]", "0"}]}], "]"}], "/.", 
                "derivRules"}], "/.", "toOrrSomerVars"}], "]"}], "//.", 
             "explicitLap2Rule"}], "]"}], "/.", "explicitLapFRule"}], "//", 
          "Expand"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Expand", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"D", "[", 
                RowBox[{
                 RowBox[{
                 "fullFluctEqs", "\[LeftDoubleBracket]", "2", 
                  "\[RightDoubleBracket]"}], ",", "z"}], "]"}], "-", 
               RowBox[{"ky", " ", 
                RowBox[{
                "fullFluctEqs", "\[LeftDoubleBracket]", "3", 
                 "\[RightDoubleBracket]"}]}]}], "/.", "derivRules"}], "/.", 
             "toOrrSomerVars"}], "]"}], "//.", "explicitLap2Rule"}], "/.", 
          RowBox[{"\[Nu]b", "\[Rule]", "0"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Expand", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
              "fullFluctEqs", "\[LeftDoubleBracket]", "5", 
               "\[RightDoubleBracket]"}], "/.", "derivRules"}], "/.", 
             "toOrrSomerVars"}], "]"}], "//.", "explicitLap2Rule"}], "/.", 
          RowBox[{"\[Eta]b", "\[Rule]", "0"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Expand", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"D", "[", 
                RowBox[{
                 RowBox[{
                 "fullFluctEqs", "\[LeftDoubleBracket]", "6", 
                  "\[RightDoubleBracket]"}], ",", "z"}], "]"}], "-", 
               RowBox[{"ky", " ", 
                RowBox[{
                "fullFluctEqs", "\[LeftDoubleBracket]", "7", 
                 "\[RightDoubleBracket]"}]}]}], "/.", "derivRules"}], "/.", 
             "toOrrSomerVars"}], "]"}], "//.", "explicitLap2Rule"}], "/.", 
          RowBox[{"\[Eta]b", "\[Rule]", "0"}]}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Fix", " ", "these", " ", "up", " ", "manually"}], " ", "-", 
        " ", 
        RowBox[{"sometimes", " ", "much", " ", "easier"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"This", " ", "is", " ", "plugging", " ", "in", " ", 
         RowBox[{"iLapF", "[", "lapF", "]"}]}], " ", "=", " ", 
        RowBox[{
        "1", " ", "in", " ", "the", " ", "more", " ", "complicated", " ", 
         "situation"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"finalEqs", "=", 
       RowBox[{"finalEqs", "/.", 
        RowBox[{
         RowBox[{"Expand", "[", 
          RowBox[{
           RowBox[{"-", "ky"}], " ", 
           RowBox[{"iLapF", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   SuperscriptBox["kxb", "2"], " ", "#"}], "+", 
                  RowBox[{
                   RowBox[{"ky", "^", "2"}], " ", "#"}], "+", 
                  RowBox[{"D", "[", 
                   RowBox[{"#", ",", "z", ",", "z"}], "]"}]}], ")"}], "&"}], 
               "[", 
               RowBox[{
                RowBox[{"b", "[", 
                 RowBox[{"z", ",", "t"}], "]"}], " ", 
                RowBox[{"By", "[", 
                 RowBox[{"z", ",", "t"}], "]"}]}], "]"}], ")"}], "/.", 
             "derivRules"}], "]"}]}], "]"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"-", " ", "ky"}], " ", 
          RowBox[{"b", "[", 
           RowBox[{"z", ",", "t"}], "]"}], 
          RowBox[{"By", "[", 
           RowBox[{"z", ",", "t"}], "]"}]}]}]}]}]}]}], "\[IndentingNewLine]", 
    "]"}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Now", ",", " ", 
    RowBox[{"form", " ", "the", " ", "A", " ", "matrix"}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"redvars", " ", "=", 
   RowBox[{"{", 
    RowBox[{"u", ",", "\[Zeta]", ",", "b", ",", "\[Eta]"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"finalEqs", "=", 
    RowBox[{
     RowBox[{"Solve", "[", 
      RowBox[{
       RowBox[{"Thread", "[", 
        RowBox[{"finalEqs", "\[Equal]", "0"}], "]"}], ",", 
       RowBox[{"dt", "/@", 
        RowBox[{"(", 
         RowBox[{"Through", "[", 
          RowBox[{"redvars", "@@", 
           RowBox[{"{", 
            RowBox[{"z", ",", "t"}], "}"}]}], "]"}], ")"}]}]}], "]"}], 
     "\[LeftDoubleBracket]", 
     RowBox[{"1", ",", "All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Solve", " ", "for", " ", "time"}], "-", "derivatives"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"Aop", " ", "=", " ", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Function", "[", 
          RowBox[{
           RowBox[{"{", "var", "}"}], ",", 
           RowBox[{
            RowBox[{"Plus", "@@", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"#", ",", 
                    RowBox[{"var", "[", 
                    RowBox[{"z", ",", "t"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}], ",", 
                  "#", ",", 
                  RowBox[{"{", "}"}]}], "]"}], "&"}], "/@", 
               RowBox[{"(", 
                RowBox[{"plusToList", "@", 
                 RowBox[{
                 "finalEqs", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}], "/.", 
            RowBox[{
             RowBox[{"var", "[", 
              RowBox[{"z", ",", "t"}], "]"}], "\[Rule]", "ph"}]}]}], "]"}], "/@",
          "redvars"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ")"}], "//", 
    "MatrixForm"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "This", " ", "matches", " ", "my", " ", "previously", " ", "derived", " ", 
    
    RowBox[{"(", 
     RowBox[{"by", " ", "hand"}], ")"}], " ", "version"}], " ", "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.613288323045455*^9, 3.613288326117752*^9}, {
   3.613288389643783*^9, 3.613288407039393*^9}, {3.613288479968417*^9, 
   3.613288487728981*^9}, {3.613288573589717*^9, 3.613288752358992*^9}, {
   3.613288852631976*^9, 3.613288916198966*^9}, {3.613288986990489*^9, 
   3.6132891926695137`*^9}, {3.613289423308837*^9, 3.613289432319971*^9}, {
   3.613289540309534*^9, 3.613289551704471*^9}, {3.613289593180532*^9, 
   3.613289597516069*^9}, {3.6132897828569527`*^9, 3.613289799551094*^9}, {
   3.613289832684938*^9, 3.613289857392364*^9}, {3.613289899387167*^9, 
   3.613289949003064*^9}, {3.613290022566579*^9, 3.613290072980708*^9}, {
   3.6132901333440037`*^9, 3.6132902277049723`*^9}, {3.613290347360075*^9, 
   3.613290348877283*^9}, {3.613290407662169*^9, 3.6132904199021072`*^9}, {
   3.613290617515009*^9, 3.613290693570179*^9}, {3.6132907374778633`*^9, 
   3.613290807808112*^9}, {3.6132911924799023`*^9, 3.613291195598812*^9}, {
   3.6132912379815063`*^9, 3.613291248693972*^9}, {3.613291280284522*^9, 
   3.613291408458893*^9}, {3.613291458080309*^9, 3.613291470927746*^9}, {
   3.6132915090035563`*^9, 3.613291525286358*^9}, {3.6132921232255783`*^9, 
   3.613292144859001*^9}, {3.613292297867838*^9, 3.613292316012755*^9}, 
   3.6132930883268547`*^9, {3.613293312306075*^9, 3.61329333079275*^9}, {
   3.6133006141405077`*^9, 3.61330070673322*^9}, {3.613300799309185*^9, 
   3.613300851120187*^9}, {3.613300912016116*^9, 3.6133009327016172`*^9}, {
   3.6133010023231773`*^9, 3.613301012699256*^9}, {3.6133010441561947`*^9, 
   3.613301156627*^9}, 3.6133013078550577`*^9, {3.613301447081024*^9, 
   3.613301449877001*^9}, {3.6133015415117207`*^9, 3.6133015541220617`*^9}, {
   3.6133016618658733`*^9, 3.613301704111124*^9}, {3.61330185743235*^9, 
   3.613301871088355*^9}, {3.613301910782558*^9, 3.6133019246441307`*^9}, {
   3.613301999871911*^9, 3.6133020708752737`*^9}, {3.61330239110786*^9, 
   3.613302487596188*^9}, {3.613302551646475*^9, 3.61330262406814*^9}, {
   3.6133045173899403`*^9, 3.6133045479377737`*^9}, {3.6133047488389683`*^9, 
   3.6133047694867353`*^9}, {3.613304829996623*^9, 3.613304868581319*^9}, {
   3.613304943519965*^9, 3.613304948407606*^9}, {3.6133053005957613`*^9, 
   3.613305319748056*^9}, {3.6133261571880493`*^9, 3.613326178299334*^9}, {
   3.613326367599222*^9, 3.613326560664708*^9}, {3.613326591582814*^9, 
   3.613326696955864*^9}, {3.613327160076173*^9, 3.613327161075317*^9}, {
   3.61332757642347*^9, 3.613327611115761*^9}, {3.613327657453199*^9, 
   3.613327813791049*^9}, {3.61332805091748*^9, 3.6133280531810827`*^9}, {
   3.613328083202976*^9, 3.613328090811761*^9}, 3.613328347059229*^9, {
   3.613328833019064*^9, 3.6133288553167562`*^9}, {3.6133291560666847`*^9, 
   3.613329177719489*^9}, 3.6141771183999968`*^9, {3.614189292301111*^9, 
   3.614189302092698*^9}, {3.614361699979642*^9, 3.614361719890554*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["k", "y"], " ", "q", " ", 
       RowBox[{
        SuperscriptBox[
         SubscriptBox["\[EmptyUpTriangle]", "F"], 
         RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], 
      RowBox[{"2", " ", 
       RowBox[{
        SuperscriptBox[
         SubscriptBox["\[EmptyUpTriangle]", "F"], 
         RowBox[{"-", "1"}]], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}], 
        "]"}]}], 
      RowBox[{
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "y"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{"2", " ", 
        SuperscriptBox[
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "F"], 
          RowBox[{"-", "1"}]], "[", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SubscriptBox["B", "y"], "[", 
            RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
          RowBox[{
           SubscriptBox["\[PartialD]", "z"], "[", 
           RowBox[{
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], 
         "]"}]}]}], 
      RowBox[{"2", " ", 
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubsuperscriptBox["k", "y", "2"], " ", 
       RowBox[{
        SuperscriptBox[
         SubscriptBox["\[EmptyUpTriangle]", "F"], 
         RowBox[{"-", "1"}]], "[", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}], "]"}]}]},
     {
      RowBox[{
       RowBox[{
        RowBox[{"-", "2"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
       "+", 
       RowBox[{"q", " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}]}], 
      "0", 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"]}], " ", "\[SmallCircle]", 
        " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "y"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}]}], 
      RowBox[{
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "y"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "-", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}]},
     {
      RowBox[{
       SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
       RowBox[{
        SubscriptBox["B", "y"], "[", 
        RowBox[{"z", ",", "t"}], "]"}]}], "0", "0", "0"},
     {
      RowBox[{
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "y"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[EmptyUpTriangle]", "2"], 
            RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}], "]"}]}],
        "+", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "-", 
       RowBox[{
        OverscriptBox[
         SubscriptBox["k", "x"], "\[LongDash]"], " ", 
        SubsuperscriptBox["k", "y", "2"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "y"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}], 
      RowBox[{
       RowBox[{
        SubscriptBox["k", "y"], " ", "\[SmallCircle]", " ", 
        RowBox[{
         SubscriptBox["B", "y"], "[", 
         RowBox[{"z", ",", "t"}], "]"}]}], "+", 
       RowBox[{"2", " ", 
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["B", "y"], "[", 
          RowBox[{"z", ",", "t"}], "]"}], "]"}], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}], "]"}]}], "+", 
       RowBox[{
        SubscriptBox["k", "y"], " ", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          RowBox[{
           SubscriptBox["B", "y"], "[", 
           RowBox[{"z", ",", "t"}], "]"}], "]"}], "]"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox["\[EmptyUpTriangle]", "2"], 
          RowBox[{"-", "1"}]], "[", "\[SmallCircle]", "]"}]}]}], 
      RowBox[{
       RowBox[{"-", "q"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", "\[SmallCircle]", "]"}]}], 
      "0"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{
  3.613304869590173*^9, 3.6133049495007257`*^9, 3.6133053207405367`*^9, {
   3.613326485387342*^9, 3.613326561490202*^9}, {3.613326595815199*^9, 
   3.6133266040226097`*^9}, 3.613326660026622*^9, 3.61332716201223*^9, {
   3.6133275947793913`*^9, 3.613327612121537*^9}, {3.613327744727991*^9, 
   3.613327815555489*^9}, 3.613328054239262*^9, 3.613328356531164*^9, 
   3.613328856170669*^9, {3.613329165606255*^9, 3.613329178601987*^9}, 
   3.614177119713147*^9, 3.614189304110643*^9, 3.6143617220896473`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Working out the matrix product, and getting things into a \
\[OpenCurlyDoubleQuote]code convenient\[CloseCurlyDoubleQuote] form\
\>", "Subsection",
 CellChangeTimes->{{3.613329080723421*^9, 3.613329105297495*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Cmat", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"Cm", "[", 
     RowBox[{"i", ",", "j"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "4"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", "4"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fullMatrixEquations", " ", "=", " ", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Aop", "\[LeftDoubleBracket]", 
          RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], "/.", 
         RowBox[{"ph", "->", 
          RowBox[{"Cmat", "\[LeftDoubleBracket]", 
           RowBox[{"j", ",", "k"}], "\[RightDoubleBracket]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "4"}], "}"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "4"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"k", ",", "4"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Redefine", " ", "lapF", " ", "to", " ", "collect", " ", "as", " ", 
     "many", " ", "terms", " ", "as", " ", "possible"}], ",", " ", 
    RowBox[{"collect", " ", "in", " ", "mean", " ", "fields"}]}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fullMatrixEquations", "=", 
   RowBox[{"MapAll", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Collect", "[", 
       RowBox[{"#", ",", "meanFieldsWDerivs"}], "]"}], "&"}], ",", 
     RowBox[{
      RowBox[{"fullMatrixEquations", "/.", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"Through", "[", 
          RowBox[{"meanFields", "@@", 
           RowBox[{"{", 
            RowBox[{"z", ",", "t"}], "}"}]}], "]"}], "->", "meanFields"}], 
        "]"}]}], 
      RowBox[{"(*", 
       RowBox[{"Easier", " ", "to", " ", "look", " ", "at"}], "*)"}], "/.", 
      "\[IndentingNewLine]", 
      RowBox[{"iLapF", "\[Rule]", "iLapFColl"}]}]}], 
    RowBox[{"(*", 
     RowBox[{"Collect", " ", "iLapF", " ", "terms"}], "*)"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"fullMatrixEquations", "=", 
  RowBox[{"fullMatrixEquations", "//.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"dz", "[", 
       RowBox[{"a_", "/;", 
        RowBox[{"!", 
         RowBox[{"meanFieldQ", "[", "a", "]"}]}]}], "]"}], "\[RuleDelayed]", 
      RowBox[{"dz", " ", "a"}]}], ",", 
     RowBox[{
      RowBox[{"iLap2", "[", "a_", "]"}], "\[RuleDelayed]", 
      RowBox[{"iLap2", " ", "a"}]}]}], "}"}]}]}]}], "Input",
 CellChangeTimes->{{3.614183523653407*^9, 3.614183619973299*^9}, {
   3.6141837102104187`*^9, 3.61418374185849*^9}, {3.6141849032639017`*^9, 
   3.614184910371166*^9}, {3.6141856403035383`*^9, 3.614185671246872*^9}, {
   3.614185814106379*^9, 3.614185877677721*^9}, {3.614186008201589*^9, 
   3.6141860563838873`*^9}, {3.6141861298094*^9, 3.614186133404842*^9}, {
   3.614186265993711*^9, 3.614186266722341*^9}, {3.61418645140637*^9, 
   3.61418648051291*^9}, {3.614186552940997*^9, 3.6141865737590837`*^9}, {
   3.614188523622821*^9, 3.6141885248935966`*^9}, {3.614189283362381*^9, 
   3.614189315179832*^9}, {3.614189422729567*^9, 3.614189433440941*^9}, {
   3.614189677743164*^9, 3.61418967848466*^9}, {3.6141967572921963`*^9, 
   3.6141967583883953`*^9}, {3.6141989228199043`*^9, 3.614198945631775*^9}, 
   3.614198982104651*^9, {3.614361772710515*^9, 3.6143618063669567`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "2"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "3"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "2"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "3"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"3", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"3", "\[InvisibleComma]", "2"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"3", "\[InvisibleComma]", "3"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"4", "\[InvisibleComma]", "1"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"4", "\[InvisibleComma]", "2"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"4", "\[InvisibleComma]", "3"}]], ",", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"4", "\[InvisibleComma]", "4"}]]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.614186133917675*^9, 3.614186267048477*^9, 3.614186481926425*^9, 
   3.6141885255283833`*^9, 3.614189319838678*^9, {3.6141894304574347`*^9, 
   3.614189433941032*^9}, 3.614189678940024*^9, 3.614195966966*^9, 
   3.614196761527596*^9, {3.61419892962738*^9, 3.614198946179511*^9}, 
   3.61419898388535*^9, {3.614361787735118*^9, 3.614361807137169*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SuperscriptBox[
        SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
        RowBox[{"-", "1"}]], "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], " ", 
         SubscriptBox["k", "y"], " ", "q", " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
        RowBox[{"2", " ", 
         SubscriptBox["\[PartialD]", "z"], " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "+", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "y"], "]"}]}]}], "]"}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SuperscriptBox[
        SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
        RowBox[{"-", "1"}]], "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], " ", 
         SubscriptBox["k", "y"], " ", "q", " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
        RowBox[{"2", " ", 
         SubscriptBox["\[PartialD]", "z"], " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "+", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "y"], "]"}]}]}], "]"}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SuperscriptBox[
        SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
        RowBox[{"-", "1"}]], "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], " ", 
         SubscriptBox["k", "y"], " ", "q", " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
        RowBox[{"2", " ", 
         SubscriptBox["\[PartialD]", "z"], " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"2", "\[InvisibleComma]", "3"}]]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "y"], "]"}]}]}], "]"}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SuperscriptBox[
        SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
        RowBox[{"-", "1"}]], "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         OverscriptBox[
          SubscriptBox["k", "x"], "\[LongDash]"], " ", 
         SubscriptBox["k", "y"], " ", "q", " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
        RowBox[{"2", " ", 
         SubscriptBox["\[PartialD]", "z"], " ", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", " ", 
            SubscriptBox["\[PartialD]", "z"], " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            SuperscriptBox[
             OverscriptBox[
              SubscriptBox["k", "x"], "\[LongDash]"], "2"], " ", 
            SubscriptBox["k", "y"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "+", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             SubscriptBox["\[EmptyUpTriangle]", "2"], 
             RowBox[{"-", "1"}]], " ", 
            OverscriptBox[
             SubscriptBox["k", "x"], "\[LongDash]"], " ", 
            SubsuperscriptBox["k", "y", "2"], " ", 
            SubscriptBox["\[ScriptCapitalC]", 
             RowBox[{"4", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "y"], "]"}]}]}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "1"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "2"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "3"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "3"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "2"}], " ", 
       SubscriptBox["\[PartialD]", "z"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"4", "\[InvisibleComma]", "4"}]]}], "-", 
      RowBox[{
       OverscriptBox[
        SubscriptBox["k", "x"], "\[LongDash]"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "4"}]], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SubscriptBox["\[PartialD]", "z"]}], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"4", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      SubscriptBox["B", "y"], " ", 
      SubscriptBox["k", "y"], " ", 
      SubscriptBox["\[ScriptCapitalC]", 
       RowBox[{"1", "\[InvisibleComma]", "1"}]]}], ",", 
     RowBox[{
      SubscriptBox["B", "y"], " ", 
      SubscriptBox["k", "y"], " ", 
      SubscriptBox["\[ScriptCapitalC]", 
       RowBox[{"1", "\[InvisibleComma]", "2"}]]}], ",", 
     RowBox[{
      SubscriptBox["B", "y"], " ", 
      SubscriptBox["k", "y"], " ", 
      SubscriptBox["\[ScriptCapitalC]", 
       RowBox[{"1", "\[InvisibleComma]", "3"}]]}], ",", 
     RowBox[{
      SubscriptBox["B", "y"], " ", 
      SubscriptBox["k", "y"], " ", 
      SubscriptBox["\[ScriptCapitalC]", 
       RowBox[{"1", "\[InvisibleComma]", "4"}]]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "1"}]]}], "-", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "1"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "1"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "1"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "2"}]]}], "-", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "2"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "2"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "2"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "3"}]]}], "-", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "y"], " ", 
       SubscriptBox["k", "y"], " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"2", "\[InvisibleComma]", "4"}]]}], "-", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], " ", "q", " ", 
       SubscriptBox["\[ScriptCapitalC]", 
        RowBox[{"3", "\[InvisibleComma]", "4"}]]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[PartialD]", "z", "2"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "-", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubsuperscriptBox["k", "y", "2"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
         RowBox[{"2", " ", 
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        SubscriptBox["B", "y"], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], " ", 
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          OverscriptBox[
           SubscriptBox["k", "x"], "\[LongDash]"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"1", "\[InvisibleComma]", "4"}]]}], "+", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "2"], 
           RowBox[{"-", "1"}]], " ", 
          SubscriptBox["k", "y"], " ", 
          SubscriptBox["\[ScriptCapitalC]", 
           RowBox[{"2", "\[InvisibleComma]", "4"}]]}]}], ")"}], " ", 
       RowBox[{
        SubscriptBox["\[PartialD]", "z"], "[", 
        RowBox[{
         SubscriptBox["\[PartialD]", "z"], "[", 
         SubscriptBox["B", "y"], "]"}], "]"}]}]}]}], "}"}]}], "}"}]], "Output",\

 CellChangeTimes->{
  3.614186133917675*^9, 3.614186267048477*^9, 3.614186481926425*^9, 
   3.6141885255283833`*^9, 3.614189319838678*^9, {3.6141894304574347`*^9, 
   3.614189433941032*^9}, 3.614189678940024*^9, 3.614195966966*^9, 
   3.614196761527596*^9, {3.61419892962738*^9, 3.614198946179511*^9}, 
   3.61419898388535*^9, {3.614361787735118*^9, 3.614361807187397*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Put everything into c++ form, including taking the Fourier transforms\
\>", "Subsection",
 CellChangeTimes->{{3.614195675973181*^9, 3.614195696141123*^9}}],

Cell[CellGroupData[{

Cell["Define the various functions to use in c++", "Subsubsection",
 CellChangeTimes->{3.614200068915313*^9}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"CklOut", " ", "=", " ", "\"\<Ckl_out[i]\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ifft", " ", "=", " ", "\"\<fft_.back_2DFull\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fft", " ", "=", " ", "\"\<fft_.for_2DFull\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vecProducts", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"\"\<.asDiagonal()*\>\"", ",", "\"\<*\>\""}], "}"}]}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{"Second", " ", "one", " ", "is", " ", "for", " ", "scalars"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"MFcppVariables", " ", "=", 
   RowBox[{"Thread", "[", " ", 
    RowBox[{"meanFieldsWDerivs", "->", 
     RowBox[{"StringReplace", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"ToString", "[", "#", "]"}], "<>", "\"\<_\>\""}], "&"}], "/@",
         "meanFieldsWDerivs"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<[\>\"", "\[Rule]", "\"\<\>\""}], ",", 
         RowBox[{"\"\<]\>\"", "\[Rule]", "\"\<\>\""}]}], "}"}]}], "]"}]}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"iLapFvar", " ", "=", " ", "\"\<ilapFtmp_.matrix()\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vectorVars", " ", "=", " ", 
   RowBox[{"iLap2", "|", "dz", "|", "iLapFColl"}]}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Variables", " ", "that", " ", "are", " ", "vectors", " ", "in", " ", 
    RowBox[{"c", "++"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"variablesInCpp", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"ky", "\[Rule]", "\"\<kyctmp_\>\""}], ",", 
     RowBox[{"kxb", "\[Rule]", "\"\<kxctmp_\>\""}], ",", 
     RowBox[{"dz", "\[Rule]", "\"\<kz_\>\""}], ",", 
     RowBox[{"q", "\[Rule]", "\"\<q_\>\""}], ",", 
     RowBox[{"iLap2", "\[Rule]", "\"\<ilap2tmp_\>\""}]}], "}"}]}]}]}], "Input",\

 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQAWIQfeAVS0/H21eOxxt/zwXRZ6ReLQLRei+VFoNoHuZ9
G0H02kWzN4NoK0MzhS4gbSbCoQiiTxxtKO4G0iKTZ5SBaE9PiakgWiflPpje
8tLnGIhuKvx+AkRHCK0X6AHS7xT3CILowDYLcRCd8MlSDkT3XXDSBNFOlRfA
dCuHgz6IjkqcAKYDJi4zBtFyfE/BtJjZj5BTQPpHl1w4iHbJrTgPopsWPLoM
oi083O+A6Jr/8x6D6Fct7K9AtJaZOpjeJvbL9jSQLltWYg+ipxgdmg+iNayW
LQDRHf06U84DaY+qhqkg+sauSx8ugMJnvv9HEA0AwX27DA==
  "]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    SubscriptBox["B", "y"], "\[Rule]", "\<\"By_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     SubscriptBox["B", "y"], "]"}], "\[Rule]", "\<\"dzBy_\"\>"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[PartialD]", "z"], "[", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      SubscriptBox["B", "y"], "]"}], "]"}], "\[Rule]", "\<\"dzdzBy_\"\>"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.6141968971191683`*^9, {3.614196955865787*^9, 3.614196976553069*^9}, 
   3.6141970176273737`*^9, {3.614197140642284*^9, 3.6141971499528723`*^9}, 
   3.61420280515613*^9, 3.6142041474039993`*^9, 3.61420432093274*^9, 
   3.614332753782305*^9, 3.6143334373897533`*^9, 3.614334227966806*^9, 
   3.614335330770611*^9, {3.614342317980378*^9, 3.6143423257325563`*^9}, 
   3.614345100654113*^9, 3.614361816160263*^9, 3.614385394517193*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    SubscriptBox["k", "y"], "\[Rule]", "\<\"kyctmp_\"\>"}], ",", 
   RowBox[{
    OverscriptBox[
     SubscriptBox["k", "x"], "\[LongDash]"], "\[Rule]", "\<\"kxctmp_\"\>"}], 
   ",", 
   RowBox[{
    SubscriptBox["\[PartialD]", "z"], "\[Rule]", "\<\"kz_\"\>"}], ",", 
   RowBox[{"q", "\[Rule]", "\<\"q_\"\>"}], ",", 
   RowBox[{
    SuperscriptBox[
     SubscriptBox["\[EmptyUpTriangle]", "2"], 
     RowBox[{"-", "1"}]], "\[Rule]", "\<\"ilap2tmp_\"\>"}]}], "}"}]], "Output",\

 CellChangeTimes->{
  3.6141968971191683`*^9, {3.614196955865787*^9, 3.614196976553069*^9}, 
   3.6141970176273737`*^9, {3.614197140642284*^9, 3.6141971499528723`*^9}, 
   3.61420280515613*^9, 3.6142041474039993`*^9, 3.61420432093274*^9, 
   3.614332753782305*^9, 3.6143334373897533`*^9, 3.614334227966806*^9, 
   3.614335330770611*^9, {3.614342317980378*^9, 3.6143423257325563`*^9}, 
   3.614345100654113*^9, 3.614361816160263*^9, 3.614385394522461*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Find all the coefficients and replace by c++ variables, save these variables \
to automatically compute later\
\>", "Subsubsection",
 CellChangeTimes->{{3.6142001576080503`*^9, 3.6142001733730717`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "coeffList", ",", "fullCppMultVariableList", ",", "vectorCppVars", ",", 
      "scalarCppVars"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"coeffList", "=", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{"MapMatrix", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Cases", "[", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"coeff_", " ", 
               RowBox[{"Cm", "[", 
                RowBox[{"i1_", ",", "i2_"}], "]"}]}], "\[RuleDelayed]", 
              "coeff"}], ",", "\[Infinity]"}], "]"}], "&"}], ",", 
          "fullMatrixEquations"}], "]"}], "]"}], "/.", 
       RowBox[{"Thread", "[", 
        RowBox[{"meanFieldsWDerivs", "\[Rule]", "1"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"coeffList", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "/.", 
         RowBox[{"coeff_", "\[RuleDelayed]", 
          RowBox[{"Rule", "[", 
           RowBox[{"coeff", ",", 
            RowBox[{"convertProdToString", "[", "coeff", "]"}]}], "]"}]}]}], 
        "&"}], "/@", "coeffList"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"coeffList", " ", "=", " ", 
      RowBox[{"DeleteDuplicates", "[", 
       RowBox[{"Sort", "[", 
        RowBox[{"coeffList", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"StringLength", "[", 
            RowBox[{
            "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "]"}], ">", 
           RowBox[{"StringLength", "[", 
            RowBox[{
            "#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "]"}]}], "&"}]}], "]"}], "]"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "Make", " ", "sure", " ", "longest", " ", "products", " ", "are", " ", 
        "first"}], ",", " ", 
       RowBox[{
       "otherwise", " ", "it", " ", "replaces", " ", "others", " ", "too", 
        " ", "early", " ", "and", " ", "they", " ", 
        RowBox[{"don", "'"}], "t", " ", "get", " ", "recognized"}]}], "*)"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"fullMatrixEquationsC", "=", 
      RowBox[{
       RowBox[{"fullMatrixEquations", "/.", "coeffList"}], "/.", 
       RowBox[{
        RowBox[{
         RowBox[{"str1_String", " ", 
          RowBox[{"Cm", "[", 
           RowBox[{"i_", ",", "j_"}], "]"}]}], "+", 
         RowBox[{"str2_String", " ", 
          RowBox[{"Cm", "[", 
           RowBox[{"i_", ",", "j_"}], "]"}]}]}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"StringJoin", "[", 
          RowBox[{"str1", ",", "\"\<PLUS\>\"", ",", "str2"}], "]"}], " ", 
         RowBox[{"Cm", "[", 
          RowBox[{"i", ",", "j"}], "]"}]}]}]}]}], ";", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Now", " ", "there", " ", "are", " ", "only"}], ",", " ", 
       RowBox[{"Mean", " ", "fields", " ", 
        RowBox[{"(", 
         RowBox[{"and", " ", "derivatives"}], ")"}]}], ",", " ", 
       RowBox[{"C", " ", "matrices"}], ",", " ", 
       RowBox[{"string", " ", "variables"}]}], "*)"}], 
     RowBox[{"(*", 
      RowBox[{
      "Second", " ", "replacment", " ", "is", " ", "for", " ", "sums"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Before", " ", "going", " ", "on"}], ",", " ", 
       RowBox[{
        RowBox[{
        "keep", " ", "the", " ", "list", " ", "of", " ", "string", " ", 
         "variables"}], " ", "-", " ", 
        RowBox[{
        "some", " ", "of", " ", "these", " ", "get", " ", "rather", " ", 
         RowBox[{"long", "!"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppMultVariableList", " ", "=", 
      RowBox[{"Union", "[", " ", 
       RowBox[{"Cases", "[", 
        RowBox[{
        "fullMatrixEquationsC", ",", "str_String", ",", "\[Infinity]"}], 
        "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"scalarCppVars", " ", "=", " ", 
      RowBox[{
       RowBox[{"Select", "[", 
        RowBox[{"coeffList", ",", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",",
              "vectorVars", ",", "\[Infinity]"}], "]"}]}], "&"}]}], "]"}], 
       "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", " ", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Separate", " ", "out", " ", "the", " ", "scalar", " ", "variables"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"vectorCppVars", " ", "=", " ", 
      RowBox[{"Complement", "[", 
       RowBox[{"coeffList", ",", "scalarCppVars"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"scalarCppQ", " ", "=", " ", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"Evaluate", "@", "scalarCppVars"}], ",", "#"}], "]"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vectorCppQ", " ", "=", " ", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"Evaluate", "@", "vectorCppVars"}], ",", "#"}], "]"}], 
       "&"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"vec2DiagProd", " ", "=", " ", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"scalarCppQ", "@", "#"}], ",", 
         RowBox[{
         "vecProducts", "\[LeftDoubleBracket]", "2", 
          "\[RightDoubleBracket]"}], ",", 
         RowBox[{
         "vecProducts", "\[LeftDoubleBracket]", "1", 
          "\[RightDoubleBracket]"}]}], "]"}], "&"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Replacement", " ", "rules", " ", "from", " ", 
       RowBox[{"c", "++"}], " ", "variables", " ", "to", " ", "real", " ", 
       "products"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"CppToBasicVariables", "=", 
      RowBox[{"Thread", "[", 
       RowBox[{"fullCppMultVariableList", "\[Rule]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"StringReplace", "[", 
            RowBox[{"fullCppMultVariableList", ",", 
             RowBox[{
              RowBox[{"a__", "~~", "\"\<PLUS\>\"", "~~", "b__"}], 
              "\[RuleDelayed]", 
              RowBox[{"a", "+", "b"}]}]}], "]"}], "/.", 
           RowBox[{"StringExpression", "\[Rule]", "Sequence"}]}], "/.", 
          RowBox[{"coeffList", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}]}], "\[RightDoubleBracket]"}]}], 
         ")"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Collect", " ", "to", " ", "scalar", " ", "and", " ", "vector", " ", 
       "variables"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"CppToBasicVariables", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", 
          RowBox[{"Complement", "[", 
           RowBox[{"CppToBasicVariables", ",", "#"}], "]"}]}], "}"}], "&"}], 
       "@", 
       RowBox[{"Select", "[", 
        RowBox[{"CppToBasicVariables", ",", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"MemberQ", "[", 
            RowBox[{"scalarVariables", ",", 
             RowBox[{
             "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            "]"}]}], "&"}]}], "]"}]}]}], ";"}]}], "\[IndentingNewLine]", 
   "]"}], "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.614199820333446*^9, 3.614199973544842*^9}, {
   3.614200154568696*^9, 3.614200177457288*^9}, {3.614203202742343*^9, 
   3.6142032132053423`*^9}, {3.614203687436726*^9, 3.614203694398652*^9}, {
   3.614204078926628*^9, 3.614204079422367*^9}, 3.6142041354989843`*^9, {
   3.614204166229424*^9, 3.6142042190601587`*^9}, {3.614204254561245*^9, 
   3.614204333690789*^9}, {3.614331697718234*^9, 3.61433174227547*^9}, {
   3.614331906693769*^9, 3.614331911117732*^9}, {3.614331987606147*^9, 
   3.614332000077257*^9}, {3.614332466912683*^9, 3.614332469135511*^9}, {
   3.614332812588958*^9, 3.614332843516348*^9}, {3.614332874370685*^9, 
   3.614332874698839*^9}, {3.614332908946308*^9, 3.6143329191369057`*^9}, {
   3.614333144869622*^9, 3.614333156472726*^9}, {3.6143332710284643`*^9, 
   3.614333279858944*^9}, {3.6143622085326366`*^9, 3.614362280097941*^9}, 
   3.614362399974094*^9, {3.614362430655244*^9, 3.614362460967514*^9}, {
   3.6143846802878942`*^9, 3.614384682302619*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"playterm", "=", 
  RowBox[{"fullMatrixEquationsC", "\[LeftDoubleBracket]", 
   RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}]}]], "Input",
 CellChangeTimes->{{3.614361463599379*^9, 3.6143614779416933`*^9}, {
  3.6143624783231*^9, 3.614362485058634*^9}, {3.614383126316844*^9, 
  3.614383134210391*^9}, {3.614383310871855*^9, 3.6143833156485033`*^9}, {
  3.614383561967888*^9, 3.614383562073267*^9}, {3.614386105995159*^9, 
  3.614386106156345*^9}, {3.614386240795024*^9, 3.614386240981345*^9}, {
  3.6143868117984047`*^9, 3.614386817514009*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\<\"Tky\"\>", " ", 
   SubscriptBox["B", "y"], " ", 
   SubscriptBox["\[ScriptCapitalC]", 
    RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
  RowBox[{
   SuperscriptBox[
    SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
    RowBox[{"-", "1"}]], "[", 
   RowBox[{
    RowBox[{"\<\"Tm2TkxbTkyTq\"\>", " ", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "+", 
    RowBox[{"\<\"T2Tdz\"\>", " ", 
     SubscriptBox["\[ScriptCapitalC]", 
      RowBox[{"2", "\[InvisibleComma]", "3"}]]}], "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"\<\"T2TdzTiLap2TkxbP2Tky\"\>", " ", 
        SubscriptBox["\[ScriptCapitalC]", 
         RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "+", 
       RowBox[{"\<\"T2TiLap2TkxbTkyP2\"\>", " ", 
        SubscriptBox["\[ScriptCapitalC]", 
         RowBox[{"4", "\[InvisibleComma]", "3"}]]}]}], ")"}], " ", 
     RowBox[{
      SubscriptBox["\[PartialD]", "z"], "[", 
      SubscriptBox["B", "y"], "]"}]}]}], "]"}]}]], "Output",
 CellChangeTimes->{
  3.614352675915477*^9, {3.614361472891809*^9, 3.6143614783086977`*^9}, 
   3.614361824792076*^9, 3.614362485415413*^9, 3.614365847017252*^9, {
   3.614383127218351*^9, 3.614383135271162*^9}, 3.614383316327475*^9, 
   3.614383562419972*^9, 3.614386107031999*^9, 3.614386241540565*^9, {
   3.614386813242256*^9, 3.614386818372037*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"ClearAll", "[", 
  RowBox[{"fft", ",", "ifft"}], "]"}]], "Input",
 CellChangeTimes->{{3.614383493230184*^9, 3.6143835004385357`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"CPlus", ",", "Orderless"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{"CTimes", ",", "Orderless"}], "]"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Set", " ", "these", " ", "as", " ", "commutative", " ", "but", " ", "not",
     " ", "associative"}], " ", "*)"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.614361998484365*^9, 3.61436205183426*^9}, {
   3.614363932484488*^9, 3.614363940078691*^9}, {3.6143651914238863`*^9, 
   3.614365192846128*^9}, {3.6143652749506683`*^9, 3.614365285806872*^9}, 
   3.614365590492131*^9}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"term", "=", 
   RowBox[{
    RowBox[{"playterm", "/.", 
     RowBox[{
      RowBox[{"Times", "[", 
       RowBox[{"a___", ",", 
        RowBox[{"B_", "?", "meanFieldQ"}], ",", "b___"}], "]"}], 
      "\[RuleDelayed]", 
      RowBox[{"CTimes", "[", 
       RowBox[{"B", ",", 
        RowBox[{"a", " ", "b"}]}], "]"}]}]}], "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Plus", "\[Rule]", "CPlus"}], ",", 
      RowBox[{"Times", "\[Rule]", "CTimes"}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Head", "[", "term", "]"}], "===", "CTimes"}], ",", 
    RowBox[{"term", " ", "=", " ", 
     RowBox[{"CPlus", "[", "term", "]"}]}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mfgroups", " ", "=", " ", 
   RowBox[{"Position", "[", 
    RowBox[{"term", ",", 
     RowBox[{"CTimes", "[", 
      RowBox[{
       RowBox[{"B_", "?", "meanFieldQ"}], ",", "expr_"}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pseudoCCode", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"CAssign", "[", 
      RowBox[{
       RowBox[{"CTemp", "[", "#", "]"}], ",", 
       RowBox[{"Extract", "[", 
        RowBox[{"term", ",", 
         RowBox[{
         "mfgroups", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}]}],
         "]"}]}], "]"}], "&"}], "/@", 
    RowBox[{"Range", "[", 
     RowBox[{"Length", "[", "mfgroups", "]"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"term", " ", "=", " ", 
   RowBox[{"term", "/.", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Reverse", "/@", "pseudoCCode"}], "/.", 
      RowBox[{"CAssign", "\[Rule]", "Rule"}]}], ")"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pseudoCCode", "=", 
   RowBox[{"pseudoCCode", "/.", 
    RowBox[{
     RowBox[{"CAssign", "[", 
      RowBox[{
       RowBox[{"CTemp", "[", "n_", "]"}], ",", 
       RowBox[{"CTimes", "[", 
        RowBox[{
         RowBox[{"B_", "?", "meanFieldQ"}], ",", "expr_"}], "]"}]}], "]"}], 
     "\[RuleDelayed]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"CAssign", "[", 
        RowBox[{
         RowBox[{"CTemp", "[", "n", "]"}], ",", "expr"}], "]"}], ",", 
       RowBox[{"Cifft", "[", 
        RowBox[{"CTemp", "[", "n", "]"}], "]"}], ",", 
       RowBox[{"CAssign", "[", 
        RowBox[{
         RowBox[{"CTemp", "[", "n", "]"}], ",", 
         RowBox[{"CTimes", "[", 
          RowBox[{"B", ",", 
           RowBox[{"CTemp", "[", "n", "]"}]}], "]"}]}], "]"}], ",", 
       RowBox[{"Cfft", "[", 
        RowBox[{"CTemp", "[", "n", "]"}], "]"}]}], "}"}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"(", 
    RowBox[{"pseudoCCode", " ", "=", " ", 
     RowBox[{"Flatten", "@", 
      RowBox[{"Join", "[", 
       RowBox[{"pseudoCCode", ",", 
        RowBox[{"{", 
         RowBox[{"CAssign", "[", 
          RowBox[{"CBlock", ",", "term"}], "]"}], "}"}]}], "]"}]}]}], ")"}], "//",
    "ColumnForm"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",\

 CellChangeTimes->{{3.614361495193363*^9, 3.614361504754315*^9}, {
   3.614361837677409*^9, 3.6143619408814993`*^9}, {3.614362059268826*^9, 
   3.614362143390728*^9}, {3.614362489641491*^9, 3.614362519232296*^9}, {
   3.614363309771316*^9, 3.614363335052932*^9}, {3.614364014828177*^9, 
   3.614364015434043*^9}, {3.614364292870434*^9, 3.614364322990637*^9}, {
   3.614364362798431*^9, 3.6143643665509567`*^9}, {3.614364664512658*^9, 
   3.614364666179654*^9}, {3.6143647056904573`*^9, 3.614364782511891*^9}, {
   3.61436520986168*^9, 3.6143654672205276`*^9}, {3.614365565676652*^9, 
   3.614365599836343*^9}, {3.6143657471979237`*^9, 3.6143657956852093`*^9}, {
   3.614365828473936*^9, 3.6143658799965677`*^9}, 3.614365967961328*^9, {
   3.614366017607759*^9, 3.614366041752763*^9}, {3.614366112117886*^9, 
   3.614366172359185*^9}, {3.61436676844319*^9, 3.614366823354409*^9}, {
   3.6143668640841503`*^9, 3.6143668773397427`*^9}, {3.614382970548337*^9, 
   3.614382986234198*^9}, {3.614383058381885*^9, 3.614383106788938*^9}, {
   3.614383181735223*^9, 3.614383211845725*^9}, {3.614383465743528*^9, 
   3.6143834822551737`*^9}, {3.614383517482526*^9, 3.6143835195698223`*^9}, {
   3.6143835674834003`*^9, 3.614383598086998*^9}, {3.6143836472734222`*^9, 
   3.614383678382275*^9}, {3.614385686770458*^9, 3.614385687006654*^9}, {
   3.614385977299189*^9, 3.614386000483903*^9}, {3.614386066463676*^9, 
   3.614386078941513*^9}}],

Cell[BoxData[
 InterpretationBox[GridBox[{
    {
     RowBox[{"CAssign", "[", 
      RowBox[{
       RowBox[{"CTemp", "[", "1", "]"}], ",", 
       RowBox[{"CTimes", "[", 
        RowBox[{"\<\"Tky\"\>", ",", 
         SubscriptBox["\[ScriptCapitalC]", 
          RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "]"}]}], "]"}]},
    {
     RowBox[{"Cifft", "[", 
      RowBox[{"CTemp", "[", "1", "]"}], "]"}]},
    {
     RowBox[{"CAssign", "[", 
      RowBox[{
       RowBox[{"CTemp", "[", "1", "]"}], ",", 
       RowBox[{"CTimes", "[", 
        RowBox[{
         SubscriptBox["B", "y"], ",", 
         RowBox[{"CTemp", "[", "1", "]"}]}], "]"}]}], "]"}]},
    {
     RowBox[{"Cfft", "[", 
      RowBox[{"CTemp", "[", "1", "]"}], "]"}]},
    {
     RowBox[{"CAssign", "[", 
      RowBox[{
       RowBox[{"CTemp", "[", "2", "]"}], ",", 
       RowBox[{"CPlus", "[", 
        RowBox[{
         RowBox[{"CTimes", "[", 
          RowBox[{"\<\"T2TdzTiLap2TkxbP2Tky\"\>", ",", 
           SubscriptBox["\[ScriptCapitalC]", 
            RowBox[{"3", "\[InvisibleComma]", "3"}]]}], "]"}], ",", 
         RowBox[{"CTimes", "[", 
          RowBox[{"\<\"T2TiLap2TkxbTkyP2\"\>", ",", 
           SubscriptBox["\[ScriptCapitalC]", 
            RowBox[{"4", "\[InvisibleComma]", "3"}]]}], "]"}]}], "]"}]}], 
      "]"}]},
    {
     RowBox[{"Cifft", "[", 
      RowBox[{"CTemp", "[", "2", "]"}], "]"}]},
    {
     RowBox[{"CAssign", "[", 
      RowBox[{
       RowBox[{"CTemp", "[", "2", "]"}], ",", 
       RowBox[{"CTimes", "[", 
        RowBox[{
         RowBox[{"CTemp", "[", "2", "]"}], ",", 
         RowBox[{
          SubscriptBox["\[PartialD]", "z"], "[", 
          SubscriptBox["B", "y"], "]"}]}], "]"}]}], "]"}]},
    {
     RowBox[{"Cfft", "[", 
      RowBox[{"CTemp", "[", "2", "]"}], "]"}]},
    {
     RowBox[{"CAssign", "[", 
      RowBox[{"CBlock", ",", 
       RowBox[{"CPlus", "[", 
        RowBox[{
         RowBox[{"CTemp", "[", "1", "]"}], ",", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
           RowBox[{"-", "1"}]], "[", 
          RowBox[{"CPlus", "[", 
           RowBox[{
            RowBox[{"CTemp", "[", "2", "]"}], ",", 
            RowBox[{"CTimes", "[", 
             RowBox[{"\<\"T2Tdz\"\>", ",", 
              SubscriptBox["\[ScriptCapitalC]", 
               RowBox[{"2", "\[InvisibleComma]", "3"}]]}], "]"}], ",", 
            RowBox[{"CTimes", "[", 
             RowBox[{"\<\"Tm2TkxbTkyTq\"\>", ",", 
              SubscriptBox["\[ScriptCapitalC]", 
               RowBox[{"1", "\[InvisibleComma]", "3"}]]}], "]"}]}], "]"}], 
          "]"}]}], "]"}]}], "]"}]}
   },
   BaselinePosition->{Baseline, {1, 1}},
   GridBoxAlignment->{
    "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
     "RowsIndexed" -> {}}],
  ColumnForm[{
    $CellContext`CAssign[
     $CellContext`CTemp[1], 
     $CellContext`CTimes["Tky", 
      $CellContext`Cm[3, 3]]], 
    $CellContext`Cifft[
     $CellContext`CTemp[1]], 
    $CellContext`CAssign[
     $CellContext`CTemp[1], 
     $CellContext`CTimes[$CellContext`By, 
      $CellContext`CTemp[1]]], 
    $CellContext`Cfft[
     $CellContext`CTemp[1]], 
    $CellContext`CAssign[
     $CellContext`CTemp[2], 
     $CellContext`CPlus[
      $CellContext`CTimes["T2TdzTiLap2TkxbP2Tky", 
       $CellContext`Cm[3, 3]], 
      $CellContext`CTimes["T2TiLap2TkxbTkyP2", 
       $CellContext`Cm[4, 3]]]], 
    $CellContext`Cifft[
     $CellContext`CTemp[2]], 
    $CellContext`CAssign[
     $CellContext`CTemp[2], 
     $CellContext`CTimes[
      $CellContext`CTemp[2], 
      $CellContext`dz[$CellContext`By]]], 
    $CellContext`Cfft[
     $CellContext`CTemp[2]], 
    $CellContext`CAssign[$CellContext`CBlock, 
     $CellContext`CPlus[
      $CellContext`CTemp[1], 
      $CellContext`iLapFColl[
       $CellContext`CPlus[
        $CellContext`CTemp[2], 
        $CellContext`CTimes["T2Tdz", 
         $CellContext`Cm[2, 3]], 
        $CellContext`CTimes["Tm2TkxbTkyTq", 
         $CellContext`Cm[1, 3]]]]]]}],
  Editable->False]], "Output",
 CellChangeTimes->{
  3.614361505213045*^9, 3.614361859804793*^9, {3.614362070357582*^9, 
   3.614362097635606*^9}, {3.614362132458107*^9, 3.614362144509121*^9}, {
   3.6143624909304333`*^9, 3.6143625197934923`*^9}, 3.614363605481401*^9, 
   3.614364016187151*^9, {3.61436431154397*^9, 3.614364323394022*^9}, 
   3.614364369043331*^9, {3.614364713356159*^9, 3.614364783632936*^9}, 
   3.614364963294969*^9, 3.6143652442775087`*^9, {3.614365457312703*^9, 
   3.6143654791722527`*^9}, 3.6143656005236*^9, 3.614365797323339*^9, {
   3.6143658312479753`*^9, 3.6143658809171963`*^9}, 3.614365994160864*^9, 
   3.6143660317893677`*^9, 3.6143829874177923`*^9, {3.614383085011554*^9, 
   3.614383137727086*^9}, 3.6143832128643084`*^9, 3.614383319689144*^9, {
   3.6143834842191467`*^9, 3.614383503435548*^9}, 3.61438353501341*^9, {
   3.6143835727303953`*^9, 3.614383599190289*^9}, 3.614383679267033*^9, 
   3.614385687789494*^9, 3.614386001500004*^9, {3.614386073270005*^9, 
   3.614386079671369*^9}, 3.6143861114417343`*^9, 3.6143862468177223`*^9, 
   3.61438682240946*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"pseudoCCode", "//.", "COperatorRules"}], "//", 
  "ColumnForm"}]], "Input",
 CellChangeTimes->{3.614386343390059*^9}],

Cell[BoxData[
 InterpretationBox[GridBox[{
    {"\<\"Ctmp_1_ = Tky*C33_\"\>"},
    {"\<\"fft_.back_2DFull( Ctmp_1_ )\"\>"},
    {"\<\"Ctmp_1_ = By_.asDiagonal()*Ctmp_1_\"\>"},
    {"\<\"fft_.for_2DFull( Ctmp_1_ )\"\>"},
    {"\<\"Ctmp_2_ = T2TdzTiLap2TkxbP2Tky.asDiagonal()*C33_ + \
T2TiLap2TkxbTkyP2.asDiagonal()*C43_\"\>"},
    {"\<\"fft_.back_2DFull( Ctmp_2_ )\"\>"},
    {"\<\"Ctmp_2_ = dzBy_.asDiagonal()*Ctmp_2_\"\>"},
    {"\<\"fft_.for_2DFull( Ctmp_2_ )\"\>"},
    {
     RowBox[{"CAssign", "[", 
      RowBox[{"CBlock", ",", 
       RowBox[{"CPlus", "[", 
        RowBox[{
         RowBox[{"CTemp", "[", "1", "]"}], ",", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[EmptyUpTriangle]", "Fc"], 
           RowBox[{"-", "1"}]], "[", 
          RowBox[{"CPlus", "[", 
           
           RowBox[{"\<\"T2Tdz.asDiagonal()*C23_\"\>", 
            ",", "\<\"Tm2TkxbTkyTq*C13_\"\>", ",", 
            RowBox[{"CTemp", "[", "2", "]"}]}], "]"}], "]"}]}], "]"}]}], "]"}]}
   },
   BaselinePosition->{Baseline, {1, 1}},
   GridBoxAlignment->{
    "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
     "RowsIndexed" -> {}}],
  ColumnForm[{
   "Ctmp_1_ = Tky*C33_", "fft_.back_2DFull( Ctmp_1_ )", 
    "Ctmp_1_ = By_.asDiagonal()*Ctmp_1_", "fft_.for_2DFull( Ctmp_1_ )", 
    "Ctmp_2_ = T2TdzTiLap2TkxbP2Tky.asDiagonal()*C33_ + \
T2TiLap2TkxbTkyP2.asDiagonal()*C43_", "fft_.back_2DFull( Ctmp_2_ )", 
    "Ctmp_2_ = dzBy_.asDiagonal()*Ctmp_2_", "fft_.for_2DFull( Ctmp_2_ )", 
    $CellContext`CAssign[$CellContext`CBlock, 
     $CellContext`CPlus[
      $CellContext`CTemp[1], 
      $CellContext`iLapFColl[
       $CellContext`CPlus["T2Tdz.asDiagonal()*C23_", "Tm2TkxbTkyTq*C13_", 
        $CellContext`CTemp[2]]]]]}],
  Editable->False]], "Output",
 CellChangeTimes->{3.6143861294905443`*^9, 3.614386255022265*^9, 
  3.614386344004212*^9, 3.614386374952915*^9, 3.6143868330305767`*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "toCString", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Cm", "/:", 
   RowBox[{"toCString", "[", 
    RowBox[{"Cm", "[", 
     RowBox[{"i_", ",", "j_"}], "]"}], "]"}], ":=", 
   RowBox[{"\"\<C\>\"", "<>", 
    RowBox[{"ToString", "[", "i", "]"}], "<>", 
    RowBox[{"ToString", "[", "j", "]"}], "<>", "\"\<_\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"toCString", "[", "a_String", "]"}], ":=", "a"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CTemp", "/:", 
   RowBox[{"toCString", "[", 
    RowBox[{"CTemp", "[", "n_", "]"}], "]"}], ":=", 
   RowBox[{"\"\<Ctmp_\>\"", "<>", 
    RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<_\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"toCString", "[", 
     RowBox[{"mf_", "?", "meanFieldQ"}], "]"}], ":=", 
    RowBox[{"mf", "/.", "MFcppVariables"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"COperatorRules", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"CTimes", "[", 
       RowBox[{"a_String", ",", "b_"}], "]"}], "\[RuleDelayed]", 
      RowBox[{"a", "<>", 
       RowBox[{"vec2DiagProd", "[", "a", "]"}], "<>", 
       RowBox[{"toCString", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"CTimes", "[", 
       RowBox[{
        RowBox[{"a_", "?", "meanFieldQ"}], ",", "b_"}], "]"}], 
      "\[RuleDelayed]", 
      RowBox[{
       RowBox[{"toCString", "[", "a", "]"}], "<>", 
       RowBox[{"vec2DiagProd", "[", "a", "]"}], "<>", 
       RowBox[{"toCString", "[", "b", "]"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"CPlus", "[", "a__String", "]"}], "\[RuleDelayed]", 
      RowBox[{"ToString", "@", 
       RowBox[{"Row", "[", 
        RowBox[{
         RowBox[{"{", "a", "}"}], ",", "\"\< + \>\""}], "]"}]}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"CAssign", "[", 
       RowBox[{"tmp_", ",", "b_String"}], "]"}], "\[RuleDelayed]", 
      RowBox[{
       RowBox[{"toCString", "[", "tmp", "]"}], "<>", "\"\< = \>\"", "<>", 
       "b"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Cfft", "[", "a_CTemp", "]"}], "\[RuleDelayed]", 
      RowBox[{"fft", "<>", "\"\<( \>\"", "<>", 
       RowBox[{"toCString", "@", "a"}], "<>", " ", "\"\< )\>\""}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Cifft", "[", "a_CTemp", "]"}], "\[RuleDelayed]", 
      RowBox[{"ifft", "<>", "\"\<( \>\"", "<>", 
       RowBox[{"toCString", "@", "a"}], "<>", " ", "\"\< )\>\""}]}]}], 
    "\[IndentingNewLine]", "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6143840350999737`*^9, 3.614384248074408*^9}, {
   3.614384373301462*^9, 3.614384393958157*^9}, {3.614384442741721*^9, 
   3.614384505722273*^9}, {3.6143845430550127`*^9, 3.614384652979141*^9}, {
   3.614384696676548*^9, 3.614384710556589*^9}, {3.614384750476577*^9, 
   3.6143848481869717`*^9}, {3.6143848801250753`*^9, 3.614384935798448*^9}, {
   3.614385012861738*^9, 3.6143850408986*^9}, {3.61438512518581*^9, 
   3.614385176533724*^9}, {3.614385231128735*^9, 3.6143853050604267`*^9}, {
   3.614385335964363*^9, 3.61438535217969*^9}, {3.614385401313758*^9, 
   3.6143854791480722`*^9}, 3.61438560431281*^9, {3.6143858739788513`*^9, 
   3.614385885737006*^9}, {3.6143860894460373`*^9, 3.614386116576591*^9}, {
   3.614386356328936*^9, 3.614386371578128*^9}, {3.614386701403512*^9, 
   3.6143867383274727`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[{
 "Build up series of expressions from the innermost level to the outermost - \
This is all wrong! Can only work like this if fft returns matrix ",
 StyleBox["by value",
  FontSlant->"Italic"],
 " and this will be very slow!"
}], "Subsubsection",
 CellChangeTimes->{
  3.614200054556031*^9, {3.6143478619510098`*^9, 3.6143478858200912`*^9}, {
   3.61434792293554*^9, 3.614347955615529*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Change", " ", "inner", " ", "products", " ", "and", " ", "take", " ", 
    "first", " ", "fourier", " ", "transform"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"fullMatrixInC", "=", 
     RowBox[{
      RowBox[{"fullMatrixEquationsC", "/.", 
       RowBox[{
        RowBox[{"coef_String", " ", 
         RowBox[{"Cm", "[", 
          RowBox[{"i1_", ",", "i2_"}], "]"}]}], "\[RuleDelayed]", 
        RowBox[{"StringJoin", "[", 
         RowBox[{"ifft", ",", "\"\<(\>\"", ",", "coef", ",", 
          RowBox[{"vec2DiagProd", "[", "coef", "]"}], ",", "\"\<C\>\"", ",", 
          RowBox[{"ToString", "[", "i1", "]"}], ",", 
          RowBox[{"ToString", "[", "i2", "]"}], ",", "\"\<_ )\>\""}], 
         "]"}]}]}], "//.", 
      RowBox[{
       RowBox[{"a_String", "+", "b_String"}], "\[RuleDelayed]", 
       RowBox[{
       "\"\<(\>\"", "<>", "a", "<>", "\"\<+\>\"", "<>", "b", "<>", 
        "\"\<)\>\""}]}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
      "Remove", " ", "fft", " ", "on", " ", "those", " ", "with", " ", "no", 
       " ", "MF", " ", "product"}], " ", "-", " ", 
      RowBox[{
      "these", " ", "will", " ", "be", " ", "a", " ", "string", " ", "by", 
       " ", "themselves"}]}], ",", " ", 
     RowBox[{"not", " ", "multiplied", " ", "by", " ", "anything"}]}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fullMatrixInC", "=", 
     RowBox[{"fullMatrixInC", "/.", 
      RowBox[{
       RowBox[{"a_String", "+", "b_"}], "\[RuleDelayed]", 
       RowBox[{
        RowBox[{"StringReplace", "[", 
         RowBox[{"a", ",", 
          RowBox[{"ifft", "\[Rule]", "\"\<\>\""}]}], "]"}], "+", "b"}]}]}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Product", " ", "with", " ", "mean", " ", "fields"}], " ", "*)"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fullMatrixInC", " ", "=", " ", 
     RowBox[{"fullMatrixInC", " ", "/.", 
      RowBox[{
       RowBox[{
        RowBox[{"Ccoef_", " ", "mf_"}], "/;", 
        RowBox[{"MemberQ", "[", 
         RowBox[{"meanFieldsWDerivs", ",", "mf"}], "]"}]}], "\[RuleDelayed]", 
       
       RowBox[{"StringJoin", "[", 
        RowBox[{"fft", ",", "\"\<(\>\"", ",", 
         RowBox[{"mf", "/.", "MFcppVariables"}], ",", 
         RowBox[{
         "vecProducts", "\[LeftDoubleBracket]", "1", 
          "\[RightDoubleBracket]"}], ",", "\"\<(\>\"", ",", "Ccoef", ",", 
         "\"\<)\>\"", ",", "\"\<)\>\""}], "]"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "There", " ", "should", " ", "be", " ", "no", " ", "multiplications", 
      " ", "left", " ", "now"}], ",", " ", 
     RowBox[{"only", " ", "+", " ", 
      RowBox[{"and", " ", "iLapFColl"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Change", " ", "Plus", " ", "to", " ", "String", " ", "and", " ", "Deal", 
     " ", "with", " ", "iLapF", " ", "operator", " ", "in", " ", "U", " ", 
     "components"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"fullMatrixInC", " ", "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"fullMatrixInC", "//.", 
       RowBox[{
        RowBox[{"a_String", "+", "b_String"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", "\"\<+\>\"", "<>", "b"}]}]}], "/.", 
      RowBox[{
       RowBox[{"iLapFColl", "[", "expr_String", "]"}], "\[RuleDelayed]", 
       RowBox[{"iLapFvar", "<>", 
        RowBox[{
        "vecProducts", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
         "<>", "\"\<(\>\"", "<>", "expr", "<>", "\"\<)\>\""}]}]}], "//.", 
     RowBox[{
      RowBox[{"a_String", "+", "b_String"}], "\[RuleDelayed]", 
      RowBox[{"a", "<>", "\"\<+\>\"", "<>", "b"}]}]}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.6141958165031767`*^9, 3.6141959120358*^9}, {
   3.61419598019985*^9, 3.614196066714016*^9}, {3.6141964145231457`*^9, 
   3.61419642658215*^9}, {3.614196481653386*^9, 3.614196552823565*^9}, {
   3.6141967277242823`*^9, 3.614196733364603*^9}, {3.614196807363927*^9, 
   3.6141968096942863`*^9}, {3.614197021245562*^9, 3.614197119481237*^9}, {
   3.6141971548294277`*^9, 3.61419719590242*^9}, {3.614197261794786*^9, 
   3.614197276993313*^9}, {3.614198100626856*^9, 3.6141981748510447`*^9}, {
   3.6141982787062073`*^9, 3.6141982961902313`*^9}, {3.614198474251419*^9, 
   3.61419848283444*^9}, {3.6141996232935953`*^9, 3.614199648578558*^9}, {
   3.614199794758665*^9, 3.614199827121056*^9}, {3.6142000468855247`*^9, 
   3.614200051095632*^9}, {3.614201472814435*^9, 3.614201499819854*^9}, {
   3.6142015508794928`*^9, 3.614201558894203*^9}, 3.614201601713216*^9, {
   3.61420215583881*^9, 3.614202162510038*^9}, {3.6142024444126053`*^9, 
   3.614202485502112*^9}, {3.614202638800509*^9, 3.614202653174382*^9}, {
   3.614202738606391*^9, 3.614202772119869*^9}, {3.614202816911977*^9, 
   3.614202841862109*^9}, {3.614202896942566*^9, 3.6142030206230717`*^9}, {
   3.614203061223126*^9, 3.6142032074211493`*^9}, 3.614203254404257*^9, {
   3.614203526263732*^9, 3.61420353528568*^9}, {3.614203986908692*^9, 
   3.614204026092698*^9}, 3.614204058012444*^9, {3.61420439522873*^9, 
   3.6142044300279617`*^9}, 3.614204626207045*^9, {3.614331738782648*^9, 
   3.614331749414591*^9}, {3.614331787870096*^9, 3.61433181055821*^9}, {
   3.6143450092741137`*^9, 3.614345011369507*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"\<\"fft_.for_2DFull(By_.asDiagonal()*(fft_.back_2DFull(Tky*C31_ \
)))+ilapFtmp_.matrix().asDiagonal()*(fft_.for_2DFull(dzBy_.asDiagonal()*((fft_\
.back_2DFull(T2TdzTiLap2TkxbP2Tky.asDiagonal()*C31_ \
)+fft_.back_2DFull(T2TiLap2TkxbTkyP2.asDiagonal()*C41_ \
))))+((T2Tdz.asDiagonal()*C21_ )+(Tm2TkxbTkyTq*C11_ )))\"\>", 
     ",", "\<\"fft_.for_2DFull(By_.asDiagonal()*(fft_.back_2DFull(Tky*C32_ \
)))+ilapFtmp_.matrix().asDiagonal()*(fft_.for_2DFull(dzBy_.asDiagonal()*((fft_\
.back_2DFull(T2TdzTiLap2TkxbP2Tky.asDiagonal()*C32_ \
)+fft_.back_2DFull(T2TiLap2TkxbTkyP2.asDiagonal()*C42_ \
))))+((T2Tdz.asDiagonal()*C22_ )+(Tm2TkxbTkyTq*C12_ )))\"\>", 
     ",", "\<\"fft_.for_2DFull(By_.asDiagonal()*(fft_.back_2DFull(Tky*C33_ \
)))+ilapFtmp_.matrix().asDiagonal()*(fft_.for_2DFull(dzBy_.asDiagonal()*((fft_\
.back_2DFull(T2TdzTiLap2TkxbP2Tky.asDiagonal()*C33_ \
)+fft_.back_2DFull(T2TiLap2TkxbTkyP2.asDiagonal()*C43_ \
))))+((T2Tdz.asDiagonal()*C23_ )+(Tm2TkxbTkyTq*C13_ )))\"\>", 
     ",", "\<\"fft_.for_2DFull(By_.asDiagonal()*(fft_.back_2DFull(Tky*C34_ \
)))+ilapFtmp_.matrix().asDiagonal()*(fft_.for_2DFull(dzBy_.asDiagonal()*((fft_\
.back_2DFull(T2TdzTiLap2TkxbP2Tky.asDiagonal()*C34_ \
)+fft_.back_2DFull(T2TiLap2TkxbTkyP2.asDiagonal()*C44_ \
))))+((T2Tdz.asDiagonal()*C24_ )+(Tm2TkxbTkyTq*C14_ )))\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"fft_.for_2DFull(By_.asDiagonal()*(fft_.back_2DFull(Tky*C41_ \
)))+fft_.for_2DFull(dzBy_.asDiagonal()*(fft_.back_2DFull(Tmkxb*C31_ \
)))+fft_.for_2DFull(dzdzBy_.asDiagonal()*((fft_.back_2DFull(TmdzTiLap2Tkxb.\
asDiagonal()*C31_ )+fft_.back_2DFull(TmiLap2Tky.asDiagonal()*C41_ \
))))+(TdzTqPLUSTm2Tdz.asDiagonal()*C11_ )\"\>", 
     ",", "\<\"fft_.for_2DFull(By_.asDiagonal()*(fft_.back_2DFull(Tky*C42_ \
)))+fft_.for_2DFull(dzBy_.asDiagonal()*(fft_.back_2DFull(Tmkxb*C32_ \
)))+fft_.for_2DFull(dzdzBy_.asDiagonal()*((fft_.back_2DFull(TmdzTiLap2Tkxb.\
asDiagonal()*C32_ )+fft_.back_2DFull(TmiLap2Tky.asDiagonal()*C42_ \
))))+(TdzTqPLUSTm2Tdz.asDiagonal()*C12_ )\"\>", 
     ",", "\<\"fft_.for_2DFull(By_.asDiagonal()*(fft_.back_2DFull(Tky*C43_ \
)))+fft_.for_2DFull(dzBy_.asDiagonal()*(fft_.back_2DFull(Tmkxb*C33_ \
)))+fft_.for_2DFull(dzdzBy_.asDiagonal()*((fft_.back_2DFull(TmdzTiLap2Tkxb.\
asDiagonal()*C33_ )+fft_.back_2DFull(TmiLap2Tky.asDiagonal()*C43_ \
))))+(TdzTqPLUSTm2Tdz.asDiagonal()*C13_ )\"\>", 
     ",", "\<\"fft_.for_2DFull(By_.asDiagonal()*(fft_.back_2DFull(Tky*C44_ \
)))+fft_.for_2DFull(dzBy_.asDiagonal()*(fft_.back_2DFull(Tmkxb*C34_ \
)))+fft_.for_2DFull(dzdzBy_.asDiagonal()*((fft_.back_2DFull(TmdzTiLap2Tkxb.\
asDiagonal()*C34_ )+fft_.back_2DFull(TmiLap2Tky.asDiagonal()*C44_ \
))))+(TdzTqPLUSTm2Tdz.asDiagonal()*C14_ )\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"fft_.for_2DFull(By_.asDiagonal()*(fft_.back_2DFull(Tky*C11_ \
)))\"\>", 
     ",", "\<\"fft_.for_2DFull(By_.asDiagonal()*(fft_.back_2DFull(Tky*C12_ \
)))\"\>", 
     ",", "\<\"fft_.for_2DFull(By_.asDiagonal()*(fft_.back_2DFull(Tky*C13_ \
)))\"\>", 
     ",", "\<\"fft_.for_2DFull(By_.asDiagonal()*(fft_.back_2DFull(Tky*C14_ \
)))\"\>"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\<\"fft_.for_2DFull(By_.asDiagonal()*(fft_.back_2DFull(Tky*C21_ \
)))+fft_.for_2DFull(dzBy_.asDiagonal()*((fft_.back_2DFull(T2TdzTiLap2Tky.\
asDiagonal()*C21_ \
)+fft_.back_2DFull(TdzP2TiLap2TkxbPLUSTmiLap2TkxbTkyP2.asDiagonal()*C11_ \
))))+fft_.for_2DFull(dzdzBy_.asDiagonal()*((fft_.back_2DFull(TdzTiLap2Tkxb.\
asDiagonal()*C11_ )+fft_.back_2DFull(TiLap2Tky.asDiagonal()*C21_ \
))))+(TmdzTq.asDiagonal()*C31_ )\"\>", 
     ",", "\<\"fft_.for_2DFull(By_.asDiagonal()*(fft_.back_2DFull(Tky*C22_ \
)))+fft_.for_2DFull(dzBy_.asDiagonal()*((fft_.back_2DFull(T2TdzTiLap2Tky.\
asDiagonal()*C22_ \
)+fft_.back_2DFull(TdzP2TiLap2TkxbPLUSTmiLap2TkxbTkyP2.asDiagonal()*C12_ \
))))+fft_.for_2DFull(dzdzBy_.asDiagonal()*((fft_.back_2DFull(TdzTiLap2Tkxb.\
asDiagonal()*C12_ )+fft_.back_2DFull(TiLap2Tky.asDiagonal()*C22_ \
))))+(TmdzTq.asDiagonal()*C32_ )\"\>", 
     ",", "\<\"fft_.for_2DFull(By_.asDiagonal()*(fft_.back_2DFull(Tky*C23_ \
)))+fft_.for_2DFull(dzBy_.asDiagonal()*((fft_.back_2DFull(T2TdzTiLap2Tky.\
asDiagonal()*C23_ \
)+fft_.back_2DFull(TdzP2TiLap2TkxbPLUSTmiLap2TkxbTkyP2.asDiagonal()*C13_ \
))))+fft_.for_2DFull(dzdzBy_.asDiagonal()*((fft_.back_2DFull(TdzTiLap2Tkxb.\
asDiagonal()*C13_ )+fft_.back_2DFull(TiLap2Tky.asDiagonal()*C23_ \
))))+(TmdzTq.asDiagonal()*C33_ )\"\>", 
     ",", "\<\"fft_.for_2DFull(By_.asDiagonal()*(fft_.back_2DFull(Tky*C24_ \
)))+fft_.for_2DFull(dzBy_.asDiagonal()*((fft_.back_2DFull(T2TdzTiLap2Tky.\
asDiagonal()*C24_ \
)+fft_.back_2DFull(TdzP2TiLap2TkxbPLUSTmiLap2TkxbTkyP2.asDiagonal()*C14_ \
))))+fft_.for_2DFull(dzdzBy_.asDiagonal()*((fft_.back_2DFull(TdzTiLap2Tkxb.\
asDiagonal()*C14_ )+fft_.back_2DFull(TiLap2Tky.asDiagonal()*C24_ \
))))+(TmdzTq.asDiagonal()*C34_ )\"\>"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.614202486188776*^9, 3.61420250925597*^9}, {
   3.614202991990562*^9, 3.614203021122381*^9}, {3.614203068812635*^9, 
   3.614203075217762*^9}, {3.6142032086538754`*^9, 3.6142032219564457`*^9}, 
   3.614203257664434*^9, {3.614203536499028*^9, 3.614203541700697*^9}, {
   3.614204432520212*^9, 3.614204454577168*^9}, 3.6143317699990683`*^9, 
   3.614342329139731*^9, 3.614345013938983*^9, 3.6143451047510347`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Split up and assign to Ckl_out", "Subsubsection",
 CellChangeTimes->{{3.6142046790049763`*^9, 3.614204686099799*^9}, {
  3.6142051931686783`*^9, 3.614205195159081*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "ind2EigenBlock", ",", "variableDef", ",", "vecVarStringList", ",", 
      "scalarVarStringList", ",", "vectorVarQ", ",", "scalarVarQ"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Function", " ", "to", " ", 
      RowBox[{"take", " ", ".", "block"}], 
      RowBox[{"(", ")"}], " ", "method", " ", "of", " ", "Ckl_out", " ", 
      "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"ind2EigenBlock", "[", 
       RowBox[{"i_", ",", "j_"}], "]"}], ":=", 
      RowBox[{"StringReplace", "[", 
       RowBox[{
        RowBox[{"CklOut", "<>", "\"\<.block( \>\"", "<>", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"i", "-", "1"}], ")"}], "NZ"}], ",", "InputForm"}], 
          "]"}], "<>", "\"\<, \>\"", "<>", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"j", "-", "1"}], ")"}], "NZ"}], ",", "InputForm"}], 
          "]"}], "<>", "\"\<, NZ, NZ)\>\""}], ",", 
        RowBox[{"\"\<NZ\>\"", "\[Rule]", "\"\<NZ_\>\""}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Form", " ", "the", " ", "full", " ", "equations", " ", "as", " ", "a", 
       " ", "single", " ", "text", " ", "block"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"fullEquations", " ", "=", " ", 
      RowBox[{"StringJoin", "@@", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ind2EigenBlock", "[", 
            RowBox[{"i", ",", "j"}], "]"}], "<>", "\"\<  =  \>\"", "<>", 
           "\"\<dealias(  \>\"", "<>", 
           RowBox[{"fullMatrixInC", "\[LeftDoubleBracket]", 
            RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], "<>", 
           "\"\<  );\\n\\n\\n\>\""}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "4"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "4"}], "}"}]}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Form", " ", "the", " ", "variable", " ", "definitions"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"vecVarStringList", " ", "=", 
      RowBox[{
       RowBox[{"List", "@@", "vectorVars"}], "/.", "variablesInCpp"}]}], ";", 
     " ", 
     RowBox[{"(*", " ", 
      RowBox[{"List", " ", "of", " ", "vector", " ", "variables"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"scalarVarStringList", " ", "=", " ", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"variablesInCpp", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
        "vecVarStringList"}], "]"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{"List", " ", "of", " ", "vector", " ", "variables"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"vectorVarQ", " ", "=", " ", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "[", "vecVarStringList", "]"}], ";", 
           "vecVarStringList"}], ")"}], ",", "#"}], "]"}], "&"}]}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Returns", " ", "true", " ", "for", " ", "vector", " ", "variable"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"scalarVarQ", " ", "=", " ", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "[", "scalarVarStringList", "]"}], ";",
            "scalarVarStringList"}], ")"}], ",", "#"}], "]"}], " ", "&"}]}], 
     ";", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Returns", " ", "true", " ", "for", " ", "scalar", " ", "variable"}], 
      " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Collect", " ", "matrix", " ", "bits", " ", "together"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"CppToBasicVariables", "/.", "variablesInCpp"}], "/.", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"a_", "?", "vectorVarQ"}], "^", "2"}], "\[RuleDelayed]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"vecVarStringList", ",", 
              RowBox[{"a", "<>", "\"\<*\>\"", "<>", "a"}]}], "]"}], ";", 
            RowBox[{"a", "<>", "\"\<*\>\"", "<>", "a"}]}], ")"}]}]}], "/.", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"a_", "?", "vectorVarQ"}], "  ", 
          RowBox[{"b_", "?", "vectorVarQ"}]}], "\[RuleDelayed]", 
         RowBox[{
         "\"\<(\>\"", "<>", "a", "<>", "\"\<*\>\"", "<>", "b", "<>", 
          "\"\<).matrix()\>\""}]}]}], "/.", 
       RowBox[{
        RowBox[{"a_", "?", "vectorVarQ"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", "\"\<.matrix()\>\""}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Collect", " ", "scalar", " ", "bits", " ", "together"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"fullCppVaribles", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"a_", "?", "scalarVarQ"}], "^", "2"}], "\[RuleDelayed]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"scalarVarStringList", ",", 
               RowBox[{"a", "<>", "\"\<*\>\"", "<>", "a"}]}], "]"}], ";", 
             RowBox[{"a", "<>", "\"\<*\>\"", "<>", "a"}]}], ")"}]}]}], "/.", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"a_", "?", "scalarVarQ"}], " ", 
           RowBox[{"b_", "?", "scalarVarQ"}]}], "\[RuleDelayed]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"scalarVarStringList", ",", 
              RowBox[{"a", "<>", "\"\<*\>\"", "<>", "b"}]}], "]"}], ";", 
            RowBox[{"a", "<>", "\"\<*\>\"", "<>", "b"}]}], ")"}]}]}], "/.", 
        RowBox[{
         RowBox[{
          RowBox[{"n_", "?", "NumericQ"}], " ", 
          RowBox[{"a_", "?", "scalarVarQ"}]}], "\[RuleDelayed]", 
         RowBox[{"\"\<(\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"N", "[", "n", "]"}], "]"}], "<>", "\"\<*\>\"", "<>", "a", 
          "<>", "\"\<)\>\""}]}]}], "/.", 
       RowBox[{
        RowBox[{
         RowBox[{"n_", "?", "NumericQ"}], " ", "b_String"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"ToString", "[", 
          RowBox[{"N", "[", "n", "]"}], "]"}], "<>", "\"\<*\>\"", "<>", 
         "b"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fullCppVaribles", " ", "=", " ", 
      RowBox[{
       RowBox[{"fullCppVaribles", "/.", 
        RowBox[{
         RowBox[{"a_String", " ", "b_String"}], "\[RuleDelayed]", 
         RowBox[{"a", "<>", "\"\<*\>\"", "<>", "b"}]}]}], "/.", 
       RowBox[{
        RowBox[{"a_String", " ", "+", " ", "b_String"}], "\[RuleDelayed]", 
        RowBox[{"a", "<>", "\"\< + \>\"", "<>", "b"}]}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Declare", " ", "variables", " ", 
       RowBox[{"(", 
        RowBox[{"in", " ", "class", " ", "definition"}], ")"}]}], " ", "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"classVariableDec", " ", "=", " ", 
      RowBox[{"\"\<dcmplxVecM \>\"", "<>", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{
          RowBox[{"CppToBasicVariables", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}], 
          ",", "\"\<, \>\""}], "]"}]}], "<>", "\"\<;\\n\\n\>\"", "<>", 
       "\[IndentingNewLine]", "\"\<dcmplx \>\"", "<>", 
       RowBox[{"ToString", "@", 
        RowBox[{"Row", "[", 
         RowBox[{
          RowBox[{"CppToBasicVariables", "\[LeftDoubleBracket]", 
           RowBox[{"2", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}], 
          ",", "\"\<, \>\""}], "]"}]}], "<>", "\"\<;\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Assign", " ", "memory", " ", "to", " ", "variables", " ", "in", " ", 
       "class", " ", "constructor"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"classConstrAssignMem", " ", "=", 
      RowBox[{"StringJoin", "@@", 
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "<>", "\"\< = dcmplxVecM(NZ_);\\n\>\""}], "&"}], "/@", 
         
         RowBox[{"CppToBasicVariables", "\[LeftDoubleBracket]", 
          RowBox[{"1", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}]}], 
        ")"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Assign", " ", "variables", " ", "inside", " ", "the", " ", 
       "equations"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"assignCppVarsInEqs", " ", "=", 
      RowBox[{
      "\"\<// Vector variable definition (automatic)\\n\>\"", "<>", " ", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "<>", "\"\< = \>\"", " ", "<>", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "<>", "\"\<;\\n\>\""}], "&"}], "/@", 
          RowBox[{
          "fullCppVaribles", "\[LeftDoubleBracket]", "1", 
           "\[RightDoubleBracket]"}]}], ")"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"assignCppVarsInEqs", " ", "=", 
      RowBox[{
      "\"\<// Scalar variable definition (automatic)\\n\>\"", "<>", " ", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "<>", "\"\< = \>\"", " ", "<>", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "<>", "\"\<;\\n\>\""}], "&"}], "/@", 
          RowBox[{
          "fullCppVaribles", "\[LeftDoubleBracket]", "2", 
           "\[RightDoubleBracket]"}]}], ")"}]}], "<>", "\"\<\\n\>\"", "<>", 
       "assignCppVarsInEqs"}]}], ";"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]",
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
    "SAVE", " ", "ALL", " ", "THIS", " ", "STUFF", " ", "TO", " ", "FILE"}], 
    " ", "*)"}],
   FontColor->RGBColor[0.5, 0, 0.5]]}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{
  "\"\<~/Documents/MRIDSS/Mathematica/MMA_Generated_Equations_BQlin.cpp\>\"", 
   ",", "\[IndentingNewLine]", 
   RowBox[{
   "\"\<// Automatically generated temporary variables - class \
definition\\n\>\"", "<>", "\[IndentingNewLine]", "classVariableDec", "<>", 
    "\"\<\\n\\n\\n\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
    "\"\<// Automatically generated temporary variables - class \
constructor\\n\>\"", "<>", "\[IndentingNewLine]", "classConstrAssignMem", 
    "<>", "\"\<\\n\\n\\n\\n\\n\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
    "\"\<//Assign automatically generated variables in equations \\n\>\"", "<>",
     "\[IndentingNewLine]", "assignCppVarsInEqs", "<>", 
    "\"\<\\n\\n\\n\\n\\n\\n\\n\>\"", "<>", "\[IndentingNewLine]", 
    "\"\<////////////////////////////////////////////////////////\\n\>\"", "<>",
     "\[IndentingNewLine]", 
    "\"\<///       AUTOMATICALLY GENERATED EQUATIONS         /////\\n\>\"", "<>",
     "\[IndentingNewLine]", 
    "\"\<///       see GenerateC++Equations.nb in MMA        /////\\n\\n\>\"",
     "<>", "\[IndentingNewLine]", "fullEquations", "<>", 
    "\[IndentingNewLine]", 
    "\"\<///     AUTOMATICALLY GENERATED EQUATIONS - END       ///\\n\>\"", "<>",
     "\[IndentingNewLine]", 
    "\"\<////////////////////////////////////////////////////////\\n\>\""}], 
   ",", "\[IndentingNewLine]", "\"\<Text\>\""}], 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.6142047962878428`*^9, 3.6142048287650623`*^9}, {
   3.6142048623685904`*^9, 3.614204871407317*^9}, {3.614204927104175*^9, 
   3.614205167284988*^9}, {3.6142056503063517`*^9, 3.61420569620709*^9}, {
   3.614205733874864*^9, 3.6142057372347527`*^9}, {3.614205801605402*^9, 
   3.6142058147158327`*^9}, {3.614205856654711*^9, 3.614205911695675*^9}, {
   3.614206098560555*^9, 3.6142061335704403`*^9}, {3.614206170108762*^9, 
   3.6142061881144047`*^9}, 3.614206293851531*^9, {3.614206461617001*^9, 
   3.614206486966379*^9}, {3.6142065247418213`*^9, 3.614206525340083*^9}, {
   3.6142065934740763`*^9, 3.6142066005860767`*^9}, {3.614206631795189*^9, 
   3.61420665105902*^9}, {3.6142067668503103`*^9, 3.614206811713435*^9}, {
   3.614206859537304*^9, 3.614206860286922*^9}, {3.6142944293493757`*^9, 
   3.6142944433506927`*^9}, {3.614333316719392*^9, 3.6143334120699873`*^9}, {
   3.614333444377398*^9, 3.614333520964388*^9}, {3.614334399437749*^9, 
   3.61433440340563*^9}, {3.6143353683089323`*^9, 3.614335386748166*^9}, {
   3.6143356115565863`*^9, 3.614335642695072*^9}, {3.614335677308119*^9, 
   3.6143357063543158`*^9}, {3.61433586767843*^9, 3.614336158690496*^9}, {
   3.614336266943084*^9, 3.614336291062385*^9}, {3.614336322628447*^9, 
   3.614336357271209*^9}, {3.614336422201798*^9, 3.61433649219413*^9}, {
   3.6143365411420527`*^9, 3.614336642975008*^9}, {3.614336674388867*^9, 
   3.6143367439724493`*^9}, {3.6143368053654327`*^9, 3.614336827572853*^9}, {
   3.614336871824078*^9, 3.6143368722227917`*^9}, {3.614336903252371*^9, 
   3.614336957793364*^9}, {3.614337118801602*^9, 3.614337369809972*^9}, {
   3.6143374183062*^9, 3.614337432720202*^9}, {3.6143375078514223`*^9, 
   3.6143375282046423`*^9}, {3.6143376036820707`*^9, 3.614337849225244*^9}, {
   3.6143384130703163`*^9, 3.6143384249236937`*^9}, {3.614342468760648*^9, 
   3.614342483795895*^9}, {3.614344870214403*^9, 3.6143448765804043`*^9}}],

Cell[BoxData["\<\"~/Documents/MRIDSS/Mathematica/MMA_Generated_Equations_\
BQlin.cpp\"\>"], "Output",
 CellChangeTimes->{
  3.6143387121822042`*^9, 3.614342337188706*^9, 3.614342486239141*^9, {
   3.6143448771742496`*^9, 3.61434488321599*^9}, 3.6143450218542852`*^9, 
   3.6143451076824017`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.6143378889821978`*^9, 3.614338230303166*^9}, {
   3.6143382939198513`*^9, 3.614338294008173*^9}, 3.614338411953074*^9}],

Cell[BoxData["\<\"~/Documents/MRIDSS/Mathematica/MMA_Generated_Equations_\
BQlin.cpp\"\>"], "Output",
 CellChangeTimes->{3.614338232191071*^9, 3.6143382962602863`*^9}]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1436, 852},
WindowMargins->{{Automatic, 0}, {Automatic, 4}},
FrontEndVersion->"10.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (June 27, \
2014)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 105, 1, 92, "Title"],
Cell[687, 25, 239, 4, 81, "Subtitle"],
Cell[CellGroupData[{
Cell[951, 33, 179, 3, 64, "Section",
 InitializationGroup->True],
Cell[CellGroupData[{
Cell[1155, 40, 271, 5, 35, "Subsubsection",
 InitializationGroup->True],
Cell[1429, 47, 16968, 435, 1509, "Input",
 InitializationGroup->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[18434, 487, 207, 3, 35, "Subsubsection",
 InitializationGroup->True],
Cell[18644, 492, 8230, 214, 403, "Input",
 InitializationGroup->True],
Cell[26877, 708, 355, 7, 49, "Text"],
Cell[27235, 717, 4867, 129, 335, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[32139, 851, 107, 1, 29, "Subsubsection"],
Cell[32249, 854, 4665, 116, 335, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[36963, 976, 105, 1, 64, "Section"],
Cell[37071, 979, 299, 8, 34, "Text"],
Cell[CellGroupData[{
Cell[37395, 991, 104, 1, 44, "Subsection"],
Cell[CellGroupData[{
Cell[37524, 996, 19960, 494, 876, "Input"],
Cell[57487, 1492, 8401, 235, 124, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[65937, 1733, 223, 4, 44, "Subsection"],
Cell[CellGroupData[{
Cell[66185, 1741, 3455, 84, 148, "Input"],
Cell[69643, 1827, 2087, 48, 28, "Output"],
Cell[71733, 1877, 26249, 685, 267, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[98031, 2568, 165, 3, 44, "Subsection"],
Cell[CellGroupData[{
Cell[98221, 2575, 109, 1, 35, "Subsubsection"],
Cell[CellGroupData[{
Cell[98355, 2580, 2309, 58, 149, "Input"],
Cell[100667, 2640, 939, 22, 35, "Output"],
Cell[101609, 2664, 984, 23, 42, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[102642, 2693, 212, 4, 35, "Subsubsection"],
Cell[102857, 2699, 8618, 205, 420, "Input"],
Cell[CellGroupData[{
Cell[111500, 2908, 573, 9, 28, "Input"],
Cell[112076, 2919, 1407, 34, 34, "Output"]
}, Open  ]],
Cell[113498, 2956, 157, 3, 28, "Input"],
Cell[113658, 2961, 682, 15, 63, "Input"],
Cell[CellGroupData[{
Cell[114365, 2980, 4525, 115, 182, "Input"],
Cell[118893, 3097, 5138, 137, 181, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[124068, 3239, 152, 4, 28, "Input"],
Cell[124223, 3245, 1932, 45, 171, "Output"]
}, Open  ]],
Cell[126170, 3293, 3540, 83, 233, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[129747, 3381, 405, 9, 59, "Subsubsection"],
Cell[CellGroupData[{
Cell[130177, 3394, 5492, 118, 233, "Input"],
Cell[135672, 3514, 5382, 88, 743, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[141103, 3608, 174, 2, 35, "Subsubsection"],
Cell[CellGroupData[{
Cell[141302, 3614, 14585, 319, 981, "Input"],
Cell[155890, 3935, 295, 5, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[156222, 3945, 168, 2, 28, "Input"],
Cell[156393, 3949, 167, 2, 28, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
